[
    {
        "id": "e8d4d920.35344",
        "type": "tab",
        "label": "Main",
        "disabled": false,
        "info": ""
    },
    {
        "id": "21b3da63.2cef2e",
        "type": "subflow",
        "name": "RPi Monitoring",
        "info": "",
        "category": "",
        "in": [],
        "out": [],
        "env": [],
        "color": "#87A980",
        "icon": "node-red/status.svg"
    },
    {
        "id": "130e0533.4f1813",
        "type": "subflow",
        "name": "Acquisition actuation",
        "info": "",
        "category": "",
        "in": [],
        "out": [],
        "env": [],
        "color": "#A6BBCF",
        "icon": "font-awesome/fa-camera"
    },
    {
        "id": "1bc3f9f9.1ee996",
        "type": "subflow",
        "name": "Acquisition inputs",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 40,
                "y": 40,
                "wires": [
                    {
                        "id": "8887f3e7.e79b5"
                    },
                    {
                        "id": "14be4afa.2ba67d"
                    },
                    {
                        "id": "600c2b46.83db14"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 740,
                "y": 40,
                "wires": [
                    {
                        "id": "d3caa802.6f22d8",
                        "port": 0
                    },
                    {
                        "id": "3a773a31.a6caee",
                        "port": 0
                    },
                    {
                        "id": "5d4c755a.800b44",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "color": "#A6BBCF",
        "icon": "node-red-contrib-camerapi/photo.png"
    },
    {
        "id": "714bd4fe.163ab4",
        "type": "subflow",
        "name": "Process metadata",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 40,
                "y": 80,
                "wires": [
                    {
                        "id": "706715a3.5ad1c4"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 700,
                "y": 80,
                "wires": [
                    {
                        "id": "7cdadcd1.736f04",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "color": "#DDAA99"
    },
    {
        "id": "bee3b478.ef4b88",
        "type": "subflow",
        "name": "MQTT Receive & Plot",
        "info": "# MQTT Topics follows this architecture:\n\n - actuator :  This topic adresses the stepper control thread\n               No publication under this topic should happen from Python\n   - actuator/pump :   Control of the pump\n                       The message is something like \"FORWARD 10 1\"\n                       to move 10mL forward at 1mL/min\n                       Receive only\n   - actuator/focus :  Control of the focus stage\n                       The message is something like \"UP 10\"\n                       to move up 10mm\n                       Receive only\n - imager/image :      This topic adresses the imaging thread\n                       Receive only\n - status :    This topics sends feedback to Node-Red\n               No publication or receive at this level\n   - status/pump :   State of the pump\n                     Is one of Start, Done, Interrupted\n                     Publish only\n   - status/focus :  State of the focus stage\n                     Is one of Start, Done, Interrupted\n                     Publish only\n   - status/imager : State of the imager\n                     Is one of Start, Completed or 12_11_15_0.1.jpg has been imaged.\n                     Publish only\n   - status/segmentation :   Status of the segmentation\n       - status/segmentation/name\n       - status/segmentation/object_id\n       - status/segmentation/metric\n",
        "category": "",
        "in": [],
        "out": [],
        "env": [],
        "color": "#F3B567",
        "icon": "node-red/bridge.svg"
    },
    {
        "id": "9c3e6ad4.7471a8",
        "type": "subflow",
        "name": "System Commands",
        "info": "",
        "category": "",
        "in": [],
        "out": [],
        "env": [],
        "color": "#FFCC66",
        "icon": "node-red-dashboard/ui_button.png"
    },
    {
        "id": "1a447be0.198674",
        "type": "subflow",
        "name": "Object metadata",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 160,
                "wires": [
                    {
                        "id": "5cdbcd15.17ec94"
                    },
                    {
                        "id": "c2ccc2e1.a697f8"
                    },
                    {
                        "id": "b3e8d04.7c83d3"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1060,
                "y": 159,
                "wires": [
                    {
                        "id": "f435f66d.26d73",
                        "port": 0
                    },
                    {
                        "id": "79026dc4.133a7c",
                        "port": 0
                    }
                ]
            },
            {
                "x": 1060,
                "y": 59,
                "wires": [
                    {
                        "id": "9c08f843.b1e1b",
                        "port": 0
                    },
                    {
                        "id": "157ba5ca.c88a52",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "color": "#DDAA99"
    },
    {
        "id": "758bc08f.c57318",
        "type": "subflow",
        "name": "Acquisition metadata",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 50,
                "y": 30,
                "wires": [
                    {
                        "id": "f3658d30.b8448"
                    },
                    {
                        "id": "5acd51d4.4ab13"
                    },
                    {
                        "id": "de2c90cf.b73b08"
                    },
                    {
                        "id": "5e3dec55.881074"
                    },
                    {
                        "id": "d3ca8847.4d1ae"
                    },
                    {
                        "id": "1f133196.96564e"
                    },
                    {
                        "id": "3414b477.4d711c"
                    },
                    {
                        "id": "a52e7caf.6bde48"
                    },
                    {
                        "id": "68fa1227.dbdd5c"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 740,
                "y": 40,
                "wires": [
                    {
                        "id": "98d1f331.a06938",
                        "port": 0
                    },
                    {
                        "id": "3b9700c4.b93ec",
                        "port": 0
                    },
                    {
                        "id": "42505cbd.f02b1c",
                        "port": 0
                    },
                    {
                        "id": "2f9ae002.b4c96",
                        "port": 0
                    },
                    {
                        "id": "c86d98d4.c56538",
                        "port": 0
                    },
                    {
                        "id": "13b51e1e.1f603a",
                        "port": 0
                    },
                    {
                        "id": "6c391d10.2f9744",
                        "port": 0
                    },
                    {
                        "id": "163df12e.f73f5f",
                        "port": 0
                    }
                ]
            },
            {
                "x": 900,
                "y": 360,
                "wires": [
                    {
                        "id": "701120fd.c5516",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "color": "#DDAA99"
    },
    {
        "id": "977131e7.c2e76",
        "type": "subflow",
        "name": "Pump actuation",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 40,
                "y": 40,
                "wires": [
                    {
                        "id": "cc757614.c8fc58"
                    },
                    {
                        "id": "8ae06f9a.4b253"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 700,
                "y": 40,
                "wires": [
                    {
                        "id": "b8bf2a9.be099d8",
                        "port": 0
                    },
                    {
                        "id": "f1b85f22.ac673",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "color": "#A6BBCF",
        "icon": "font-awesome/fa-recycle"
    },
    {
        "id": "a0f9bde.423644",
        "type": "subflow",
        "name": "Focus actuation",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 40,
                "y": 40,
                "wires": [
                    {
                        "id": "411211be.745ef8"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1040,
                "y": 40,
                "wires": [
                    {
                        "id": "b69e435f.b93558",
                        "port": 0
                    },
                    {
                        "id": "d9930546.489a58",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "color": "#A6BBCF",
        "icon": "node-red/sort.svg"
    },
    {
        "id": "81483277.2521e",
        "type": "subflow",
        "name": "Sample metadata",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 40,
                "y": 40,
                "wires": [
                    {
                        "id": "d027a6bf.7049e8"
                    },
                    {
                        "id": "45911c98.2bd83c"
                    },
                    {
                        "id": "5a811caf.0f3144"
                    },
                    {
                        "id": "1e09a4ab.72996b"
                    },
                    {
                        "id": "a3272681.f271c8"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 840,
                "y": 40,
                "wires": [
                    {
                        "id": "adaccbb2.320458",
                        "port": 0
                    },
                    {
                        "id": "a63c1b66.f9a77",
                        "port": 0
                    },
                    {
                        "id": "67fc8b3f.96c6cc",
                        "port": 0
                    },
                    {
                        "id": "8cc6c6f1.65bf28",
                        "port": 0
                    },
                    {
                        "id": "91a896c8.7c9fb8",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "color": "#DDAA99"
    },
    {
        "id": "4b508eab.dccae8",
        "type": "subflow",
        "name": "Segmentation control",
        "info": "",
        "category": "",
        "in": [],
        "out": [],
        "env": [],
        "color": "#D7D7A0",
        "icon": "node-red/db.svg"
    },
    {
        "id": "674362b7.9b6574",
        "type": "subflow",
        "name": "Camera settings",
        "info": "",
        "category": "",
        "in": [],
        "out": [],
        "env": [],
        "color": "#3FADB5",
        "icon": "font-awesome/fa-camera"
    },
    {
        "id": "d95291dc.83b0b8",
        "type": "subflow",
        "name": "Python Startup",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 160,
                "y": 40,
                "wires": [
                    {
                        "id": "afa9f4b.2e77988"
                    },
                    {
                        "id": "35ea3cf0.a398ac"
                    },
                    {
                        "id": "a776b9fc.d542e8"
                    }
                ]
            }
        ],
        "out": [],
        "env": [],
        "color": "#DDAA99"
    },
    {
        "id": "779606c9.19d2b8",
        "type": "ui_group",
        "z": "",
        "name": "Monitor RPi",
        "tab": "a3de84cd.c01b6",
        "order": 13,
        "disp": true,
        "width": "24",
        "collapse": false
    },
    {
        "id": "75a5ce1f.728d",
        "type": "ui_group",
        "z": "",
        "name": "Acquisition actuation",
        "tab": "d10d9d99.00f4b8",
        "order": 11,
        "disp": true,
        "width": 24,
        "collapse": false
    },
    {
        "id": "758f41b8.1680c8",
        "type": "ui_group",
        "z": "",
        "name": "Acquisition inputs",
        "tab": "d10d9d99.00f4b8",
        "order": 10,
        "disp": true,
        "width": "24",
        "collapse": false
    },
    {
        "id": "eef6f881.7b3b38",
        "type": "ui_group",
        "z": "",
        "name": "Process metadata",
        "tab": "d10d9d99.00f4b8",
        "order": 9,
        "disp": true,
        "width": 24,
        "collapse": false
    },
    {
        "id": "6d1af0ab.7b4a18",
        "type": "ui_group",
        "z": "",
        "name": "MQTT Plots",
        "tab": "d10d9d99.00f4b8",
        "order": 14,
        "disp": true,
        "width": "24",
        "collapse": false
    },
    {
        "id": "ab1d06d6.bf9898",
        "type": "ui_group",
        "z": "",
        "name": "Object metadata",
        "tab": "d10d9d99.00f4b8",
        "order": 2,
        "disp": true,
        "width": "24",
        "collapse": true
    },
    {
        "id": "4361c3b6.e2b7a4",
        "type": "ui_group",
        "z": "",
        "name": "Acquisition metadata",
        "tab": "d10d9d99.00f4b8",
        "order": 3,
        "disp": true,
        "width": "24",
        "collapse": true
    },
    {
        "id": "34f03c4a.abdf94",
        "type": "ui_group",
        "z": "",
        "name": "Pump actuation",
        "tab": "d10d9d99.00f4b8",
        "order": 8,
        "disp": true,
        "width": "24",
        "collapse": false
    },
    {
        "id": "de7c8e82.7faa98",
        "type": "ui_group",
        "z": "",
        "name": "Focus actuation",
        "tab": "d10d9d99.00f4b8",
        "order": 7,
        "disp": true,
        "width": "24",
        "collapse": false
    },
    {
        "id": "8dc3722c.06efa8",
        "type": "mqtt-broker",
        "z": "",
        "name": "",
        "broker": "0.0.0.0",
        "port": "1883",
        "clientid": "Client_node",
        "usetls": false,
        "compatmode": false,
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "closeTopic": "",
        "closeQos": "0",
        "closePayload": "",
        "willTopic": "",
        "willQos": "0",
        "willPayload": ""
    },
    {
        "id": "71c63dd4.311c44",
        "type": "ui_group",
        "z": "",
        "name": "Sample Metadata",
        "tab": "d10d9d99.00f4b8",
        "order": 1,
        "disp": true,
        "width": "24",
        "collapse": true
    },
    {
        "id": "d10d9d99.00f4b8",
        "type": "ui_tab",
        "z": "",
        "name": "Acquisition",
        "icon": "fa-eyedropper",
        "order": 1,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "59434d8d.70ed94",
        "type": "ui_group",
        "z": "",
        "name": "Streaming camera",
        "tab": "d10d9d99.00f4b8",
        "order": 5,
        "disp": true,
        "width": "24",
        "collapse": false
    },
    {
        "id": "9b06d49f.aa144",
        "type": "ui_base",
        "theme": {
            "name": "theme-dark",
            "lightTheme": {
                "default": "#0094CE",
                "baseColor": "#0094CE",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "darkTheme": {
                "default": "#097479",
                "baseColor": "#097479",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "customTheme": {
                "name": "Untitled Theme 1",
                "default": "#4B7930",
                "baseColor": "#4B7930",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
            },
            "themeState": {
                "base-color": {
                    "default": "#097479",
                    "value": "#097479",
                    "edited": false
                },
                "page-titlebar-backgroundColor": {
                    "value": "#097479",
                    "edited": false
                },
                "page-backgroundColor": {
                    "value": "#111111",
                    "edited": false
                },
                "page-sidebar-backgroundColor": {
                    "value": "#333333",
                    "edited": false
                },
                "group-textColor": {
                    "value": "#0eb8c0",
                    "edited": false
                },
                "group-borderColor": {
                    "value": "#555555",
                    "edited": false
                },
                "group-backgroundColor": {
                    "value": "#333333",
                    "edited": false
                },
                "widget-textColor": {
                    "value": "#eeeeee",
                    "edited": false
                },
                "widget-backgroundColor": {
                    "value": "#097479",
                    "edited": false
                },
                "widget-borderColor": {
                    "value": "#333333",
                    "edited": false
                },
                "base-font": {
                    "value": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
                }
            },
            "angularTheme": {
                "primary": "indigo",
                "accents": "blue",
                "warn": "red",
                "background": "grey"
            }
        },
        "site": {
            "name": "PlanktoScope Dashboard",
            "hideToolbar": "false",
            "allowSwipe": "true",
            "lockMenu": "false",
            "allowTempTheme": "true",
            "dateFormat": "DD/MM/YYYY",
            "sizes": {
                "sx": 48,
                "sy": 48,
                "gx": 6,
                "gy": 6,
                "cx": 6,
                "cy": 6,
                "px": 0,
                "py": 0
            }
        }
    },
    {
        "id": "a3de84cd.c01b6",
        "type": "ui_tab",
        "z": "",
        "name": "Management",
        "icon": "dashboard",
        "order": 2,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "adcd0ef7.81a7f8",
        "type": "ui_group",
        "z": "",
        "name": "RPi commands",
        "tab": "a3de84cd.c01b6",
        "order": 1,
        "disp": true,
        "width": 13,
        "collapse": false
    },
    {
        "id": "566dcd6a.03db74",
        "type": "ui_group",
        "z": "",
        "name": "Segmentation control",
        "tab": "d10d9d99.00f4b8",
        "order": 12,
        "disp": true,
        "width": "24",
        "collapse": false
    },
    {
        "id": "e8b67968.dea6",
        "type": "ui_group",
        "z": "",
        "name": "Camera settings",
        "tab": "d10d9d99.00f4b8",
        "order": 6,
        "disp": true,
        "width": "24",
        "collapse": true
    },
    {
        "id": "f1dc35d9.99b9f8",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "adcd0ef7.81a7f8",
        "order": 2,
        "width": 13,
        "height": 1
    },
    {
        "id": "248136a7.29b74a",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "adcd0ef7.81a7f8",
        "order": 4,
        "width": 5,
        "height": 1
    },
    {
        "id": "7b7849e8.363288",
        "type": "ui_group",
        "z": "1a447be0.198674",
        "name": "GPS",
        "tab": "d10d9d99.00f4b8",
        "order": 4,
        "disp": true,
        "width": "24",
        "collapse": false
    },
    {
        "id": "91acd434.6205",
        "type": "ui_group",
        "z": "bee3b478.ef4b88",
        "name": "Status",
        "tab": "d10d9d99.00f4b8",
        "order": 13,
        "disp": true,
        "width": "24",
        "collapse": true
    },
    {
        "id": "4e3f24b.177a7dc",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "de7c8e82.7faa98",
        "order": 7,
        "width": 6,
        "height": 1
    },
    {
        "id": "4bb924fe.fc097c",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "de7c8e82.7faa98",
        "order": 9,
        "width": 10,
        "height": 1
    },
    {
        "id": "98b8d88c.dc5d",
        "type": "exec",
        "z": "21b3da63.2cef2e",
        "command": "free -m | grep \"Mem\" | awk -F ' ' '{print $3}'",
        "addpay": false,
        "append": "",
        "useSpawn": "",
        "timer": "",
        "name": "Get memory used",
        "x": 430,
        "y": 100,
        "wires": [
            [
                "ddf0e242.88258",
                "f1a7a389.2cc528"
            ],
            [],
            []
        ]
    },
    {
        "id": "34130a77.042d46",
        "type": "inject",
        "z": "21b3da63.2cef2e",
        "name": "",
        "repeat": "1",
        "crontab": "",
        "once": false,
        "onceDelay": "",
        "topic": "",
        "payload": "",
        "payloadType": "num",
        "x": 210,
        "y": 100,
        "wires": [
            [
                "98b8d88c.dc5d"
            ]
        ]
    },
    {
        "id": "ddf0e242.88258",
        "type": "ui_chart",
        "z": "21b3da63.2cef2e",
        "name": "Memory Load Chart",
        "group": "779606c9.19d2b8",
        "order": 8,
        "width": 19,
        "height": 4,
        "label": "Memory Load Chart",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "bezier",
        "nodata": "",
        "dot": true,
        "ymin": "",
        "ymax": "",
        "removeOlder": "20",
        "removeOlderPoints": "",
        "removeOlderUnit": "60",
        "cutout": 0,
        "useOneColor": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "useOldStyle": false,
        "outputs": 1,
        "x": 650,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "f1a7a389.2cc528",
        "type": "ui_gauge",
        "z": "21b3da63.2cef2e",
        "name": "Memory Load Donut",
        "group": "779606c9.19d2b8",
        "order": 7,
        "width": 5,
        "height": 4,
        "gtype": "donut",
        "title": "Memory Load Donut",
        "label": "Mo",
        "format": "{{value}}",
        "min": 0,
        "max": "4000",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "1000",
        "seg2": "2000",
        "x": 660,
        "y": 80,
        "wires": []
    },
    {
        "id": "30fcb8f6.12fe",
        "type": "ui_gauge",
        "z": "21b3da63.2cef2e",
        "name": "CPU Temp Donut",
        "group": "779606c9.19d2b8",
        "order": 1,
        "width": 5,
        "height": 4,
        "gtype": "donut",
        "title": "CPU Temp Donut",
        "label": "C",
        "format": "{{value}}",
        "min": "35",
        "max": "55",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "x": 650,
        "y": 160,
        "wires": []
    },
    {
        "id": "81105630.ed06e8",
        "type": "exec",
        "z": "21b3da63.2cef2e",
        "command": "vcgencmd measure_temp | tr -d \"temp=\" | tr -d \"'C\" | tr -d \"\\n\"",
        "addpay": false,
        "append": "",
        "useSpawn": "",
        "timer": "",
        "name": "RPi Temp.",
        "x": 410,
        "y": 180,
        "wires": [
            [
                "59fe3900.da6c8",
                "30fcb8f6.12fe",
                "d70d3e88.eaca48"
            ],
            [],
            []
        ]
    },
    {
        "id": "d70d3e88.eaca48",
        "type": "ui_chart",
        "z": "21b3da63.2cef2e",
        "name": "CPU Temp Chart",
        "group": "779606c9.19d2b8",
        "order": 2,
        "width": 19,
        "height": 4,
        "label": "CPU Temp Chart",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "",
        "ymax": "",
        "removeOlder": "20",
        "removeOlderPoints": "200",
        "removeOlderUnit": "60",
        "cutout": 0,
        "useOneColor": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "useOldStyle": true,
        "outputs": 1,
        "x": 650,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "6e383122.133d5",
        "type": "python3-function",
        "z": "21b3da63.2cef2e",
        "name": "fan.py",
        "func": "#!/usr/bin/python\nimport smbus\nimport sys\n\nstate = msg[\"payload\"]\n\nbus = smbus.SMBus(1)\n\nDEVICE_ADDRESS = 0x0d\n\nif state == \"off\":\n    bus.write_byte_data(DEVICE_ADDRESS, 0x08, 0x00)\n    bus.write_byte_data(DEVICE_ADDRESS, 0x08, 0x00)\nif state == \"on\":\n    bus.write_byte_data(DEVICE_ADDRESS, 0x08, 0x01)\n    bus.write_byte_data(DEVICE_ADDRESS, 0x08, 0x01)",
        "outputs": 1,
        "x": 1290,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "59fe3900.da6c8",
        "type": "switch",
        "z": "21b3da63.2cef2e",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "45",
                "vt": "num"
            },
            {
                "t": "lte",
                "v": "35",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 950,
        "y": 140,
        "wires": [
            [
                "1d11bfc1.ad4788"
            ],
            [
                "5aeccc80.5e9c54"
            ]
        ]
    },
    {
        "id": "5aeccc80.5e9c54",
        "type": "change",
        "z": "21b3da63.2cef2e",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "off",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1120,
        "y": 160,
        "wires": [
            [
                "6e383122.133d5"
            ]
        ]
    },
    {
        "id": "8338294b.8082d",
        "type": "inject",
        "z": "21b3da63.2cef2e",
        "name": "",
        "repeat": "5",
        "crontab": "",
        "once": false,
        "onceDelay": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 190,
        "y": 260,
        "wires": [
            [
                "e7fe62ae.efb4f",
                "eba0a98a.e4d56",
                "81105630.ed06e8"
            ]
        ]
    },
    {
        "id": "e7fe62ae.efb4f",
        "type": "exec",
        "z": "21b3da63.2cef2e",
        "command": "top -d 0.5 -b -n2 | grep \"Cpu(s)\"|tail -n 1 | awk '{print $2 + $4}' | tr -d \"\\n\"",
        "addpay": false,
        "append": "",
        "useSpawn": "",
        "timer": "",
        "name": "CPU Load",
        "x": 410,
        "y": 260,
        "wires": [
            [
                "aa4065d2.14a66",
                "a9aef217.f0aae"
            ],
            [],
            []
        ]
    },
    {
        "id": "eba0a98a.e4d56",
        "type": "exec",
        "z": "21b3da63.2cef2e",
        "command": "free | grep Mem | awk '{print 100*($4+$6+$7)/$2}' | awk -F \".\" '{print $1}' | tr -d \"\\n\"",
        "addpay": false,
        "append": "",
        "useSpawn": "",
        "timer": "",
        "name": "Free Memory",
        "x": 410,
        "y": 340,
        "wires": [
            [
                "539c69d4.618bd8",
                "96ceb8d7.0ed66"
            ],
            [],
            []
        ]
    },
    {
        "id": "aa4065d2.14a66",
        "type": "ui_gauge",
        "z": "21b3da63.2cef2e",
        "name": "CPU Load Donut",
        "group": "779606c9.19d2b8",
        "order": 5,
        "width": 5,
        "height": 4,
        "gtype": "donut",
        "title": "CPU Load Donut",
        "label": "CPU",
        "format": "{{value}}",
        "min": 0,
        "max": "100",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "x": 650,
        "y": 240,
        "wires": []
    },
    {
        "id": "539c69d4.618bd8",
        "type": "ui_gauge",
        "z": "21b3da63.2cef2e",
        "name": "Free memory Donut",
        "group": "779606c9.19d2b8",
        "order": 9,
        "width": 5,
        "height": 4,
        "gtype": "donut",
        "title": "Free memory Donut",
        "label": "RAM",
        "format": "{{value}}",
        "min": 0,
        "max": "200",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "x": 650,
        "y": 320,
        "wires": []
    },
    {
        "id": "9031b9ea.483fa8",
        "type": "exec",
        "z": "21b3da63.2cef2e",
        "command": "df -h | grep /dev/root | awk -F ' ' '{print $3}' | tr -d G | tr \"\\n$\" \"\\ \" |  sed 's/,/./' | tr -d \" \" ",
        "addpay": false,
        "append": "",
        "useSpawn": "",
        "timer": "",
        "name": "Disk Usage",
        "x": 410,
        "y": 420,
        "wires": [
            [
                "32eded3f.f3b42a",
                "49c71440.02a25c"
            ],
            [],
            []
        ]
    },
    {
        "id": "32eded3f.f3b42a",
        "type": "ui_gauge",
        "z": "21b3da63.2cef2e",
        "name": "Disk Usage Donut",
        "group": "779606c9.19d2b8",
        "order": 3,
        "width": 5,
        "height": 4,
        "gtype": "donut",
        "title": "Disk Usage Donut",
        "label": "Go",
        "format": "{{value}}",
        "min": 0,
        "max": "256",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "x": 650,
        "y": 400,
        "wires": []
    },
    {
        "id": "a9aef217.f0aae",
        "type": "ui_chart",
        "z": "21b3da63.2cef2e",
        "name": "CPU Load Chart",
        "group": "779606c9.19d2b8",
        "order": 6,
        "width": 19,
        "height": 4,
        "label": "CPU Load Chart",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "",
        "ymax": "",
        "removeOlder": "20",
        "removeOlderPoints": "",
        "removeOlderUnit": "60",
        "cutout": 0,
        "useOneColor": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "useOldStyle": true,
        "outputs": 1,
        "x": 640,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "96ceb8d7.0ed66",
        "type": "ui_chart",
        "z": "21b3da63.2cef2e",
        "name": "Free memory Chart",
        "group": "779606c9.19d2b8",
        "order": 10,
        "width": 19,
        "height": 4,
        "label": "Free memory Chart",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "",
        "ymax": "",
        "removeOlder": "20",
        "removeOlderPoints": "",
        "removeOlderUnit": "60",
        "cutout": 0,
        "useOneColor": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "useOldStyle": true,
        "outputs": 1,
        "x": 650,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "fb614565.7a2108",
        "type": "inject",
        "z": "21b3da63.2cef2e",
        "name": "",
        "repeat": "60",
        "crontab": "",
        "once": false,
        "onceDelay": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 190,
        "y": 420,
        "wires": [
            [
                "9031b9ea.483fa8"
            ]
        ]
    },
    {
        "id": "49c71440.02a25c",
        "type": "ui_chart",
        "z": "21b3da63.2cef2e",
        "name": "Disk Usage Chart",
        "group": "779606c9.19d2b8",
        "order": 4,
        "width": 19,
        "height": 4,
        "label": "Disk Usage Chart",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "",
        "ymax": "",
        "removeOlder": "20",
        "removeOlderPoints": "",
        "removeOlderUnit": "60",
        "cutout": 0,
        "useOneColor": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "useOldStyle": true,
        "outputs": 1,
        "x": 650,
        "y": 440,
        "wires": [
            []
        ]
    },
    {
        "id": "1d11bfc1.ad4788",
        "type": "change",
        "z": "21b3da63.2cef2e",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "on",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1120,
        "y": 120,
        "wires": [
            [
                "6e383122.133d5"
            ]
        ]
    },
    {
        "id": "4b489713.ccde5",
        "type": "ui_button",
        "z": "130e0533.4f1813",
        "name": "",
        "group": "75a5ce1f.728d",
        "order": 1,
        "width": 16,
        "height": 1,
        "passthru": false,
        "label": "Start Acquisition",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "imager/image",
        "x": 200,
        "y": 100,
        "wires": [
            [
                "52ea7d01.711034",
                "40c12463.a1f84c"
            ]
        ]
    },
    {
        "id": "c9f510c0.7d1328",
        "type": "function",
        "z": "130e0533.4f1813",
        "name": "image.js",
        "func": "state = global.get(\"state\");\nglobal.set('img_counter',0);\nglobal.set('obj_counter',0);\nif (state === null){state=\"free\"}\n\nvar sleep_before= global.get(\"custom_sleep_before\");\nvar nb_step= global.get(\"custom_nb_step\");\nvar nb_frame= global.get(\"custom_nb_frame\");\n\nif (sleep_before === undefined || sleep_before === \"\" || sleep_before === null) {\n    msg.topic = \"Missing entry :\";\n    msg.payload = \"Duration before the acquisition\";\n    \n}else if (nb_step === undefined || nb_step === \"\" || nb_step === null) {\n    msg.topic = \"Missing entry :\";\n    msg.payload = \"Number of step in between two frames\";\n    \n}else if (nb_frame === undefined || nb_frame === \"\" || nb_frame === null) {\n    msg.topic = \"Missing entry :\";\n    msg.payload = \"Number of image to save\";\n    \n}else {\n    msg.payload={\"action\":\"image\", \n                    \"sleep\":sleep_before,\n                    \"volume\":nb_step,\n                    \"nb_frame\":nb_frame,\n                }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 560,
        "y": 100,
        "wires": [
            [
                "d6ebaa2.ea21d58"
            ]
        ],
        "info": "### Focusing\n##### focus.py `nb_step` `orientation`\n\n- `nb_step` : **integer** (from 1 to 100000) - number of step to perform by the stage (about 31um/step)\n- `orientation` : **string** - orientation of the focus either `up` or `down`\n\nExample:\n\n    python3.7 $HOME/PlanktonScope/scripts/focus.py 650 up\n"
    },
    {
        "id": "d6ebaa2.ea21d58",
        "type": "switch",
        "z": "130e0533.4f1813",
        "name": "",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "imager/image",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "Missing entry :",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 710,
        "y": 100,
        "wires": [
            [
                "c3e50240.82aa58"
            ],
            [
                "20e0a8c8.edbeb"
            ]
        ]
    },
    {
        "id": "20e0a8c8.edbeb",
        "type": "ui_toast",
        "z": "130e0533.4f1813",
        "position": "dialog",
        "displayTime": "3",
        "highlight": "",
        "sendall": true,
        "outputs": 1,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "topic": "",
        "name": "",
        "x": 870,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "c3e50240.82aa58",
        "type": "mqtt out",
        "z": "130e0533.4f1813",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "broker": "8dc3722c.06efa8",
        "x": 850,
        "y": 60,
        "wires": []
    },
    {
        "id": "3a4450b1.4459a8",
        "type": "ui_button",
        "z": "130e0533.4f1813",
        "name": "Stop Acquisition",
        "group": "75a5ce1f.728d",
        "order": 2,
        "width": 8,
        "height": 1,
        "passthru": true,
        "label": "STOP ACQUISITION",
        "tooltip": "",
        "color": "",
        "bgcolor": "#AD1625",
        "icon": "",
        "payload": "{\"action\":\"stop\"}",
        "payloadType": "json",
        "topic": "imager/image",
        "x": 200,
        "y": 140,
        "wires": [
            [
                "d74210ef.edc15"
            ]
        ]
    },
    {
        "id": "d74210ef.edc15",
        "type": "mqtt out",
        "z": "130e0533.4f1813",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "broker": "8dc3722c.06efa8",
        "x": 390,
        "y": 140,
        "wires": []
    },
    {
        "id": "d3caa802.6f22d8",
        "type": "ui_text_input",
        "z": "1bc3f9f9.1ee996",
        "name": "custom_nb_step",
        "label": "Volume in mL between two images",
        "tooltip": "TODO This should be in mm ?",
        "group": "758f41b8.1680c8",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "number",
        "delay": 300,
        "topic": "custom_nb_step",
        "x": 540,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "5d4c755a.800b44",
        "type": "ui_text_input",
        "z": "1bc3f9f9.1ee996",
        "name": "custom_nb_frame",
        "label": "Number of images per acquisition",
        "tooltip": "",
        "group": "758f41b8.1680c8",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "number",
        "delay": 300,
        "topic": "custom_nb_frame",
        "x": 530,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "8887f3e7.e79b5",
        "type": "function",
        "z": "1bc3f9f9.1ee996",
        "name": "get custom_nb_step",
        "func": "msg.payload = msg.payload.custom_nb_step;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 220,
        "y": 80,
        "wires": [
            [
                "d3caa802.6f22d8"
            ]
        ]
    },
    {
        "id": "600c2b46.83db14",
        "type": "function",
        "z": "1bc3f9f9.1ee996",
        "name": "get custom_nb_frame",
        "func": "msg.payload = msg.payload.custom_nb_frame;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 220,
        "y": 120,
        "wires": [
            [
                "5d4c755a.800b44"
            ]
        ]
    },
    {
        "id": "14be4afa.2ba67d",
        "type": "function",
        "z": "1bc3f9f9.1ee996",
        "name": "get custom_sleep_before",
        "func": "msg.payload = msg.payload.custom_sleep_before;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 230,
        "y": 40,
        "wires": [
            [
                "3a773a31.a6caee"
            ]
        ]
    },
    {
        "id": "3a773a31.a6caee",
        "type": "ui_text_input",
        "z": "1bc3f9f9.1ee996",
        "name": "custom_sleep_before",
        "label": "Duration before the acquisition (s)",
        "tooltip": "",
        "group": "758f41b8.1680c8",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "number",
        "delay": 300,
        "topic": "custom_sleep_before",
        "x": 520,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "7cdadcd1.736f04",
        "type": "ui_text_input",
        "z": "714bd4fe.163ab4",
        "name": "process_id",
        "label": "Id of the process",
        "tooltip": "",
        "group": "eef6f881.7b3b38",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "number",
        "delay": 300,
        "topic": "process_id",
        "x": 550,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "706715a3.5ad1c4",
        "type": "function",
        "z": "714bd4fe.163ab4",
        "name": "get process_id",
        "func": "msg.payload = msg.payload.process_id+1;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 200,
        "y": 80,
        "wires": [
            [
                "7cdadcd1.736f04"
            ]
        ]
    },
    {
        "id": "8cb80d95.13d2e8",
        "type": "mqtt in",
        "z": "bee3b478.ef4b88",
        "name": "",
        "topic": "status/#",
        "qos": "0",
        "datatype": "json",
        "broker": "8dc3722c.06efa8",
        "x": 70,
        "y": 300,
        "wires": [
            [
                "2aa5b118.d75f2e",
                "f6fd015e.5c1fe"
            ]
        ]
    },
    {
        "id": "ecedbda4.fed15",
        "type": "switch",
        "z": "bee3b478.ef4b88",
        "name": "topic filter",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "status/pump",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "status/focus",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "status/imager",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "status/segmenter",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 4,
        "x": 360,
        "y": 300,
        "wires": [
            [
                "117aad13.53e11b",
                "d700c8a1.2d1f48"
            ],
            [
                "117aad13.53e11b",
                "dc72e121.0aacd"
            ],
            [
                "af9a1d81.c21fa8",
                "5a159d39.3bdca4"
            ],
            [
                "30a9de16.d55cda",
                "89058790.909e7"
            ]
        ]
    },
    {
        "id": "af9a1d81.c21fa8",
        "type": "switch",
        "z": "bee3b478.ef4b88",
        "name": "Imaging state",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "else"
            },
            {
                "t": "jsonata_exp",
                "v": "$contains(msg.payload.status, \"jpg\")\t",
                "vt": "jsonata"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 640,
        "y": 340,
        "wires": [
            [
                "117aad13.53e11b"
            ],
            [
                "a636cac5.e28448"
            ]
        ]
    },
    {
        "id": "a636cac5.e28448",
        "type": "function",
        "z": "bee3b478.ef4b88",
        "name": "img_counter.js",
        "func": "img_counter=global.get('img_counter')\nimg_counter=img_counter+1\nglobal.set('img_counter',img_counter)\nmsg.payload = img_counter\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 900,
        "y": 400,
        "wires": [
            [
                "abd84e73.aefc9"
            ]
        ]
    },
    {
        "id": "f71d0cda.0a4f88",
        "type": "function",
        "z": "bee3b478.ef4b88",
        "name": "obj_counter.js",
        "func": "obj_counter=global.get('obj_counter')\nobj_counter=obj_counter+1\nglobal.set('obj_counter',obj_counter)\nmsg.payload = obj_counter\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 900,
        "y": 500,
        "wires": [
            [
                "d0d14f00.e2ff88"
            ]
        ]
    },
    {
        "id": "abd84e73.aefc9",
        "type": "ui_chart",
        "z": "bee3b478.ef4b88",
        "name": "img_counter",
        "group": "6d1af0ab.7b4a18",
        "order": 1,
        "width": 24,
        "height": 2,
        "label": "image counter",
        "chartType": "horizontalBar",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "",
        "ymax": "",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "3600",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "useOldStyle": false,
        "outputs": 1,
        "x": 1370,
        "y": 400,
        "wires": [
            []
        ]
    },
    {
        "id": "30a9de16.d55cda",
        "type": "switch",
        "z": "bee3b478.ef4b88",
        "name": "Segmenter",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "status/segmenter",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "status/segmenter/name",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "status/segmenter/object_id",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "status/segmenter/metric",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 4,
        "x": 630,
        "y": 480,
        "wires": [
            [
                "117aad13.53e11b"
            ],
            [
                "c2d35803.b5024"
            ],
            [
                "f71d0cda.0a4f88"
            ],
            [
                "87d402c5.c02008"
            ]
        ]
    },
    {
        "id": "d0d14f00.e2ff88",
        "type": "ui_chart",
        "z": "bee3b478.ef4b88",
        "name": "obj_counter",
        "group": "6d1af0ab.7b4a18",
        "order": 2,
        "width": 24,
        "height": 2,
        "label": "obj_counter",
        "chartType": "horizontalBar",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "",
        "ymax": "",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "3600",
        "cutout": 0,
        "useOneColor": true,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "useOldStyle": false,
        "outputs": 1,
        "x": 1370,
        "y": 500,
        "wires": [
            []
        ]
    },
    {
        "id": "d7944cf2.1ddb18",
        "type": "function",
        "z": "bee3b478.ef4b88",
        "name": "ex : area",
        "func": "msg.payload=msg.payload.object_area\nmsg.topic=\"area\"\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1000,
        "y": 540,
        "wires": [
            [
                "6f64625f.243fd4",
                "f6fd015e.5c1fe"
            ]
        ]
    },
    {
        "id": "87d402c5.c02008",
        "type": "json",
        "z": "bee3b478.ef4b88",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 870,
        "y": 540,
        "wires": [
            [
                "d7944cf2.1ddb18"
            ]
        ]
    },
    {
        "id": "1403e1a4.528926",
        "type": "ui_toast",
        "z": "bee3b478.ef4b88",
        "position": "top right",
        "displayTime": "5",
        "highlight": "",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "topic": "",
        "name": "",
        "x": 1390,
        "y": 280,
        "wires": []
    },
    {
        "id": "6f64625f.243fd4",
        "type": "ui_chart",
        "z": "bee3b478.ef4b88",
        "name": "chart area",
        "group": "6d1af0ab.7b4a18",
        "order": 3,
        "width": 24,
        "height": 7,
        "label": "chart area",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": true,
        "ymin": "",
        "ymax": "",
        "removeOlder": 1,
        "removeOlderPoints": "1000",
        "removeOlderUnit": "3600",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "useOldStyle": false,
        "outputs": 1,
        "x": 1370,
        "y": 540,
        "wires": [
            []
        ]
    },
    {
        "id": "c2d35803.b5024",
        "type": "debug",
        "z": "bee3b478.ef4b88",
        "name": "segmentation name",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 920,
        "y": 460,
        "wires": []
    },
    {
        "id": "ce12cb65.115838",
        "type": "ui_button",
        "z": "9c3e6ad4.7471a8",
        "name": "",
        "group": "adcd0ef7.81a7f8",
        "order": 3,
        "width": 4,
        "height": 1,
        "passthru": false,
        "label": "Reboot",
        "tooltip": "",
        "color": "",
        "bgcolor": "#AD1625",
        "icon": "",
        "payload": "reboot",
        "payloadType": "str",
        "topic": "reboot",
        "x": 240,
        "y": 80,
        "wires": [
            [
                "677f762b.43c648"
            ]
        ]
    },
    {
        "id": "690ed112.f50c3",
        "type": "exec",
        "z": "9c3e6ad4.7471a8",
        "command": "sudo",
        "addpay": true,
        "append": "now",
        "useSpawn": "false",
        "timer": "2",
        "oldrc": false,
        "name": "cmd",
        "x": 530,
        "y": 80,
        "wires": [
            [],
            [],
            []
        ]
    },
    {
        "id": "4a608a65.1882ec",
        "type": "ui_button",
        "z": "9c3e6ad4.7471a8",
        "name": "",
        "group": "adcd0ef7.81a7f8",
        "order": 5,
        "width": 4,
        "height": 1,
        "passthru": false,
        "label": "Shutdown",
        "tooltip": "",
        "color": "",
        "bgcolor": "#AD1625",
        "icon": "",
        "payload": "shutdown",
        "payloadType": "str",
        "topic": "shutdown",
        "x": 230,
        "y": 160,
        "wires": [
            [
                "677f762b.43c648"
            ]
        ]
    },
    {
        "id": "677f762b.43c648",
        "type": "python3-function",
        "z": "9c3e6ad4.7471a8",
        "name": "action",
        "func": "#!/usr/bin/python\nimport smbus\nimport time\nbus = smbus.SMBus(1)\ntime.sleep(1)\n#turn off fan RGB\nbus.write_byte_data(0x0d, 0x07, 0x00)\nbus.write_byte_data(0x0d, 0x07, 0x00)\n\n#msg[\"payload\"] = str(msg[\"topic\"])+' now'\nreturn msg",
        "outputs": 1,
        "x": 390,
        "y": 120,
        "wires": [
            [
                "50d1becd.7b5f",
                "690ed112.f50c3"
            ]
        ]
    },
    {
        "id": "50d1becd.7b5f",
        "type": "exec",
        "z": "9c3e6ad4.7471a8",
        "command": "i2cdetect -y 1",
        "addpay": false,
        "append": "",
        "useSpawn": "false",
        "timer": "1",
        "oldrc": false,
        "name": "i2c update",
        "x": 550,
        "y": 160,
        "wires": [
            [],
            [],
            []
        ]
    },
    {
        "id": "f435f66d.26d73",
        "type": "ui_numeric",
        "z": "1a447be0.198674",
        "name": "object_depth_min",
        "label": "Minimum depth (m)",
        "tooltip": "",
        "group": "ab1d06d6.bf9898",
        "order": 3,
        "width": 0,
        "height": 0,
        "wrap": false,
        "passthru": true,
        "topic": "object_depth_min",
        "format": "{{value}}",
        "min": "0",
        "max": "2000",
        "step": "1",
        "x": 610,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "79026dc4.133a7c",
        "type": "ui_numeric",
        "z": "1a447be0.198674",
        "name": "object_depth_max",
        "label": "Maximum depth (m)",
        "tooltip": "",
        "group": "ab1d06d6.bf9898",
        "order": 2,
        "width": 0,
        "height": 0,
        "wrap": false,
        "passthru": true,
        "topic": "object_depth_max",
        "format": "{{value}}",
        "min": "0",
        "max": "2000",
        "step": "1",
        "x": 610,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "5cdbcd15.17ec94",
        "type": "function",
        "z": "1a447be0.198674",
        "name": "get object_depth_min",
        "func": "msg.payload = msg.payload.object_depth_min;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 360,
        "y": 120,
        "wires": [
            [
                "f435f66d.26d73"
            ]
        ]
    },
    {
        "id": "c2ccc2e1.a697f8",
        "type": "function",
        "z": "1a447be0.198674",
        "name": "get object_depth_max",
        "func": "msg.payload = msg.payload.object_depth_max;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 360,
        "y": 160,
        "wires": [
            [
                "79026dc4.133a7c"
            ]
        ]
    },
    {
        "id": "cb77803f.357f88",
        "type": "gpsd",
        "z": "1a447be0.198674",
        "name": "",
        "hostname": "localhost",
        "port": "2947",
        "tpv": true,
        "sky": false,
        "info": false,
        "device": false,
        "gst": false,
        "att": false,
        "x": 90,
        "y": 220,
        "wires": [
            [
                "b3e8d04.7c83d3",
                "3f718ceb.5e9f34",
                "74554b33.14ab6c"
            ]
        ]
    },
    {
        "id": "f7ae988c.184598",
        "type": "ui_worldmap",
        "z": "1a447be0.198674",
        "d": true,
        "group": "7b7849e8.363288",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "",
        "lat": "",
        "lon": "",
        "zoom": "7",
        "layer": "Nat Geo",
        "cluster": "1",
        "maxage": "",
        "usermenu": "hide",
        "layers": "hide",
        "panit": "false",
        "panlock": "false",
        "zoomlock": "false",
        "hiderightclick": "true",
        "coords": "deg",
        "showgrid": "false",
        "path": "/worldmap",
        "x": 640,
        "y": 200,
        "wires": []
    },
    {
        "id": "b3e8d04.7c83d3",
        "type": "function",
        "z": "1a447be0.198674",
        "name": "get object_lat & object_lon",
        "func": "error = Math.sqrt(msg.payload.epx**2+msg.payload.epy**2)\n\nmsg.payload = {\n    \"name\":\"sailboat\",\n    \"lat\":msg.payload.lat,\n    \"lon\":msg.payload.lon,\n    \"speed\":msg.payload.speed,\n    \"bearing\":msg.payload.track,\n    \"icon\":\"ship\",\n    \"accuracy\":error,\n    \"command\": { \"lat\":msg.payload.lat, \"lon\":msg.payload.lon,\n        grid : {showgrid: true,\n                opt: { showLabel:true, dashArray:[5, 5], fontColor:\"#900\" }\n        }\n    }\n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 350,
        "y": 200,
        "wires": [
            [
                "f7ae988c.184598"
            ]
        ]
    },
    {
        "id": "9c08f843.b1e1b",
        "type": "function",
        "z": "1a447be0.198674",
        "name": "set object_time",
        "func": "var time = new Date(msg.payload);\n\nvar hour = time.getUTCHours();\nif (hour<10){hour = \"0\"+hour;}\nvar minute = time.getUTCMinutes();\nif (minute<10){minute = \"0\"+minute;}\n\nvar time_UTC = \"\"+hour+minute;\nglobal.set('object_time',time_UTC);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 620,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "157ba5ca.c88a52",
        "type": "function",
        "z": "1a447be0.198674",
        "name": "set object_date",
        "func": "var date = new Date(msg.payload);\n\nvar year = date.getUTCFullYear();\nvar month = date.getUTCMonth()+1;\nif (month<10){month = \"0\"+month;}\nvar day = date.getUTCDate();\nif (day<10){day = \"0\"+day;}\n\nvar date_UTC = \"\"+year+month+day;\nglobal.set('object_date',date_UTC);\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 620,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "701120fd.c5516",
        "type": "function",
        "z": "758bc08f.c57318",
        "name": "set optical config",
        "func": "global.set(msg.topic,msg.payload);\nvar acq_fnumber_objective = String(global.get(msg.topic));\n\nswitch(acq_fnumber_objective) {\n  case \"25\":\n    global.set(\"acq_magnification\",0.6);\n    global.set(\"process_pixel\",1.86);\n    global.set(\"sug_min\",60);\n    global.set(\"sug_max\",670);\n    global.set(\"sug_flowrate\",3);\n    break;\n  case \"16\":\n    global.set(\"acq_magnification\",0.94);\n    global.set(\"process_pixel\",1.19);\n    global.set(\"sug_min\",40);\n    global.set(\"sug_max\",430);\n    global.set(\"sug_flowrate\",2.4);\n    break;\n  case \"12\":\n    global.set(\"acq_magnification\",1.20);\n    global.set(\"process_pixel\",0.94);\n    global.set(\"sug_min\",30);\n    global.set(\"sug_max\",340);\n    global.set(\"sug_flowrate\",1.25);\n    break;\n  case \"8\":\n    global.set(\"acq_magnification\",1.78);\n    global.set(\"process_pixel\",0.63);\n    global.set(\"sug_min\",20);\n    global.set(\"sug_max\",230);\n    global.set(\"sug_flowrate\",0.42);\n    break;\n  case \"6\":\n    global.set(\"acq_magnification\",2.36);\n    global.set(\"process_pixel\",0.48);\n    global.set(\"sug_min\",15);\n    global.set(\"sug_max\",170);\n    global.set(\"sug_flowrate\",0.32);\n    break;\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 750,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "2554ff8e.8cf1a8",
        "type": "ui_dropdown",
        "z": "758bc08f.c57318",
        "name": "acq_fnumber_objective",
        "label": "M12 Lens*",
        "tooltip": "",
        "place": "Select option",
        "group": "4361c3b6.e2b7a4",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": true,
        "options": [
            {
                "label": "f 25mm 1/2\" 5MP IR",
                "value": 25,
                "type": "num"
            },
            {
                "label": "f 16mm 1/2.5\" 5MP IR",
                "value": 16,
                "type": "num"
            },
            {
                "label": "f 12mm 1/2.5\" 5MP IR",
                "value": 12,
                "type": "num"
            },
            {
                "label": "f 8mm 1/2.5\" 5MP IR",
                "value": 8,
                "type": "num"
            },
            {
                "label": "f 6mm 1/2.5\" 5MP IR",
                "value": 6,
                "type": "num"
            }
        ],
        "payload": "",
        "topic": "acq_fnumber_objective",
        "x": 526,
        "y": 360,
        "wires": [
            [
                "701120fd.c5516"
            ]
        ]
    },
    {
        "id": "2f9ae002.b4c96",
        "type": "ui_numeric",
        "z": "758bc08f.c57318",
        "name": "acq_minimum_mesh",
        "label": "Min fraction size (m)",
        "tooltip": "",
        "group": "4361c3b6.e2b7a4",
        "order": 8,
        "width": 0,
        "height": 0,
        "wrap": false,
        "passthru": true,
        "topic": "acq_minimum_mesh",
        "format": "{{value}}",
        "min": 0,
        "max": "300",
        "step": "10",
        "x": 536,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "c86d98d4.c56538",
        "type": "ui_numeric",
        "z": "758bc08f.c57318",
        "name": "acq_maximum_mesh",
        "label": "Max fraction size (m)",
        "tooltip": "",
        "group": "4361c3b6.e2b7a4",
        "order": 4,
        "width": 0,
        "height": 0,
        "wrap": false,
        "passthru": true,
        "topic": "acq_maximum_mesh",
        "format": "{{value}}",
        "min": "200",
        "max": "2000",
        "step": "100",
        "x": 536,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "98d1f331.a06938",
        "type": "ui_text_input",
        "z": "758bc08f.c57318",
        "name": "acq_id",
        "label": "Acquisition unique ID*",
        "tooltip": "",
        "group": "4361c3b6.e2b7a4",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "number",
        "delay": 300,
        "topic": "acq_id",
        "x": 586,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "42505cbd.f02b1c",
        "type": "ui_dropdown",
        "z": "758bc08f.c57318",
        "name": "acq_celltype",
        "label": "Thickness flowcell*",
        "tooltip": "",
        "place": "Select option",
        "group": "4361c3b6.e2b7a4",
        "order": 7,
        "width": 0,
        "height": 0,
        "passthru": true,
        "options": [
            {
                "label": "200 m -Slide I Luer",
                "value": 200,
                "type": "num"
            },
            {
                "label": "400 m -Slide I Luer",
                "value": 400,
                "type": "num"
            },
            {
                "label": "600 m -Slide I Luer",
                "value": 600,
                "type": "num"
            },
            {
                "label": "800 m -Slide I Luer",
                "value": 800,
                "type": "num"
            }
        ],
        "payload": "",
        "topic": "acq_celltype",
        "x": 566,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "13b51e1e.1f603a",
        "type": "ui_text_input",
        "z": "758bc08f.c57318",
        "name": "acq_volume",
        "label": "Volume to pass (ml)",
        "tooltip": "",
        "group": "4361c3b6.e2b7a4",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "number",
        "delay": 300,
        "topic": "acq_volume",
        "x": 566,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "3b9700c4.b93ec",
        "type": "ui_text_input",
        "z": "758bc08f.c57318",
        "name": "acq_instrument",
        "label": "Acquisition instrument",
        "tooltip": "PlanktonScope V2.1",
        "group": "4361c3b6.e2b7a4",
        "order": 6,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "text",
        "delay": 300,
        "topic": "acq_instrument",
        "x": 556,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "f3658d30.b8448",
        "type": "function",
        "z": "758bc08f.c57318",
        "name": "get acq_id",
        "func": "msg.payload = msg.payload.acq_id+1;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 210,
        "y": 40,
        "wires": [
            [
                "98d1f331.a06938"
            ]
        ]
    },
    {
        "id": "5acd51d4.4ab13",
        "type": "function",
        "z": "758bc08f.c57318",
        "name": "get acq_instrument",
        "func": "msg.payload = msg.payload.acq_instrument;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 230,
        "y": 80,
        "wires": [
            [
                "3b9700c4.b93ec"
            ]
        ]
    },
    {
        "id": "de2c90cf.b73b08",
        "type": "function",
        "z": "758bc08f.c57318",
        "name": "get acq_celltype",
        "func": "msg.payload = msg.payload.acq_celltype;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 220,
        "y": 120,
        "wires": [
            [
                "42505cbd.f02b1c"
            ]
        ]
    },
    {
        "id": "5e3dec55.881074",
        "type": "function",
        "z": "758bc08f.c57318",
        "name": "get acq_minimum_mesh",
        "func": "msg.payload = msg.payload.acq_minimum_mesh;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 250,
        "y": 160,
        "wires": [
            [
                "2f9ae002.b4c96"
            ]
        ]
    },
    {
        "id": "d3ca8847.4d1ae",
        "type": "function",
        "z": "758bc08f.c57318",
        "name": "get acq_maximum_mesh",
        "func": "msg.payload = msg.payload.acq_maximum_mesh;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 250,
        "y": 200,
        "wires": [
            [
                "c86d98d4.c56538"
            ]
        ]
    },
    {
        "id": "1f133196.96564e",
        "type": "function",
        "z": "758bc08f.c57318",
        "name": "get acq_volume",
        "func": "msg.payload = msg.payload.acq_volume;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 220,
        "y": 240,
        "wires": [
            [
                "13b51e1e.1f603a"
            ]
        ]
    },
    {
        "id": "68fa1227.dbdd5c",
        "type": "function",
        "z": "758bc08f.c57318",
        "name": "get acq_fnumber_objective",
        "func": "msg.payload = msg.payload.acq_fnumber_objective;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 260,
        "y": 360,
        "wires": [
            [
                "2554ff8e.8cf1a8"
            ]
        ]
    },
    {
        "id": "6c391d10.2f9744",
        "type": "ui_numeric",
        "z": "758bc08f.c57318",
        "name": "acq_min_esd",
        "label": "Minimum size to segment (m)",
        "tooltip": "",
        "group": "4361c3b6.e2b7a4",
        "order": 9,
        "width": 0,
        "height": 0,
        "wrap": false,
        "passthru": true,
        "topic": "acq_min_esd",
        "format": "{{value}}",
        "min": 0,
        "max": "300",
        "step": "5",
        "x": 566,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "163df12e.f73f5f",
        "type": "ui_numeric",
        "z": "758bc08f.c57318",
        "name": "acq_max_esd",
        "label": "Maximum size to segment (m)",
        "tooltip": "",
        "group": "4361c3b6.e2b7a4",
        "order": 5,
        "width": 0,
        "height": 0,
        "wrap": false,
        "passthru": true,
        "topic": "acq_max_esd",
        "format": "{{value}}",
        "min": "100",
        "max": "2000",
        "step": "5",
        "x": 556,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "3414b477.4d711c",
        "type": "function",
        "z": "758bc08f.c57318",
        "name": "get acq_min_esd",
        "func": "msg.payload = msg.payload.acq_min_esd;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 230,
        "y": 280,
        "wires": [
            [
                "6c391d10.2f9744"
            ]
        ]
    },
    {
        "id": "a52e7caf.6bde48",
        "type": "function",
        "z": "758bc08f.c57318",
        "name": "get acq_max_esd",
        "func": "msg.payload = msg.payload.acq_max_esd;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 230,
        "y": 320,
        "wires": [
            [
                "163df12e.f73f5f"
            ]
        ]
    },
    {
        "id": "3cb96380.e575ec",
        "type": "function",
        "z": "977131e7.c2e76",
        "name": "pump.js",
        "func": "state = global.get(\"state\");\n\nif (state == null){state=\"free\"}\n\nvar manual_volume= global.get(\"pump_manual_volume\");\nvar flowrate= global.get(\"pump_flowrate\");\n\nif (manual_volume === undefined || manual_volume === \"\" || manual_volume === null) {\n    msg.topic = \"Missing entry :\"\n    msg.payload = \"Volume to pass\";\n    \n}else if (flowrate === undefined || flowrate === \"\" || flowrate === null) {\n    msg.topic = \"Missing entry :\"\n    msg.payload = \"Flowrate\";\n    \n}else {\n    volume = global.get(\"pump_manual_volume\");\n    msg.volume = volume;\n    flowrate = global.get(\"pump_flowrate\");\n    msg.topic = \"actuator/pump\";\n    \n    if(state===\"free\"){\n        // msg.payload is FORWARD or BACKWARD here\n        msg.payload={\"action\":\"move\", \n                    \"direction\":msg.payload,\n                    \"volume\":volume,\n                    \"flowrate\":flowrate};\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 640,
        "y": 140,
        "wires": [
            [
                "43fa762d.35bcb"
            ]
        ],
        "info": "### Focusing\n##### focus.py `nb_step` `orientation`\n\n- `nb_step` : **integer** (from 1 to 100000) - number of step to perform by the stage (about 31um/step)\n- `orientation` : **string** - orientation of the focus either `up` or `down`\n\nExample:\n\n    python3.7 $HOME/PlanktonScope/scripts/focus.py 650 up\n"
    },
    {
        "id": "517efd7f.811f44",
        "type": "ui_button",
        "z": "977131e7.c2e76",
        "name": "BACKWARD",
        "group": "34f03c4a.abdf94",
        "order": 2,
        "width": 6,
        "height": 1,
        "passthru": false,
        "label": "",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "arrow_back",
        "payload": "BACKWARD",
        "payloadType": "str",
        "topic": "actuator/pump",
        "x": 470,
        "y": 120,
        "wires": [
            [
                "3cb96380.e575ec"
            ]
        ]
    },
    {
        "id": "d5de2fb4.dc9d8",
        "type": "ui_button",
        "z": "977131e7.c2e76",
        "name": "FORWARD",
        "group": "34f03c4a.abdf94",
        "order": 4,
        "width": 6,
        "height": 1,
        "passthru": true,
        "label": "",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "arrow_forward",
        "payload": "FORWARD",
        "payloadType": "str",
        "topic": "actuator/pump",
        "x": 470,
        "y": 160,
        "wires": [
            [
                "3cb96380.e575ec"
            ]
        ]
    },
    {
        "id": "43fa762d.35bcb",
        "type": "switch",
        "z": "977131e7.c2e76",
        "name": "",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "actuator/pump",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "Missing entry :",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 770,
        "y": 140,
        "wires": [
            [
                "bdc8ce57.de1f08"
            ],
            [
                "8bcce348.efc1a"
            ]
        ]
    },
    {
        "id": "8bcce348.efc1a",
        "type": "ui_toast",
        "z": "977131e7.c2e76",
        "position": "dialog",
        "displayTime": "3",
        "highlight": "",
        "sendall": true,
        "outputs": 1,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "topic": "",
        "name": "",
        "x": 930,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "f162cc1b.985148",
        "type": "ui_button",
        "z": "977131e7.c2e76",
        "name": "stop pump",
        "group": "34f03c4a.abdf94",
        "order": 5,
        "width": 4,
        "height": 1,
        "passthru": true,
        "label": "STOP PUMP",
        "tooltip": "",
        "color": "",
        "bgcolor": "#AD1625",
        "icon": "",
        "payload": "{\"action\":\"stop\"}",
        "payloadType": "json",
        "topic": "actuator/pump",
        "x": 470,
        "y": 200,
        "wires": [
            [
                "c38103c0.9aaa18"
            ]
        ]
    },
    {
        "id": "bdc8ce57.de1f08",
        "type": "mqtt out",
        "z": "977131e7.c2e76",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "broker": "8dc3722c.06efa8",
        "x": 910,
        "y": 120,
        "wires": []
    },
    {
        "id": "c38103c0.9aaa18",
        "type": "mqtt out",
        "z": "977131e7.c2e76",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "broker": "8dc3722c.06efa8",
        "x": 610,
        "y": 200,
        "wires": []
    },
    {
        "id": "f1b85f22.ac673",
        "type": "ui_text_input",
        "z": "977131e7.c2e76",
        "name": "pump_manual_volume",
        "label": "Volume to pass (ml)",
        "tooltip": "",
        "group": "34f03c4a.abdf94",
        "order": 3,
        "width": 8,
        "height": 1,
        "passthru": true,
        "mode": "number",
        "delay": 300,
        "topic": "pump_manual_volume",
        "x": 510,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "8ae06f9a.4b253",
        "type": "function",
        "z": "977131e7.c2e76",
        "name": "get pump_manual_volume",
        "func": "msg.payload = msg.payload.pump_manual_volume;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 220,
        "y": 80,
        "wires": [
            [
                "f1b85f22.ac673"
            ]
        ]
    },
    {
        "id": "b8bf2a9.be099d8",
        "type": "ui_slider",
        "z": "977131e7.c2e76",
        "name": "pump_flowrate",
        "label": "Flowrate (ml/min)*",
        "tooltip": "",
        "group": "34f03c4a.abdf94",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "outs": "end",
        "topic": "pump_flowrate",
        "min": "0.1",
        "max": "10",
        "step": "0.1",
        "x": 480,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "cc757614.c8fc58",
        "type": "function",
        "z": "977131e7.c2e76",
        "name": "get pump_flowrate",
        "func": "msg.payload = msg.payload.pump_flowrate;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 190,
        "y": 40,
        "wires": [
            [
                "b8bf2a9.be099d8"
            ]
        ]
    },
    {
        "id": "f49b3397.2599f8",
        "type": "ui_text_input",
        "z": "a0f9bde.423644",
        "name": "focus_distance",
        "label": "Distance in m",
        "tooltip": "This will be rounded to the nearest 25m",
        "group": "de7c8e82.7faa98",
        "order": 8,
        "width": 8,
        "height": 1,
        "passthru": true,
        "mode": "number",
        "delay": 300,
        "topic": "focus_distance",
        "x": 540,
        "y": 40,
        "wires": [
            [
                "b69e435f.b93558"
            ]
        ]
    },
    {
        "id": "411211be.745ef8",
        "type": "function",
        "z": "a0f9bde.423644",
        "name": "get focus_distance",
        "func": "msg.payload = msg.payload.focus_distance;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 220,
        "y": 40,
        "wires": [
            [
                "f49b3397.2599f8",
                "d9930546.489a58"
            ]
        ]
    },
    {
        "id": "30718b7.3986b74",
        "type": "ui_button",
        "z": "a0f9bde.423644",
        "name": "DOWN",
        "group": "de7c8e82.7faa98",
        "order": 4,
        "width": 3,
        "height": 1,
        "passthru": true,
        "label": "",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "arrow_downward",
        "payload": "DOWN",
        "payloadType": "str",
        "topic": "actuator/focus",
        "x": 280,
        "y": 320,
        "wires": [
            [
                "ee01103f.f91b28"
            ]
        ]
    },
    {
        "id": "e0e433da.64e4e8",
        "type": "ui_button",
        "z": "a0f9bde.423644",
        "name": "UP",
        "group": "de7c8e82.7faa98",
        "order": 2,
        "width": 3,
        "height": 1,
        "passthru": false,
        "label": "",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "arrow_upwards",
        "payload": "UP",
        "payloadType": "str",
        "topic": "actuator/focus",
        "x": 290,
        "y": 281,
        "wires": [
            [
                "ee01103f.f91b28"
            ]
        ]
    },
    {
        "id": "c46d3379.54e17",
        "type": "switch",
        "z": "a0f9bde.423644",
        "name": "",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "actuator/focus",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "Missing entry :",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 570,
        "y": 300,
        "wires": [
            [
                "a8dfcfd1.c5863"
            ],
            [
                "6e5f2b4e.fcbeac"
            ]
        ]
    },
    {
        "id": "6e5f2b4e.fcbeac",
        "type": "ui_toast",
        "z": "a0f9bde.423644",
        "position": "dialog",
        "displayTime": "3",
        "highlight": "",
        "sendall": true,
        "outputs": 1,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "topic": "",
        "name": "",
        "x": 730,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "ee01103f.f91b28",
        "type": "function",
        "z": "a0f9bde.423644",
        "name": "focus.js",
        "func": "state = global.get(\"state\");\n\nif (state == null){state=\"free\"}\n\nvar distance = global.get(\"focus_distance\");\n\nif (distance === undefined || distance === \"\" || distance === null) {\n    msg.topic = \"Missing entry :\"\n    msg.payload = \"Distance\";\n}else {\n    distance = global.get(\"focus_distance\");\n    if(state===\"free\"){\n        // msg.payload is UP or DOWN here\n        msg.payload={\"action\":\"move\", \n                    \"direction\":msg.payload,\n                    \"distance\":(distance/1000)};\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 420,
        "y": 300,
        "wires": [
            [
                "c46d3379.54e17"
            ]
        ]
    },
    {
        "id": "b8a2ecb3.f4f5f",
        "type": "ui_button",
        "z": "a0f9bde.423644",
        "name": "stop focus",
        "group": "de7c8e82.7faa98",
        "order": 6,
        "width": 4,
        "height": 1,
        "passthru": true,
        "label": "STOP FOCUS",
        "tooltip": "",
        "color": "",
        "bgcolor": "#AD1625",
        "icon": "",
        "payload": "{\"action\":\"stop\"}",
        "payloadType": "json",
        "topic": "actuator/focus",
        "x": 270,
        "y": 400,
        "wires": [
            [
                "2c100d73.ac6fba"
            ]
        ]
    },
    {
        "id": "a8dfcfd1.c5863",
        "type": "mqtt out",
        "z": "a0f9bde.423644",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "broker": "8dc3722c.06efa8",
        "x": 710,
        "y": 280,
        "wires": []
    },
    {
        "id": "2c100d73.ac6fba",
        "type": "mqtt out",
        "z": "a0f9bde.423644",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "broker": "8dc3722c.06efa8",
        "x": 410,
        "y": 400,
        "wires": []
    },
    {
        "id": "67fc8b3f.96c6cc",
        "type": "ui_text_input",
        "z": "81483277.2521e",
        "name": "sample_ship",
        "label": "Name of the ship",
        "tooltip": "",
        "group": "71c63dd4.311c44",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "text",
        "delay": 300,
        "topic": "sample_ship",
        "x": 590,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "91a896c8.7c9fb8",
        "type": "ui_dropdown",
        "z": "81483277.2521e",
        "name": "sample_sampling_gear",
        "label": "Sampling gear",
        "tooltip": "",
        "place": "Select",
        "group": "71c63dd4.311c44",
        "order": 5,
        "width": 0,
        "height": 0,
        "passthru": true,
        "multiple": true,
        "options": [
            {
                "label": "Plankton net",
                "value": "net",
                "type": "str"
            },
            {
                "label": "Niskin bottle 12L",
                "value": "niskin_12L",
                "type": "str"
            },
            {
                "label": "Niskin bottle 24L",
                "value": "niskin_24L",
                "type": "str"
            },
            {
                "label": "Pass Hull",
                "value": "pass_hull",
                "type": "str"
            },
            {
                "label": "Flask",
                "value": "flask",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "sample_sampling_gear",
        "x": 550,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "8cc6c6f1.65bf28",
        "type": "ui_text_input",
        "z": "81483277.2521e",
        "name": "sample_operator",
        "label": "Name of the operator",
        "tooltip": "",
        "group": "71c63dd4.311c44",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "text",
        "delay": 300,
        "topic": "sample_operator",
        "x": 570,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "adaccbb2.320458",
        "type": "ui_text_input",
        "z": "81483277.2521e",
        "name": "sample_project",
        "label": "Name of the project*",
        "tooltip": "",
        "group": "71c63dd4.311c44",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "text",
        "delay": 300,
        "topic": "sample_project",
        "x": 580,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "a63c1b66.f9a77",
        "type": "ui_text_input",
        "z": "81483277.2521e",
        "name": "sample_id",
        "label": "ID of the station*",
        "tooltip": "",
        "group": "71c63dd4.311c44",
        "order": 6,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "number",
        "delay": 300,
        "topic": "sample_id",
        "x": 590,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "d027a6bf.7049e8",
        "type": "function",
        "z": "81483277.2521e",
        "name": "get sample_projet",
        "func": "msg.payload = msg.payload.sample_project;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 250,
        "y": 80,
        "wires": [
            [
                "adaccbb2.320458"
            ]
        ]
    },
    {
        "id": "5a811caf.0f3144",
        "type": "function",
        "z": "81483277.2521e",
        "name": "get sample_ship",
        "func": "msg.payload = msg.payload.sample_ship;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 250,
        "y": 160,
        "wires": [
            [
                "67fc8b3f.96c6cc"
            ]
        ]
    },
    {
        "id": "45911c98.2bd83c",
        "type": "function",
        "z": "81483277.2521e",
        "name": "get sample_id",
        "func": "msg.payload = msg.payload.sample_id+1;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 240,
        "y": 120,
        "wires": [
            [
                "a63c1b66.f9a77"
            ]
        ]
    },
    {
        "id": "1e09a4ab.72996b",
        "type": "function",
        "z": "81483277.2521e",
        "name": "get sample_operator",
        "func": "msg.payload = msg.payload.sample_operator;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 260,
        "y": 200,
        "wires": [
            [
                "8cc6c6f1.65bf28"
            ]
        ]
    },
    {
        "id": "a3272681.f271c8",
        "type": "function",
        "z": "81483277.2521e",
        "name": "get sample_sampling_gear",
        "func": "msg.payload = msg.payload.sample_sampling_gear;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 280,
        "y": 240,
        "wires": [
            [
                "91a896c8.7c9fb8"
            ]
        ]
    },
    {
        "id": "10bfbbf.494c244",
        "type": "ui_template",
        "z": "81483277.2521e",
        "group": "71c63dd4.311c44",
        "name": "Information message",
        "order": 1,
        "width": 24,
        "height": "1",
        "format": "<div layout=\"row\">Fill the different inputs concerning the sample you want to image.</div>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": false,
        "templateScope": "local",
        "x": 420,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "6f6ad84e.d9222",
        "type": "function",
        "z": "e8d4d920.35344",
        "name": "get global",
        "func": "msg.payload={\n    \n        \"sample_project\":global.get(\"sample_project\"),\n        \"sample_id\":global.get(\"sample_id\"),\n        \"sample_ship\":global.get(\"sample_ship\"),\n        \"sample_operator\":global.get(\"sample_operator\"),\n        \"sample_sampling_gear\":global.get(\"sample_sampling_gear\"),\n        \n        \"acq_id\":global.get(\"acq_id\"),\n        \"acq_instrument\":global.get(\"acq_instrument\"),\n        //\"acq_instrument_id\":global.get(\"acq_instrument_id\"),\n        \"acq_celltype\":global.get(\"acq_celltype\"),\n        \"acq_minimum_mesh\":global.get(\"acq_minimum_mesh\"),\n        \"acq_maximum_mesh\":global.get(\"acq_maximum_mesh\"),\n        \"acq_min_esd\":global.get(\"acq_min_esd\"),\n        \"acq_max_esd\":global.get(\"acq_max_esd\"),\n        \"acq_volume\":global.get(\"acq_volume\"),\n        \"acq_magnification\":global.get(\"magnification\"),\n        \"acq_fnumber_objective\":global.get(\"acq_fnumber_objective\"),\n        \n        \"acq_camera_name\":\"Pi Camera V2.1 - 8MP\",\n        \n        \"object_date\":global.get(\"object_date\"),\n        \"object_time\":global.get(\"object_time\"),\n        \"object_lat\":global.get(\"object_lat\"),\n        \"object_lon\":global.get(\"object_lon\"),\n        \"object_depth_min\":global.get(\"object_depth_min\"),\n        \"object_depth_max\":global.get(\"object_depth_max\"),\n        \n        \"custom_nb_frame\":global.get(\"custom_nb_frame\"),\n        \"custom_nb_step\":global.get(\"custom_nb_step\"),\n        \"custom_segmentation\":global.get(\"custom_segmentation\"),\n        \"custom_sleep_before\":global.get(\"custom_sleep_before\"),\n        \"focus_nb_step\":global.get(\"focus_nb_step\"),\n        \"pump_flowrate\":global.get(\"pump_flowrate\"),\n        \"pump_manual_volume\":global.get(\"pump_manual_volume\"),\n        \n        \"process_pixel\":global.get(\"process_pixel\"),\n        \"process_id\":global.get(\"process_id\")\n        \n        \n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1300,
        "y": 220,
        "wires": [
            [
                "7cd7b4d0.cfc56c"
            ]
        ]
    },
    {
        "id": "bb1b1e3.906e7e",
        "type": "file",
        "z": "e8d4d920.35344",
        "name": "",
        "filename": "/home/pi/PlanktonScope/config.json",
        "appendNewline": true,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 1710,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "7cd7b4d0.cfc56c",
        "type": "json",
        "z": "e8d4d920.35344",
        "name": "config.json",
        "property": "payload",
        "action": "str",
        "pretty": true,
        "x": 1460,
        "y": 220,
        "wires": [
            [
                "bb1b1e3.906e7e"
            ]
        ]
    },
    {
        "id": "83f2e27a.b59688",
        "type": "file in",
        "z": "e8d4d920.35344",
        "name": "",
        "filename": "/home/pi/PlanktonScope/config.json",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "x": 370,
        "y": 80,
        "wires": [
            [
                "3333aa46.5fa3ee"
            ]
        ],
        "info": "# PlanktonScope Help\nThis Node will read the content of the file named **config.txt** containing all the input placeholders.\n"
    },
    {
        "id": "9db37b60.5e5488",
        "type": "inject",
        "z": "e8d4d920.35344",
        "name": "on_load",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 120,
        "y": 80,
        "wires": [
            [
                "83f2e27a.b59688",
                "172d187b.ad216"
            ]
        ],
        "info": "# PlanktonScope Help\nWhen the **Pi** is booting, **Node-RED** will be initiated and this node will be activated once and execute the following nodes."
    },
    {
        "id": "3333aa46.5fa3ee",
        "type": "json",
        "z": "e8d4d920.35344",
        "name": "config.json",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 610,
        "y": 80,
        "wires": [
            [
                "1f2d3f3d.5eeff9",
                "64b58fc8.cdc4e",
                "c94db91f.7cf2b8",
                "70625f12.179948",
                "f56b39e5.245b4",
                "24a381c3.761f56",
                "6a7bbade.f3174c"
            ]
        ]
    },
    {
        "id": "6725d70.a4aed28",
        "type": "function",
        "z": "e8d4d920.35344",
        "name": "set global",
        "func": "var value = msg.payload;\nvar key = msg.topic;\n\nglobal.set(key,value);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1300,
        "y": 140,
        "wires": [
            [
                "6f6ad84e.d9222"
            ]
        ]
    },
    {
        "id": "9f81fc0f.814988",
        "type": "rpi-gpio out",
        "z": "e8d4d920.35344",
        "name": "LED OUTPUT",
        "pin": "40",
        "set": true,
        "level": "0",
        "freq": "",
        "out": "out",
        "x": 540,
        "y": 180,
        "wires": []
    },
    {
        "id": "60cc050b.8dae74",
        "type": "ui_template",
        "z": "e8d4d920.35344",
        "group": "59434d8d.70ed94",
        "name": "Stream Pi Camera",
        "order": 1,
        "width": 24,
        "height": 19,
        "format": "<center>\n  <img src=\"http://planktoscope.local:8000/stream.mjpg\"\n    width=\"100%\" height=\"100%\">\n</center>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": false,
        "templateScope": "local",
        "x": 930,
        "y": 440,
        "wires": [
            []
        ]
    },
    {
        "id": "1f2d3f3d.5eeff9",
        "type": "subflow:81483277.2521e",
        "z": "e8d4d920.35344",
        "name": "",
        "env": [],
        "x": 930,
        "y": 140,
        "wires": [
            [
                "6725d70.a4aed28"
            ]
        ]
    },
    {
        "id": "24a381c3.761f56",
        "type": "subflow:a0f9bde.423644",
        "z": "e8d4d920.35344",
        "name": "",
        "env": [],
        "x": 920,
        "y": 360,
        "wires": [
            [
                "6725d70.a4aed28"
            ]
        ]
    },
    {
        "id": "6a7bbade.f3174c",
        "type": "subflow:977131e7.c2e76",
        "z": "e8d4d920.35344",
        "name": "",
        "env": [],
        "x": 920,
        "y": 400,
        "wires": [
            [
                "6725d70.a4aed28"
            ]
        ]
    },
    {
        "id": "64b58fc8.cdc4e",
        "type": "subflow:758bc08f.c57318",
        "z": "e8d4d920.35344",
        "name": "",
        "env": [],
        "x": 940,
        "y": 180,
        "wires": [
            [
                "6725d70.a4aed28"
            ],
            [
                "6f6ad84e.d9222"
            ]
        ]
    },
    {
        "id": "c94db91f.7cf2b8",
        "type": "subflow:1a447be0.198674",
        "z": "e8d4d920.35344",
        "name": "",
        "env": [],
        "x": 930,
        "y": 220,
        "wires": [
            [
                "6725d70.a4aed28"
            ],
            [
                "6f6ad84e.d9222"
            ]
        ]
    },
    {
        "id": "f1f6f8ca.a80bd",
        "type": "subflow:9c3e6ad4.7471a8",
        "z": "e8d4d920.35344",
        "name": "RPi commands",
        "env": [],
        "x": 920,
        "y": 820,
        "wires": []
    },
    {
        "id": "b8638c84.bcd58",
        "type": "subflow:bee3b478.ef4b88",
        "z": "e8d4d920.35344",
        "name": "",
        "env": [],
        "x": 320,
        "y": 320,
        "wires": []
    },
    {
        "id": "70625f12.179948",
        "type": "subflow:714bd4fe.163ab4",
        "z": "e8d4d920.35344",
        "name": "Process metadata",
        "env": [],
        "x": 930,
        "y": 260,
        "wires": [
            [
                "6725d70.a4aed28"
            ]
        ]
    },
    {
        "id": "f56b39e5.245b4",
        "type": "subflow:1bc3f9f9.1ee996",
        "z": "e8d4d920.35344",
        "name": "Acquisition inputs",
        "env": [],
        "x": 930,
        "y": 540,
        "wires": [
            [
                "6725d70.a4aed28"
            ]
        ],
        "icon": "node-red-dashboard/ui_switch.png"
    },
    {
        "id": "590670c8.5b17c",
        "type": "subflow:130e0533.4f1813",
        "z": "e8d4d920.35344",
        "name": "",
        "env": [],
        "x": 940,
        "y": 580,
        "wires": []
    },
    {
        "id": "b902251f.c756f",
        "type": "comment",
        "z": "e8d4d920.35344",
        "name": "Inject config.json in GUI inputs",
        "info": "",
        "x": 660,
        "y": 40,
        "wires": []
    },
    {
        "id": "e824bf49.c0716",
        "type": "comment",
        "z": "e8d4d920.35344",
        "name": "Edit config.json on changes",
        "info": "",
        "x": 1320,
        "y": 40,
        "wires": []
    },
    {
        "id": "5836c9be.895de8",
        "type": "subflow:21b3da63.2cef2e",
        "z": "e8d4d920.35344",
        "name": "",
        "env": [],
        "x": 920,
        "y": 860,
        "wires": []
    },
    {
        "id": "b94ee83b.5fc548",
        "type": "comment",
        "z": "e8d4d920.35344",
        "name": "Create and run python code receiving MQTT queries",
        "info": "",
        "x": 420,
        "y": 240,
        "wires": []
    },
    {
        "id": "61f01a83.88da5c",
        "type": "comment",
        "z": "e8d4d920.35344",
        "name": "On Load",
        "info": "",
        "x": 120,
        "y": 40,
        "wires": []
    },
    {
        "id": "fa75a682.73df7",
        "type": "comment",
        "z": "e8d4d920.35344",
        "name": "Get metadata from config.json",
        "info": "",
        "x": 350,
        "y": 40,
        "wires": []
    },
    {
        "id": "5d22882.f86d2f8",
        "type": "comment",
        "z": "e8d4d920.35344",
        "name": "White LED control",
        "info": "",
        "x": 310,
        "y": 140,
        "wires": []
    },
    {
        "id": "d418fabe.d0b75",
        "type": "comment",
        "z": "e8d4d920.35344",
        "name": "Visible on the GUI",
        "info": "",
        "x": 930,
        "y": 40,
        "wires": []
    },
    {
        "id": "ac2a06c3.0eec2",
        "type": "comment",
        "z": "e8d4d920.35344",
        "name": "RPi",
        "info": "",
        "x": 890,
        "y": 780,
        "wires": []
    },
    {
        "id": "630ed3ce.35374c",
        "type": "comment",
        "z": "e8d4d920.35344",
        "name": "Metadata",
        "info": "",
        "x": 900,
        "y": 100,
        "wires": []
    },
    {
        "id": "1fc17ae3.11b69d",
        "type": "comment",
        "z": "e8d4d920.35344",
        "name": "Actuation",
        "info": "",
        "x": 900,
        "y": 320,
        "wires": []
    },
    {
        "id": "dada61e7.83ee38",
        "type": "comment",
        "z": "e8d4d920.35344",
        "name": "Acquisition",
        "info": "",
        "x": 900,
        "y": 500,
        "wires": []
    },
    {
        "id": "f44de853.0c855",
        "type": "ui_switch",
        "z": "e8d4d920.35344",
        "name": "",
        "label": "LED",
        "tooltip": "",
        "group": "59434d8d.70ed94",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "x": 390,
        "y": 180,
        "wires": [
            [
                "9f81fc0f.814988"
            ]
        ]
    },
    {
        "id": "22392d.ef1a66d4",
        "type": "status",
        "z": "1a447be0.198674",
        "name": "GPS Status",
        "scope": [
            "cb77803f.357f88"
        ],
        "x": 110,
        "y": 560,
        "wires": [
            [
                "a30fe92c.6b73e8"
            ]
        ]
    },
    {
        "id": "a30fe92c.6b73e8",
        "type": "ui_text",
        "z": "1a447be0.198674",
        "group": "7b7849e8.363288",
        "order": 2,
        "width": 6,
        "height": 1,
        "name": "GPS Status Display",
        "label": "GPS Status:",
        "format": "{{msg.status.text}}",
        "layout": "row-left",
        "x": 600,
        "y": 560,
        "wires": []
    },
    {
        "id": "ec0d715e.19fdd",
        "type": "ui_text",
        "z": "1a447be0.198674",
        "group": "7b7849e8.363288",
        "order": 3,
        "width": 6,
        "height": 1,
        "name": "Latitude",
        "label": "Latitude",
        "format": "{{msg.payload.lat.deg}}&deg{{msg.payload.lat.min}}'{{msg.payload.lat.sec}}{{msg.payload.lat.dir}}",
        "layout": "row-left",
        "x": 640,
        "y": 340,
        "wires": []
    },
    {
        "id": "f8c5f7ef.e93908",
        "type": "ui_text",
        "z": "1a447be0.198674",
        "group": "7b7849e8.363288",
        "order": 4,
        "width": 6,
        "height": 1,
        "name": "Longitude",
        "label": "Longitude",
        "format": "{{msg.payload.lon.deg}}&deg{{msg.payload.lon.min}}'{{msg.payload.lon.sec}}{{msg.payload.lon.dir}}",
        "layout": "row-right",
        "x": 640,
        "y": 380,
        "wires": []
    },
    {
        "id": "3f718ceb.5e9f34",
        "type": "function",
        "z": "1a447be0.198674",
        "name": "Convert DD to DMS",
        "func": "function ConvertDDToDMS(D, lng){\n    // from https://stackoverflow.com/a/5786281/2108279\n    return {\n        dir : D<0?lng?'W':'S':lng?'E':'N',\n        deg : 0|(D<0?D=-D:D),\n        min : 0|D%1*60,\n        sec :(0|D*60%1*6000)/100\n    };\n}\n\nmsg.payload = {\n    \"lat\":ConvertDDToDMS(msg.payload.lat, false),\n    \"lon\":ConvertDDToDMS(msg.payload.lon, true)\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 350,
        "y": 360,
        "wires": [
            [
                "ec0d715e.19fdd",
                "f8c5f7ef.e93908"
            ]
        ]
    },
    {
        "id": "74554b33.14ab6c",
        "type": "file",
        "z": "1a447be0.198674",
        "d": true,
        "name": "gpsd_output",
        "filename": "/home/pi/gpsd.json",
        "appendNewline": true,
        "createDir": false,
        "overwriteFile": "false",
        "x": 630,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "b69e435f.b93558",
        "type": "function",
        "z": "a0f9bde.423644",
        "name": "round distance",
        "func": "// Here we change the focus_distance to 25 m increment\nif (msg.payload%25 <= 12.5){\n    msg.payload = msg.payload - msg.payload%25\n}\nelse {\n    msg.payload = msg.payload + msg.payload%25\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 820,
        "y": 40,
        "wires": [
            [
                "f49b3397.2599f8"
            ]
        ]
    },
    {
        "id": "2aa5b118.d75f2e",
        "type": "json",
        "z": "bee3b478.ef4b88",
        "name": "",
        "property": "payload",
        "action": "obj",
        "pretty": true,
        "x": 210,
        "y": 300,
        "wires": [
            [
                "ecedbda4.fed15"
            ]
        ]
    },
    {
        "id": "1dd0c3dd.60236c",
        "type": "template",
        "z": "bee3b478.ef4b88",
        "name": "Create sentence",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "The {{topic}} is {{payload.status}}",
        "output": "str",
        "x": 1170,
        "y": 280,
        "wires": [
            [
                "1403e1a4.528926"
            ]
        ]
    },
    {
        "id": "117aad13.53e11b",
        "type": "change",
        "z": "bee3b478.ef4b88",
        "name": "Remove high-level topic",
        "rules": [
            {
                "t": "change",
                "p": "topic",
                "pt": "msg",
                "from": "status/",
                "fromt": "str",
                "to": "",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 930,
        "y": 280,
        "wires": [
            [
                "1dd0c3dd.60236c"
            ]
        ]
    },
    {
        "id": "8ec68b82.17e3d8",
        "type": "ui_button",
        "z": "4b508eab.dccae8",
        "name": "Start segmentation",
        "group": "566dcd6a.03db74",
        "order": 1,
        "width": 16,
        "height": 1,
        "passthru": false,
        "label": "Start segmentation",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "{\"action\":\"segment\"}",
        "payloadType": "json",
        "topic": "segmenter/segment",
        "x": 270,
        "y": 200,
        "wires": [
            [
                "16f3cef4.0acac9"
            ]
        ]
    },
    {
        "id": "27be7971.b3fbce",
        "type": "ui_button",
        "z": "4b508eab.dccae8",
        "name": "Stop segmentation",
        "group": "566dcd6a.03db74",
        "order": 2,
        "width": 8,
        "height": 1,
        "passthru": true,
        "label": "Stop segmentation",
        "tooltip": "",
        "color": "",
        "bgcolor": "#AD1625",
        "icon": "",
        "payload": "{\"action\":\"stop\"}",
        "payloadType": "json",
        "topic": "segmenter/segment",
        "x": 270,
        "y": 320,
        "wires": [
            [
                "16f3cef4.0acac9"
            ]
        ]
    },
    {
        "id": "16f3cef4.0acac9",
        "type": "mqtt out",
        "z": "4b508eab.dccae8",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "broker": "8dc3722c.06efa8",
        "x": 610,
        "y": 260,
        "wires": []
    },
    {
        "id": "f8eade62.0eb118",
        "type": "subflow:4b508eab.dccae8",
        "z": "e8d4d920.35344",
        "name": "",
        "env": [],
        "x": 940,
        "y": 720,
        "wires": []
    },
    {
        "id": "30fc0aaa.8fdd96",
        "type": "comment",
        "z": "e8d4d920.35344",
        "name": "Segmentation",
        "info": "",
        "x": 910,
        "y": 680,
        "wires": []
    },
    {
        "id": "16aa0238.209276",
        "type": "ui_slider",
        "z": "674362b7.9b6574",
        "name": "Iso slider",
        "label": "ISO",
        "tooltip": "Possible values are  100, 200, 320, 400, 500, 640, 800",
        "group": "e8b67968.dea6",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "outs": "end",
        "topic": "imager/image",
        "min": "100",
        "max": "800",
        "step": "20",
        "x": 300,
        "y": 100,
        "wires": [
            [
                "bb090334.1e21a8"
            ]
        ]
    },
    {
        "id": "bb090334.1e21a8",
        "type": "function",
        "z": "674362b7.9b6574",
        "name": "round iso",
        "func": "// Iso should be one of 60, 100, 200, 320, 400, 500, 640, 800\n\nif (msg.payload <= 80){\n    msg.payload = 60;\n    return msg;\n}\n\nif (msg.payload <= 150){\n    msg.payload = 100;\n    return msg;\n}\n\nif (msg.payload <= 260){\n    msg.payload = 200;\n    return msg;\n}\n\nif (msg.payload <= 360){\n    msg.payload = 320;\n    return msg;\n}\n\nif (msg.payload <= 450){\n    msg.payload = 400;\n    return msg;\n}\n\nif (msg.payload <= 565){\n    msg.payload = 500;\n    return msg;\n}\n\nif (msg.payload <= 700){\n    msg.payload = 640;\n    return msg;\n}\n\n\nif (700 < msg.payload){\n    msg.payload = 800;\n    return msg;\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 460,
        "y": 100,
        "wires": [
            [
                "16aa0238.209276",
                "8ea9dc9a.c7d87"
            ]
        ]
    },
    {
        "id": "8ea9dc9a.c7d87",
        "type": "function",
        "z": "674362b7.9b6574",
        "name": "Encapsulate settings",
        "func": "msg.payload = {\n    \"action\":\"settings\", \n    \"settings\":{\"iso\":msg.payload}\n}\nmsg.topic = \"imager/image\"\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 660,
        "y": 100,
        "wires": [
            [
                "845e06e1.0d812"
            ]
        ]
    },
    {
        "id": "5765a825.a595c8",
        "type": "ui_slider",
        "z": "674362b7.9b6574",
        "name": "Shutter speed slider",
        "label": "Shutter Speed",
        "tooltip": "In microseconds, up to 5000s, 10s by default",
        "group": "e8b67968.dea6",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": true,
        "outs": "end",
        "topic": "imager/image",
        "min": "10",
        "max": "5000",
        "step": "10",
        "x": 340,
        "y": 220,
        "wires": [
            [
                "c38509b.fb08af8"
            ]
        ]
    },
    {
        "id": "c38509b.fb08af8",
        "type": "function",
        "z": "674362b7.9b6574",
        "name": "Encapsulate settings",
        "func": "msg.payload = {\n    \"action\":\"settings\", \n    \"settings\":{\"shutter_speed\":msg.payload}\n}\nmsg.topic = \"imager/image\"\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 660,
        "y": 220,
        "wires": [
            [
                "845e06e1.0d812"
            ]
        ]
    },
    {
        "id": "845e06e1.0d812",
        "type": "mqtt out",
        "z": "674362b7.9b6574",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "broker": "8dc3722c.06efa8",
        "x": 950,
        "y": 160,
        "wires": []
    },
    {
        "id": "2350e507.d4e302",
        "type": "inject",
        "z": "674362b7.9b6574",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payload": "10",
        "payloadType": "num",
        "x": 110,
        "y": 220,
        "wires": [
            [
                "5765a825.a595c8"
            ]
        ]
    },
    {
        "id": "2edd922b.a471a6",
        "type": "inject",
        "z": "674362b7.9b6574",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payload": "500",
        "payloadType": "num",
        "x": 110,
        "y": 100,
        "wires": [
            [
                "16aa0238.209276"
            ]
        ]
    },
    {
        "id": "649552a6.bf68fc",
        "type": "subflow:674362b7.9b6574",
        "z": "e8d4d920.35344",
        "name": "",
        "env": [],
        "x": 920,
        "y": 620,
        "wires": []
    },
    {
        "id": "bb62da8a.ebc328",
        "type": "ui_switch",
        "z": "130e0533.4f1813",
        "name": "",
        "label": "Pump FORWARD/BACKWARD",
        "tooltip": "",
        "group": "75a5ce1f.728d",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "",
        "style": "",
        "onvalue": "FORWARD",
        "onvalueType": "str",
        "onicon": "",
        "oncolor": "",
        "offvalue": "BACKWARD",
        "offvalueType": "str",
        "officon": "",
        "offcolor": "",
        "x": 150,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "743041f8.d2b9b",
        "type": "inject",
        "z": "e8d4d920.35344",
        "name": "OFF",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "false",
        "payloadType": "bool",
        "x": 270,
        "y": 180,
        "wires": [
            [
                "f44de853.0c855"
            ]
        ]
    },
    {
        "id": "f6fd015e.5c1fe",
        "type": "debug",
        "z": "bee3b478.ef4b88",
        "name": "segmenter area",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1320,
        "y": 660,
        "wires": []
    },
    {
        "id": "9998aa86.74bb",
        "type": "exec",
        "z": "d95291dc.83b0b8",
        "command": "python3 /home/pi/PlanktonScope/scripts/main.py",
        "addpay": false,
        "append": "",
        "useSpawn": "true",
        "timer": "",
        "oldrc": false,
        "name": "",
        "x": 830,
        "y": 140,
        "wires": [
            [],
            [],
            [
                "de4ba211.e1d3f"
            ]
        ]
    },
    {
        "id": "35ded403.3d7244",
        "type": "template",
        "z": "d95291dc.83b0b8",
        "name": "main.py",
        "field": "payload",
        "fieldType": "msg",
        "format": "python",
        "syntax": "plain",
        "template": "#Library to send command over I2C for the light module on the fan and subprocess to run bash command\nimport smbus, subprocess\n################################################################################\n#LEDs Actuation\n################################################################################\n\n#define the bus used to actuate the light module on the fan\nbus = smbus.SMBus(1)\n\ndef rgb(R,G,B):\n    #Update LED n1\n    bus.write_byte_data(0x0d, 0x00, 0)\n    bus.write_byte_data(0x0d, 0x01, R)\n    bus.write_byte_data(0x0d, 0x02, G)\n    bus.write_byte_data(0x0d, 0x03, B)\n\n    #Update LED n2\n    bus.write_byte_data(0x0d, 0x00, 1)\n    bus.write_byte_data(0x0d, 0x01, R)\n    bus.write_byte_data(0x0d, 0x02, G)\n    bus.write_byte_data(0x0d, 0x03, B)\n\n    #Update LED n3\n    bus.write_byte_data(0x0d, 0x00, 2)\n    bus.write_byte_data(0x0d, 0x01, R)\n    bus.write_byte_data(0x0d, 0x02, G)\n    bus.write_byte_data(0x0d, 0x03, B)\n\n    #Update the I2C Bus in order to really update the LEDs new values\n    cmd=\"i2cdetect -y 1\"\n    subprocess.Popen(cmd.split(),stdout=subprocess.PIPE)\n    \n#Present the RED color\nrgb(255,0,0)\n\n################################################################################\n#Actuator Libraries\n################################################################################\n\n#Library for exchaning messages with Node-RED\nimport paho.mqtt.client as mqtt\n\n#Library to control the PiCamera\nfrom picamera import PiCamera\n\n#Libraries to control the steppers for focusing and pumping\nfrom adafruit_motor import stepper\nfrom adafruit_motorkit import MotorKit\n\n################################################################################\n#Practical Libraries\n################################################################################\n\n#Library to get date and time for folder name and filename\nfrom datetime import datetime, timedelta\n\n#Library to be able to sleep for a duration\nfrom time import sleep\n\n#Libraries manipulate json format, execute bash commands\nimport json, shutil, os\n\n################################################################################\n#Morphocut Libraries\n################################################################################\n\nfrom skimage.util import img_as_ubyte\nfrom morphocut import Call\nfrom morphocut.contrib.ecotaxa import EcotaxaWriter\nfrom morphocut.contrib.zooprocess import CalculateZooProcessFeatures\nfrom morphocut.core import Pipeline\nfrom morphocut.file import Find\nfrom morphocut.image import (ExtractROI,\n    FindRegions,\n    ImageReader,\n    ImageWriter,\n    RescaleIntensity,\n    RGB2Gray\n)\nfrom morphocut.stat import RunningMedian\nfrom morphocut.str import Format\nfrom morphocut.stream import TQDM, Enumerate, FilterVariables\n\n################################################################################\n#Other image processing Libraries\n################################################################################\n\nfrom skimage.feature import canny\nfrom skimage.color import rgb2gray, label2rgb\nfrom skimage.morphology import disk\nfrom skimage.morphology import erosion, dilation, closing\nfrom skimage.measure import label, regionprops\nimport cv2\n\n################################################################################\n#Streaming PiCamera over server\n################################################################################\nimport io\nimport picamera\nimport logging\nimport socketserver\nfrom threading import Condition\nfrom http import server\nimport threading\n\n################################################################################\n#Get possibility to generate random numbers\n################################################################################\n# generate random integer values\nfrom random import seed\nfrom random import randint\n\n\n\n################################################################################\n#Creation of the webpage containing the PiCamera Streaming\n################################################################################\n\nPAGE=\"\"\"\\\n<html>\n<head>\n<title>PlanktonScope v2 | PiCamera Streaming</title>\n</head>\n<body>\n<img src=\"stream.mjpg\" width=\"1280\" height=\"960\" />\n</body>\n</html>\n\"\"\"\n\n################################################################################\n#Classes for the PiCamera Streaming\n################################################################################\n\nclass StreamingOutput(object):\n    def __init__(self):\n        self.frame = None\n        self.buffer = io.BytesIO()\n        self.condition = Condition()\n\n    def write(self, buf):\n        if buf.startswith(b'\\xff\\xd8'):\n            # New frame, copy the existing buffer's content and notify all\n            # clients it's available\n            self.buffer.truncate()\n            with self.condition:\n                self.frame = self.buffer.getvalue()\n                self.condition.notify_all()\n            self.buffer.seek(0)\n        return self.buffer.write(buf)\n\nclass StreamingHandler(server.BaseHTTPRequestHandler):\n    def do_GET(self):\n        if self.path == '/':\n            self.send_response(301)\n            self.send_header('Location', '/index.html')\n            self.end_headers()\n        elif self.path == '/index.html':\n            content = PAGE.encode('utf-8')\n            self.send_response(200)\n            self.send_header('Content-Type', 'text/html')\n            self.send_header('Content-Length', len(content))\n            self.end_headers()\n            self.wfile.write(content)\n        elif self.path == '/stream.mjpg':\n            self.send_response(200)\n            self.send_header('Age', 0)\n            self.send_header('Cache-Control', 'no-cache, private')\n            self.send_header('Pragma', 'no-cache')\n            self.send_header('Content-Type', 'multipart/x-mixed-replace; boundary=FRAME')\n            self.end_headers()\n            try:\n                while True:\n                    with output.condition:\n                        output.condition.wait()\n                        frame = output.frame\n                    self.wfile.write(b'--FRAME\\r\\n')\n                    self.send_header('Content-Type', 'image/jpeg')\n                    self.send_header('Content-Length', len(frame))\n                    self.end_headers()\n                    self.wfile.write(frame)\n                    self.wfile.write(b'\\r\\n')\n            except Exception as e:\n                logging.warning(\n                    'Removed streaming client %s: %s',\n                    self.client_address, str(e))\n        else:\n            self.send_error(404)\n            self.end_headers()\n\nclass StreamingServer(socketserver.ThreadingMixIn, server.HTTPServer):\n    allow_reuse_address = True\n    daemon_threads = True\n\n################################################################################\n#MQTT core functions\n################################################################################\n\n#Run this function in order to connect to the client (Node-RED)\ndef on_connect(client, userdata, flags, rc):\n    #Print when connected\n    print(\"Connected! - \" + str(rc))\n    #When connected, run subscribe()\n    client.subscribe(\"actuator/#\")\n    #Turn green the light module\n    rgb(0,255,0)\n\n#Run this function in order to subscribe to all the topics begining by actuator\ndef on_subscribe(client, obj, mid, granted_qos):\n    #Print when subscribed\n    print(\"Subscribed! - \"+str(mid)+\" \"+str(granted_qos))\n\n#Run this command when Node-RED is sending a message on the subscribed topic\ndef on_message(client, userdata, msg):\n    #Print the topic and the message\n    print(msg.topic+\" \"+str(msg.qos)+\" \"+str(msg.payload))\n    #Update the global variables command, args and counter\n    global command\n    global args\n    global counter\n    #Parse the topic to find the command. ex : actuator/pump -> pump\n    command=msg.topic.split(\"/\")[1]\n    #Decode the message to find the arguments\n    args=str(msg.payload.decode())\n    #Reset the counter to 0\n    counter=0\n\n################################################################################\n#Init functions\n################################################################################\n\n#define the names for the 2 exsting steppers\nkit = MotorKit()\npump_stepper = kit.stepper1\nfocus_stepper = kit.stepper2\n#Make sure the steppers are release and do not use any power\npump_stepper.release()\nfocus_stepper.release()\n\n#Precise the settings of the PiCamera\ncamera = PiCamera()\ncamera.resolution = (3280, 2464)\ncamera.iso = 60\ncamera.shutter_speed = 500\ncamera.exposure_mode = 'fixedfps'\n\n#Declare the global variables command, args and counter\ncommand = ''\nargs = ''\ncounter=''\n\n#MQTT Client functions definition\nclient = mqtt.Client()\nclient.connect(\"192.168.4.1\",1883,60)\nclient.on_connect = on_connect\nclient.on_subscribe = on_subscribe\nclient.on_message = on_message\nclient.loop_start()\n\n################################################################################\n#Definition of the few important metadata\n################################################################################\n\nlocal_metadata = {\n    \"process_datetime\": datetime.now(),\n    \"acq_camera_resolution\" : camera.resolution,\n    \"acq_camera_iso\" : camera.iso,\n    \"acq_camera_shutter_speed\" : camera.shutter_speed\n}\n\n#Read the content of config.json containing the metadata defined on Node-RED\nconfig_json = open('/home/pi/PlanktonScope/config.json','r')\nnode_red_metadata = json.loads(config_json.read())\n\n#Concat the local metadata and the metadata from Node-RED\nglobal_metadata = {**local_metadata, **node_red_metadata}\n\n#Define the name of the .zip file that will contain the images and the .tsv table for EcoTaxa\narchive_fn = os.path.join(\"/home/pi/PlanktonScope/\",\"export\", \"ecotaxa_export.zip\")\n\n################################################################################\n#MorphoCut Script\n################################################################################\n\n#Define processing pipeline\nwith Pipeline() as p:\n\n    #Recursively find .jpg files in import_path.\n    #Sort to get consective frames.\n    abs_path = Find(\"/home/pi/PlanktonScope/tmp\", [\".jpg\"], sort=True, verbose=True)\n\n    #Extract name from abs_path\n    name = Call(lambda p: os.path.splitext(os.path.basename(p))[0], abs_path)\n\n    #Set the LEDs as Green\n    Call(rgb, 0,255,0)\n\n    #Read image\n    img = ImageReader(abs_path)\n\n    #Show progress bar for frames\n    TQDM(Format(\"Frame {name}\", name=name))\n\n    #Apply running median to approximate the background image\n    flat_field = RunningMedian(img, 5)\n\n    #Correct image\n    img = img / flat_field\n\n    #Rescale intensities and convert to uint8 to speed up calculations\n    img = RescaleIntensity(img, in_range=(0, 1.1), dtype=\"uint8\")\n\n    #Publish the json containing all the metadata to via MQTT to Node-RED\n    Call(client.publish, \"receiver/segmentation/name\", name)\n\n    #Filter variable to reduce memory load\n    FilterVariables(name,img)\n\n    #Save cleaned images\n    #frame_fn = Format(os.path.join(\"/home/pi/PlanktonScope/tmp\",\"CLEAN\", \"{name}.jpg\"), name=name)\n    #ImageWriter(frame_fn, img)\n\n    #Convert image to uint8 gray\n    img_gray = RGB2Gray(img)\n\n    #?\n    img_gray = Call(img_as_ubyte, img_gray)\n\n    #Canny edge detection using OpenCV\n    img_canny = Call(cv2.Canny, img_gray, 50,100)\n\n    #Dilate using OpenCV\n    kernel = Call(cv2.getStructuringElement, cv2.MORPH_ELLIPSE, (15, 15))\n    img_dilate = Call(cv2.dilate, img_canny, kernel, iterations=2)\n\n    #Close using OpenCV\n    kernel = Call(cv2.getStructuringElement, cv2.MORPH_ELLIPSE, (5, 5))\n    img_close = Call(cv2.morphologyEx, img_dilate, cv2.MORPH_CLOSE, kernel, iterations=1)\n\n    #Erode using OpenCV\n    kernel = Call(cv2.getStructuringElement, cv2.MORPH_ELLIPSE, (15, 15))\n    mask = Call(cv2.erode, img_close, kernel, iterations=2)\n\n    #Find objects\n    regionprops = FindRegions(\n        mask, img_gray, min_area=1000, padding=10, warn_empty=name\n    )\n\n    #Set the LEDs as Purple\n    Call(rgb, 255,0,255)\n\n    # For an object, extract a vignette/ROI from the image\n    roi_orig = ExtractROI(img, regionprops, bg_color=255)\n\n    # Generate an object identifier\n    i = Enumerate()\n\n    #Call(print,i)\n\n    #Define the ID of each object\n    object_id = Format(\"{name}_{i:d}\", name=name, i=i)\n\n    #Call(print,object_id)\n\n    #Define the name of each object\n    object_fn = Format(os.path.join(\"/home/pi/PlanktonScope/\",\"OBJECTS\", \"{name}.jpg\"), name=object_id)\n\n    #Save the image of the object with its name\n    ImageWriter(object_fn, roi_orig)\n\n    #Calculate features. The calculated features are added to the global_metadata.\n    #Returns a Variable representing a dict for every object in the stream.\n    meta = CalculateZooProcessFeatures(\n        regionprops, prefix=\"object_\", meta=global_metadata\n    )\n\n    #Get all the metadata\n    json_meta = Call(json.dumps,meta, sort_keys=True, default=str)\n\n    #Publish the json containing all the metadata to via MQTT to Node-RED\n    Call(client.publish, \"receiver/segmentation/metric\", json_meta)\n\n    #Add object_id to the metadata dictionary\n    meta[\"object_id\"] = object_id\n\n    #Generate object filenames\n    orig_fn = Format(\"{object_id}.jpg\", object_id=object_id)\n\n    #Write objects to an EcoTaxa archive:\n    #roi image in original color, roi image in grayscale, metadata associated with each object\n    EcotaxaWriter(archive_fn, (orig_fn, roi_orig), meta)\n\n    #Progress bar for objects\n    TQDM(Format(\"Object {object_id}\", object_id=object_id))\n\n    #Publish the object_id to via MQTT to Node-RED\n    Call(client.publish, \"receiver/segmentation/object_id\", object_id)\n\n    #Set the LEDs as Green\n    Call(rgb, 0,255,0)\n\n################################################################################\n#While loop for capting commands from Node-RED\n################################################################################\n\noutput = StreamingOutput()\naddress = ('192.168.4.1', 8000)\nserver = StreamingServer(address, StreamingHandler)\nthreading.Thread(target=server.serve_forever).start()\ncamera.start_recording(output, format='mjpeg', resize=(640, 480))\n\nwhile True:\n\n    ############################################################################\n    #Pump Event\n    ############################################################################\n\n    #If the command is \"pump\"\n    if (command==\"pump\"):\n\n        #Set the LEDs as Blue\n        rgb(0,0,255)\n\n        #Get direction from the different received arguments\n        direction=args.split(\" \")[0]\n\n        #Get delay (in between steps) from the different received arguments\n        delay=float(args.split(\" \")[1])\n\n        #Get number of steps from the different received arguments\n        nb_step=int(args.split(\" \")[2])\n\n        #Print status\n        print(\"The pump has been started.\")\n\n        #Publish the status \"Start\" to via MQTT to Node-RED\n        client.publish(\"receiver/pump\", delay);\n\n        ########################################################################\n        while True:\n\n            #Depending on direction, select the right direction for the pump\n            if direction == \"BACKWARD\":\n                direction=stepper.BACKWARD\n\n            if direction == \"FORWARD\":\n                direction=stepper.FORWARD\n\n            #Actuate the pump for one step in the right direction\n            pump_stepper.onestep(direction=direction, style=stepper.DOUBLE)\n\n            #Increment the counter\n            counter+=1\n\n            #Wait during the delay to pump at the right flowrate\n            sleep(delay)\n\n            ####################################################################\n            #If counter reach the number of step, break\n            if counter>nb_step:\n\n                #Release the pump stepper to stop power draw\n                pump_stepper.release()\n\n                #Print status\n                print(\"The pumping is done.\")\n\n                #Change the command to not re-enter in this while loop\n                command=\"wait\"\n\n                #Publish the status \"Done\" to via MQTT to Node-RED\n                client.publish(\"receiver/pump\", \"Done\");\n\n                #Set the LEDs as Green\n                rgb(0,255,0)\n\n                #Reset the counter to 0\n                counter=0\n\n                break\n\n            ####################################################################\n            #If a new received command isn't \"pump\", break this while loop\n            if command!=\"pump\":\n\n                #Release the pump stepper to stop power draw\n                pump_stepper.release()\n\n                #Print status\n                print(\"The pump has been interrompted.\")\n\n                #Publish the status \"Interrompted\" to via MQTT to Node-RED\n                client.publish(\"receiver/pump\", \"Interrompted\");\n\n                #Set the LEDs as Green\n                rgb(0,255,0)\n\n                #Reset the counter to 0\n                counter=0\n\n                break\n\n    ############################################################################\n    #Focus Event\n    ############################################################################\n\n    #If the command is \"focus\"\n    elif (command==\"focus\"):\n\n        #Set the LEDs as Yellow\n        rgb(255,255,0)\n\n        #Get direction from the different received arguments\n        direction=args.split(\" \")[0]\n\n        #Get number of steps from the different received arguments\n        nb_step=int(args.split(\" \")[1])\n\n        #Print status\n        print(\"The focus has been started.\")\n\n        #Publish the status \"Start\" to via MQTT to Node-RED\n        client.publish(\"receiver/focus\", \"Start\");\n\n        ########################################################################\n        while True:\n\n            #Depending on direction, select the right direction for the focus\n            if direction == \"FORWARD\":\n                direction=stepper.FORWARD\n\n            if direction == \"BACKWARD\":\n                direction=stepper.BACKWARD\n\n            #Actuate the focus for one microstep in the right direction\n            focus_stepper.onestep(direction=direction, style=stepper.MICROSTEP)\n\n            #Increment the counter\n            counter+=1\n\n            ####################################################################\n            #If counter reach the number of step, break\n            if counter>nb_step:\n\n                #Release the focus steppers to stop power draw\n                focus_stepper.release()\n\n                #Print status\n                print(\"The focusing is done.\")\n\n                #Change the command to not re-enter in this while loop\n                command=\"wait\"\n\n                #Publish the status \"Done\" to via MQTT to Node-RED\n                client.publish(\"receiver/focus\", \"Done\");\n\n                #Set the LEDs as Green\n                rgb(0,255,0)\n\n                #Reset the counter to 0\n                counter=0\n\n                break\n\n            ####################################################################\n            #If a new received command isn't \"pump\", break this while loop\n            if command!=\"focus\":\n\n                #Release the focus steppers to stop power draw\n                focus_stepper.release()\n\n                #Print status\n                print(\"The stage has been interrompted.\")\n\n                #Publish the status \"Done\" to via MQTT to Node-RED\n                client.publish(\"receiver/focus\", \"Interrompted\");\n\n                #Set the LEDs as Green\n                rgb(0,255,0)\n\n                #Reset the counter to 0\n                counter=0\n\n                break\n\n    ############################################################################\n    #Image Event\n    ############################################################################\n\n    elif (command==\"image\"):\n\n        #Get duration to wait before an image from the different received arguments\n        sleep_before=int(args.split(\" \")[0])\n\n        #Get number of step in between two images from the different received arguments\n        nb_step=int(args.split(\" \")[1])\n\n        #Get the number of frames to image from the different received arguments\n        nb_frame=int(args.split(\" \")[2])\n\n        #Sleep a duration before to start acquisition\n        sleep(sleep_before)\n\n        #Publish the status \"Start\" to via MQTT to Node-RED\n        client.publish(\"receiver/image\", \"Start\");\n\n        #Set the LEDs as Blue\n        rgb(0,0,255)\n\n        #Pump duing a given number of steps (in between each image)\n        for i in range(nb_step):\n\n            #If the command is still image - pump a defined nb of steps\n            if (command==\"image\"):\n\n                #Actuate the pump for one step in the FORWARD direction\n                pump_stepper.onestep(direction=stepper.FORWARD, style=stepper.DOUBLE)\n\n                #The flowrate is fixed for now.\n                sleep(0.01)\n\n            #If the command isn't image anymore - break\n            else:\n\n                break\n\n\n        #Set the LEDs as Green\n        rgb(0,255,0)\n\n        while True:\n            #Release the pump stepper to stop power draw\n            pump_stepper.release()\n\n            #Set the LEDs as Cyan\n            rgb(0,255,255)\n\n            #Increment the counter\n            counter+=1\n\n            #Get datetime\n            datetime_tmp=datetime.now().strftime(\"%H_%M_%S_%f\")\n\n            #Print datetime\n            print(datetime_tmp)\n\n            #Define the filename of the image\n            filename = os.path.join(\"/home/pi/PlanktonScope/tmp\",datetime_tmp+\".jpg\")\n\n            #Capture an image with the proper filename\n            camera.capture(filename)\n\n            #Set the LEDs as Green\n            rgb(0,255,0)\n\n            #Publish the name of the image to via MQTT to Node-RED\n\n            client.publish(\"receiver/image\", datetime_tmp+\".jpg has been imaged.\");\n            \n            #Set the LEDs as Blue\n            rgb(0,0,255)\n\n            #Pump during a given nb of steps\n            for i in range(nb_step):\n\n                #Actuate the pump for one step in the FORWARD direction\n                pump_stepper.onestep(direction=stepper.FORWARD, style=stepper.DOUBLE)\n\n                #The flowrate is fixed for now.\n                sleep(0.01)\n\n            #Wait a fixed delay which set the framerate as < than 2 imag/sec\n            sleep(0.5)\n\n            #Set the LEDs as Green\n            rgb(0,255,0)\n\n            ####################################################################\n            #If counter reach the number of frame, break\n            if(counter>nb_frame):\n\n                #Publish the status \"Completed\" to via MQTT to Node-RED\n                client.publish(\"receiver/image\", \"Completed\");\n\n                #Release the pump steppers to stop power draw\n                pump_stepper.release()\n\n                #Publish the status \"Start\" to via MQTT to Node-RED\n                client.publish(\"receiver/segmentation\", \"Start\");\n\n                #Start the MorphoCut Pipeline\n                p.run()\n\n                #remove directory\n                #shutil.rmtree(import_path)\n\n                #Publish the status \"Completed\" to via MQTT to Node-RED\n                client.publish(\"receiver/segmentation\", \"Completed\");\n\n                #Set the LEDs as White\n                rgb(255,255,255)\n\n                sample_project=node_red_metadata['sample_project'];\n                \n                acq_id=node_red_metadata['acq_id'];\n                \n                export_name = str(sample_project)+\"_\"+str(acq_id)+\".zip\"\n                \n                \n                os.popen(\"mv /home/pi/PlanktonScope/export/ecotaxa_export.zip /home/pi/PlanktonScope/export/\"+export_name)\n                \n                os.popen(\"rm -rf /home/pi/PlanktonScope/tmp/*.jpg\")\n                \n                os.popen(\"rm -rf /home/pi/PlanktonScope/OBJECTS/*.jpg\")\n                \n\n                #Let it happen\n                sleep(1)\n\n                #Set the LEDs as Green\n                rgb(0,255,0)\n\n\n                #Change the command to not re-enter in this while loop\n                command=\"wait\"\n                    \n                #Set the LEDs as Green\n                rgb(0,255,255)\n\n                #Reset the counter to 0\n                counter=0\n\n                break\n\n            ####################################################################\n            #If a new received command isn't \"image\", break this while loop\n            if command!=\"image\":\n\n                #Release the pump steppers to stop power draw\n                pump_stepper.release()\n\n                #Print status\n                print(\"The imaging has been interrompted.\")\n\n                #Publish the status \"Interrompted\" to via MQTT to Node-RED\n                client.publish(\"receiver/image\", \"Interrompted\");\n\n                #Set the LEDs as Green\n                rgb(0,255,0)\n\n                #Reset the counter to 0\n                counter=0\n\n                break\n\n    else:\n        #Its just waiting to receive command from Node-RED\n        sleep(0.4)\n",
        "output": "str",
        "x": 760,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "672d89a8.4e6968",
        "type": "exec",
        "z": "d95291dc.83b0b8",
        "command": "sudo killall -9 python3",
        "addpay": true,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": false,
        "name": "Hard kill",
        "x": 1280,
        "y": 100,
        "wires": [
            [],
            [],
            []
        ]
    },
    {
        "id": "172d187b.ad216",
        "type": "subflow:d95291dc.83b0b8",
        "z": "e8d4d920.35344",
        "name": "",
        "env": [],
        "x": 300,
        "y": 280,
        "wires": []
    },
    {
        "id": "afa9f4b.2e77988",
        "type": "delay",
        "z": "d95291dc.83b0b8",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 420,
        "y": 140,
        "wires": [
            [
                "9998aa86.74bb"
            ]
        ]
    },
    {
        "id": "1df370a8.6c70ff",
        "type": "ui_button",
        "z": "d95291dc.83b0b8",
        "name": "Restart Python",
        "group": "adcd0ef7.81a7f8",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Restart Python",
        "tooltip": "",
        "color": "",
        "bgcolor": "#AD1625",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "",
        "x": 100,
        "y": 140,
        "wires": [
            [
                "afa9f4b.2e77988",
                "39edf8d2.bc92e8"
            ]
        ]
    },
    {
        "id": "39edf8d2.bc92e8",
        "type": "function",
        "z": "d95291dc.83b0b8",
        "name": "",
        "func": "msg.kill = \"SIGTERM\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 420,
        "y": 200,
        "wires": [
            [
                "9998aa86.74bb",
                "de4ba211.e1d3f",
                "a776b9fc.d542e8"
            ]
        ]
    },
    {
        "id": "de4ba211.e1d3f",
        "type": "debug",
        "z": "d95291dc.83b0b8",
        "name": "output",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1270,
        "y": 200,
        "wires": []
    },
    {
        "id": "7aa2e737.e16d98",
        "type": "status",
        "z": "d95291dc.83b0b8",
        "name": "",
        "scope": [
            "9998aa86.74bb"
        ],
        "x": 960,
        "y": 260,
        "wires": [
            [
                "439b952c.3e9cf4"
            ]
        ]
    },
    {
        "id": "439b952c.3e9cf4",
        "type": "debug",
        "z": "d95291dc.83b0b8",
        "name": "status",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "status",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1270,
        "y": 260,
        "wires": []
    },
    {
        "id": "631688df.6f74c",
        "type": "ui_switch",
        "z": "1a447be0.198674",
        "name": "",
        "label": "Manual input",
        "tooltip": "",
        "group": "7b7849e8.363288",
        "order": 1,
        "width": 4,
        "height": 1,
        "passthru": true,
        "decouple": "false",
        "topic": "",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "x": 110,
        "y": 460,
        "wires": [
            [
                "c05c94eb.25471"
            ]
        ]
    },
    {
        "id": "c05c94eb.25471",
        "type": "function",
        "z": "1a447be0.198674",
        "name": "Enable Invert",
        "func": "msg.enabled = !msg.payload;\nmsg.payload = \"\"\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 320,
        "y": 460,
        "wires": [
            [
                "ec0d715e.19fdd",
                "1b5cd285.71fa15",
                "f8c5f7ef.e93908"
            ]
        ]
    },
    {
        "id": "6d0acc39.1d2e9c",
        "type": "ui_text_input",
        "z": "1a447be0.198674",
        "name": "Lat Manual",
        "label": "Latitude",
        "tooltip": "",
        "group": "7b7849e8.363288",
        "order": 7,
        "width": 12,
        "height": 1,
        "passthru": false,
        "mode": "text",
        "delay": "2000",
        "topic": "latitude",
        "x": 650,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "1b5cd285.71fa15",
        "type": "change",
        "z": "1a447be0.198674",
        "name": "invert",
        "rules": [
            {
                "t": "set",
                "p": "enabled",
                "pt": "msg",
                "to": "$not(msg.enabled)",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 490,
        "y": 480,
        "wires": [
            [
                "6d0acc39.1d2e9c",
                "8c2f9e2.0f3cd6"
            ]
        ]
    },
    {
        "id": "8c2f9e2.0f3cd6",
        "type": "ui_text_input",
        "z": "1a447be0.198674",
        "name": "Lon Manual",
        "label": "Longitude",
        "tooltip": "",
        "group": "7b7849e8.363288",
        "order": 6,
        "width": 12,
        "height": 1,
        "passthru": false,
        "mode": "text",
        "delay": "2000",
        "topic": "longitude",
        "x": 650,
        "y": 500,
        "wires": [
            []
        ]
    },
    {
        "id": "34a51d85.680172",
        "type": "inject",
        "z": "1a447be0.198674",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "false",
        "payloadType": "bool",
        "x": 130,
        "y": 420,
        "wires": [
            [
                "c05c94eb.25471",
                "60308f41.f3b54"
            ]
        ]
    },
    {
        "id": "52ea7d01.711034",
        "type": "function",
        "z": "130e0533.4f1813",
        "name": "Encapsulate config",
        "func": "msg.payload = {\n    \"action\":\"update_config\", \n    \"config\":{\n        \"sample_project\":global.get(\"sample_project\"),\n        \"sample_id\":global.get(\"sample_id\"),\n        \"sample_ship\":global.get(\"sample_ship\"),\n        \"sample_operator\":global.get(\"sample_operator\"),\n        \"sample_sampling_gear\":global.get(\"sample_sampling_gear\"),\n        \n        \"acq_id\":global.get(\"acq_id\"),\n        \"acq_instrument\":global.get(\"acq_instrument\"),\n        //\"acq_instrument_id\":global.get(\"acq_instrument_id\"),\n        \"acq_celltype\":global.get(\"acq_celltype\"),\n        \"acq_minimum_mesh\":global.get(\"acq_minimum_mesh\"),\n        \"acq_maximum_mesh\":global.get(\"acq_maximum_mesh\"),\n        \"acq_min_esd\":global.get(\"acq_min_esd\"),\n        \"acq_max_esd\":global.get(\"acq_max_esd\"),\n        \"acq_volume\":global.get(\"acq_volume\"),\n        \"acq_magnification\":global.get(\"magnification\"),\n        \"acq_fnumber_objective\":global.get(\"acq_fnumber_objective\"),\n        \n        \"acq_camera_name\":\"Pi Camera V2.1 - 8MP\",\n        \n        \"object_date\":global.get(\"object_date\"),\n        \"object_time\":global.get(\"object_time\"),\n        \"object_lat\":global.get(\"object_lat\"),\n        \"object_lon\":global.get(\"object_lon\"),\n        \"object_depth_min\":global.get(\"object_depth_min\"),\n        \"object_depth_max\":global.get(\"object_depth_max\"),\n        \n        \"custom_nb_frame\":global.get(\"custom_nb_frame\"),\n        \"custom_nb_step\":global.get(\"custom_nb_step\"),\n        \"custom_segmentation\":global.get(\"custom_segmentation\"),\n        \"custom_sleep_before\":global.get(\"custom_sleep_before\"),\n        \"focus_nb_step\":global.get(\"focus_nb_step\"),\n        \"pump_flowrate\":global.get(\"pump_flowrate\"),\n        \"pump_manual_volume\":global.get(\"pump_manual_volume\"),\n        \n        \"process_pixel\":global.get(\"process_pixel\"),\n        \"process_id\":global.get(\"process_id\")\n    }\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 430,
        "y": 60,
        "wires": [
            [
                "c3e50240.82aa58"
            ]
        ]
    },
    {
        "id": "40c12463.a1f84c",
        "type": "delay",
        "z": "130e0533.4f1813",
        "name": "",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 400,
        "y": 100,
        "wires": [
            [
                "c9f510c0.7d1328"
            ]
        ]
    },
    {
        "id": "4d1b02cb.83b51c",
        "type": "ui_button",
        "z": "130e0533.4f1813",
        "name": "",
        "group": "4361c3b6.e2b7a4",
        "order": 10,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Update config",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "imager/image",
        "x": 200,
        "y": 60,
        "wires": [
            [
                "52ea7d01.711034"
            ]
        ]
    },
    {
        "id": "5a159d39.3bdca4",
        "type": "ui_text",
        "z": "bee3b478.ef4b88",
        "group": "91acd434.6205",
        "order": 3,
        "width": 6,
        "height": 1,
        "name": "imager",
        "label": "Imager status:",
        "format": "{{msg.payload.status}}",
        "layout": "col-center",
        "x": 870,
        "y": 200,
        "wires": []
    },
    {
        "id": "89058790.909e7",
        "type": "ui_text",
        "z": "bee3b478.ef4b88",
        "group": "91acd434.6205",
        "order": 4,
        "width": 6,
        "height": 1,
        "name": "segmenter",
        "label": "Segmenter status:",
        "format": "{{msg.payload.status}}",
        "layout": "col-center",
        "x": 890,
        "y": 240,
        "wires": []
    },
    {
        "id": "dc72e121.0aacd",
        "type": "ui_text",
        "z": "bee3b478.ef4b88",
        "group": "91acd434.6205",
        "order": 1,
        "width": 6,
        "height": 1,
        "name": "focus",
        "label": "Focus status:",
        "format": "{{msg.payload.status}}",
        "layout": "col-center",
        "x": 870,
        "y": 160,
        "wires": []
    },
    {
        "id": "d700c8a1.2d1f48",
        "type": "ui_text",
        "z": "bee3b478.ef4b88",
        "group": "91acd434.6205",
        "order": 2,
        "width": 6,
        "height": 1,
        "name": "pump",
        "label": "Pump status:",
        "format": "{{msg.payload.status}}",
        "layout": "col-center",
        "x": 870,
        "y": 120,
        "wires": []
    },
    {
        "id": "d95c87fe.e4ccd",
        "type": "ui_button",
        "z": "a0f9bde.423644",
        "name": "",
        "group": "de7c8e82.7faa98",
        "order": 1,
        "width": 3,
        "height": 1,
        "passthru": false,
        "label": "UP 1mm",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "{\"action\":\"move\",\"direction\":\"UP\",\"distance\":1}",
        "payloadType": "json",
        "topic": "actuator/focus",
        "x": 280,
        "y": 200,
        "wires": [
            [
                "a8dfcfd1.c5863"
            ]
        ]
    },
    {
        "id": "1be18c84.59a4ab",
        "type": "ui_button",
        "z": "a0f9bde.423644",
        "name": "",
        "group": "de7c8e82.7faa98",
        "order": 5,
        "width": 3,
        "height": 1,
        "passthru": false,
        "label": "DOWN 1mm",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "{\"action\":\"move\",\"direction\":\"DOWN\",\"distance\":1}",
        "payloadType": "json",
        "topic": "actuator/focus",
        "x": 270,
        "y": 240,
        "wires": [
            [
                "a8dfcfd1.c5863"
            ]
        ]
    },
    {
        "id": "d9930546.489a58",
        "type": "ui_slider",
        "z": "a0f9bde.423644",
        "name": "focus_distance",
        "label": "",
        "tooltip": "in m",
        "group": "de7c8e82.7faa98",
        "order": 3,
        "width": 8,
        "height": 1,
        "passthru": true,
        "outs": "end",
        "topic": "focus_distance",
        "min": "25",
        "max": "2000",
        "step": "25",
        "x": 540,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "4a30a6af.fa662",
        "type": "ui_switch",
        "z": "1a447be0.198674",
        "d": true,
        "name": "Worldmap",
        "label": "Display worldmap",
        "tooltip": "",
        "group": "7b7849e8.363288",
        "order": 5,
        "width": 2,
        "height": 1,
        "passthru": true,
        "decouple": "false",
        "topic": "",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "x": 290,
        "y": 260,
        "wires": [
            [
                "60308f41.f3b54"
            ]
        ]
    },
    {
        "id": "60308f41.f3b54",
        "type": "function",
        "z": "1a447be0.198674",
        "d": true,
        "name": "Enable",
        "func": "msg.enabled = msg.payload;\nmsg.payload = \"\"\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 440,
        "y": 260,
        "wires": [
            [
                "f7ae988c.184598"
            ]
        ]
    },
    {
        "id": "35ea3cf0.a398ac",
        "type": "exec",
        "z": "d95291dc.83b0b8",
        "command": "sudo killall -15 python3",
        "addpay": true,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": false,
        "name": "Soft kill",
        "x": 1280,
        "y": 40,
        "wires": [
            [],
            [],
            []
        ]
    },
    {
        "id": "a776b9fc.d542e8",
        "type": "delay",
        "z": "d95291dc.83b0b8",
        "d": true,
        "name": "",
        "pauseType": "delay",
        "timeout": "4",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 700,
        "y": 100,
        "wires": [
            [
                "672d89a8.4e6968"
            ]
        ]
    }
]