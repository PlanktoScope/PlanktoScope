setup:
    sudo apt install -y network-manager dnsmasq-base avahi-utils
    sudo systemctl reenable NetworkManager
    sudo systemctl restart NetworkManager
    sudo cp -r cfg80211_regdomain.conf /etc/modprobe.d/
    sudo chown pi:pi /etc/modprobe.d/cfg80211_regdomain.conf
    sudo cp wlan0-hotspot.ini /etc/NetworkManager/system-connections/wlan0-hotspot.nmconnection
    # "failed to load connection: File permissions (100644) are insecure"
    sudo chmod 0600 /etc/NetworkManager/system-connections/wlan0-hotspot.nmconnection

    # By default we are greeted with
    # "Wi-Fi is currently blocked by rfkill.
    # Enable wifi, country is unset, user will set it.
    # See https://github.com/RPi-Distro/raspberrypi-net-mods/blob/master/etc/profile.d/wifi-check.sh
    sudo rm -f /etc/profile.d/wifi-check.sh

    # Enable wifi by default without selecting a country (will use global)
    sudo cp planktoscope-org.firstboot-wifi.service /etc/systemd/system/
    sudo systemctl reenable planktoscope-org.firstboot-wifi.service
    sudo systemctl restart planktoscope-org.firstboot-wifi.service

    wget https://github.com/grishy/go-avahi-cname/releases/download/v2.3.0/go-avahi-cname_2.3.0_linux_arm64.tar.gz -P /tmp
    cd /tmp && tar -xzf /tmp/go-avahi-cname_2.3.0_linux_arm64.tar.gz go-avahi-cname
    -sudo systemctl stop avahi-publish-cname@planktoscope.local.service
    -sudo systemctl stop avahi-publish-cname@pkscope.local.service
    sudo cp /tmp/go-avahi-cname /usr/local/bin/go-avahi-cname
    sudo cp avahi-publish-cname@.service /usr/lib/systemd/system
    sudo systemctl reenable avahi-publish-cname@planktoscope.local.service avahi-publish-cname@pkscope.local
    sudo systemctl restart avahi-publish-cname@planktoscope.local.service avahi-publish-cname@pkscope.local

    sudo cp hosts /etc/
    sudo cp dnsmasq-shared.properties /etc/NetworkManager/dnsmasq-shared.d/40-config.conf
    sudo ./setup-hostname.sh

test:
    validator wlan0-hotspot.ini
    validator dnsmasq-shared.properties
