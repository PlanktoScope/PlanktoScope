# Refer to the Caddy docs for more information:
# https://caddyserver.com/docs/caddyfile

:80 {
	redir / /dashboard/

	handle /ps/hal/camera/streams/preview.mjpg {
		rewrite * /stream.mjpg
		reverse_proxy localhost:8000
	}

	handle /ps/hal/camera/streams/preview.mjpg {
		rewrite * /stream.mjpg
		reverse_proxy localhost:8000
	}

	handle /ps/processing/segmenter/streams/object.mjpg {
		rewrite * /object.mjpg
		reverse_proxy localhost:8001
	}

	redir /admin/ps/node-red-v2 /admin/ps/node-red-v2/
	handle /admin/ps/node-red-v2/* {
		reverse_proxy localhost:1880
	}

	# base path cannot be changed
	# even with url rewrite, it shows a white page after loading
	# https://github.com/FlowFuse/node-red-dashboard/issues/586
	handle /dashboard/* {
		reverse_proxy localhost:1880
	}

	redir /admin/fs /admin/fs/
	handle /admin/fs/* {
		reverse_proxy localhost:8080
	}

	redir /admin/cockpit /admin/cockpit/
	handle /admin/cockpit/* {
		reverse_proxy localhost:9090
	}
}
