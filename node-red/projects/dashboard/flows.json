[
    {
        "id": "07f3b717f2a2c8c7",
        "type": "tab",
        "label": "Setup",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "1b667c6443413ced",
        "type": "tab",
        "label": "Home",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "ab58b3fd0e6bcd77",
        "type": "tab",
        "label": "Preview",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "190b0c9aa75e8843",
        "type": "tab",
        "label": "Metadata",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "35d7387466dd0bc0",
        "type": "tab",
        "label": "Acquisition",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "0fd76ac156d78937",
        "type": "tab",
        "label": "Segmentation",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "14f8c9b5ce1235cc",
        "type": "tab",
        "label": "Visualization",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "8018bd5586fd4054",
        "type": "tab",
        "label": "Calibration",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "6426e7bea6900426",
        "type": "tab",
        "label": "Calibration - Saturation Level",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "14c685bd04db8be5",
        "type": "tab",
        "label": "Calibration - Lightness",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "3afb1d2b21be9114",
        "type": "tab",
        "label": "Calibration - Pixel size",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "d5b2c64b84f8ed4f",
        "type": "tab",
        "label": "Calibration - Pump",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "8555b76c53e789e0",
        "type": "tab",
        "label": "[TEST] EcoTaxa",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "a02961610bc3982a",
        "type": "tab",
        "label": "[TEST] PlanktoScope nodes",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "4ed26b8b.253504",
        "type": "subflow",
        "name": "Save hardware config",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 40,
                "y": 40,
                "wires": [
                    {
                        "id": "53d163be.47cf24"
                    }
                ]
            }
        ],
        "out": [],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "b7861ce703215a01",
        "type": "subflow",
        "name": "Load hardware config",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 40,
                "y": 40,
                "wires": [
                    {
                        "id": "0f16258953fae292"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 900,
                "y": 40,
                "wires": [
                    {
                        "id": "d0fbcd200cd09981",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "63c85b96537b7355",
        "type": "subflow",
        "name": "Config",
        "info": "An input to this subflow will get the configuration to be saved to disk.\n\nOn startup, this node outputs the loaded configuration",
        "category": "",
        "in": [
            {
                "x": 220,
                "y": 160,
                "wires": [
                    {
                        "id": "5248e5e225d854d1"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1040,
                "y": 60,
                "wires": [
                    {
                        "id": "f1c0a882a9e3d927",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "color": "#DDAA99"
    },
    {
        "id": "f591255fbfc6c466",
        "type": "group",
        "z": "6426e7bea6900426",
        "name": "Step Bar",
        "style": {
            "label": true
        },
        "nodes": [
            "062a3af5e12e8445",
            "e5da27b9abdcb156"
        ],
        "x": 994,
        "y": 19,
        "w": 372,
        "h": 82
    },
    {
        "id": "da1cb3ed0c90bb56",
        "type": "group",
        "z": "3afb1d2b21be9114",
        "name": "Step Bar",
        "style": {
            "label": true
        },
        "nodes": [
            "05a5a9c4530d07ea",
            "419cccaf23eb2548"
        ],
        "x": 994,
        "y": 19,
        "w": 372,
        "h": 82
    },
    {
        "id": "0861054b07c3373d",
        "type": "group",
        "z": "d5b2c64b84f8ed4f",
        "name": "Step Bar",
        "style": {
            "label": true
        },
        "nodes": [
            "c92cd7e25b01278d",
            "f8db1578262f6bc8"
        ],
        "x": 994,
        "y": 19,
        "w": 372,
        "h": 82
    },
    {
        "id": "426f6cef77fbb290",
        "type": "group",
        "z": "14c685bd04db8be5",
        "name": "Step Bar",
        "style": {
            "label": true
        },
        "nodes": [
            "5fbdba7e61973f9a",
            "25cb0163587aee15"
        ],
        "x": 994,
        "y": 19,
        "w": 372,
        "h": 82
    },
    {
        "id": "3bb20cd87e85a6b8",
        "type": "group",
        "z": "a02961610bc3982a",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "abc662f31074fc22",
            "d082d59bfaddcd80",
            "9f5061a034f606a3",
            "1f6f854383bffbc8",
            "0e1835e8b7c470ee"
        ],
        "x": 14,
        "y": 19,
        "w": 752,
        "h": 202
    },
    {
        "id": "153af3e4645145a8",
        "type": "group",
        "z": "a02961610bc3982a",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "7ccb5c8c66ad170a",
            "7bf0f35f3f491657",
            "89c198d4d49eca98",
            "2fe0de4d0d304630",
            "bcdab829fb50bc57"
        ],
        "x": 14,
        "y": 239,
        "w": 812,
        "h": 202
    },
    {
        "id": "cef91df1f697848e",
        "type": "group",
        "z": "a02961610bc3982a",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "29b3163c363f83d7",
            "19da48e7c9119862",
            "28f8ab1b6c179786",
            "4966524cdc764174",
            "f640495d00bb68b9"
        ],
        "x": 14,
        "y": 459,
        "w": 932,
        "h": 182
    },
    {
        "id": "3fe3efd04fb1a41a",
        "type": "group",
        "z": "a02961610bc3982a",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "1433d7bb97c2b52e",
            "58b352badddb48f5",
            "1f1c86a14bf3ac61"
        ],
        "x": 14,
        "y": 659,
        "w": 372,
        "h": 142
    },
    {
        "id": "9c49d230dea06fdf",
        "type": "group",
        "z": "a02961610bc3982a",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "79d35d7ad73f89f9",
            "39cd9534b43ef484",
            "7e293f564d4fbfc4"
        ],
        "x": 14,
        "y": 819,
        "w": 372,
        "h": 142
    },
    {
        "id": "27e22d982f0bcb2f",
        "type": "group",
        "z": "a02961610bc3982a",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "959839bc2c390088",
            "0d10e66bb2b9d1cc",
            "53516cda8e4f5a3c"
        ],
        "x": 414,
        "y": 819,
        "w": 352,
        "h": 142
    },
    {
        "id": "fc6b573a63d6dfaa",
        "type": "group",
        "z": "a02961610bc3982a",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "c34bff0e83b45e68",
            "dc07c747a235da10",
            "f12fd63508bb1b63",
            "2babe27c1bf9d6ef",
            "15f16463c05bb479",
            "b552ca516cc07737",
            "94a433cec8b54203"
        ],
        "x": 934,
        "y": 39,
        "w": 352,
        "h": 262
    },
    {
        "id": "dc792afbab434446",
        "type": "group",
        "z": "a02961610bc3982a",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "50128147f802f133",
            "b9c2e0abaad12bd9",
            "61ebceb724041fb2"
        ],
        "x": 994,
        "y": 499,
        "w": 412,
        "h": 142
    },
    {
        "id": "dc307bb5d26c60f4",
        "type": "group",
        "z": "a02961610bc3982a",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "300343e6b56f088e",
            "da645aa8ebbed646",
            "7d1f9414be49d7c3"
        ],
        "x": 994,
        "y": 659,
        "w": 412,
        "h": 142
    },
    {
        "id": "855d9ef468b5db0f",
        "type": "group",
        "z": "a02961610bc3982a",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "f7c18ab2aa687120",
            "ede7a86fd97b5e1b",
            "af8ce4702c170449",
            "9249e16ed7ae4929"
        ],
        "x": 14,
        "y": 979,
        "w": 562,
        "h": 162
    },
    {
        "id": "91f8b76bf61fc59c",
        "type": "group",
        "z": "a02961610bc3982a",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "a98bde5f8940edbc",
            "59ec9623add53a47",
            "750a1061c84bdae2"
        ],
        "x": 994,
        "y": 819,
        "w": 412,
        "h": 142
    },
    {
        "id": "e6ae26617c24c3ea",
        "type": "ui-base",
        "name": "PlanktoScope",
        "path": "/dashboard",
        "appIcon": "",
        "includeClientData": true,
        "acceptsClientConfig": [
            "ui-notification",
            "ui-control"
        ],
        "showPathInSidebar": true,
        "headerContent": "dashboard",
        "navigationStyle": "none",
        "titleBarStyle": "fixed",
        "showReconnectNotification": true,
        "notificationDisplayTime": "1",
        "showDisconnectNotification": true,
        "allowInstall": true
    },
    {
        "id": "8dc3722c.06efa8",
        "type": "mqtt-broker",
        "name": "",
        "broker": "0.0.0.0",
        "port": "1883",
        "clientid": "Client_node",
        "autoConnect": true,
        "usetls": false,
        "compatmode": false,
        "protocolVersion": 4,
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "closeTopic": "",
        "closeQos": "0",
        "closePayload": "",
        "willTopic": "",
        "willQos": "0",
        "willPayload": ""
    },
    {
        "id": "81a80e32347ff991",
        "type": "ui_base",
        "theme": {
            "name": "theme-light",
            "lightTheme": {
                "default": "#0094CE",
                "baseColor": "#5900ce",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "darkTheme": {
                "default": "#097479",
                "baseColor": "#097479",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "customTheme": {
                "name": "Untitled Theme 1",
                "default": "#4B7930",
                "baseColor": "#4B7930",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
            },
            "themeState": {
                "base-color": {
                    "default": "#0094CE",
                    "value": "#0094CE",
                    "edited": true
                },
                "page-titlebar-backgroundColor": {
                    "value": "#5900ce",
                    "edited": false
                },
                "page-backgroundColor": {
                    "value": "#fafafa",
                    "edited": false
                },
                "page-sidebar-backgroundColor": {
                    "value": "#333333",
                    "edited": false
                },
                "group-textColor": {
                    "value": "#7e1bff",
                    "edited": false
                },
                "group-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "group-backgroundColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "widget-textColor": {
                    "value": "#111111",
                    "edited": false
                },
                "widget-backgroundColor": {
                    "value": "#5900ce",
                    "edited": false
                },
                "widget-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "base-font": {
                    "value": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
                }
            },
            "angularTheme": {
                "primary": "indigo",
                "accents": "blue",
                "warn": "red",
                "background": "grey",
                "palette": "light"
            }
        },
        "site": {
            "name": "PlanktoScope",
            "hideToolbar": "false",
            "allowSwipe": "false",
            "lockMenu": "false",
            "allowTempTheme": "true",
            "dateFormat": "Y-MM-DD",
            "sizes": {
                "sx": 55,
                "sy": 55,
                "gx": 4,
                "gy": 4,
                "cx": 4,
                "cy": 4,
                "px": 4,
                "py": 4
            }
        }
    },
    {
        "id": "f7770f0b818c3a67",
        "type": "ui-theme",
        "name": "PlanktoScope GUI 2",
        "colors": {
            "surface": "#ffffff",
            "primary": "#1976d2",
            "bgPage": "#eef3ff",
            "groupBg": "#ffffff",
            "groupOutline": "#c6d1dc"
        },
        "sizes": {
            "density": "default",
            "pagePadding": "1.5rem",
            "groupGap": "1.5rem",
            "groupBorderRadius": "8px",
            "widgetGap": "0px"
        }
    },
    {
        "id": "73070e06474249b4",
        "type": "ui-page",
        "name": "Metadata",
        "ui": "e6ae26617c24c3ea",
        "path": "/metadata",
        "icon": "information-outline",
        "layout": "grid",
        "theme": "f7770f0b818c3a67",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "6"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "6"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 4,
        "className": "",
        "visible": "true",
        "disabled": "false"
    },
    {
        "id": "dd015fda7456b9b0",
        "type": "ui-group",
        "name": "Navigation Top",
        "page": "73070e06474249b4",
        "width": "12",
        "height": 1,
        "order": 1,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "69c772603e9cec0d",
        "type": "ui-group",
        "name": "Sample Information",
        "page": "73070e06474249b4",
        "width": "12",
        "height": 1,
        "order": 2,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "6fab47af451c6d95",
        "type": "ui-group",
        "name": "Starting point",
        "page": "73070e06474249b4",
        "width": "6",
        "height": 1,
        "order": 3,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "1cfe3062a8353012",
        "type": "ui-group",
        "name": "Ending point",
        "page": "73070e06474249b4",
        "width": "6",
        "height": 1,
        "order": 4,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "cb3521392eb4e9ed",
        "type": "ui-group",
        "name": "Net Specificity",
        "page": "73070e06474249b4",
        "width": "12",
        "height": 1,
        "order": 5,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "dd4d9707051041c9",
        "type": "ui-group",
        "name": "Other informations",
        "page": "73070e06474249b4",
        "width": "12",
        "height": 1,
        "order": 6,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "59ce6abfbb7f8683",
        "type": "ui-group",
        "name": "Navigation Bottom",
        "page": "73070e06474249b4",
        "width": "12",
        "height": 1,
        "order": 7,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "7a4e042a60b734a6",
        "type": "ui-page",
        "name": "Segmentation",
        "ui": "e6ae26617c24c3ea",
        "path": "/segmentation",
        "icon": "crop",
        "layout": "grid",
        "theme": "f7770f0b818c3a67",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "6"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "9"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 6,
        "className": "",
        "visible": "true",
        "disabled": "false"
    },
    {
        "id": "bfd4acb7b243514f",
        "type": "ui-group",
        "name": "List of Acquisitions",
        "page": "7a4e042a60b734a6",
        "width": "12",
        "height": 1,
        "order": 3,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "f22f627015431032",
        "type": "ui-page",
        "name": "Calibration - Lightness",
        "ui": "e6ae26617c24c3ea",
        "path": "/calibration_lightness",
        "icon": "target-variant",
        "layout": "grid",
        "theme": "f7770f0b818c3a67",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "6"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "9"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 10,
        "className": "",
        "visible": "false",
        "disabled": "false"
    },
    {
        "id": "728c7ed3d63dfcee",
        "type": "ui-group",
        "name": "Settings",
        "page": "f22f627015431032",
        "width": "12",
        "height": "1",
        "order": 1,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "aa9ba6cedf56d2cd",
        "type": "ui-page",
        "name": "Calibration - Pixel size",
        "ui": "e6ae26617c24c3ea",
        "path": "/calibration_pixel_size",
        "icon": "target-variant",
        "layout": "grid",
        "theme": "f7770f0b818c3a67",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "6"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "9"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 11,
        "className": "",
        "visible": "false",
        "disabled": "false"
    },
    {
        "id": "c966455a52d121c0",
        "type": "ui-group",
        "name": "Settings",
        "page": "aa9ba6cedf56d2cd",
        "width": "12",
        "height": "1",
        "order": 1,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "48216bc1f7c53a75",
        "type": "ui-page",
        "name": "Calibration - Pump",
        "ui": "e6ae26617c24c3ea",
        "path": "/calibration_pump",
        "icon": "target-variant",
        "layout": "grid",
        "theme": "f7770f0b818c3a67",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "6"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "9"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 12,
        "className": "",
        "visible": "false",
        "disabled": "false"
    },
    {
        "id": "6039d653304537af",
        "type": "ui-group",
        "name": "Settings",
        "page": "48216bc1f7c53a75",
        "width": "12",
        "height": "1",
        "order": 1,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "803aa402d5c66b73",
        "type": "ui-page",
        "name": "Calibration - Saturation Level",
        "ui": "e6ae26617c24c3ea",
        "path": "/calibration_saturation_level",
        "icon": "target-variant",
        "layout": "grid",
        "theme": "f7770f0b818c3a67",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "6"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "9"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 9,
        "className": "",
        "visible": "false",
        "disabled": "false"
    },
    {
        "id": "af8acdfe9afbad74",
        "type": "ui-group",
        "name": "Settings",
        "page": "803aa402d5c66b73",
        "width": "12",
        "height": "1",
        "order": 1,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "f8dd620721c6d70b",
        "type": "ui-page",
        "name": "Calibration",
        "ui": "e6ae26617c24c3ea",
        "path": "/calibration",
        "icon": "mdi-tune",
        "layout": "grid",
        "theme": "f7770f0b818c3a67",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "6"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "9"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 7,
        "className": "",
        "visible": "true",
        "disabled": "false"
    },
    {
        "id": "c29c835a70533b69",
        "type": "ui-group",
        "name": "header",
        "page": "f8dd620721c6d70b",
        "width": "12",
        "height": 1,
        "order": 1,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "822cdc5b6ef13f39",
        "type": "ui-group",
        "name": "body",
        "page": "f8dd620721c6d70b",
        "width": "12",
        "height": 1,
        "order": 2,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "bcc78241b99ba27f",
        "type": "ui-page",
        "name": "Preview",
        "ui": "e6ae26617c24c3ea",
        "path": "/preview",
        "icon": "mdi-eye",
        "layout": "grid",
        "theme": "f7770f0b818c3a67",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "6"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "6"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 3,
        "className": "",
        "visible": "true",
        "disabled": "false"
    },
    {
        "id": "58ab4d5e3dd68192",
        "type": "ui-group",
        "name": "Streaming",
        "page": "bcc78241b99ba27f",
        "width": "6",
        "height": 1,
        "order": 2,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "39cbd2658f16d608",
        "type": "ui-group",
        "name": "Settings",
        "page": "bcc78241b99ba27f",
        "width": "6",
        "height": 1,
        "order": 3,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "5c3e73c675caac42",
        "type": "ui-page",
        "name": "Acquisition",
        "ui": "e6ae26617c24c3ea",
        "path": "/acquisition",
        "icon": "video-image",
        "layout": "grid",
        "theme": "f7770f0b818c3a67",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "6"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "6"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 5,
        "className": "",
        "visible": "true",
        "disabled": "false"
    },
    {
        "id": "b274327af3807b79",
        "type": "ui-group",
        "name": "Streaming",
        "page": "5c3e73c675caac42",
        "width": "6",
        "height": 1,
        "order": 2,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "d2f77573ed4317e4",
        "type": "ui-group",
        "name": "Acquisition settings",
        "page": "5c3e73c675caac42",
        "width": "6",
        "height": 1,
        "order": 3,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "632260133d581caa",
        "type": "ui-page",
        "name": "Home",
        "ui": "e6ae26617c24c3ea",
        "path": "/home",
        "icon": "home",
        "layout": "grid",
        "theme": "f7770f0b818c3a67",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "3"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "12"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 2,
        "className": "",
        "visible": "true",
        "disabled": "false"
    },
    {
        "id": "5d39a98563150f22",
        "type": "ui-group",
        "name": "body",
        "page": "632260133d581caa",
        "width": "12",
        "height": 1,
        "order": 1,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "7572915171e440cd",
        "type": "ui-group",
        "name": "Navigation Top",
        "page": "bcc78241b99ba27f",
        "width": "12",
        "height": 1,
        "order": 1,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "3ae252a2e5abca89",
        "type": "ui-group",
        "name": "Navigation Top",
        "page": "5c3e73c675caac42",
        "width": "12",
        "height": 1,
        "order": 1,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "55c2fe64e681037d",
        "type": "ui-group",
        "name": "Navigation bottom",
        "page": "bcc78241b99ba27f",
        "width": "12",
        "height": 1,
        "order": 4,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "3d88a1872dbbf8a7",
        "type": "ui-group",
        "name": "Navigation bottom",
        "page": "5c3e73c675caac42",
        "width": "12",
        "height": 1,
        "order": 4,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "9b992ca6515ed058",
        "type": "ui-group",
        "name": "Navigation Top",
        "page": "7a4e042a60b734a6",
        "width": "12",
        "height": 1,
        "order": 1,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "9f00807878a32dd5",
        "type": "ui-group",
        "name": "Navigation Bottom",
        "page": "7a4e042a60b734a6",
        "width": "12",
        "height": 1,
        "order": 4,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "d129fac8e7742d5b",
        "type": "ui-page",
        "name": "Visualization",
        "ui": "e6ae26617c24c3ea",
        "path": "/visualization",
        "icon": "chart-scatter-plot",
        "layout": "grid",
        "theme": "f7770f0b818c3a67",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "6"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "9"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 8,
        "className": "",
        "visible": "true",
        "disabled": "false"
    },
    {
        "id": "b570f76ef526af45",
        "type": "ui-group",
        "name": "Navigation Top",
        "page": "d129fac8e7742d5b",
        "width": "12",
        "height": 1,
        "order": 1,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "1d3abb201c51ff47",
        "type": "ui-group",
        "name": "Navigation Bottom",
        "page": "d129fac8e7742d5b",
        "width": "12",
        "height": 1,
        "order": 15,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "402b3d24c87ab0d2",
        "type": "ui-group",
        "name": "Informations",
        "page": "7a4e042a60b734a6",
        "width": "12",
        "height": 1,
        "order": 2,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "fa6393a7d7e3b7d7",
        "type": "ui-group",
        "name": "List of Segmentation",
        "page": "d129fac8e7742d5b",
        "width": "12",
        "height": 1,
        "order": 2,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "34112984a39c35bd",
        "type": "ui-page",
        "name": "Setup",
        "ui": "e6ae26617c24c3ea",
        "path": "/setup",
        "icon": "cog",
        "layout": "grid",
        "theme": "f7770f0b818c3a67",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "6"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "9"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 1,
        "className": "",
        "visible": "true",
        "disabled": "false"
    },
    {
        "id": "de680effc3e27451",
        "type": "ui-group",
        "name": "body",
        "page": "34112984a39c35bd",
        "width": "12",
        "height": 1,
        "order": 1,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "c5651e1a3e56f3f5",
        "type": "ui-group",
        "name": "Explorer",
        "page": "d129fac8e7742d5b",
        "width": "12",
        "height": 1,
        "order": 13,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "0c1537ce71affc2b",
        "type": "ui-group",
        "name": "Gallery",
        "page": "d129fac8e7742d5b",
        "width": "12",
        "height": 1,
        "order": 14,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "36931a9722892790",
        "type": "ui-group",
        "name": "Software Version",
        "page": "632260133d581caa",
        "width": "3",
        "height": 1,
        "order": 6,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "2aa235120084abe4",
        "type": "ui-group",
        "name": "Images Acquired",
        "page": "632260133d581caa",
        "width": "3",
        "height": 1,
        "order": 7,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "df7c60bd8b265e48",
        "type": "ui-group",
        "name": "Objects Segmented",
        "page": "632260133d581caa",
        "width": "3",
        "height": 1,
        "order": 8,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "dc304678d9a6b53b",
        "type": "ui-group",
        "name": "Storage",
        "page": "632260133d581caa",
        "width": "3",
        "height": 1,
        "order": 9,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "8a113b6c8e1eadb7",
        "type": "ui-group",
        "name": "Learn the basic",
        "page": "632260133d581caa",
        "width": "12",
        "height": 1,
        "order": 5,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "97e552a2d05b0800",
        "type": "ui-group",
        "name": "Lanch the preview",
        "page": "632260133d581caa",
        "width": "4",
        "height": 1,
        "order": 2,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "82480e386ed6f8bd",
        "type": "ui-group",
        "name": "Explore your data",
        "page": "632260133d581caa",
        "width": "4",
        "height": 1,
        "order": 3,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "9d3e8bdd535f0e0d",
        "type": "ui-group",
        "name": "Run the Calibration",
        "page": "632260133d581caa",
        "width": "4",
        "height": 1,
        "order": 4,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "53490f9c39e2065d",
        "type": "ui-group",
        "name": "Informations",
        "page": "d129fac8e7742d5b",
        "width": "12",
        "height": 1,
        "order": 3,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "90b33e458dd29d04",
        "type": "ui-group",
        "name": "Heat Map",
        "page": "d129fac8e7742d5b",
        "width": 6,
        "height": 1,
        "order": 4,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "47800358cf7cee25",
        "type": "ui-group",
        "name": "ESD Histogram",
        "page": "d129fac8e7742d5b",
        "width": 6,
        "height": 1,
        "order": 5,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "1d9c6927a0e0a71b",
        "type": "ui-group",
        "name": "Timeline",
        "page": "d129fac8e7742d5b",
        "width": "12",
        "height": 1,
        "order": 6,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "03ad1c8f517e8769",
        "type": "ui-group",
        "name": "Colorspace",
        "page": "d129fac8e7742d5b",
        "width": "4",
        "height": 1,
        "order": 7,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "0be15f8190e6fd43",
        "type": "ui-group",
        "name": "Aspect",
        "page": "d129fac8e7742d5b",
        "width": "4",
        "height": 1,
        "order": 8,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "1edc962c44888abc",
        "type": "ui-group",
        "name": "Greenness",
        "page": "d129fac8e7742d5b",
        "width": "4",
        "height": 1,
        "order": 9,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "67c63cc92c23c4b1",
        "type": "ui-group",
        "name": "Complexity",
        "page": "d129fac8e7742d5b",
        "width": "4",
        "height": 1,
        "order": 10,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "95a152a68b7ba779",
        "type": "ui-group",
        "name": "Texture",
        "page": "d129fac8e7742d5b",
        "width": "4",
        "height": 1,
        "order": 11,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "1baa943e505febf1",
        "type": "ui-group",
        "name": "Solidity",
        "page": "d129fac8e7742d5b",
        "width": "4",
        "height": 1,
        "order": 12,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "82099021.9ceb08",
        "type": "file",
        "z": "4ed26b8b.253504",
        "name": "",
        "filename": "/home/pi/PlanktoScope/hardware.json",
        "appendNewline": true,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 660,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "bb0a8725.a1849",
        "type": "json",
        "z": "4ed26b8b.253504",
        "name": "Create JSON",
        "property": "payload",
        "action": "str",
        "pretty": true,
        "x": 490,
        "y": 40,
        "wires": [
            [
                "82099021.9ceb08"
            ]
        ]
    },
    {
        "id": "53d163be.47cf24",
        "type": "function",
        "z": "4ed26b8b.253504",
        "name": "Update and retrieve hardware_conf",
        "func": "// change global\nhardware_conf = global.get(\"hardware_conf\");\n\nif (msg.topic == \"process_pixel_fixed\" && msg.payload == 0){\n    delete hardware_conf[msg.topic]\n    delete msg.topic\n}\n\nif (msg.topic !== null && msg.topic !== undefined){\n    hardware_conf[msg.topic] = msg.payload;\n    global.set(\"hardware_conf\", hardware_conf);\n}\n\nreturn {\"payload\": hardware_conf};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 240,
        "y": 40,
        "wires": [
            [
                "bb0a8725.a1849"
            ]
        ]
    },
    {
        "id": "0f16258953fae292",
        "type": "file in",
        "z": "b7861ce703215a01",
        "name": "",
        "filename": "/home/pi/PlanktoScope/hardware.json",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 250,
        "y": 40,
        "wires": [
            [
                "81c516291ab19acd"
            ]
        ],
        "info": "# PlanktoScope Help\nThis Node will read the content of the file named **config.txt** containing all the input placeholders.\n"
    },
    {
        "id": "81c516291ab19acd",
        "type": "json",
        "z": "b7861ce703215a01",
        "name": "Parse JSON",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 510,
        "y": 40,
        "wires": [
            [
                "d0fbcd200cd09981"
            ]
        ]
    },
    {
        "id": "d0fbcd200cd09981",
        "type": "change",
        "z": "b7861ce703215a01",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "hardware_conf",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 730,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "730b2780ac215a52",
        "type": "file in",
        "z": "63c85b96537b7355",
        "name": "",
        "filename": "/home/pi/PlanktoScope/config.json",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "x": 560,
        "y": 60,
        "wires": [
            [
                "e0b7238a0c5d4ed0"
            ]
        ],
        "info": "# PlanktoScope Help\nThis Node will read the content of the file named **config.txt** containing all the input placeholders.\n"
    },
    {
        "id": "e0b7238a0c5d4ed0",
        "type": "json",
        "z": "63c85b96537b7355",
        "name": "config.json",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 730,
        "y": 60,
        "wires": [
            [
                "f1c0a882a9e3d927"
            ]
        ]
    },
    {
        "id": "b8109badf5f39d35",
        "type": "file",
        "z": "63c85b96537b7355",
        "name": "",
        "filename": "/home/pi/PlanktoScope/config.json",
        "appendNewline": true,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 990,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "31ae9b857627673c",
        "type": "json",
        "z": "63c85b96537b7355",
        "name": "config.json",
        "property": "payload",
        "action": "str",
        "pretty": true,
        "x": 730,
        "y": 160,
        "wires": [
            [
                "b8109badf5f39d35"
            ]
        ]
    },
    {
        "id": "f1c0a882a9e3d927",
        "type": "function",
        "z": "63c85b96537b7355",
        "name": "Global Set",
        "func": "global.set(\"config_keys\", Object.keys(msg.payload));\n\nfor (const key in msg.payload) {\n    global.set(key, msg.payload[key]);\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "24ea99bb02eeffa2",
        "type": "inject",
        "z": "63c85b96537b7355",
        "name": "Load config",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payloadType": "str",
        "x": 230,
        "y": 60,
        "wires": [
            [
                "730b2780ac215a52"
            ]
        ]
    },
    {
        "id": "5248e5e225d854d1",
        "type": "function",
        "z": "63c85b96537b7355",
        "name": "get config payload",
        "func": "keys = global.get(\"config_keys\")\n\nvar payload = {}\n\nkeys.forEach(function(item, index, array) {\n  payload[item] = global.get(item);\n})\n\nreturn {\"payload\": payload};",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 160,
        "wires": [
            [
                "31ae9b857627673c"
            ]
        ]
    },
    {
        "id": "97f8a94e71055782",
        "type": "ui_ui_control",
        "z": "63c85b96537b7355",
        "name": "Connect Event",
        "events": "connect",
        "x": 220,
        "y": 100,
        "wires": [
            [
                "730b2780ac215a52"
            ]
        ]
    },
    {
        "id": "7e7d02f3ea356eff",
        "type": "switch",
        "z": "07f3b717f2a2c8c7",
        "name": "msg.payload.page.path === \"/home\"",
        "property": "payload.page.path",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "/home",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 570,
        "y": 40,
        "wires": [
            [
                "d55333906aeb7517"
            ]
        ]
    },
    {
        "id": "f49d711b2738e87e",
        "type": "switch",
        "z": "07f3b717f2a2c8c7",
        "name": "msg.topic === \"$pageview\"",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "$pageview",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 280,
        "y": 40,
        "wires": [
            [
                "7e7d02f3ea356eff"
            ]
        ]
    },
    {
        "id": "b1f5b8b5f26121e6",
        "type": "ui-event",
        "z": "07f3b717f2a2c8c7",
        "ui": "e6ae26617c24c3ea",
        "name": "UI Event",
        "x": 80,
        "y": 40,
        "wires": [
            [
                "f49d711b2738e87e"
            ]
        ]
    },
    {
        "id": "d55333906aeb7517",
        "type": "function",
        "z": "07f3b717f2a2c8c7",
        "name": "Get Global Variables",
        "func": "const keys = global.keys(); // Get all global variable keys\nmsg.payload = {}; // Initialize the payload object\n\nkeys.forEach(key => {\n    // Ignore keys that start with \"$\"\n    if (!key.startsWith('$')) {\n        msg.payload[key] = global.get(key);\n    }\n});\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 120,
        "y": 140,
        "wires": [
            [
                "87b0cc67cfa07120"
            ]
        ]
    },
    {
        "id": "87b0cc67cfa07120",
        "type": "ui-template",
        "z": "07f3b717f2a2c8c7",
        "group": "de680effc3e27451",
        "page": "",
        "ui": "",
        "name": "body",
        "order": 1,
        "width": "0",
        "height": "0",
        "head": "",
        "format": "<template>\n    <v-container fluid>\n        <v-card elevation=\"4\">\n            <!-- Header -->\n            <v-card-item class=\"bg-primary pa-4\">\n                <template v-slot:prepend>\n                    <v-icon icon=\"mdi-microscope\" size=\"large\" class=\"mr-2\"></v-icon>\n                </template>\n                <v-card-title class=\"text-h6 font-weight-bold\">\n                    Welcome to the PlanktoScope GUI\n                </v-card-title>\n            </v-card-item>\n\n            <v-card-text>\n                <div class=\"text-h6 my-4\">Enter your information</div>\n\n                <v-form ref=\"form\" v-model=\"valid\">\n                    <v-row>\n                        <!-- Region / Country Select -->\n                        <v-col cols=\"12\" md=\"12\" class=\"pa-0\">\n                            <v-autocomplete v-model=\"formData.country\" :items=\"countries\" item-title=\"label\"\n                                item-value=\"value\" label=\"Region\" placeholder=\"Please select\" variant=\"outlined\"\n                                density=\"compact\" clearable></v-autocomplete>\n                        </v-col>\n\n                        <!-- Timezone Select -->\n                        <v-col cols=\"12\" md=\"12\" class=\"pa-0\">\n                            <v-autocomplete v-model=\"formData.timezone\" :items=\"timezones\" label=\"Timezone\"\n                                placeholder=\"Please select\" variant=\"outlined\" density=\"compact\"\n                                clearable></v-autocomplete>\n                        </v-col>\n                    </v-row>\n                </v-form>\n            </v-card-text>\n\n            <!-- Actions -->\n            <v-card-actions class=\"pa-4\" >\n                <v-spacer></v-spacer>\n                <v-btn variant=\"flat\" class=\"px-4\" size=\"large\" color=\"primary\" @click=\"submitForm\" :disabled=\"!isValid\">\n                    <v-icon start>mdi-content-save</v-icon>\n                    Save Configuration\n                </v-btn>\n            </v-card-actions>\n        </v-card>\n    </v-container>\n</template>\n\n<script>\n    export default {\n    data() {\n        return {\n            valid: true,\n            formData: {\n                country: \"\",\n                timezone: \"UTC\", // Valeur par dfaut modifie\n            },\n            // Large lists are loaded in mounted to keep data cleaner\n            countries: [],\n            timezones: []\n        };\n    },\n    computed: {\n        isValid() {\n            return this.formData.country && this.formData.timezone;\n        }\n    },\n    methods: {\n        submitForm() {\n            // Send the form data to Node-RED\n            this.send({ payload: this.formData });\n        }\n    },\n    mounted() {\n        // Populating the massive lists provided in the prompt\n        this.countries = [\n            { value: \"AF\", label: \"Afghanistan\" },\n            { value: \"AX\", label: \"land Islands\" },\n            { value: \"AL\", label: \"Albania\" },\n            { value: \"DZ\", label: \"Algeria\" },\n            { value: \"AD\", label: \"Andorra\" },\n            { value: \"AO\", label: \"Angola\" },\n            { value: \"AI\", label: \"Anguilla\" },\n            { value: \"AQ\", label: \"Antarctica\" },\n            { value: \"AG\", label: \"Antigua & Barbuda\" },\n            { value: \"AR\", label: \"Argentina\" },\n            { value: \"AM\", label: \"Armenia\" },\n            { value: \"AW\", label: \"Aruba\" },\n            { value: \"AU\", label: \"Australia\" },\n            { value: \"AT\", label: \"Austria\" },\n            { value: \"AZ\", label: \"Azerbaijan\" },\n            { value: \"BS\", label: \"Bahamas\" },\n            { value: \"BH\", label: \"Bahrain\" },\n            { value: \"BD\", label: \"Bangladesh\" },\n            { value: \"BB\", label: \"Barbados\" },\n            { value: \"BY\", label: \"Belarus\" },\n            { value: \"BE\", label: \"Belgium\" },\n            { value: \"BZ\", label: \"Belize\" },\n            { value: \"BJ\", label: \"Benin\" },\n            { value: \"BM\", label: \"Bermuda\" },\n            { value: \"BT\", label: \"Bhutan\" },\n            { value: \"BO\", label: \"Bolivia\" },\n            { value: \"BA\", label: \"Bosnia & Herzegovina\" },\n            { value: \"BW\", label: \"Botswana\" },\n            { value: \"BV\", label: \"Bouvet Island\" },\n            { value: \"BR\", label: \"Brazil\" },\n            { value: \"GB\", label: \"Britain (UK)\" },\n            { value: \"IO\", label: \"British Indian Ocean Territory\" },\n            { value: \"BN\", label: \"Brunei\" },\n            { value: \"BG\", label: \"Bulgaria\" },\n            { value: \"BF\", label: \"Burkina Faso\" },\n            { value: \"BI\", label: \"Burundi\" },\n            { value: \"KH\", label: \"Cambodia\" },\n            { value: \"CM\", label: \"Cameroon\" },\n            { value: \"CA\", label: \"Canada\" },\n            { value: \"CV\", label: \"Cape Verde\" },\n            { value: \"BQ\", label: \"Caribbean NL\" },\n            { value: \"KY\", label: \"Cayman Islands\" },\n            { value: \"CF\", label: \"Central African Rep.\" },\n            { value: \"TD\", label: \"Chad\" },\n            { value: \"CL\", label: \"Chile\" },\n            { value: \"CN\", label: \"China\" },\n            { value: \"CX\", label: \"Christmas Island\" },\n            { value: \"CC\", label: \"Cocos (Keeling) Islands\" },\n            { value: \"CO\", label: \"Colombia\" },\n            { value: \"KM\", label: \"Comoros\" },\n            { value: \"CD\", label: \"Congo (Dem. Rep.)\" },\n            { value: \"CG\", label: \"Congo (Rep.)\" },\n            { value: \"CK\", label: \"Cook Islands\" },\n            { value: \"CR\", label: \"Costa Rica\" },\n            { value: \"CI\", label: \"Cte d'Ivoire\" },\n            { value: \"HR\", label: \"Croatia\" },\n            { value: \"CU\", label: \"Cuba\" },\n            { value: \"CW\", label: \"Curaao\" },\n            { value: \"CY\", label: \"Cyprus\" },\n            { value: \"CZ\", label: \"Czech Republic\" },\n            { value: \"DK\", label: \"Denmark\" },\n            { value: \"DJ\", label: \"Djibouti\" },\n            { value: \"DM\", label: \"Dominica\" },\n            { value: \"DO\", label: \"Dominican Republic\" },\n            { value: \"TL\", label: \"East Timor\" },\n            { value: \"EC\", label: \"Ecuador\" },\n            { value: \"EG\", label: \"Egypt\" },\n            { value: \"SV\", label: \"El Salvador\" },\n            { value: \"GQ\", label: \"Equatorial Guinea\" },\n            { value: \"ER\", label: \"Eritrea\" },\n            { value: \"EE\", label: \"Estonia\" },\n            { value: \"SZ\", label: \"Eswatini (Swaziland)\" },\n            { value: \"ET\", label: \"Ethiopia\" },\n            { value: \"FK\", label: \"Falkland Islands\" },\n            { value: \"FO\", label: \"Faroe Islands\" },\n            { value: \"FJ\", label: \"Fiji\" },\n            { value: \"FI\", label: \"Finland\" },\n            { value: \"FR\", label: \"France\" },\n            { value: \"GF\", label: \"French Guiana\" },\n            { value: \"PF\", label: \"French Polynesia\" },\n            { value: \"TF\", label: \"French S. Terr.\" },\n            { value: \"GA\", label: \"Gabon\" },\n            { value: \"GM\", label: \"Gambia\" },\n            { value: \"GE\", label: \"Georgia\" },\n            { value: \"DE\", label: \"Germany\" },\n            { value: \"GH\", label: \"Ghana\" },\n            { value: \"GI\", label: \"Gibraltar\" },\n            { value: \"GR\", label: \"Greece\" },\n            { value: \"GL\", label: \"Greenland\" },\n            { value: \"GD\", label: \"Grenada\" },\n            { value: \"GP\", label: \"Guadeloupe\" },\n            { value: \"GU\", label: \"Guam\" },\n            { value: \"GT\", label: \"Guatemala\" },\n            { value: \"GG\", label: \"Guernsey\" },\n            { value: \"GN\", label: \"Guinea\" },\n            { value: \"GW\", label: \"Guinea-Bissau\" },\n            { value: \"GY\", label: \"Guyana\" },\n            { value: \"HT\", label: \"Haiti\" },\n            { value: \"HM\", label: \"Heard Island & McDonald Islands\" },\n            { value: \"HN\", label: \"Honduras\" },\n            { value: \"HK\", label: \"Hong Kong\" },\n            { value: \"HU\", label: \"Hungary\" },\n            { value: \"IS\", label: \"Iceland\" },\n            { value: \"IN\", label: \"India\" },\n            { value: \"ID\", label: \"Indonesia\" },\n            { value: \"IR\", label: \"Iran\" },\n            { value: \"IQ\", label: \"Iraq\" },\n            { value: \"IE\", label: \"Ireland\" },\n            { value: \"IM\", label: \"Isle of Man\" },\n            { value: \"IL\", label: \"Israel\" },\n            { value: \"IT\", label: \"Italy\" },\n            { value: \"JM\", label: \"Jamaica\" },\n            { value: \"JP\", label: \"Japan\" },\n            { value: \"JE\", label: \"Jersey\" },\n            { value: \"JO\", label: \"Jordan\" },\n            { value: \"KZ\", label: \"Kazakhstan\" },\n            { value: \"KE\", label: \"Kenya\" },\n            { value: \"KI\", label: \"Kiribati\" },\n            { value: \"KP\", label: \"Korea (North)\" },\n            { value: \"KR\", label: \"Korea (South)\" },\n            { value: \"KW\", label: \"Kuwait\" },\n            { value: \"KG\", label: \"Kyrgyzstan\" },\n            { value: \"LA\", label: \"Laos\" },\n            { value: \"LV\", label: \"Latvia\" },\n            { value: \"LB\", label: \"Lebanon\" },\n            { value: \"LS\", label: \"Lesotho\" },\n            { value: \"LR\", label: \"Liberia\" },\n            { value: \"LY\", label: \"Libya\" },\n            { value: \"LI\", label: \"Liechtenstein\" },\n            { value: \"LT\", label: \"Lithuania\" },\n            { value: \"LU\", label: \"Luxembourg\" },\n            { value: \"MO\", label: \"Macau\" },\n            { value: \"MG\", label: \"Madagascar\" },\n            { value: \"MW\", label: \"Malawi\" },\n            { value: \"MY\", label: \"Malaysia\" },\n            { value: \"MV\", label: \"Maldives\" },\n            { value: \"ML\", label: \"Mali\" },\n            { value: \"MT\", label: \"Malta\" },\n            { value: \"MH\", label: \"Marshall Islands\" },\n            { value: \"MQ\", label: \"Martinique\" },\n            { value: \"MR\", label: \"Mauritania\" },\n            { value: \"MU\", label: \"Mauritius\" },\n            { value: \"YT\", label: \"Mayotte\" },\n            { value: \"MX\", label: \"Mexico\" },\n            { value: \"FM\", label: \"Micronesia\" },\n            { value: \"MD\", label: \"Moldova\" },\n            { value: \"MC\", label: \"Monaco\" },\n            { value: \"MN\", label: \"Mongolia\" },\n            { value: \"ME\", label: \"Montenegro\" },\n            { value: \"MS\", label: \"Montserrat\" },\n            { value: \"MA\", label: \"Morocco\" },\n            { value: \"MZ\", label: \"Mozambique\" },\n            { value: \"MM\", label: \"Myanmar (Burma)\" },\n            { value: \"NA\", label: \"Namibia\" },\n            { value: \"NR\", label: \"Nauru\" },\n            { value: \"NP\", label: \"Nepal\" },\n            { value: \"NL\", label: \"Netherlands\" },\n            { value: \"NC\", label: \"New Caledonia\" },\n            { value: \"NZ\", label: \"New Zealand\" },\n            { value: \"NI\", label: \"Nicaragua\" },\n            { value: \"NE\", label: \"Niger\" },\n            { value: \"NG\", label: \"Nigeria\" },\n            { value: \"NU\", label: \"Niue\" },\n            { value: \"NF\", label: \"Norfolk Island\" },\n            { value: \"MK\", label: \"North Macedonia\" },\n            { value: \"MP\", label: \"Northern Mariana Islands\" },\n            { value: \"NO\", label: \"Norway\" },\n            { value: \"OM\", label: \"Oman\" },\n            { value: \"PK\", label: \"Pakistan\" },\n            { value: \"PW\", label: \"Palau\" },\n            { value: \"PS\", label: \"Palestine\" },\n            { value: \"PA\", label: \"Panama\" },\n            { value: \"PG\", label: \"Papua New Guinea\" },\n            { value: \"PY\", label: \"Paraguay\" },\n            { value: \"PE\", label: \"Peru\" },\n            { value: \"PH\", label: \"Philippines\" },\n            { value: \"PN\", label: \"Pitcairn\" },\n            { value: \"PL\", label: \"Poland\" },\n            { value: \"PT\", label: \"Portugal\" },\n            { value: \"PR\", label: \"Puerto Rico\" },\n            { value: \"QA\", label: \"Qatar\" },\n            { value: \"RE\", label: \"Runion\" },\n            { value: \"RO\", label: \"Romania\" },\n            { value: \"RU\", label: \"Russia\" },\n            { value: \"RW\", label: \"Rwanda\" },\n            { value: \"AS\", label: \"Samoa (American)\" },\n            { value: \"WS\", label: \"Samoa (western)\" },\n            { value: \"SM\", label: \"San Marino\" },\n            { value: \"ST\", label: \"Sao Tome & Principe\" },\n            { value: \"SA\", label: \"Saudi Arabia\" },\n            { value: \"SN\", label: \"Senegal\" },\n            { value: \"RS\", label: \"Serbia\" },\n            { value: \"SC\", label: \"Seychelles\" },\n            { value: \"SL\", label: \"Sierra Leone\" },\n            { value: \"SG\", label: \"Singapore\" },\n            { value: \"SK\", label: \"Slovakia\" },\n            { value: \"SI\", label: \"Slovenia\" },\n            { value: \"SB\", label: \"Solomon Islands\" },\n            { value: \"SO\", label: \"Somalia\" },\n            { value: \"ZA\", label: \"South Africa\" },\n            { value: \"GS\", label: \"South Georgia & the South Sandwich Islands\" },\n            { value: \"SS\", label: \"South Sudan\" },\n            { value: \"ES\", label: \"Spain\" },\n            { value: \"LK\", label: \"Sri Lanka\" },\n            { value: \"BL\", label: \"St Barthelemy\" },\n            { value: \"SH\", label: \"St Helena\" },\n            { value: \"KN\", label: \"St Kitts & Nevis\" },\n            { value: \"LC\", label: \"St Lucia\" },\n            { value: \"SX\", label: \"St Maarten (Dutch)\" },\n            { value: \"MF\", label: \"St Martin (French)\" },\n            { value: \"PM\", label: \"St Pierre & Miquelon\" },\n            { value: \"VC\", label: \"St Vincent\" },\n            { value: \"SD\", label: \"Sudan\" },\n            { value: \"SR\", label: \"Suriname\" },\n            { value: \"SJ\", label: \"Svalbard & Jan Mayen\" },\n            { value: \"SE\", label: \"Sweden\" },\n            { value: \"CH\", label: \"Switzerland\" },\n            { value: \"SY\", label: \"Syria\" },\n            { value: \"TW\", label: \"Taiwan\" },\n            { value: \"TJ\", label: \"Tajikistan\" },\n            { value: \"TZ\", label: \"Tanzania\" },\n            { value: \"TH\", label: \"Thailand\" },\n            { value: \"TG\", label: \"Togo\" },\n            { value: \"TK\", label: \"Tokelau\" },\n            { value: \"TO\", label: \"Tonga\" },\n            { value: \"TT\", label: \"Trinidad & Tobago\" },\n            { value: \"TN\", label: \"Tunisia\" },\n            { value: \"TR\", label: \"Turkey\" },\n            { value: \"TM\", label: \"Turkmenistan\" },\n            { value: \"TC\", label: \"Turks & Caicos Is\" },\n            { value: \"TV\", label: \"Tuvalu\" },\n            { value: \"UG\", label: \"Uganda\" },\n            { value: \"UA\", label: \"Ukraine\" },\n            { value: \"AE\", label: \"United Arab Emirates\" },\n            { value: \"US\", label: \"United States\" },\n            { value: \"UY\", label: \"Uruguay\" },\n            { value: \"UM\", label: \"US minor outlying islands\" },\n            { value: \"UZ\", label: \"Uzbekistan\" },\n            { value: \"VU\", label: \"Vanuatu\" },\n            { value: \"VA\", label: \"Vatican City\" },\n            { value: \"VE\", label: \"Venezuela\" },\n            { value: \"VN\", label: \"Vietnam\" },\n            { value: \"VG\", label: \"Virgin Islands (UK)\" },\n            { value: \"VI\", label: \"Virgin Islands (US)\" },\n            { value: \"WF\", label: \"Wallis & Futuna\" },\n            { value: \"EH\", label: \"Western Sahara\" },\n            { value: \"YE\", label: \"Yemen\" },\n            { value: \"ZM\", label: \"Zambia\" },\n            { value: \"ZW\", label: \"Zimbabwe\" }\n        ];\n        \n        this.timezones = [\n            \"Africa/Abidjan\", \"Africa/Accra\", \"Africa/Addis_Ababa\", \"Africa/Algiers\", \"Africa/Asmara\", \"Africa/Asmera\", \"Africa/Bamako\", \"Africa/Bangui\", \"Africa/Banjul\", \"Africa/Bissau\", \"Africa/Blantyre\", \"Africa/Brazzaville\", \"Africa/Bujumbura\", \"Africa/Cairo\", \"Africa/Casablanca\", \"Africa/Ceuta\", \"Africa/Conakry\", \"Africa/Dakar\", \"Africa/Dar_es_Salaam\", \"Africa/Djibouti\", \"Africa/Douala\", \"Africa/El_Aaiun\", \"Africa/Freetown\", \"Africa/Gaborone\", \"Africa/Harare\", \"Africa/Johannesburg\", \"Africa/Juba\", \"Africa/Kampala\", \"Africa/Khartoum\", \"Africa/Kigali\", \"Africa/Kinshasa\", \"Africa/Lagos\", \"Africa/Libreville\", \"Africa/Lome\", \"Africa/Luanda\", \"Africa/Lubumbashi\", \"Africa/Lusaka\", \"Africa/Malabo\", \"Africa/Maputo\", \"Africa/Maseru\", \"Africa/Mbabane\", \"Africa/Mogadishu\", \"Africa/Monrovia\", \"Africa/Nairobi\", \"Africa/Ndjamena\", \"Africa/Niamey\", \"Africa/Nouakchott\", \"Africa/Ouagadougou\", \"Africa/Porto-Novo\", \"Africa/Sao_Tome\", \"Africa/Timbuktu\", \"Africa/Tripoli\", \"Africa/Tunis\", \"Africa/Windhoek\", \"America/Adak\", \"America/Anchorage\", \"America/Anguilla\", \"America/Antigua\", \"America/Araguaina\", \"America/Argentina/Buenos_Aires\", \"America/Argentina/Catamarca\", \"America/Argentina/ComodRivadavia\", \"America/Argentina/Cordoba\", \"America/Argentina/Jujuy\", \"America/Argentina/La_Rioja\", \"America/Argentina/Mendoza\", \"America/Argentina/Rio_Gallegos\", \"America/Argentina/Salta\", \"America/Argentina/San_Juan\", \"America/Argentina/San_Luis\", \"America/Argentina/Tucuman\", \"America/Argentina/Ushuaia\", \"America/Aruba\", \"America/Asuncion\", \"America/Atikokan\", \"America/Atka\", \"America/Bahia\", \"America/Bahia_Banderas\", \"America/Barbados\", \"America/Belem\", \"America/Belize\", \"America/Blanc-Sablon\", \"America/Boa_Vista\", \"America/Bogota\", \"America/Boise\", \"America/Buenos_Aires\", \"America/Cambridge_Bay\", \"America/Campo_Grande\", \"America/Cancun\", \"America/Caracas\", \"America/Catamarca\", \"America/Cayenne\", \"America/Cayman\", \"America/Chicago\", \"America/Chihuahua\", \"America/Ciudad_Juarez\", \"America/Coral_Harbour\", \"America/Cordoba\", \"America/Costa_Rica\", \"America/Coyhaique\", \"America/Creston\", \"America/Cuiaba\", \"America/Curacao\", \"America/Danmarkshavn\", \"America/Dawson\", \"America/Dawson_Creek\", \"America/Denver\", \"America/Detroit\", \"America/Dominica\", \"America/Edmonton\", \"America/Eirunepe\", \"America/El_Salvador\", \"America/Ensenada\", \"America/Fort_Nelson\", \"America/Fort_Wayne\", \"America/Fortaleza\", \"America/Glace_Bay\", \"America/Godthab\", \"America/Goose_Bay\", \"America/Grand_Turk\", \"America/Grenada\", \"America/Guadeloupe\", \"America/Guatemala\", \"America/Guayaquil\", \"America/Guyana\", \"America/Halifax\", \"America/Havana\", \"America/Hermosillo\", \"America/Indiana/Indianapolis\", \"America/Indiana/Knox\", \"America/Indiana/Marengo\", \"America/Indiana/Petersburg\", \"America/Indiana/Tell_City\", \"America/Indiana/Vevay\", \"America/Indiana/Vincennes\", \"America/Indiana/Winamac\", \"America/Indianapolis\", \"America/Inuvik\", \"America/Iqaluit\", \"America/Jamaica\", \"America/Jujuy\", \"America/Juneau\", \"America/Kentucky/Louisville\", \"America/Kentucky/Monticello\", \"America/Knox_IN\", \"America/Kralendijk\", \"America/La_Paz\", \"America/Lima\", \"America/Los_Angeles\", \"America/Louisville\", \"America/Lower_Princes\", \"America/Maceio\", \"America/Managua\", \"America/Manaus\", \"America/Marigot\", \"America/Martinique\", \"America/Matamoros\", \"America/Mazatlan\", \"America/Mendoza\", \"America/Menominee\", \"America/Merida\", \"America/Metlakatla\", \"America/Mexico_City\", \"America/Miquelon\", \"America/Moncton\", \"America/Monterrey\", \"America/Montevideo\", \"America/Montreal\", \"America/Montserrat\", \"America/Nassau\", \"America/New_York\", \"America/Nipigon\", \"America/Nome\", \"America/Noronha\", \"America/North_Dakota/Beulah\", \"America/North_Dakota/Center\", \"America/North_Dakota/New_Salem\", \"America/Nuuk\", \"America/Ojinaga\", \"America/Panama\", \"America/Pangnirtung\", \"America/Paramaribo\", \"America/Phoenix\", \"America/Port-au-Prince\", \"America/Port_of_Spain\", \"America/Porto_Acre\", \"America/Porto_Velho\", \"America/Puerto_Rico\", \"America/Punta_Arenas\", \"America/Rainy_River\", \"America/Rankin_Inlet\", \"America/Recife\", \"America/Regina\", \"America/Resolute\", \"America/Rio_Branco\", \"America/Rosario\", \"America/Santa_Isabel\", \"America/Santarem\", \"America/Santiago\", \"America/Santo_Domingo\", \"America/Sao_Paulo\", \"America/Scoresbysund\", \"America/Shiprock\", \"America/Sitka\", \"America/St_Barthelemy\", \"America/St_Johns\", \"America/St_Kitts\", \"America/St_Lucia\", \"America/St_Thomas\", \"America/St_Vincent\", \"America/Swift_Current\", \"America/Tegucigalpa\", \"America/Thule\", \"America/Thunder_Bay\", \"America/Tijuana\", \"America/Toronto\", \"America/Tortola\", \"America/Vancouver\", \"America/Virgin\", \"America/Whitehorse\", \"America/Winnipeg\", \"America/Yakutat\", \"America/Yellowknife\", \"Antarctica/Casey\", \"Antarctica/Davis\", \"Antarctica/DumontDUrville\", \"Antarctica/Macquarie\", \"Antarctica/Mawson\", \"Antarctica/McMurdo\", \"Antarctica/Palmer\", \"Antarctica/Rothera\", \"Antarctica/South_Pole\", \"Antarctica/Syowa\", \"Antarctica/Troll\", \"Antarctica/Vostok\", \"Arctic/Longyearbyen\", \"Asia/Aden\", \"Asia/Almaty\", \"Asia/Amman\", \"Asia/Anadyr\", \"Asia/Aqtau\", \"Asia/Aqtobe\", \"Asia/Ashgabat\", \"Asia/Ashkhabad\", \"Asia/Atyrau\", \"Asia/Baghdad\", \"Asia/Bahrain\", \"Asia/Baku\", \"Asia/Bangkok\", \"Asia/Barnaul\", \"Asia/Beirut\", \"Asia/Bishkek\", \"Asia/Brunei\", \"Asia/Calcutta\", \"Asia/Chita\", \"Asia/Choibalsan\", \"Asia/Chongqing\", \"Asia/Chungking\", \"Asia/Colombo\", \"Asia/Dacca\", \"Asia/Damascus\", \"Asia/Dhaka\", \"Asia/Dili\", \"Asia/Dubai\", \"Asia/Dushanbe\", \"Asia/Famagusta\", \"Asia/Gaza\", \"Asia/Harbin\", \"Asia/Hebron\", \"Asia/Ho_Chi_Minh\", \"Asia/Hong_Kong\", \"Asia/Hovd\", \"Asia/Irkutsk\", \"Asia/Istanbul\", \"Asia/Jakarta\", \"Asia/Jayapura\", \"Asia/Jerusalem\", \"Asia/Kabul\", \"Asia/Kamchatka\", \"Asia/Karachi\", \"Asia/Kashgar\", \"Asia/Kathmandu\", \"Asia/Katmandu\", \"Asia/Khandyga\", \"Asia/Kolkata\", \"Asia/Krasnoyarsk\", \"Asia/Kuala_Lumpur\", \"Asia/Kuching\", \"Asia/Kuwait\", \"Asia/Macao\", \"Asia/Macau\", \"Asia/Magadan\", \"Asia/Makassar\", \"Asia/Manila\", \"Asia/Muscat\", \"Asia/Nicosia\", \"Asia/Novokuznetsk\", \"Asia/Novosibirsk\", \"Asia/Omsk\", \"Asia/Oral\", \"Asia/Phnom_Penh\", \"Asia/Pontianak\", \"Asia/Pyongyang\", \"Asia/Qatar\", \"Asia/Qostanay\", \"Asia/Qyzylorda\", \"Asia/Rangoon\", \"Asia/Riyadh\", \"Asia/Saigon\", \"Asia/Sakhalin\", \"Asia/Samarkand\", \"Asia/Seoul\", \"Asia/Shanghai\", \"Asia/Singapore\", \"Asia/Srednekolymsk\", \"Asia/Taipei\", \"Asia/Tashkent\", \"Asia/Tbilisi\", \"Asia/Tehran\", \"Asia/Tel_Aviv\", \"Asia/Thimbu\", \"Asia/Thimphu\", \"Asia/Tokyo\", \"Asia/Tomsk\", \"Asia/Ujung_Pandang\", \"Asia/Ulaanbaatar\", \"Asia/Ulan_Bator\", \"Asia/Urumqi\", \"Asia/Ust-Nera\", \"Asia/Vientiane\", \"Asia/Vladivostok\", \"Asia/Yakutsk\", \"Asia/Yangon\", \"Asia/Yekaterinburg\", \"Asia/Yerevan\", \"Atlantic/Azores\", \"Atlantic/Bermuda\", \"Atlantic/Canary\", \"Atlantic/Cape_Verde\", \"Atlantic/Faeroe\", \"Atlantic/Faroe\", \"Atlantic/Jan_Mayen\", \"Atlantic/Madeira\", \"Atlantic/Reykjavik\", \"Atlantic/South_Georgia\", \"Atlantic/St_Helena\", \"Atlantic/Stanley\", \"Australia/ACT\", \"Australia/Adelaide\", \"Australia/Brisbane\", \"Australia/Broken_Hill\", \"Australia/Canberra\", \"Australia/Currie\", \"Australia/Darwin\", \"Australia/Eucla\", \"Australia/Hobart\", \"Australia/LHI\", \"Australia/Lindeman\", \"Australia/Lord_Howe\", \"Australia/Melbourne\", \"Australia/NSW\", \"Australia/North\", \"Australia/Perth\", \"Australia/Queensland\", \"Australia/South\", \"Australia/Sydney\", \"Australia/Tasmania\", \"Australia/Victoria\", \"Australia/West\", \"Australia/Yancowinna\", \"Brazil/Acre\", \"Brazil/DeNoronha\", \"Brazil/East\", \"Brazil/West\", \"CET\", \"CST6CDT\", \"Canada/Atlantic\", \"Canada/Central\", \"Canada/Eastern\", \"Canada/Mountain\", \"Canada/Newfoundland\", \"Canada/Pacific\", \"Canada/Saskatchewan\", \"Canada/Yukon\", \"Chile/Continental\", \"Chile/EasterIsland\", \"Cuba\", \"EET\", \"EST\", \"EST5EDT\", \"Egypt\", \"Eire\", \"Etc/GMT\", \"Etc/GMT+0\", \"Etc/GMT+1\", \"Etc/GMT+10\", \"Etc/GMT+11\", \"Etc/GMT+12\", \"Etc/GMT+2\", \"Etc/GMT+3\", \"Etc/GMT+4\", \"Etc/GMT+5\", \"Etc/GMT+6\", \"Etc/GMT+7\", \"Etc/GMT+8\", \"Etc/GMT+9\", \"Etc/GMT-0\", \"Etc/GMT-1\", \"Etc/GMT-10\", \"Etc/GMT-11\", \"Etc/GMT-12\", \"Etc/GMT-13\", \"Etc/GMT-14\", \"Etc/GMT-2\", \"Etc/GMT-3\", \"Etc/GMT-4\", \"Etc/GMT-5\", \"Etc/GMT-6\", \"Etc/GMT-7\", \"Etc/GMT-8\", \"Etc/GMT-9\", \"Etc/GMT0\", \"Etc/Greenwich\", \"Etc/UCT\", \"Etc/UTC\", \"Etc/Universal\", \"Etc/Zulu\", \"Europe/Amsterdam\", \"Europe/Andorra\", \"Europe/Astrakhan\", \"Europe/Athens\", \"Europe/Belfast\", \"Europe/Belgrade\", \"Europe/Berlin\", \"Europe/Bratislava\", \"Europe/Brussels\", \"Europe/Bucharest\", \"Europe/Budapest\", \"Europe/Busingen\", \"Europe/Chisinau\", \"Europe/Copenhagen\", \"Europe/Dublin\", \"Europe/Gibraltar\", \"Europe/Guernsey\", \"Europe/Helsinki\", \"Europe/Isle_of_Man\", \"Europe/Istanbul\", \"Europe/Jersey\", \"Europe/Kaliningrad\", \"Europe/Kiev\", \"Europe/Kirov\", \"Europe/Kyiv\", \"Europe/Lisbon\", \"Europe/Ljubljana\", \"Europe/London\", \"Europe/Luxembourg\", \"Europe/Madrid\", \"Europe/Malta\", \"Europe/Mariehamn\", \"Europe/Minsk\", \"Europe/Monaco\", \"Europe/Moscow\", \"Europe/Nicosia\", \"Europe/Oslo\", \"Europe/Paris\", \"Europe/Podgorica\", \"Europe/Prague\", \"Europe/Riga\", \"Europe/Rome\", \"Europe/Samara\", \"Europe/San_Marino\", \"Europe/Sarajevo\", \"Europe/Saratov\", \"Europe/Simferopol\", \"Europe/Skopje\", \"Europe/Sofia\", \"Europe/Stockholm\", \"Europe/Tallinn\", \"Europe/Tirane\", \"Europe/Tiraspol\", \"Europe/Ulyanovsk\", \"Europe/Uzhgorod\", \"Europe/Vaduz\", \"Europe/Vatican\", \"Europe/Vienna\", \"Europe/Vilnius\", \"Europe/Volgograd\", \"Europe/Warsaw\", \"Europe/Zagreb\", \"Europe/Zaporozhye\", \"Europe/Zurich\", \"Factory\", \"GB\", \"GB-Eire\", \"GMT\", \"GMT+0\", \"GMT-0\", \"GMT0\", \"Greenwich\", \"HST\", \"Hongkong\", \"Iceland\", \"Indian/Antananarivo\", \"Indian/Chagos\", \"Indian/Christmas\", \"Indian/Cocos\", \"Indian/Comoro\", \"Indian/Kerguelen\", \"Indian/Mahe\", \"Indian/Maldives\", \"Indian/Mauritius\", \"Indian/Mayotte\", \"Indian/Reunion\", \"Iran\", \"Israel\", \"Jamaica\", \"Japan\", \"Kwajalein\", \"Libya\", \"MET\", \"MST\", \"MST7MDT\", \"Mexico/BajaNorte\", \"Mexico/BajaSur\", \"Mexico/General\", \"NZ\", \"NZ-CHAT\", \"Navajo\", \"PRC\", \"PST8PDT\", \"Pacific/Apia\", \"Pacific/Auckland\", \"Pacific/Bougainville\", \"Pacific/Chatham\", \"Pacific/Chuuk\", \"Pacific/Easter\", \"Pacific/Efate\", \"Pacific/Enderbury\", \"Pacific/Fakaofo\", \"Pacific/Fiji\", \"Pacific/Funafuti\", \"Pacific/Galapagos\", \"Pacific/Gambier\", \"Pacific/Guadalcanal\", \"Pacific/Guam\", \"Pacific/Honolulu\", \"Pacific/Johnston\", \"Pacific/Kanton\", \"Pacific/Kiritimati\", \"Pacific/Kosrae\", \"Pacific/Kwajalein\", \"Pacific/Majuro\", \"Pacific/Marquesas\", \"Pacific/Midway\", \"Pacific/Nauru\", \"Pacific/Niue\", \"Pacific/Norfolk\", \"Pacific/Noumea\", \"Pacific/Pago_Pago\", \"Pacific/Palau\", \"Pacific/Pitcairn\", \"Pacific/Pohnpei\", \"Pacific/Ponape\", \"Pacific/Port_Moresby\", \"Pacific/Rarotonga\", \"Pacific/Saipan\", \"Pacific/Samoa\", \"Pacific/Tahiti\", \"Pacific/Tarawa\", \"Pacific/Tongatapu\", \"Pacific/Truk\", \"Pacific/Wake\", \"Pacific/Wallis\", \"Pacific/Yap\", \"Poland\", \"Portugal\", \"ROC\", \"ROK\", \"Singapore\", \"Turkey\", \"UCT\", \"US/Alaska\", \"US/Aleutian\", \"US/Arizona\", \"US/Central\", \"US/East-Indiana\", \"US/Eastern\", \"US/Hawaii\", \"US/Indiana-Starke\", \"US/Michigan\", \"US/Mountain\", \"US/Pacific\", \"US/Samoa\", \"UTC\", \"Universal\", \"W-SU\", \"WET\", \"Zulu\"\n        ];\n    }\n}\n</script>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 370,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "c8caad8136e6c5e3",
        "type": "ui-template",
        "z": "07f3b717f2a2c8c7",
        "group": "",
        "page": "34112984a39c35bd",
        "ui": "",
        "name": "CSS (All Pages)",
        "order": 0,
        "width": 0,
        "height": 0,
        "head": "",
        "format": ".v-toolbar__content {\n  display:none;\n}\n\n.v-main{\n  --v-layout-top: 0px !important;\n\n}       \n.v-card {\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;\n}",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "page:style",
        "className": "",
        "x": 920,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "1cf1b20e425ec126",
        "type": "ui-template",
        "z": "1b667c6443413ced",
        "group": "",
        "page": "",
        "ui": "e6ae26617c24c3ea",
        "name": "footer",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n  <v-footer class=\"pa-6\">\n    <v-container fluid style=\"background:white\">\n      <!-- Top Section -->\n      <v-row justify=\"space-between\" align=\"start\">\n        <!-- Branding -->\n\n          <v-col cols=\"12\" md=\"4\">\n\n            <v-row no-gutters class=\"align-center\">\n\n              <!-- Colonne logo : largeur fixe -->\n              <v-col class=\"d-flex justify-center pa-0 pr-4\" style=\"width: 40px; max-width: 40px;\">\n                <v-icon size=\"40\">\n                  <svg viewBox=\"0 0 52.916666 52.916666\" width=\"40\" height=\"40\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <ellipse cx=\"26.222767\" cy=\"27.404638\" rx=\"23.859026\" ry=\"23.268091\"\n                      style=\"fill:#ffffff;stroke:#adadad;stroke-width:0.255058;stroke-dasharray:0.255058,0.510117\" />\n                    <path\n                      d=\"M 25.235172,52.886866 C 18.788363,52.603542 12.618867,49.920327 7.9862278,45.385011 5.7884865,43.233443 4.126863,40.96322 2.7783721,38.269687 -0.69951435,31.3228 -0.92413866,23.055533 2.1714608,15.932226 4.2927656,11.050887 7.8775566,6.8759872 12.379084,4.0442925 16.268483,1.5976551 20.749011,0.2041208 25.311296,0.02211622 32.912028,-0.28110313 40.068898,2.5428839 45.330004,7.921181 c 1.394211,1.4252635 2.203509,2.427764 3.254874,4.031906 3.067465,4.680258 4.533514,10.016501 4.301182,15.65584 -0.24014,5.828764 -2.396645,11.365031 -6.195763,15.90599 -0.609303,0.728286 -2.000689,2.145321 -2.779528,2.830762 -3.92791,3.456901 -8.899105,5.69775 -14.107867,6.359358 -0.842019,0.106946 -1.343409,0.141442 -3.0145,0.207349 -0.281856,0.0112 -0.980811,-3.6e-4 -1.55323,-0.02554 z m -8.730149,-9.822631 c 0.109695,-0.04173 0.154655,-0.103087 0.154655,-0.211139 0,-0.298316 -0.854772,-0.812893 -2.806491,-1.689537 C 11.53131,40.120648 10.3078,39.367878 9.3006669,38.362582 7.0517974,36.117829 5.8601816,33.216131 6.2543214,30.944446 6.3887402,30.169737 6.5434509,29.871103 6.901246,29.695768 c 0.4841667,-0.23727 0.995125,-0.338007 1.7097068,-0.337072 0.9709729,0.0014 1.5470122,0.171079 2.0152092,0.594067 0.283418,0.256043 0.560221,0.375098 0.989405,0.425544 0.510426,0.05997 0.82424,-0.0134 1.252715,-0.292743 1.01939,-0.664717 5.540491,-2.409825 6.233136,-2.405942 0.165803,6.88e-4 0.423543,-0.03619 0.57276,-0.08247 0.631382,-0.195875 2.844992,-0.422152 4.954857,-0.506488 1.239664,-0.04953 3.354525,-0.02172 8.097936,0.106687 1.127421,0.03052 3.605179,0.06097 5.506133,0.06763 1.900954,0.0064 3.745833,0.03853 4.099724,0.07075 0.353899,0.03222 1.498055,0.07329 2.542584,0.09127 1.898992,0.03272 2.911755,-0.0184 3.397943,-0.171558 0.573761,-0.180697 0.764411,-0.672624 0.353353,-0.911762 -0.248676,-0.144681 -1.481535,-0.21537 -3.82899,-0.219564 -2.488027,-0.0042 -5.224909,-0.131603 -11.075963,-0.514612 -3.222986,-0.210967 -5.937562,-0.378602 -8.802349,-0.543559 -3.976844,-0.228997 -4.985076,-0.481342 -5.999512,-1.501557 -0.167847,-0.168804 -0.600666,-0.673184 -0.961825,-1.120835 -0.92504,-1.146598 -2.832132,-3.036395 -3.740139,-3.706229 -0.397915,-0.293538 -0.804872,-0.61865 -0.904352,-0.722468 -0.09948,-0.103824 -0.333374,-0.262472 -0.519766,-0.352557 -1.28055,-0.618905 -1.618906,-1.875722 -0.853693,-3.170983 0.461938,-0.781901 1.523215,-1.660846 2.748294,-2.276117 1.13425,-0.569655 2.255356,-0.975853 4.382863,-1.587996 2.089099,-0.60109 2.927546,-0.9311702 3.077629,-1.2115953 0.08554,-0.1598279 0.0077,-0.4070348 -0.163425,-0.5191737 -0.239138,-0.1566868 -0.614968,-0.1939369 -1.316519,-0.130482 -0.852279,0.077088 -1.490305,0.2163293 -3.131411,0.6833976 -1.418582,0.403736 -1.911513,0.5888334 -3.108608,1.1672844 -2.333261,1.127465 -3.264923,1.941987 -4.698402,4.107681 -0.4611363,0.696689 -0.8715706,1.36878 -0.9120808,1.49354 -0.1059747,0.32644 -0.6208078,1.341941 -1.5210083,3.000179 -1.9466021,3.585797 -2.6241442,5.326854 -3.0597521,7.862531 -0.066004,0.384261 -0.1606715,0.902139 -0.2103378,1.150829 -0.04968,0.248696 -0.1069963,0.926964 -0.1273797,1.507254 -0.081086,2.308272 0.2512527,4.04802 1.0944559,5.729316 1.2878816,2.567957 3.2322337,4.503921 5.8597418,5.834441 2.243901,1.136279 5.019803,2.001753 5.650844,1.761829 z\"\n                      fill=\"#674ea7\" />\n                  </svg>\n                </v-icon>\n              </v-col>\n\n              <!-- Colonne texte : occupe tout l'espace restant -->\n              <v-col class=\"d-flex flex-column justify-center\" style=\"flex: 1;\">\n\n                <a href=\"https://www.planktoscope.org\" target=\"_blank\" class=\"text-decoration-none\" style=\"color: inherit;\">\n                  <h4 class=\"font-weight-bold mb-1\">PlanktoScope</h4>\n                </a>\n\n                <p class=\"mb-0\">Open and Affordable Quantitative Imaging Platform.</p>\n\n              </v-col>\n\n            </v-row>\n\n          </v-col>\n\n\n        <!-- Action Links -->\n        <v-col cols=\"12\" md=\"8\" class=\"d-flex flex-wrap justify-end\">\n          <v-chip\n            size=\"small\"\n            color=\"grey-darken-3\"\n            href=\"https://www.planktoscope.org/join\"\n            target=\"_blank\"\n            class=\"mx-2 my-1\"\n          >\n            <v-icon color=\"primary\" class=\"mr-1\">mdi-slack</v-icon>\n            Ask the community\n          </v-chip>\n          <v-chip\n            size=\"small\"\n            color=\"grey-darken-3\"\n            href=\"https://github.com/PlanktoScope/PlanktoScope/issues/new?template=software-bug-report.md\"\n            target=\"_blank\"\n            class=\"mx-2 my-1\"\n          >\n            <v-icon color=\"red\" class=\"mr-1\">mdi-bug</v-icon>\n            Report a Bug\n          </v-chip>\n\n          <v-chip\n            size=\"small\"\n            color=\"grey-darken-3\"\n            href=\"https://github.com/PlanktoScope/dashboard\"\n            target=\"_blank\"\n            class=\"mx-2 my-1\"\n          >\n            <v-icon color=\"black\" class=\"mr-1\">mdi-github</v-icon>\n            GitHub Repo\n          </v-chip>\n\n          <v-chip\n            size=\"small\"\n            color=\"grey-darken-3\"\n            href=\"https://github.com/PlanktoScope/PlanktoScope/graphs/contributors\"\n            target=\"_blank\"\n            class=\"mx-2 my-1\"\n          >\n            <v-icon color=\"green\" class=\"mr-1\">mdi-account-group</v-icon>\n            Contributors\n          </v-chip>\n        </v-col>\n      </v-row>\n\n      <v-divider class=\"my-2 opacity-50\"></v-divider>\n\n      <!-- Bottom Section -->\n      <v-row justify=\"space-between\" align=\"center\">\n        <v-col cols=\"12\" md=\"6\" class=\"text-caption\">\n\n           {{ new Date().getFullYear() }} PlanktoScope GUI  made by\n          <a href=\"https://fairscope.com\" target=\"_blank\" rel=\"noopener noreferrer\" class=\"text-decoration-none\" color=\"primary\">\n            FairScope\n          </a>\n        </v-col>\n\n      </v-row>\n    </v-container>\n  </v-footer>\n</template>\n\n<script>\nexport default {\n  name: 'AppFooter',\n}\n</script>\n",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "widget:ui",
        "className": "",
        "x": 510,
        "y": 700,
        "wires": [
            []
        ]
    },
    {
        "id": "67b871e8f9c64c2b",
        "type": "switch",
        "z": "1b667c6443413ced",
        "name": "msg.payload.page.path === \"/home\"",
        "property": "payload.page.path",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "/home",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 570,
        "y": 40,
        "wires": [
            [
                "abe86c4e9dedb557",
                "605bf275a4d80952",
                "90ba8dbcce201a83"
            ]
        ]
    },
    {
        "id": "e74e4d04e4a79458",
        "type": "switch",
        "z": "1b667c6443413ced",
        "name": "msg.topic === \"$pageview\"",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "$pageview",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 280,
        "y": 40,
        "wires": [
            [
                "67b871e8f9c64c2b"
            ]
        ]
    },
    {
        "id": "7c16cbd0b2c40ea4",
        "type": "ui-event",
        "z": "1b667c6443413ced",
        "ui": "e6ae26617c24c3ea",
        "name": "UI Event",
        "x": 80,
        "y": 40,
        "wires": [
            [
                "e74e4d04e4a79458"
            ]
        ]
    },
    {
        "id": "5d4e95854b504124",
        "type": "ui-template",
        "z": "1b667c6443413ced",
        "group": "",
        "page": "",
        "ui": "e6ae26617c24c3ea",
        "name": "CSS (All Pages)",
        "order": 0,
        "width": 0,
        "height": 0,
        "head": "",
        "format": ".v-btn--variant-outlined.v-btn--active {\n    background-color: #1976d2 !important;\n    color: white !important;\n}\n\n\n.v-field__field {\n    background: #eef3ff;\n    border-radius: 4px;\n}\n\n.v-btn-group .v-btn, .v-field__overlay {\n    background: #eef3ff;\n}\n    \n",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "site:style",
        "className": "",
        "x": 1300,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "abe86c4e9dedb557",
        "type": "get machine info",
        "z": "1b667c6443413ced",
        "name": "",
        "x": 850,
        "y": 40,
        "wires": [
            [
                "c06a59555d958a6f"
            ]
        ]
    },
    {
        "id": "605bf275a4d80952",
        "type": "storage info",
        "z": "1b667c6443413ced",
        "name": "",
        "x": 830,
        "y": 80,
        "wires": [
            [
                "ee16d4c7be3a6e3a"
            ]
        ]
    },
    {
        "id": "ee16d4c7be3a6e3a",
        "type": "function",
        "z": "1b667c6443413ced",
        "name": "set storage info",
        "func": "if (msg.topic) {\n    global.set(\"image_acquired\", msg.payload.image_acquired);\n    global.set(\"object_segmented\", msg.payload.object_segmented);\n    global.set(\"storage_percent_free\", msg.payload.storage_percent_free);\n    global.set(\"storage_percent_used\", msg.payload.storage_percent_used);\n}\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1000,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "c06a59555d958a6f",
        "type": "function",
        "z": "1b667c6443413ced",
        "name": "set machine info",
        "func": "if (msg.topic) {\n    global.set(\"hardware_version\", msg.payload.machine_info.hardware_version);\n    global.set(\"machine_name\", msg.payload.machine_info.machine_name);\n    global.set(\"hostname\", msg.payload.machine_info.hostname);\n    global.set(\"software_version\", msg.payload.machine_info.software_version);\n}\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1040,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "90ba8dbcce201a83",
        "type": "delay",
        "z": "1b667c6443413ced",
        "name": "",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 180,
        "y": 140,
        "wires": [
            [
                "74f8dad75cdd3c16"
            ]
        ]
    },
    {
        "id": "74f8dad75cdd3c16",
        "type": "function",
        "z": "1b667c6443413ced",
        "name": "Get Global Variables",
        "func": "const keys = global.keys(); // Get all global variable keys\nmsg.payload = {}; // Initialize the payload object\n\nkeys.forEach(key => {\n    // Ignore keys that start with \"$\"\n    if (!key.startsWith('$')) {\n        msg.payload[key] = global.get(key);\n    }\n});\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 200,
        "y": 280,
        "wires": [
            [
                "04386808e694e97e",
                "e68b686e94d78c9d",
                "e431a9253416f9eb",
                "b50dce0a86c2668c",
                "07c889f3fa18b15b"
            ]
        ]
    },
    {
        "id": "8efc52e6ee9206f6",
        "type": "poweroff",
        "z": "1b667c6443413ced",
        "name": "",
        "x": 1160,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "39c7e4b018ce16cb",
        "type": "reboot",
        "z": "1b667c6443413ced",
        "name": "",
        "x": 1160,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "1db1c2e3e19e85ff",
        "type": "switch",
        "z": "1b667c6443413ced",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "reboot",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "shutdown",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 970,
        "y": 200,
        "wires": [
            [
                "39c7e4b018ce16cb",
                "1044b154a90406dc"
            ],
            [
                "8efc52e6ee9206f6"
            ]
        ]
    },
    {
        "id": "cd5cd3a0277b8dba",
        "type": "ui-template",
        "z": "1b667c6443413ced",
        "group": "5d39a98563150f22",
        "page": "",
        "ui": "",
        "name": "body",
        "order": 1,
        "width": "0",
        "height": "0",
        "head": "",
        "format": "<template>\n  <v-container fluid>\n    <!-- HEADER -->\n    <v-row justify=\"center\" dense class=\"py-8\">\n              <svg viewBox=\"0 0 52.916666 52.916666\" width=\"150\" height=\"150\" xmlns=\"http://www.w3.org/2000/svg\">\n                <ellipse cx=\"26.222767\" cy=\"27.404638\" rx=\"23.859026\" ry=\"23.268091\"\n                  style=\"fill:#ffffff;stroke:#adadad;stroke-width:0.255058;stroke-dasharray:0.255058,0.510117\" />\n                <path\n                  d=\"M 25.235172,52.886866 C 18.788363,52.603542 12.618867,49.920327 7.9862278,45.385011 5.7884865,43.233443 4.126863,40.96322 2.7783721,38.269687 -0.69951435,31.3228 -0.92413866,23.055533 2.1714608,15.932226 4.2927656,11.050887 7.8775566,6.8759872 12.379084,4.0442925 16.268483,1.5976551 20.749011,0.2041208 25.311296,0.02211622 32.912028,-0.28110313 40.068898,2.5428839 45.330004,7.921181 c 1.394211,1.4252635 2.203509,2.427764 3.254874,4.031906 3.067465,4.680258 4.533514,10.016501 4.301182,15.65584 -0.24014,5.828764 -2.396645,11.365031 -6.195763,15.90599 -0.609303,0.728286 -2.000689,2.145321 -2.779528,2.830762 -3.92791,3.456901 -8.899105,5.69775 -14.107867,6.359358 -0.842019,0.106946 -1.343409,0.141442 -3.0145,0.207349 -0.281856,0.0112 -0.980811,-3.6e-4 -1.55323,-0.02554 z m -8.730149,-9.822631 c 0.109695,-0.04173 0.154655,-0.103087 0.154655,-0.211139 0,-0.298316 -0.854772,-0.812893 -2.806491,-1.689537 C 11.53131,40.120648 10.3078,39.367878 9.3006669,38.362582 7.0517974,36.117829 5.8601816,33.216131 6.2543214,30.944446 6.3887402,30.169737 6.5434509,29.871103 6.901246,29.695768 c 0.4841667,-0.23727 0.995125,-0.338007 1.7097068,-0.337072 0.9709729,0.0014 1.5470122,0.171079 2.0152092,0.594067 0.283418,0.256043 0.560221,0.375098 0.989405,0.425544 0.510426,0.05997 0.82424,-0.0134 1.252715,-0.292743 1.01939,-0.664717 5.540491,-2.409825 6.233136,-2.405942 0.165803,6.88e-4 0.423543,-0.03619 0.57276,-0.08247 0.631382,-0.195875 2.844992,-0.422152 4.954857,-0.506488 1.239664,-0.04953 3.354525,-0.02172 8.097936,0.106687 1.127421,0.03052 3.605179,0.06097 5.506133,0.06763 1.900954,0.0064 3.745833,0.03853 4.099724,0.07075 0.353899,0.03222 1.498055,0.07329 2.542584,0.09127 1.898992,0.03272 2.911755,-0.0184 3.397943,-0.171558 0.573761,-0.180697 0.764411,-0.672624 0.353353,-0.911762 -0.248676,-0.144681 -1.481535,-0.21537 -3.82899,-0.219564 -2.488027,-0.0042 -5.224909,-0.131603 -11.075963,-0.514612 -3.222986,-0.210967 -5.937562,-0.378602 -8.802349,-0.543559 -3.976844,-0.228997 -4.985076,-0.481342 -5.999512,-1.501557 -0.167847,-0.168804 -0.600666,-0.673184 -0.961825,-1.120835 -0.92504,-1.146598 -2.832132,-3.036395 -3.740139,-3.706229 -0.397915,-0.293538 -0.804872,-0.61865 -0.904352,-0.722468 -0.09948,-0.103824 -0.333374,-0.262472 -0.519766,-0.352557 -1.28055,-0.618905 -1.618906,-1.875722 -0.853693,-3.170983 0.461938,-0.781901 1.523215,-1.660846 2.748294,-2.276117 1.13425,-0.569655 2.255356,-0.975853 4.382863,-1.587996 2.089099,-0.60109 2.927546,-0.9311702 3.077629,-1.2115953 0.08554,-0.1598279 0.0077,-0.4070348 -0.163425,-0.5191737 -0.239138,-0.1566868 -0.614968,-0.1939369 -1.316519,-0.130482 -0.852279,0.077088 -1.490305,0.2163293 -3.131411,0.6833976 -1.418582,0.403736 -1.911513,0.5888334 -3.108608,1.1672844 -2.333261,1.127465 -3.264923,1.941987 -4.698402,4.107681 -0.4611363,0.696689 -0.8715706,1.36878 -0.9120808,1.49354 -0.1059747,0.32644 -0.6208078,1.341941 -1.5210083,3.000179 -1.9466021,3.585797 -2.6241442,5.326854 -3.0597521,7.862531 -0.066004,0.384261 -0.1606715,0.902139 -0.2103378,1.150829 -0.04968,0.248696 -0.1069963,0.926964 -0.1273797,1.507254 -0.081086,2.308272 0.2512527,4.04802 1.0944559,5.729316 1.2878816,2.567957 3.2322337,4.503921 5.8597418,5.834441 2.243901,1.136279 5.019803,2.001753 5.650844,1.761829 z\"\n                  fill=\"#076eca\" />\n              </svg>\n    </v-row>\n    <v-row justify=\"center\" dense>\n      <v-empty-state \n      headline=\"Welcome to your PlanktoScope\" \n      title=\"What would you like to do today?\"\n    />\n    </v-row>\n  </v-container>\n</template>\n",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 510,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "1044b154a90406dc",
        "type": "exec",
        "z": "1b667c6443413ced",
        "command": "sudo reboot now",
        "addpay": "",
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "winHide": false,
        "oldrc": false,
        "name": "",
        "x": 1190,
        "y": 300,
        "wires": [
            [],
            [],
            []
        ]
    },
    {
        "id": "04386808e694e97e",
        "type": "ui-template",
        "z": "1b667c6443413ced",
        "group": "",
        "page": "",
        "ui": "e6ae26617c24c3ea",
        "name": "toolbar",
        "order": 2,
        "width": "12",
        "height": "6",
        "head": "",
        "format": "<style>\n    /* --- Zone Droite (Horloge + Menu) --- */\n    #pks-menu-wrapper {\n        position: relative;\n        display: flex;\n        align-items: center;\n        gap: 12px;\n        z-index: 999999 !important;\n        margin-right: 0 !important;\n    }\n\n    /* --- Styles pour le Logo et Texte PlanktoScope --- */\n    #pks-logo-link {\n        display: flex;\n        align-items: center;\n        text-decoration: none;\n        color: inherit;\n    }\n\n    #pks-logo-link svg {\n        margin-right: 8px;\n        height: 36px;\n        width: 36px;\n    }\n\n    .pks-logo-text {\n        font-size: 18px;\n        font-weight: 600;\n        letter-spacing: 0.5px;\n        color: #1976d2;\n    }\n\n    /* --- Zone Gauche (Badge Version) --- */\n    #pks-hw-version {\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n\n        /* Apparence de badge */\n        background: #eef3ff;\n        color: #1976d2;\n        border: 1px solid #d6e4ff;\n\n        font-size: 11px;\n        font-weight: 800;\n        letter-spacing: 0.5px;\n\n        padding: 4px 8px;\n        border-radius: 4px;\n\n        vertical-align: middle;\n        line-height: 1.5;\n\n        /* Masqu par dfaut */\n        display: none;\n\n    }\n\n    /* --- Horloge --- */\n    #pks-clock {\n        font-size: 14px;\n        color: #555;\n        opacity: 0.9;\n        white-space: nowrap;\n        user-select: none;\n    }\n\n    /* --- Bouton Machine --- */\n    #pks-machine-button {\n        display: flex;\n        align-items: center;\n        gap: 6px;\n        background: #eef3ff;\n        border: 1px solid #d6e4ff;\n        margin-right: 1rem;\n        padding: 6px 10px;\n        border-radius: 6px;\n        cursor: pointer;\n        font-size: 14px;\n        font-weight: 600;\n        color: #1b76d3;\n        transition: background 0.2s;\n    }\n\n    #pks-machine-button:hover {\n        background: #1976d2;\n        color:white;\n    }\n\n    #pks-machine-button i {\n        font-size: 18px;\n        opacity: 0.8;\n    }\n\n    /* --- Dropdown Menu --- */\n    #pks-dropdown {\n        position: fixed !important;\n        top: 64px !important;\n\n        background: #ffffff;\n        border-radius: 0px 0px 6px 6px;\n        width: 250px;\n        border: 1px solid #b6b6b6;\n        display: none;\n        z-index: 999999 !important;\n        padding: 6px 0;\n        box-shadow: 0 3px 12px rgba(0, 0, 0, 0.15);\n    }\n\n    .menu-separator {\n        border-top: 1px solid #cfcfcf;\n        margin: 6px 0;\n    }\n\n    .menu-item {\n        display: flex;\n        align-items: center;\n        padding: 10px 16px;\n        cursor: pointer;\n        color: #333;\n        font-size: 15px;\n    }\n\n    .menu-item:hover {\n        background: #eef3ff;\n    }\n\n    .menu-item i {\n        font-size: 20px;\n        color: #1976d2;\n        margin-right: 10px;\n        width: 22px;\n        text-align: center;\n    }\n\n    .menu-item.reboot i {\n        color: #f57c00;\n    }\n\n    .menu-item.reboot:hover {\n        background: #fef2e6;\n    }\n\n    .menu-item.shutdown i {\n        color: #d32f2f;\n    }\n\n    .menu-item.shutdown:hover {\n        background: #fbeaea;\n    }\n\n    .menu-item .ext {\n        margin-left: auto;\n        font-size: 18px;\n        color: #777;\n    }\n\n    /* --- Loader Modal --- */\n    #pks-modal {\n        display: none;\n        position: fixed;\n        top: 0;\n        right: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0, 0, 0, 0.45);\n        z-index: 9999999;\n        backdrop-filter: blur(2px);\n        justify-content: center;\n        align-items: center;\n    }\n\n    #pks-modal-box {\n        background: white;\n        padding: 20px 30px;\n        border-radius: 10px;\n        text-align: center;\n        min-width: 260px;\n    }\n\n    #pks-loader {\n        border: 4px solid #ddd;\n        border-top: 4px solid #1976d2;\n        border-radius: 50%;\n        width: 36px;\n        height: 36px;\n        margin: 10px auto;\n        animation: spin 0.9s linear infinite;\n    }\n\n    .v-toolbar__append {\n        margin-inline: 0px;\n    }\n\n    @keyframes spin {\n        100% {\n            transform: rotate(360deg);\n        }\n    }\n\n    #app-bar-actions,\n    #pks-menu-wrapper {\n        flex-shrink: 0 !important;\n    }\n\n    /* Important: S'assurer que le titre prend l'espace ncessaire */\n    .v-toolbar-title {\n        overflow: visible !important;\n        white-space: nowrap;\n    }\n\n    #app-bar {\n        width: 100% !important;\n        max-width: 100% !important;\n    }\n</style>\n\n<script>\n    let scope = this;\n\n    /* Load MDI icons if missing */\n    if (!document.querySelector('link[href*=\"materialdesignicons\"]')) {\n        const mdi = document.createElement(\"link\");\n        mdi.rel = \"stylesheet\";\n        mdi.href = \"https://cdn.materialdesignicons.com/7.4.47/css/materialdesignicons.min.css\";\n        document.head.appendChild(mdi);\n    }\n\n    /* Clock */\n    function updateClock() {\n        const el = document.getElementById(\"pks-clock\");\n        if (!el) return;\n        const now = new Date();\n        const days = [\"Sun.\", \"Mon.\", \"Tue.\", \"Wed.\", \"Thu.\", \"Fri.\", \"Sat.\"];\n        const months = [\"janv.\", \"fvr.\", \"mars\", \"avr.\", \"mai\", \"juin\", \"juil.\", \"aot\", \"sept.\", \"oct.\", \"nov.\", \"dc.\"];\n        const d = days[now.getUTCDay()];\n        const day = String(now.getUTCDate()).padStart(2, \"0\");\n        const month = months[now.getUTCMonth()];\n        const year = now.getUTCFullYear();\n        const hh = now.getUTCHours().toString().padStart(2, \"0\");\n        const mm = now.getUTCMinutes().toString().padStart(2, \"0\");\n        el.textContent = `${d} ${day} ${month} ${year} - ${hh}:${mm} (UTC)`;\n    }\n    setInterval(updateClock, 60000);\n\n    /* =========================================================\n       BUILD MENU CONTENT\n    ========================================================= */\n    const PLANKTOSCOPE_LOGO_SVG = `\n        <svg viewBox=\"0 0 52.916666 52.916666\" width=\"20\" height=\"20\" xmlns=\"http://www.w3.org/2000/svg\">\n            <ellipse cx=\"26.222767\" cy=\"27.404638\" rx=\"23.859026\" ry=\"23.268091\" style=\"fill:#ffffff;stroke:#adadad;stroke-width:0.255058;stroke-dasharray:0.255058,0.510117\" />\n                    <path\n                        d=\"M 25.235172,52.886866 C 18.788363,52.603542 12.618867,49.920327 7.9862278,45.385011 5.7884865,43.233443 4.126863,40.96322 2.7783721,38.269687 -0.69951435,31.3228 -0.92413866,23.055533 2.1714608,15.932226 4.2927656,11.050887 7.8775566,6.8759872 12.379084,4.0442925 16.268483,1.5976551 20.749011,0.2041208 25.311296,0.02211622 32.912028,-0.28110313 40.068898,2.5428839 45.330004,7.921181 c 1.394211,1.4252635 2.203509,2.427764 3.254874,4.031906 3.067465,4.680258 4.533514,10.016501 4.301182,15.65584 -0.24014,5.828764 -2.396645,11.365031 -6.195763,15.90599 -0.609303,0.728286 -2.000689,2.145321 -2.779528,2.830762 -3.92791,3.456901 -8.899105,5.69775 -14.107867,6.359358 -0.842019,0.106946 -1.343409,0.141442 -3.0145,0.207349 -0.281856,0.0112 -0.980811,-3.6e-4 -1.55323,-0.02554 z m -8.730149,-9.822631 c 0.109695,-0.04173 0.154655,-0.103087 0.154655,-0.211139 0,-0.298316 -0.854772,-0.812893 -2.806491,-1.689537 C 11.53131,40.120648 10.3078,39.367878 9.3006669,38.362582 7.0517974,36.117829 5.8601816,33.216131 6.2543214,30.944446 6.3887402,30.169737 6.5434509,29.871103 6.901246,29.695768 c 0.4841667,-0.23727 0.995125,-0.338007 1.7097068,-0.337072 0.9709729,0.0014 1.5470122,0.171079 2.0152092,0.594067 0.283418,0.256043 0.560221,0.375098 0.989405,0.425544 0.510426,0.05997 0.82424,-0.0134 1.252715,-0.292743 1.01939,-0.664717 5.540491,-2.409825 6.233136,-2.405942 0.165803,6.88e-4 0.423543,-0.03619 0.57276,-0.08247 0.631382,-0.195875 2.844992,-0.422152 4.954857,-0.506488 1.239664,-0.04953 3.354525,-0.02172 8.097936,0.106687 1.127421,0.03052 3.605179,0.06097 5.506133,0.06763 1.900954,0.0064 3.745833,0.03853 4.099724,0.07075 0.353899,0.03222 1.498055,0.07329 2.542584,0.09127 1.898992,0.03272 2.911755,-0.0184 3.397943,-0.171558 0.573761,-0.180697 0.764411,-0.672624 0.353353,-0.911762 -0.248676,-0.144681 -1.481535,-0.21537 -3.82899,-0.219564 -2.488027,-0.0042 -5.224909,-0.131603 -11.075963,-0.514612 -3.222986,-0.210967 -5.937562,-0.378602 -8.802349,-0.543559 -3.976844,-0.228997 -4.985076,-0.481342 -5.999512,-1.501557 -0.167847,-0.168804 -0.600666,-0.673184 -0.961825,-1.120835 -0.92504,-1.146598 -2.832132,-3.036395 -3.740139,-3.706229 -0.397915,-0.293538 -0.804872,-0.61865 -0.904352,-0.722468 -0.09948,-0.103824 -0.333374,-0.262472 -0.519766,-0.352557 -1.28055,-0.618905 -1.618906,-1.875722 -0.853693,-3.170983 0.461938,-0.781901 1.523215,-1.660846 2.748294,-2.276117 1.13425,-0.569655 2.255356,-0.975853 4.382863,-1.587996 2.089099,-0.60109 2.927546,-0.9311702 3.077629,-1.2115953 0.08554,-0.1598279 0.0077,-0.4070348 -0.163425,-0.5191737 -0.239138,-0.1566868 -0.614968,-0.1939369 -1.316519,-0.130482 -0.852279,0.077088 -1.490305,0.2163293 -3.131411,0.6833976 -1.418582,0.403736 -1.911513,0.5888334 -3.108608,1.1672844 -2.333261,1.127465 -3.264923,1.941987 -4.698402,4.107681 -0.4611363,0.696689 -0.8715706,1.36878 -0.9120808,1.49354 -0.1059747,0.32644 -0.6208078,1.341941 -1.5210083,3.000179 -1.9466021,3.585797 -2.6241442,5.326854 -3.0597521,7.862531 -0.066004,0.384261 -0.1606715,0.902139 -0.2103378,1.150829 -0.04968,0.248696 -0.1069963,0.926964 -0.1273797,1.507254 -0.081086,2.308272 0.2512527,4.04802 1.0944559,5.729316 1.2878816,2.567957 3.2322337,4.503921 5.8597418,5.834441 2.243901,1.136279 5.019803,2.001753 5.650844,1.761829 z\"\n                        fill=\"#076eca\" />    </svg>`;\n\n    function buildMenu(machineName) {\n        const menu = document.getElementById(\"pks-dropdown\");\n        if (!menu) return;\n        menu.innerHTML = `\n            <div class=\"menu-item\" data-href=\"home\">\n                 ${PLANKTOSCOPE_LOGO_SVG.replace('width=\"20\" height=\"20\" xmlns=\"http://www.w3.org/2000/svg\"', 'width=\"20\" height=\"20\" xmlns=\"http://www.w3.org/2000/svg\" class=\"mr-3\"')}\n                <b>Home</b>\n            </div>\n            <div class=\"menu-separator\"></div>\n            <div class=\"menu-item\" data-href=\"preview\"><i class=\"mdi mdi-eye\"></i> Preview</div>\n            <div class=\"menu-item\" data-href=\"visualization\"><i class=\"mdi mdi-chart-scatter-plot-hexbin\"></i> Visualization</div>\n            <div class=\"menu-item\" data-href=\"calibration\"><i class=\"mdi mdi-crosshairs-gps\"></i> Calibration</div>\n            <div class=\"menu-item\" data-external=\"/ps/docs/\"><i class=\"mdi mdi-book-outline\"></i> Documentation <i class=\"mdi mdi-open-in-new ext\"></i></div>\n            <div class=\"menu-separator\"></div>\n            <div class=\"menu-item reboot\" data-action=\"reboot\"><i class=\"mdi mdi-refresh\"></i> Reboot</div>\n            <div class=\"menu-item shutdown\" data-action=\"shutdown\"><i class=\"mdi mdi-power\"></i> Shutdown</div>\n        `;\n    }\n\n    /* =========================================================\n       MODAL LOADER\n    ========================================================= */\n    function showModal(message) {\n        let modal = document.getElementById(\"pks-modal\");\n        if (!modal) {\n            modal = document.createElement(\"div\");\n            modal.id = \"pks-modal\";\n            modal.innerHTML = `<div id=\"pks-modal-box\"><div id=\"pks-loader\"></div><div id=\"pks-modal-text\">${message}</div></div>`;\n            document.body.appendChild(modal);\n        }\n        document.getElementById(\"pks-modal-text\").textContent = message;\n        modal.style.display = \"flex\";\n    }\n\n    function hideModal() {\n        const modal = document.getElementById(\"pks-modal\");\n        if (modal) modal.style.display = \"none\";\n    }\n\n    /* =========================================================\n       INJECT HARDWARE VERSION (LEFT)\n    ========================================================= */\n    function injectHardwareVersion() {\n        // Cible la div principale du titre\n        const titleContainer = document.querySelector(\".v-toolbar-title.v-app-bar-title\"); \n        \n        if (titleContainer) {\n            // S'assure que notre ID d'injection est bien sur le conteneur principal\n            titleContainer.id = \"app-bar-title\";\n            const appBarTitle = titleContainer;\n\n            // --- 1. Suppression de tout placeholder restant (logique prcdente) ---\n            const placeholderEl = appBarTitle.querySelector(\".v-toolbar-title__placeholder\");\n            if (placeholderEl) {\n                placeholderEl.remove();\n            }\n\n            // --- 2. Ajout du logo et du texte PlanktoScope (lien vers home) ---\n            if (!document.getElementById(\"pks-logo-link\")) {\n                const logoLink = document.createElement(\"a\");\n                logoLink.id = \"pks-logo-link\";\n                logoLink.href = \"home\";\n                logoLink.innerHTML = `\n                    ${PLANKTOSCOPE_LOGO_SVG.replace('width=\"20\" height=\"20\"', 'width=\"36\" height=\"36\"')}\n                    <span class=\"pks-logo-text\">PlanktoScope</span>\n                `;\n                // On insre le lien du logo en premier enfant\n                appBarTitle.prepend(logoLink);\n            }\n\n            // --- 3. Ajout/Dplacement du badge de version ---\n            if (!document.getElementById(\"pks-hw-version\")) {\n                const verDiv = document.createElement(\"div\");\n                verDiv.id = \"pks-hw-version\";\n                appBarTitle.appendChild(verDiv);\n            }\n        }\n    }\n\n    /* =========================================================\n       INJECT MENU (RIGHT)\n    ========================================================= */\n    function injectMenu() {\n        const zone = document.getElementById(\"app-bar-actions\");\n        if (!zone) return;\n        if (!document.getElementById(\"pks-menu-wrapper\")) {\n            const wrap = document.createElement(\"div\");\n            wrap.id = \"pks-menu-wrapper\";\n            zone.appendChild(wrap);\n        }\n        const wrapper = document.getElementById(\"pks-menu-wrapper\");\n\n        if (!document.getElementById(\"pks-dropdown\")) {\n            const dropdown = document.createElement(\"div\");\n            dropdown.id = \"pks-dropdown\";\n            document.body.appendChild(dropdown);\n        }\n\n        if (!document.getElementById(\"pks-machine-button\")) {\n            wrapper.innerHTML = `\n                <div id=\"pks-clock\"></div>\n                <button id=\"pks-machine-button\">\n                    <i class=\"mdi mdi-desktop-classic\"></i>\n                    <span id=\"pks-machine-name\">Loading..</span>\n                    <i class=\"mdi mdi-menu-down\"></i>\n                </button>\n            `;\n            updateClock();\n        }\n\n        const btn = document.getElementById(\"pks-machine-button\");\n        const menu = document.getElementById(\"pks-dropdown\");\n\n        btn.onclick = (e) => {\n            e.stopPropagation();\n            const rect = btn.getBoundingClientRect();\n            menu.style.top = rect.bottom + \"px\";\n            menu.style.right = \"0px\";\n            menu.style.left = \"auto\";\n            menu.style.display = menu.style.display === \"block\" ? \"none\" : \"block\";\n        };\n\n        menu.onclick = (e) => {\n            const item = e.target.closest(\".menu-item\");\n            if (!item) return;\n            if (item.dataset.href) window.location.href = item.dataset.href;\n            if (item.dataset.external) window.open(item.dataset.external, \"_blank\");\n\n            if (item.dataset.action) {\n                showModal(item.dataset.action === \"reboot\" ? \"Rebooting\" : \"Shutting down\");\n                scope.send({ topic: \"action\", payload: item.dataset.action });\n                setTimeout(() => {\n                    window.location.reload();\n                }, 5000);\n            }\n            menu.style.display = \"none\";\n        };\n\n        document.addEventListener(\"click\", (e) => {\n            if (!wrapper.contains(e.target)) menu.style.display = \"none\";\n        });\n    }\n\n    /* DOM observer pour lancer les injections si la structure change */\n    function runInjections() {\n        injectMenu();\n        injectHardwareVersion();\n    }\n\n    const observer = new MutationObserver(() => runInjections());\n    observer.observe(document.body, {\n        childList: true,\n        subtree: true\n    });\n\n    /* =========================================================\n       DATA UPDATES\n    ========================================================= */\n    this.$watch(\"msg\", (msg) => {\n        if (!msg || !msg.payload) return;\n\n        // 1. Update Machine Name (Droite)\n        if (msg.payload.machine_name) {\n            const name = msg.payload.machine_name;\n            const el = document.getElementById(\"pks-machine-name\");\n            if (el) el.textContent = name;\n            buildMenu(name);\n        }\n\n        // 2. Update Hardware Version (Gauche)\n        if (msg.payload.hardware_version) {\n            // On s'assure que l'lment existe\n            injectHardwareVersion();\n\n            const hwEl = document.getElementById(\"pks-hw-version\");\n            if (hwEl) {\n                hwEl.textContent = msg.payload.hardware_version;\n                hwEl.style.display = \"inline-flex\"; // On l'affiche maintenant qu'on a la valeur\n            }\n        }\n\n        runInjections();\n    });\n\n    setTimeout(runInjections, 200);\n</script>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "widget:ui",
        "className": "",
        "x": 800,
        "y": 180,
        "wires": [
            [
                "1db1c2e3e19e85ff"
            ]
        ]
    },
    {
        "id": "e68b686e94d78c9d",
        "type": "ui-template",
        "z": "1b667c6443413ced",
        "group": "36931a9722892790",
        "page": "",
        "ui": "",
        "name": "Software Version",
        "order": 1,
        "width": "0",
        "height": "0",
        "head": "",
        "format": "<template>\n  <v-row class=\"align-center pa-4\">\n    <v-col cols=\"auto\" class=\"d-flex align-center\">\n      <v-icon size=\"32\" color=\"primary\" class=\"mr-4\">mdi-github</v-icon>\n      <span class=\"text-subtitle-2 font-weight-medium\">Software Version</span>\n    </v-col>\n\n    <v-col class=\"text-subtitle-2 font-weight-bold\">\n      {{ msg.payload.software_version }}\n    </v-col>\n  </v-row>\n</template>\n",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 550,
        "y": 480,
        "wires": [
            []
        ]
    },
    {
        "id": "e431a9253416f9eb",
        "type": "ui-template",
        "z": "1b667c6443413ced",
        "group": "2aa235120084abe4",
        "page": "",
        "ui": "",
        "name": "Images Acquired",
        "order": 1,
        "width": "0",
        "height": "0",
        "head": "",
        "format": "<template>\n  <v-row class=\"align-center pa-4\">\n    <v-col cols=\"auto\" class=\"d-flex align-center\">\n      <v-icon size=\"32\" color=\"primary\" class=\"mr-4\">\n        mdi-image-multiple-outline\n      </v-icon>\n      <span class=\"text-subtitle-2 font-weight-medium\">\n        Images Acquired\n      </span>\n    </v-col>\n\n    <v-col class=\"text-subtitle-2 font-weight-bold\">\n      {{ msg.payload.image_acquired }}\n    </v-col>\n  </v-row>\n</template>\n",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 550,
        "y": 520,
        "wires": [
            []
        ]
    },
    {
        "id": "b50dce0a86c2668c",
        "type": "ui-template",
        "z": "1b667c6443413ced",
        "group": "df7c60bd8b265e48",
        "page": "",
        "ui": "",
        "name": "Objects Segmented",
        "order": 1,
        "width": "0",
        "height": "0",
        "head": "",
        "format": "<template>\n  <v-row class=\"align-center pa-4\">\n    <v-col cols=\"auto\" class=\"d-flex align-center\">\n      <v-icon size=\"32\" color=\"primary\" class=\"mr-4\">\n        mdi-crop\n      </v-icon>\n      <span class=\"text-subtitle-2 font-weight-medium\">\n        Objects Segmented\n      </span>\n    </v-col>\n\n    <v-col class=\"text-subtitle-2 font-weight-bold\">\n      {{ msg.payload.object_segmented }}\n    </v-col>\n  </v-row>\n</template>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 560,
        "y": 560,
        "wires": [
            []
        ]
    },
    {
        "id": "07c889f3fa18b15b",
        "type": "ui-template",
        "z": "1b667c6443413ced",
        "group": "dc304678d9a6b53b",
        "page": "",
        "ui": "",
        "name": "Storage",
        "order": 1,
        "width": "0",
        "height": "0",
        "head": "",
        "format": "<template>\n  <v-row class=\"align-center pa-4\">\n    <!-- Icon + Label -->\n    <v-col cols=\"auto\" class=\"d-flex align-center\">\n      <v-icon size=\"32\" color=\"primary\" class=\"mr-4\">mdi-sd</v-icon>\n      <span class=\"text-subtitle-2 font-weight-medium\">Storage</span>\n    </v-col>\n\n    <!-- Progress bar -->\n    <v-col>\n      <v-progress-linear :model-value=\"msg.payload.storage_percent_used\" height=\"12\" rounded class=\"mx-3\" :color=\"\n          msg.payload.storage_percent_used > 90\n            ? 'error'\n            : msg.payload.storage_percent_used > 70\n            ? 'warning'\n            : 'success'\n        \" />\n    </v-col>\n\n    <!-- Percentage -->\n    <v-col cols=\"auto\" class=\"text-subtitle-2 font-weight-bold text-right\" style=\"min-width: 48px;\">\n      {{ msg.payload.storage_percent_used }}%\n    </v-col>\n  </v-row>\n</template>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 520,
        "y": 600,
        "wires": [
            []
        ]
    },
    {
        "id": "ae546211d7d4413c",
        "type": "ui-template",
        "z": "1b667c6443413ced",
        "group": "8a113b6c8e1eadb7",
        "page": "",
        "ui": "",
        "name": "Learn the basic",
        "order": 1,
        "width": "0",
        "height": "0",
        "head": "",
        "format": "<template>\n      <v-btn\n        href=\"/ps/docs/operation/protocol-v4.pdf\"\n        target=\"_blank\"\n        color=\"grey-darken-3\"\n        variant=\"tonal\"\n        size=\"large\"\n        class=\"text-none w-100 text-subtitle-1 py-3\"\n      >\n        <v-icon start size=\"30\">mdi-book-open-variant</v-icon>\n        Learn the Basics\n      </v-btn>\n</template>\n",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 540,
        "y": 440,
        "wires": [
            []
        ]
    },
    {
        "id": "6440d3bb6107d79d",
        "type": "ui-template",
        "z": "1b667c6443413ced",
        "group": "97e552a2d05b0800",
        "page": "",
        "ui": "",
        "name": "Lanch the preview",
        "order": 1,
        "width": "0",
        "height": "0",
        "head": "",
        "format": "<template>\n    <v-btn\n      href=\"preview\"\n      variant=\"flat\"\n      color=\"primary\"\n      size=\"large\"\n      stacked\n      class=\"text-none w-100 py-6 flex-column\"\n    >\n      <v-icon size=\"50\" class=\"mb-2\">mdi-eye</v-icon>\n      <span class=\"text-h6\">Launch the Preview</span>\n    </v-btn>\n</template>\n",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 550,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "19ee8d1758dd9c06",
        "type": "ui-template",
        "z": "1b667c6443413ced",
        "group": "82480e386ed6f8bd",
        "page": "",
        "ui": "",
        "name": "Explore your data",
        "order": 1,
        "width": "0",
        "height": "0",
        "head": "",
        "format": "<template>\n    <v-btn\n      href=\"visualization\"\n      target=\"_blank\"\n      variant=\"outlined\"\n      color=\"primary\"\n      size=\"large\"\n      stacked\n      class=\"text-none w-100 py-6 flex-column\"\n    >\n      <v-icon size=\"50\" class=\"mb-2\">mdi-chart-scatter-plot-hexbin</v-icon>\n      <span class=\"text-h6\">Explore your data</span>\n    </v-btn>\n</template>\n",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 550,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "0152d19f6346a058",
        "type": "ui-template",
        "z": "1b667c6443413ced",
        "group": "9d3e8bdd535f0e0d",
        "page": "",
        "ui": "",
        "name": "Run the Calibration",
        "order": 1,
        "width": "0",
        "height": "0",
        "head": "",
        "format": "<template>\n    <v-btn\n      href=\"calibration\"\n      variant=\"flat\"\n      color=\"grey-darken-3\"\n      size=\"large\"\n      stacked\n      class=\"text-none w-100 py-6 flex-column\"\n    >\n      <v-icon size=\"50\" class=\"mb-2\">mdi-tune</v-icon>\n      <span class=\"text-h6\">Run the Calibration</span>\n    </v-btn>\n</template>\n",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 550,
        "y": 400,
        "wires": [
            []
        ]
    },
    {
        "id": "683fec6ef9b340f7",
        "type": "ui-template",
        "z": "1b667c6443413ced",
        "group": "",
        "page": "632260133d581caa",
        "ui": "",
        "name": "CSS (All Pages)",
        "order": 0,
        "width": 0,
        "height": 0,
        "head": "",
        "format": ".v-card-text{\n    padding : 0 !important;\n}\n\n\n    \n",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "page:style",
        "className": "",
        "x": 1300,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "a57a165cd0ce511b",
        "type": "ui-template",
        "z": "ab58b3fd0e6bcd77",
        "group": "58ab4d5e3dd68192",
        "page": "",
        "ui": "",
        "name": "Streaming",
        "order": 1,
        "width": "0",
        "height": "0",
        "head": "",
        "format": "<template>\n    <v-container fluid class=\"pa-0\">\n                \n\n                    <div class=\"iframe-container border\">\n                        <!-- \n                            Replace '/preview/node-red' with your actual target URL. \n                            Ensure the target URL allows iframe embedding (X-Frame-Options).\n                        -->\n                        <iframe src=\"/preview/node-red\" title=\"Node-RED Preview\"></iframe>\n                    </div>\n                    \n    </v-container>\n</template>\n\n<style>\n    /* Scoped styles for the iframe container \n      Force a 4:3 aspect ratio\n    */\n    .iframe-container {\n        position: relative;\n        width: 100%;\n        padding-top: 75%; /* 4:3 Aspect Ratio */\n        overflow: hidden;\n        border-radius: 8px;\n    }\n\n    .iframe-container iframe {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        border: none;\n        margin: 0;\n    }\n</style>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 1310,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "c8de0186a0a927e8",
        "type": "function",
        "z": "ab58b3fd0e6bcd77",
        "name": "Get Global Variables",
        "func": "const keys = global.keys(); // Get all global variable keys\nmsg.payload = {}; // Initialize the payload object\n\nkeys.forEach(key => {\n    // Ignore keys that start with \"$\"\n    if (!key.startsWith('$')) {\n        msg.payload[key] = global.get(key);\n    }\n});\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 120,
        "y": 140,
        "wires": [
            [
                "f514a138d38d3c61"
            ]
        ]
    },
    {
        "id": "927b92eee9edfcbe",
        "type": "ui-template",
        "z": "ab58b3fd0e6bcd77",
        "group": "7572915171e440cd",
        "page": "",
        "ui": "",
        "name": "Navigation Top",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n  <v-container fluid class=\"ma-0 pa-0\">\n    <v-row \n      align=\"center\" \n      class=\"py-4 px-6 rounded-lg border\" \n      no-gutters variant=\"flat\" style=\"background:white\"\n    >\n      \n      <v-col cols=\"3\" class=\"py-0 d-flex justify-start\">\n        <v-btn\n          to=\"home\"\n          color=\"primary\"\n          rounded=\"lg\"\n          class=\"px-4\" variant=\"text\" size=\"large\"\n        >\n          <v-icon start>mdi-chevron-left</v-icon>\n          Home\n        </v-btn>\n      </v-col>\n\n      <v-col cols=\"6\" class=\"text-center py-0\">\n        <h1 class=\"text-h5 font-weight-bold text-primary my-0 text-truncate\">\n          Preview\n        </h1>\n      </v-col>\n\n      <v-col cols=\"3\" class=\"py-0 d-flex justify-end\">\n        <v-btn\n          to=\"metadata\"\n          color=\"primary\"\n          rounded=\"lg\"\n          class=\"px-4\" variant=\"text\" size=\"large\"\n        >\n          Metadata\n          <v-icon end>mdi-chevron-right</v-icon>\n        </v-btn>\n      </v-col>\n      \n    </v-row>\n  </v-container>\n</template>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 1300,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "8d5eadf60a2fd54b",
        "type": "switch",
        "z": "ab58b3fd0e6bcd77",
        "name": "msg.topic === \"$pageview\"",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "$pageview",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 280,
        "y": 40,
        "wires": [
            [
                "6074fc31218f9a74"
            ]
        ]
    },
    {
        "id": "da4fbaab826b0d62",
        "type": "ui-event",
        "z": "ab58b3fd0e6bcd77",
        "ui": "e6ae26617c24c3ea",
        "name": "UI Event",
        "x": 80,
        "y": 40,
        "wires": [
            [
                "8d5eadf60a2fd54b"
            ]
        ]
    },
    {
        "id": "6074fc31218f9a74",
        "type": "switch",
        "z": "ab58b3fd0e6bcd77",
        "name": "msg.payload.page.path === \"/preview\"",
        "property": "payload.page.path",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "/preview",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 580,
        "y": 40,
        "wires": [
            [
                "c8de0186a0a927e8"
            ]
        ]
    },
    {
        "id": "6d0408bb7ca6e5f3",
        "type": "function",
        "z": "ab58b3fd0e6bcd77",
        "name": "set pump settings",
        "func": "if (msg.topic) {\n    global.set(\"pump_flowrate\", msg.payload.pump_flowrate);\n    global.set(\"pump_manual_volume\", msg.payload.pump_manual_volume);\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 810,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "4a208e0233bea4ae",
        "type": "function",
        "z": "ab58b3fd0e6bcd77",
        "name": "set focus settings",
        "func": "if (msg.topic) {\n    global.set(\"focus_distance\", msg.payload.focus_distance);\n\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 810,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "ea8e81951587e46d",
        "type": "mqtt out",
        "z": "ab58b3fd0e6bcd77",
        "name": "MQTT",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "8dc3722c.06efa8",
        "x": 770,
        "y": 340,
        "wires": []
    },
    {
        "id": "4112a93b1b129756",
        "type": "switch",
        "z": "ab58b3fd0e6bcd77",
        "name": "",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "set_global/pump",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "actuator/pump",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "set_global/focus",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "actuator/focus",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "light",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 5,
        "x": 550,
        "y": 160,
        "wires": [
            [
                "6d0408bb7ca6e5f3"
            ],
            [
                "ea8e81951587e46d"
            ],
            [
                "4a208e0233bea4ae"
            ],
            [
                "ea8e81951587e46d"
            ],
            [
                "ea8e81951587e46d",
                "1d591029bae11418"
            ]
        ]
    },
    {
        "id": "f514a138d38d3c61",
        "type": "ui-template",
        "z": "ab58b3fd0e6bcd77",
        "group": "39cbd2658f16d608",
        "page": "",
        "ui": "",
        "name": "body",
        "order": 1,
        "width": "0",
        "height": "0",
        "head": "",
        "format": "<template>\n  <v-container fluid  class=\"pa-0\">\n    <!-- LED CONTROL -->\n    <v-card class=\"mb-6 pa-6 rounded-lg border\" variant=\"flat\" color=\"white\">\n      <v-card-text><!-- Label -->\n\n      <div class=\"d-flex justify-space-between align-center mb-4\">\n        <div class=\"text-h6\">LED Control</div>\n      </div>\n        <v-row>\n          <v-col cols=\"12\">\n            <v-btn-toggle variant=\"outlined\" v-model=\"led_state\" color=\"primary\" mandatory divided shaped\n              class=\"d-flex justify-space-between\" @update:model-value=\"on_led_toggle\">\n              <v-btn class=\"flex-grow-1\" :value=\"'off'\">Off</v-btn>\n              <v-btn class=\"flex-grow-1\" :value=\"'on'\">On</v-btn>\n            </v-btn-toggle>\n          </v-col>\n        </v-row>\n      </v-card-text>\n    </v-card>\n\n    <!-- FOCUS CONTROL -->\n    <v-card class=\"mb-6 pa-6 rounded-lg border\" variant=\"flat\" color=\"white\">\n    <v-card-text>\n\n    <!-- Label -->\n    <div class=\"d-flex justify-space-between align-center mb-4\">\n      <div class=\"text-h6\">Focus Distance</div>\n    </div>\n    <!-- Focus slider + input -->\n    <v-row align=\"center\">\n      <v-col :cols=\"isTablet ? 4 : 7\">\n        <v-slider\n          v-model.number=\"focus_distance\"\n          :max=\"maxFocus\"\n          :min=\"minFocus\"\n          :step=\"25\"\n          hide-details\n          :thumb-size=\"isTablet ? 12 : 20\"\n          :track-size=\"isTablet ? 2 : 4\"\n        />\n      </v-col>\n      <v-col :cols=\"isTablet ? 8 : 5\">\n        <v-text-field\n          v-model.number=\"focus_distance\"\n          type=\"number\"\n          variant=\"outlined\"\n          hide-details\n          suffix=\"m\"\n          :density=\"isTablet ? 'comfortable' : 'default'\"\n          :style=\"isTablet ? 'font-size: 1.3rem; width: 100%;' : ''\"\n          append-icon=\"mdi-information\"\n          @click:append=\"showInfo('focus_speed')\"\n        />\n      </v-col>\n    </v-row>\n\n    <!-- Presets -->\n    <v-row>\n      <v-col cols=\"12\">\n        <v-btn-toggle\n          variant=\"outlined\"\n          v-model=\"focus_distance_preset\"\n          divided\n          shaped\n          color=\"primary\"\n          class=\"d-flex justify-space-between\"\n          mandatory\n          @update:model-value=\"on_focus_distance_toggle\"\n        >\n          <v-btn\n            v-for=\"value in focus_distance_presets\"\n            :key=\"'distance-' + value\"\n            :value=\"value\"\n            class=\"flex-grow-1\"\n          >\n            {{ value }}\n          </v-btn>\n        </v-btn-toggle>\n      </v-col>\n    </v-row>\n\n    <!-- Focus direction -->\n    <v-row>\n      <v-col cols=\"12\">\n        <v-btn-toggle\n          variant=\"outlined\"\n          v-model=\"focus_direction\"\n          color=\"primary\"\n          mandatory\n          divided\n          shaped\n          class=\"d-flex justify-space-between\"\n          @update:model-value=\"on_focus_direction_change\"\n        >\n          <v-btn class=\"flex-grow-1\" :value=\"'UP'\">Up</v-btn>\n          <v-btn class=\"flex-grow-1\" :value=\"'stop'\">Stop</v-btn>\n          <v-btn class=\"flex-grow-1\" :value=\"'DOWN'\">Down</v-btn>\n        </v-btn-toggle>\n      </v-col>\n    </v-row>\n\n  </v-card-text>\n</v-card>\n\n    <!-- PUMP CONTROL -->\n    <v-card class=\"mb-6 pa-6 rounded-lg border\" variant=\"flat\" color=\"white\">\n      <v-card-text>\n\n    <!-- Label -->\n\n    <div class=\"d-flex justify-space-between align-center mb-4\">\n      <div class=\"text-h6\">Pump Flowrate</div>\n    </div>\n        <!-- Flowrate -->\n        <v-row align=\"center\">\n          <v-col :cols=\"isTablet ? 4 : 7\">\n            <v-slider v-model.number=\"pump_flowrate\" :min=\"minFlow\" :max=\"maxFlow\" :step=\"0.2\" hide-details\n              :thumb-size=\"isTablet ? 12 : 20\" :track-size=\"isTablet ? 2 : 4\" />\n          </v-col>\n          <v-col :cols=\"isTablet ? 8 : 5\">\n            <v-text-field v-model.number=\"pump_flowrate\" type=\"number\" variant=\"outlined\" hide-details suffix=\"ml/min\"\n              :density=\"isTablet ? 'comfortable' : 'default'\" :style=\"isTablet ? 'font-size: 1.3rem; width: 100%;' : ''\"\n              append-icon=\"mdi-information\" @click:append=\"showInfo('pump_flowrate')\" />\n          </v-col>\n        </v-row>\n\n        <!-- Flowrate presets -->\n        <v-row>\n          <v-col cols=\"12\">\n            <v-btn-toggle v-model=\"pump_flowrate_preset\" class=\"d-flex justify-space-between\" color=\"primary\"\n              variant=\"outlined\" divided shaped mandatory @update:model-value=\"onFlowrateToggle\">\n              <v-btn v-for=\"value in pump_flowrate_presets\" :key=\"'flowrate-' + value\" :value=\"value\"\n                class=\"flex-grow-1\">\n                {{ value }}\n              </v-btn>\n            </v-btn-toggle>\n          </v-col>\n        </v-row>\n\n      <!-- Label -->\n<v-divider class=\"py-2\"></v-divider>\n\n    <div class=\"d-flex justify-space-between align-center mb-4\">\n      <div class=\"text-h6\">Pump Volume</div>\n    </div>\n        <!-- Volume -->\n        <v-row align=\"center\">\n          <v-col :cols=\"isTablet ? 4 : 7\">\n            <v-slider v-model.number=\"pump_manual_volume\" :min=\"minFlow\" :max=\"maxFlow\" :step=\"0.2\" hide-details\n              :thumb-size=\"isTablet ? 12 : 20\" :track-size=\"isTablet ? 2 : 4\" />\n          </v-col>\n          <v-col :cols=\"isTablet ? 8 : 5\">\n            <v-text-field v-model.number=\"pump_manual_volume\" type=\"number\" variant=\"outlined\" hide-details suffix=\"ml\"\n              :density=\"isTablet ? 'comfortable' : 'default'\" :style=\"isTablet ? 'font-size: 1.3rem; width: 100%;' : ''\"\n              append-icon=\"mdi-information\" @click:append=\"showInfo('pump_manual_volume')\" />\n          </v-col>\n        </v-row>\n\n        <!-- Volume presets -->\n        <v-row>\n          <v-col cols=\"12\">\n            <v-btn-toggle v-model=\"pump_volume_preset\" class=\"d-flex justify-space-between\" variant=\"outlined\"\n              color=\"primary\" divided shaped mandatory @update:model-value=\"onVolumeToggle\">\n              <v-btn v-for=\"value in pump_volume_presets\" :key=\"'volume-' + value\" :value=\"value\" class=\"flex-grow-1\">\n                {{ value }}\n              </v-btn>\n            </v-btn-toggle>\n          </v-col>\n        </v-row>\n\n        <!-- Pump direction -->\n        <v-row>\n          <v-col cols=\"12\">\n            <v-btn-toggle variant=\"outlined\" v-model=\"pump_direction\" color=\"primary\" mandatory divided shaped\n              class=\"d-flex justify-space-between\" @update:model-value=\"on_pump_direction_change\">\n              <v-btn class=\"flex-grow-1\" :value=\"'backward'\">Backward</v-btn>\n              <v-btn class=\"flex-grow-1\" :value=\"'stop'\">Stop</v-btn>\n              <v-btn class=\"flex-grow-1\" :value=\"'forward'\">Forward</v-btn>\n            </v-btn-toggle>\n          </v-col>\n        </v-row>\n      </v-card-text>\n    </v-card>\n\n    <!-- CALIBRATION INFO -->\n    <v-card class=\"pa-6 rounded-lg border\" variant=\"tonal\" color=\"grey-darken-3\">\n          \n    <v-list-item lines=\"two\" href=\"calibration\" class=\"pa-4\">\n    <template v-slot:prepend>\n      <v-icon size=\"x-large\">mdi-tune</v-icon>\n    </template>\n\n    <v-list-item-title class=\"text-h6\">\n      Calibration\n    </v-list-item-title>\n\n    <v-list-item-subtitle>\n      Modify camera settings and optical parameters for accurate imaging.\n    </v-list-item-subtitle>\n\n    <template v-slot:append>\n      <v-icon >mdi-chevron-right</v-icon>\n    </template>\n  </v-list-item>\n</v-card>\n\n    <!-- INFO DIALOG -->\n    <v-dialog v-model=\"infoDialog\" max-width=\"500\">\n      <v-card>\n        <v-card-title class=\"text-h6\">{{ infoContent.title }}</v-card-title>\n        <v-card-text>\n          <p><strong>Unit:</strong> {{ infoContent.unit }}</p>\n          <p><strong>Description:</strong> {{ infoContent.description }}</p>\n        </v-card-text>\n        <v-card-actions>\n          <v-spacer></v-spacer>\n          <v-btn color=\"primary\" text @click=\"infoDialog = false\">Close</v-btn>\n        </v-card-actions>\n      </v-card>\n    </v-dialog>\n  </v-container>\n</template>\n\n<script>\nexport default {\n  props: { msg: { type: Object, default: () => ({}) } },\n\n  data() {\n    return {\n      minFlow: 0.02,\n      maxFlow: 30,\n      pump_flowrate: 0,\n      pump_manual_volume: 0,\n      pump_flowrate_presets: [0.02, 0.2, 2, 20],\n      pump_volume_presets: [0.004, 0.2, 2, 20],\n      pump_flowrate_preset: null,\n      pump_volume_preset: null,\n      pump_direction: \"stop\",\n\n      minFocus: 25,\n      maxFocus: 5000,\n      focus_distance: 25,\n      focus_distance_presets: [25, 150, 500, 5000],\n      focus_distance_preset: null,\n      focus_direction: \"stop\",\n\n      led_state: \"off\",\n\n      infoDialog: false,\n      infoContent: { title: \"\", unit: \"\", description: \"\" },\n    };\n  },\n\n  computed: {\n    isTablet() {\n      return this.$vuetify.display.mdAndDown;\n    },\n  },\n\n  created() {\n    this.hydrateFromMsg(this.msg);\n  },\n\n  watch: {\n    msg: { handler(newMsg) { this.hydrateFromMsg(newMsg); }, deep: true },\n\n    pump_flowrate(newVal) {\n      this.pump_flowrate_preset =\n        this.pump_flowrate_presets.find((v) => v === newVal) ?? null;\n      this.sendPumpParams();\n    },\n    pump_manual_volume(newVal) {\n      this.pump_volume_preset =\n        this.pump_volume_presets.find((v) => v === newVal) ?? null;\n      this.sendPumpParams();\n    },\n    focus_distance(newVal) {\n      this.focus_distance_preset =\n        this.focus_distance_presets.find((v) => v === newVal) ?? null;\n      this.sendFocusParams();\n    },\n  },\n\n  methods: {\n    hydrateFromMsg(m) {\n      const p = m?.payload ?? {};\n\n      // --- STATUS MESSAGES (ne bloquent plus les autres updates !) ---\n      if (m.topic === \"status/pump\" && p.status === \"Done\") {\n        this.pump_direction = \"stop\";\n      }\n\n      if (m.topic === \"status/focus\" && p.status === \"Done\") {\n        this.focus_direction = \"stop\";\n      }\n\n      // --- LED STATE (ne bloque plus le reste du payload) ---\n      if (\"led_status\" in p) {\n        const s = String(p.led_status).toLowerCase().trim();\n        this.led_state = [\"on\", \"true\", \"1\"].includes(s) ? \"on\" : \"off\";\n      }\n\n      if (m.topic === \"status/light\" && \"status\" in p) {\n        const s = String(p.status).toLowerCase().trim();\n        this.led_state = [\"on\", \"true\", \"1\"].includes(s) ? \"on\" : \"off\";\n      }\n\n      // --- GLOBAL / ACTUATOR PARAMS ---\n      this.pump_flowrate =\n        p.flowrate ?? p.pump_flowrate ?? this.pump_flowrate;\n\n      this.pump_manual_volume =\n        p.volume ?? p.pump_manual_volume ?? this.pump_manual_volume;\n\n      if ([\"backward\", \"stop\", \"forward\"].includes(p.command)) {\n        this.pump_direction = p.command;\n      }\n\n      if (typeof p.focus_distance === \"number\") {\n        this.focus_distance = p.focus_distance;\n      }\n\n      if ([\"UP\", \"stop\", \"DOWN\"].includes(p.command)) {\n        this.focus_direction = p.command;\n      }\n\n      if (typeof p.ledState === \"string\") {\n        this.led_state = p.ledState;\n      }\n\n      if (typeof p.action === \"string\" && [\"on\", \"off\"].includes(p.action)) {\n        this.led_state = p.action;\n      }\n    },\n\n    // --- PUMP PARAMS ---\n    onFlowrateToggle(val) {\n      if (val != null) this.pump_flowrate = val;\n    },\n\n    onVolumeToggle(val) {\n      if (val != null) this.pump_manual_volume = val;\n    },\n\n    sendPumpParams() {\n      this.send({\n        topic: \"set_global/pump\",\n        payload: {\n          pump_flowrate: Number(this.pump_flowrate) || 0,\n          pump_manual_volume: Number(this.pump_manual_volume) || 0,\n        },\n      });\n    },\n\n    on_pump_direction_change(val) {\n      this.pump_direction = val;\n\n      if (val === \"stop\") {\n        this.send({ topic: \"actuator/pump\", payload: { action: \"stop\" } });\n      } else {\n        const dir = val === \"forward\" ? \"FORWARD\" : \"BACKWARD\";\n        this.send({\n          topic: \"actuator/pump\",\n          payload: {\n            action: \"move\",\n            direction: dir,\n            volume: Number(this.pump_manual_volume) || 0,\n            flowrate: Number(this.pump_flowrate) || 0,\n          },\n        });\n      }\n    },\n\n    // --- FOCUS PARAMS ---\n    on_focus_distance_toggle(val) {\n      if (val != null) this.focus_distance = val;\n    },\n\n    speedFromDistance(d) {\n      const x1 = 100, y1 = 1000;\n      const x2 = 1000, y2 = 2000;\n      const x3 = 5000, y3 = 5000;\n\n      if (d <= x1) return y1;\n      if (d >= x3) return y3;\n\n      if (d <= x2) {\n        const m = (y2 - y1) / (x2 - x1);\n        return Math.round(y1 + m * (d - x1));\n      }\n\n      const m = (y3 - y2) / (x3 - x2);\n      return Math.round(y2 + m * (d - x2));\n    },\n\n    sendFocusParams() {\n      const d = Number(this.focus_distance) || 25;\n      const speed = this.speedFromDistance(d);\n\n      this.send({\n        topic: \"set_global/focus\",\n        payload: {\n          focus_distance: d,\n          focus_speed: speed,\n        },\n      });\n    },\n\n    on_focus_direction_change(val) {\n      this.focus_direction = val;\n\n      if (val === \"stop\") {\n        this.send({ topic: \"actuator/focus\", payload: { action: \"stop\" } });\n      } else {\n        const d = Number(this.focus_distance) || 25;\n        const speed = this.speedFromDistance(d);\n\n        this.send({\n          topic: \"actuator/focus\",\n          payload: {\n            action: \"move\",\n            direction: val,\n            distance: d / 1000,\n            speed: speed / 1000,\n          },\n        });\n      }\n    },\n\n    // --- LED ---\n    on_led_toggle(val) {\n      if (!val) return;\n      this.led_state = val;\n      this.send({ topic: \"light\", payload: { action: val } });\n    },\n\n    // --- INFO POPUP ---\n    showInfo(type) {\n      const infoMap = {\n        pump_flowrate: {\n          title: \"Flowrate (ml/min)\",\n          unit: \"ml/min\",\n          description: \"Flowrate of the pump during manual exploration\",\n        },\n        pump_manual_volume: {\n          title: \"Volume to pass (ml)\",\n          unit: \"ml\",\n          description: \"Volume displaced by the pump during manual exploration\",\n        },\n        focus_speed: {\n          title: \"Focus Speed (m/sec)\",\n          unit: \"m/s\",\n          description: \"Speed of the displacement by the focus plate during manual exploration\",\n        },\n      };\n      this.infoContent = infoMap[type] || {};\n      this.infoDialog = true;\n    },\n  },\n};\n</script>\n\n<style scoped>\n\n  @media (max-width: 1024px) {\n    .v-text-field input {\n      font-size: 1.3rem !important;\n    }\n\n    .v-slider {\n      height: 2px !important;\n    }\n  }\n\n.v-card-text{\n  padding : 0 !important;\n}\n.v-card{\n  border:none;\n}\n.v-container{\n  background: #eef3ff;\n}\n\n\n</style>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 370,
        "y": 140,
        "wires": [
            [
                "4112a93b1b129756"
            ]
        ]
    },
    {
        "id": "cf663463da2a47a1",
        "type": "mqtt in",
        "z": "ab58b3fd0e6bcd77",
        "name": "",
        "topic": "status/pump",
        "qos": "0",
        "datatype": "json",
        "broker": "8dc3722c.06efa8",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 90,
        "y": 200,
        "wires": [
            [
                "f514a138d38d3c61"
            ]
        ]
    },
    {
        "id": "1b2c14f14bbf80c2",
        "type": "mqtt in",
        "z": "ab58b3fd0e6bcd77",
        "name": "",
        "topic": "status/focus",
        "qos": "0",
        "datatype": "json",
        "broker": "8dc3722c.06efa8",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 90,
        "y": 260,
        "wires": [
            [
                "f514a138d38d3c61"
            ]
        ]
    },
    {
        "id": "2321977c636b9849",
        "type": "ui-template",
        "z": "ab58b3fd0e6bcd77",
        "group": "55c2fe64e681037d",
        "page": "",
        "ui": "",
        "name": "Navigation Bottom",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n  <v-container fluid class=\"ma-0 pa-0\">\n    <v-row \n      align=\"center\" \n      class=\"py-4 px-6 rounded-lg border\" \n      no-gutters variant=\"flat\" style=\"background:white\"\n    >\n      \n      <v-col cols=\"3\" class=\"py-0 d-flex justify-start\">\n        <v-btn\n          to=\"home\"\n          color=\"primary\"\n          rounded=\"lg\"\n          class=\"px-4\" variant=\"text\" size=\"large\"\n        >\n          <v-icon start>mdi-chevron-left</v-icon>\n          Home\n        </v-btn>\n      </v-col>\n\n      <v-col cols=\"6\" class=\"text-center py-0\">\n\n      </v-col>\n\n      <v-col cols=\"3\" class=\"py-0 d-flex justify-end\">\n        <v-btn\n          to=\"metadata\"\n          color=\"primary\"\n          rounded=\"lg\"\n          class=\"px-4\" variant=\"text\" size=\"large\"\n        >\n          Metadata\n          <v-icon end>mdi-chevron-right</v-icon>\n        </v-btn>\n      </v-col>\n      \n    </v-row>\n  </v-container>\n</template>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 1290,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "1d591029bae11418",
        "type": "function",
        "z": "ab58b3fd0e6bcd77",
        "name": "set light settings",
        "func": "if (msg.topic) {\n    global.set(\"led_status\", msg.payload.action);\n\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "44438204d4b0d21e",
        "type": "mqtt in",
        "z": "ab58b3fd0e6bcd77",
        "name": "",
        "topic": "status/light",
        "qos": "0",
        "datatype": "json",
        "broker": "8dc3722c.06efa8",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 80,
        "y": 320,
        "wires": [
            [
                "f514a138d38d3c61"
            ]
        ]
    },
    {
        "id": "349d0f7644f26a62",
        "type": "ui-template",
        "z": "190b0c9aa75e8843",
        "group": "dd015fda7456b9b0",
        "page": "",
        "ui": "",
        "name": "Navigation Top",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n  <v-container fluid class=\"ma-0 pa-0\">\n    <v-row \n      align=\"center\" \n      class=\"px-2 py-0\" \n      no-gutters\n    >\n      \n      <v-col cols=\"3\" class=\"py-0 d-flex justify-start\">\n        <v-btn\n          to=\"preview\"\n          color=\"primary\"\n          rounded=\"lg\"\n          class=\"px-4\" variant=\"text\" size=\"large\"\n        >\n          <v-icon start>mdi-chevron-left</v-icon>\n          Preview\n        </v-btn>\n      </v-col>\n\n      <v-col cols=\"6\" class=\"text-center py-0\">\n        <h1 class=\"text-h5 font-weight-bold text-primary my-0 text-truncate\">\n          Metadata\n        </h1>\n      </v-col>\n\n      <v-col cols=\"3\" class=\"py-0 d-flex justify-end\">\n        <v-btn\n          to=\"acquisition\"\n          color=\"primary\"\n          rounded=\"lg\"\n          class=\"px-4\" variant=\"text\" size=\"large\"\n        >\n          Acquisition\n          <v-icon end>mdi-chevron-right</v-icon>\n        </v-btn>\n      </v-col>\n      \n    </v-row>\n  </v-container>\n</template>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 1300,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "279f3ddada9cadaa",
        "type": "ui-template",
        "z": "190b0c9aa75e8843",
        "group": "69c772603e9cec0d",
        "page": "",
        "ui": "",
        "name": "Sample Information",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n  <!-- Project Metadata Inputs -->\n  <v-row class=\"mt-2\">\n    <!-- Project Name -->\n    <v-col cols=\"12\" md=\"4\">\n      <v-text-field v-model=\"sample_project\" label=\"Name of the project\" placeholder=\"ex : Tara Pacifique\"\n        variant=\"outlined\" hint=\"Enter the research project or expedition name this sample is part of.\"\n        @input=\"sendUpdate\">\n        <template #append>\n          <v-icon class=\"cursor-pointer\" @click=\"openHint(\n              'Name of the project',\n              'Enter the research project or expedition name this sample is part of.'\n            )\">\n            mdi-information\n          </v-icon>\n        </template>\n      </v-text-field>\n    </v-col>\n\n    <!-- Sample ID -->\n    <v-col cols=\"12\" md=\"4\">\n      <v-text-field \n      v-model.number=\"sample_id\"\n      type=\"number\"\n      label=\"Sample ID\"\n      prefix=\"S_\"\n      placeholder=\"ex : S001\"\n      variant=\"outlined\"\n      density=\"compact\"\n        hint=\"Provide a unique identifier for this sample (e.g., S001).\" @input=\"sendUpdate\">\n        <template #append>\n          <v-icon class=\"cursor-pointer\" @click=\"openHint(\n              'Sample ID',\n              'Provide a unique identifier for this sample (e.g., S001).'\n            )\">\n            mdi-information\n          </v-icon>\n        </template>\n      </v-text-field>\n    </v-col>\n\n    <!-- Operator Name -->\n    <v-col cols=\"12\" md=\"4\">\n      <v-text-field v-model=\"sample_operator\" label=\"Operator name\" placeholder=\"ex : Manu Prakash\" variant=\"outlined\"\n        hint=\"Name of the person who collected the sample.\" @input=\"sendUpdate\">\n        <template #append>\n          <v-icon class=\"cursor-pointer\" @click=\"openHint(\n              'Operator name',\n              'Name of the person who collected the sample.'\n            )\">\n            mdi-information\n          </v-icon>\n        </template>\n      </v-text-field>\n    </v-col>\n  </v-row>\n\n  <!-- Sampling Gear Selector -->\n  <v-row class=\"mt-4\">\n    <v-col cols=\"12\">\n      <div class=\"d-flex align-center mb-2\">\n        <label class=\"text-subtitle-2 font-weight-medium me-2\">\n          Sampling Gear\n        </label>\n        <v-icon class=\"cursor-pointer\" color=\"#666666\" @click=\"openHint(\n            'Sampling Gear',\n            'The type of gear used to collect the sample. This field describes the specific equipment used during the sampling process and provides context about the sampling method and conditions.'\n          )\">\n          mdi-information\n        </v-icon>\n      </div>\n\n      <div style=\"overflow-x: auto;\">\n        <v-btn-toggle v-model=\"sample_gear\" variant=\"outlined\"  color=\"primary\" mandatory divided shaped class=\"d-flex\"\n          style=\"min-width: max-content; min-height: 100px\" @update:model-value=\"sendUpdate\">\n          <v-btn value=\"Horizontal Net\" prepend-icon=\"mdi-arrow-right-bold\" stacked>\n            Horizontal Net\n          </v-btn>\n          <v-btn value=\"Vertical Net\" prepend-icon=\"mdi-arrow-up-bold\" stacked>\n            Vertical Net\n          </v-btn>\n          <v-btn value=\"Niskin bottle\" prepend-icon=\"mdi-bottle-tonic\" stacked>\n            Niskin bottle\n          </v-btn>\n          <v-btn value=\"Lab culture\" prepend-icon=\"mdi-flask-outline\" stacked>\n            Lab culture\n          </v-btn>\n          <v-btn value=\"Demo / Test\" prepend-icon=\"mdi-beaker-outline\" stacked>\n            Demo / Test\n          </v-btn>\n        </v-btn-toggle>\n      </div>\n\n    </v-col>\n  </v-row>\n\n  <!-- Hint Popup -->\n  <v-dialog v-model=\"hintDialog\" max-width=\"400\">\n    <v-card>\n      <v-card-title class=\"text-h6\">{{ hintTitle }}</v-card-title>\n      <v-card-text>{{ hintText }}</v-card-text>\n      <v-card-actions>\n        <v-spacer></v-spacer>\n        <v-btn text color=\"primary\" @click=\"hintDialog = false\">Close</v-btn>\n      </v-card-actions>\n    </v-card>\n  </v-dialog>\n</template>\n\n<script>\n  export default {\n  props: [\"msg\"],\n  data() {\n    return {\n      sample_project: \"\",\n      sample_id: \"\",\n      sample_operator: \"\",\n      sample_gear: null,\n      hintDialog: false,\n      hintTitle: \"\",\n      hintText: \"\",\n      topic: \"sample_project_meta\", // single topic\n    };\n  },\n  watch: {\n    msg: {\n      handler(newMsg) {\n        const p = newMsg?.payload || {};\n        if (p.sample_project !== undefined) this.sample_project = p.sample_project;\n        if (p.sample_id !== undefined) {\n          // Supprime le prfixe ventuel avant d'afficher\n          this.sample_id = String(p.sample_id).replace(/^S[_-]?/, \"\");\n        }\n\n        if (p.sample_operator !== undefined)\n          this.sample_operator = p.sample_operator;\n        if (p.sample_gear !== undefined) this.sample_gear = p.sample_gear;\n      },\n      deep: true,\n    },\n  },\n  methods: {\n    /**\n     * Send grouped payload for all fields under one topic.\n     */\n    sendUpdate(extra = {}) {\n      this.send({\n        topic: this.topic,\n        payload: {\n          sample_project: this.sample_project || \"\",\n          sample_id: this.sample_id ? `S_${this.sample_id}` : \"\",\n          sample_operator: this.sample_operator || \"\",\n          sample_gear: this.sample_gear || \"\",\n          ...extra,\n        },\n      });\n    },\n\n    openHint(title, text) {\n      this.hintTitle = title;\n      this.hintText = text;\n      this.hintDialog = true;\n    },\n  },\n};\n</script>\n\n<style scoped>\n  .cursor-pointer {\n    cursor: pointer;\n  }\n</style>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 410,
        "y": 140,
        "wires": [
            [
                "13f96cf49ae6d6a6"
            ]
        ]
    },
    {
        "id": "96550b272e3da513",
        "type": "ui-template",
        "z": "190b0c9aa75e8843",
        "group": "6fab47af451c6d95",
        "page": "",
        "ui": "",
        "name": "Starting point",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n  <v-container>\n    <!-- Date & Time -->\n    <v-row>\n      <v-col cols=\"12\"><strong>Date and Time</strong></v-col>\n    </v-row>\n\n    <v-row>\n      <v-col cols=\"12\" md=\"6\">\n        <v-text-field\n          v-model=\"object_date\"\n          label=\"Date (UTC)\"\n          variant=\"outlined\"\n          type=\"date\"\n          hide-details=\"auto\"\n          :density=\"isTablet ? 'comfortable' : 'default'\"\n          :style=\"isTablet ? 'font-size:1.2rem;width:100%;' : ''\"\n          @input=\"sendUpdate('object_datetime')\"\n        />\n      </v-col>\n\n      <v-col cols=\"12\" md=\"6\">\n        <v-text-field\n          v-model=\"object_time\"\n          label=\"Time (UTC)\"\n          variant=\"outlined\"\n          type=\"time\"\n          hide-details=\"auto\"\n          :density=\"isTablet ? 'comfortable' : 'default'\"\n          :style=\"isTablet ? 'font-size:1.2rem;width:100%;' : ''\"\n          @input=\"sendUpdate('object_datetime')\"\n        >\n          <template #append>\n            <v-icon class=\"cursor-pointer\" @click=\"openHint('datetime')\">\n              mdi-information\n            </v-icon>\n          </template>\n        </v-text-field>\n      </v-col>\n    </v-row>\n\n    <!-- LATITUDE SECTION -->\n    <v-row>\n      <v-col cols=\"12\"><strong>Latitude</strong></v-col>\n    </v-row>\n    <v-row class=\"mt-4\" align=\"start\">\n      <v-col :cols=\"isTablet ? 3 : 2\">\n        <v-text-field\n          v-model=\"latitude_D\"\n          label=\"\"\n          variant=\"outlined\"\n          hide-details\n          type=\"number\"\n          min=\"0\"\n          max=\"90\"\n          :density=\"isTablet ? 'comfortable' : 'default'\"\n          @input=\"syncDecimal\"\n        />\n      </v-col>\n      <v-col :cols=\"isTablet ? 3 : 2\">\n        <v-text-field\n          v-model=\"latitude_M\"\n          label=\"\"\n          variant=\"outlined\"\n          hide-details\n          type=\"number\"\n          min=\"0\"\n          max=\"59\"\n          :density=\"isTablet ? 'comfortable' : 'default'\"\n          @input=\"syncDecimal\"\n        />\n      </v-col>\n      <v-col :cols=\"isTablet ? 3 : 2\">\n        <v-text-field\n          v-model=\"latitude_S\"\n          label=\"\"\n          variant=\"outlined\"\n          hide-details\n          type=\"number\"\n          min=\"0\"\n          max=\"59\"\n          step=\"0.001\"\n          :density=\"isTablet ? 'comfortable' : 'default'\"\n          @input=\"syncDecimal\"\n        />\n      </v-col>\n      <v-col :cols=\"isTablet ? 3 : 2\">\n        <v-select\n          v-model=\"latDir\"\n          :items=\"['N','S']\"\n          label=\"Dir\"\n          variant=\"outlined\"\n          hide-details\n          :density=\"isTablet ? 'comfortable' : 'default'\"\n          @update:model-value=\"syncDecimal\"\n        />\n      </v-col>\n\n      <!-- Latitude Decimal -->\n      <v-col cols=\"12\" lg=\"4\">\n        <v-text-field\n          v-model.number=\"object_lat\"\n          label=\"Latitude (decimal)\"\n          variant=\"outlined\"\n          hide-details\n          type=\"number\"\n          min=\"-90\"\n          max=\"90\"\n          step=\"0.000001\"\n          :density=\"isTablet ? 'comfortable' : 'default'\"\n          :style=\"isTablet ? 'font-size:1.2rem;width:100%;' : ''\"\n          @input=\"updateFromDecimal('lat')\"\n        >\n          <template #append>\n            <v-icon class=\"cursor-pointer\" @click=\"openHint('latitude')\">\n              mdi-information\n            </v-icon>\n          </template>\n        </v-text-field>\n      </v-col>\n    </v-row>\n\n    <!-- LONGITUDE SECTION -->\n    <v-row>\n      <v-col cols=\"12\"><strong>Longitude</strong></v-col>\n    </v-row>\n    <v-row class=\"mt-4\" align=\"start\">\n      <v-col :cols=\"isTablet ? 3 : 2\">\n        <v-text-field\n          v-model=\"longitude_D\"\n          label=\"\"\n          variant=\"outlined\"\n          hide-details\n          type=\"number\"\n          min=\"0\"\n          max=\"180\"\n          :density=\"isTablet ? 'comfortable' : 'default'\"\n          @input=\"syncDecimal\"\n        />\n      </v-col>\n      <v-col :cols=\"isTablet ? 3 : 2\">\n        <v-text-field\n          v-model=\"longitude_M\"\n          label=\"\"\n          variant=\"outlined\"\n          hide-details\n          type=\"number\"\n          min=\"0\"\n          max=\"59\"\n          :density=\"isTablet ? 'comfortable' : 'default'\"\n          @input=\"syncDecimal\"\n        />\n      </v-col>\n      <v-col :cols=\"isTablet ? 3 : 2\">\n        <v-text-field\n          v-model=\"longitude_S\"\n          label=\"\"\n          variant=\"outlined\"\n          hide-details\n          type=\"number\"\n          min=\"0\"\n          max=\"59\"\n          step=\"0.001\"\n          :density=\"isTablet ? 'comfortable' : 'default'\"\n          @input=\"syncDecimal\"\n        />\n      </v-col>\n      <v-col :cols=\"isTablet ? 3 : 2\">\n        <v-select\n          v-model=\"lonDir\"\n          :items=\"['E','W']\"\n          label=\"Dir\"\n          variant=\"outlined\"\n          hide-details\n          :density=\"isTablet ? 'comfortable' : 'default'\"\n          @update:model-value=\"syncDecimal\"\n        />\n      </v-col>\n\n      <!-- Longitude Decimal -->\n      <v-col cols=\"12\" lg=\"4\">\n        <v-text-field\n          v-model.number=\"object_lon\"\n          label=\"Longitude (decimal)\"\n          variant=\"outlined\"\n          hide-details\n          type=\"number\"\n          min=\"-180\"\n          max=\"180\"\n          step=\"0.000001\"\n          :density=\"isTablet ? 'comfortable' : 'default'\"\n          :style=\"isTablet ? 'font-size:1.2rem;width:100%;' : ''\"\n          @input=\"updateFromDecimal('lon')\"\n        >\n          <template #append>\n            <v-icon class=\"cursor-pointer\" @click=\"openHint('longitude')\">\n              mdi-information\n            </v-icon>\n          </template>\n        </v-text-field>\n      </v-col>\n    </v-row>\n\n    <!-- Canvas Map -->\n    <v-row class=\"mt-6\" style=\"position: relative;\">\n      <v-col cols=\"12\" class=\"text-center\" style=\"position: relative;\">\n        <canvas\n          id=\"mapCanvas\"\n          width=\"800\"\n          height=\"500\"\n          style=\"width:100%;max-width:1200px;border:1px solid #999;border-radius:8px;background:#c5ecff;cursor:grab;\"\n          @wheel.prevent=\"onWheel\"\n        ></canvas>\n\n        <!-- Zoom controls -->\n        <div\n          style=\"position:absolute;bottom:25px;right:18px;display:flex;flex-direction:column;gap:6px;\"\n        >\n          <v-btn icon :size=\"isTablet ? 'large' : 'default'\" @click=\"zoomIn\"><span>+</span></v-btn>\n          <v-btn icon :size=\"isTablet ? 'large' : 'default'\" @click=\"zoomOut\"><span></span></v-btn>\n        </div>\n      </v-col>\n    </v-row>\n\n    <!-- MID-INFO POPUP -->\n    <v-dialog v-model=\"hintDialog\" max-width=\"500\">\n      <v-card>\n        <v-card-title class=\"text-h6\">{{ hintTitle }}</v-card-title>\n        <v-card-text>{{ hintText }}</v-card-text>\n        <v-card-actions>\n          <v-spacer></v-spacer>\n          <v-btn color=\"primary\" text @click=\"hintDialog = false\">Got it</v-btn>\n        </v-card-actions>\n      </v-card>\n    </v-dialog>\n  </v-container>\n</template>\n\n<script>\nexport default {\n  props: [\"msg\"],\n  data() {\n    return {\n      object_date: \"\",\n      object_time: \"\",\n      object_lat: 0,\n      object_lon: 0,\n      latitude_D: \"0\",\n      latitude_M: \"0\",\n      latitude_S: \"0\",\n      latDir: \"N\",\n      longitude_D: \"0\",\n      longitude_M: \"0\",\n      longitude_S: \"0\",\n      lonDir: \"E\",\n      ctx: null,\n      mapImage: null,\n      imageLoaded: false,\n      zoom: 1,\n      offsetX: 0,\n      offsetY: 0,\n      sample_gear: \"\", // ajout\n      hintDialog: false,\n      hintTitle: \"\",\n      hintText: \"\",\n    };\n  },\n  computed: {\n    isTablet() {\n      return this.$vuetify.display.mdAndDown;\n    },\n  },\n  watch: {\n    msg: {\n      handler(newMsg) {\n        const p = newMsg?.payload || {};\n        if (p.sample_gear !== undefined) {\n          this.sample_gear = p.sample_gear;\n\n          //  Si \"Lab culture\" ou \"Demo / Test\", remplir automatiquement date/heure et GPS\n          if ([\"Lab culture\", \"Demo / Test\"].includes(this.sample_gear)) {\n            const now = new Date();\n            this.object_date = now.toISOString().split(\"T\")[0];\n            this.object_time = now.toISOString().split(\"T\")[1].slice(0, 5);\n            this.object_lat = 0;\n            this.object_lon = 0;\n            this.updateFromDecimal(\"lat\");\n            this.updateFromDecimal(\"lon\");\n            this.sendUpdate(\"object_datetime\", {\n              object_lat: 0,\n              object_lon: 0,\n            });\n          }\n        }\n\n        if (p.object_date !== undefined) this.object_date = p.object_date;\n        if (p.object_time !== undefined) {\n          // Conversion \"HHMM\"  \"HH:MM\"\n          const t = p.object_time.toString();\n          if (t.length === 4) this.object_time = `${t.slice(0,2)}:${t.slice(2,4)}`;\n          else this.object_time = t; // fallback si format dj HH:MM\n        }\n\n        if (p.object_lat !== undefined)\n          this.object_lat = parseFloat(p.object_lat.toFixed(6));\n        if (p.object_lon !== undefined)\n          this.object_lon = parseFloat(p.object_lon.toFixed(6));\n        if (p.object_lat !== undefined || p.object_lon !== undefined) {\n          this.updateFromDecimal(\"lat\");\n          this.updateFromDecimal(\"lon\");\n        }\n        this.centerOnMarker();\n      },\n      deep: true,\n    },\n  },\n  mounted() {\n    const canvas = document.getElementById(\"mapCanvas\");\n    this.ctx = canvas.getContext(\"2d\");\n    this.mapImage = new Image();\n    this.mapImage.src = \"/world-map.svg\";\n    this.mapImage.onload = () => {\n      this.imageLoaded = true;\n      this.centerOnMarker();\n    };\n  },\n  methods: {\n    openHint(type) {\n      if (type === \"datetime\") {\n        this.hintTitle = \"Date and Time (UTC)\";\n      this.hintText =\n        \"Enter the observation timestamp in Coordinated Universal Time (UTC). \" +\n        \"Use YYYY-MM-DD for date and HH:MM (24-hour). The saved format will be HHMM (without colon).\";\n\n      } else if (type === \"latitude\") {\n        this.hintTitle = \"Latitude\";\n        this.hintText =\n          \"Latitude defines how far north or south you are from the equator.\";\n      } else if (type === \"longitude\") {\n        this.hintTitle = \"Longitude\";\n        this.hintText =\n          \"Longitude defines how far east or west you are from the Prime Meridian.\";\n      }\n      this.hintDialog = true;\n    },\n    sendUpdate(topic, extra = {}) {\n      // Conversion \"HH:MM\"  \"HHMM\"\n      const formattedTime = this.object_time ? this.object_time.replace(\":\", \"\") : \"\";\n      this.send({\n        topic,\n        payload: {\n          object_date: this.object_date,\n          object_time: formattedTime,\n          ...extra,\n        },\n      });\n    },\n    syncDecimal() {\n      this.object_lon = parseFloat(\n        this.toDecimal(this.longitude_D, this.longitude_M, this.longitude_S, this.lonDir).toFixed(6)\n      );\n      this.object_lat = parseFloat(\n        this.toDecimal(this.latitude_D, this.latitude_M, this.latitude_S, this.latDir).toFixed(6)\n      );\n      this.centerOnMarker();\n      this.sendUpdate(\"object_latlon\", {\n        object_lat: this.object_lat,\n        object_lon: this.object_lon,\n      });\n    },\n    updateFromDecimal(which) {\n      if (which === \"lon\") {\n        this.object_lon = parseFloat(this.object_lon.toFixed(6));\n        const { D, M, S, dir } = this.fromDecimal(this.object_lon, \"lon\");\n        this.longitude_D = D;\n        this.longitude_M = M;\n        this.longitude_S = S;\n        this.lonDir = dir;\n      } else {\n        this.object_lat = parseFloat(this.object_lat.toFixed(6));\n        const { D, M, S, dir } = this.fromDecimal(this.object_lat, \"lat\");\n        this.latitude_D = D;\n        this.latitude_M = M;\n        this.latitude_S = S;\n        this.latDir = dir;\n      }\n      this.centerOnMarker();\n      this.sendUpdate(\"object_latlon\", {\n        object_lat: this.object_lat,\n        object_lon: this.object_lon,\n      });\n    },\n    toDecimal(D, M, S, dir) {\n      const d = parseFloat(D) || 0;\n      const m = parseFloat(M) || 0;\n      const s = parseFloat(S) || 0;\n      let val = d + m / 60 + s / 3600;\n      if (dir === \"S\" || dir === \"W\") val *= -1;\n      return val;\n    },\n    fromDecimal(dec, type) {\n      const dirPositive = type === \"lat\" ? \"N\" : \"E\";\n      const dirNegative = type === \"lat\" ? \"S\" : \"W\";\n      const absVal = Math.abs(dec);\n      const D = Math.floor(absVal);\n      const M = Math.floor((absVal - D) * 60);\n      const S = ((absVal - D - M / 60) * 3600).toFixed(3);\n      const dir = dec >= 0 ? dirPositive : dirNegative;\n      return { D, M, S, dir };\n    },\n    onWheel(e) {\n      if (e.deltaY < 0) this.zoomIn();\n      else this.zoomOut();\n    },\n    zoomIn() {\n      this.zoom = Math.min(this.zoom * 1.25, 10);\n      this.centerOnMarker();\n    },\n    zoomOut() {\n      this.zoom = Math.max(this.zoom / 1.25, 0.5);\n      this.centerOnMarker();\n    },\n    centerOnMarker() {\n      const w = 800;\n      const h = 500;\n      const lat = this.object_lat;\n      const lon = this.object_lon;\n      const x = w / 2 + (lon / 180) * (w / 2);\n      const y = h / 2 - (lat / 90) * (h / 2);\n      this.offsetX = w / 2 - x;\n      this.offsetY = h / 2 - y;\n      this.drawPoint();\n    },\n    drawMap(w, h) {\n      const ctx = this.ctx;\n      ctx.clearRect(0, 0, w, h);\n      ctx.save();\n      ctx.translate(\n        this.offsetX * this.zoom + (w / 2) * (1 - this.zoom),\n        this.offsetY * this.zoom + (h / 2) * (1 - this.zoom)\n      );\n      ctx.scale(this.zoom, this.zoom);\n      if (this.imageLoaded) ctx.drawImage(this.mapImage, 0, 0, w, h);\n      else {\n        ctx.fillStyle = \"#000\";\n        ctx.fillRect(0, 0, w, h);\n      }\n      ctx.restore();\n    },\n    drawPoint() {\n      const w = 800;\n      const h = 500;\n      const ctx = this.ctx;\n      if (!ctx) return;\n      this.drawMap(w, h);\n      const lat = this.object_lat;\n      const lon = this.object_lon;\n      const x = w / 2 + (lon / 180) * (w / 2);\n      const y = h / 2 - (lat / 90) * (h / 2);\n      ctx.save();\n      ctx.translate(\n        this.offsetX * this.zoom + (w / 2) * (1 - this.zoom),\n        this.offsetY * this.zoom + (h / 2) * (1 - this.zoom)\n      );\n      ctx.scale(this.zoom, this.zoom);\n      ctx.fillStyle = \"blue\";\n      ctx.beginPath();\n      ctx.arc(x, y, 6 / this.zoom, 0, 2 * Math.PI);\n      ctx.fill();\n      ctx.fillStyle = \"black\";\n      ctx.font = `${13 / this.zoom}px sans-serif`;\n      ctx.fillText(`${lat.toFixed(4)}, ${lon.toFixed(4)}`, x + 10 / this.zoom, y - 10 / this.zoom);\n      ctx.restore();\n    },\n  },\n};\n</script>\n",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 400,
        "y": 200,
        "wires": [
            [
                "9780c3e7b1792160"
            ]
        ]
    },
    {
        "id": "1c90e219a749e53e",
        "type": "ui-template",
        "z": "190b0c9aa75e8843",
        "group": "1cfe3062a8353012",
        "page": "",
        "ui": "",
        "name": "Ending point",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n  <!-- Le conteneur principal devient dsactiv si sample_gear n'est pas \"Horizontal Net\" -->\n  <v-container\n    :disabled=\"isDisabled\"\n    :style=\"{\n      pointerEvents: isDisabled ? 'none' : 'auto',\n      opacity: isDisabled ? 0.5 : 1,\n    }\"\n  >\n    <!-- Date & Time (End) -->\n    <v-row>\n      <v-col cols=\"12\"><strong>End Date and Time</strong></v-col>\n    </v-row>\n\n    <v-row>\n      <v-col cols=\"12\" md=\"6\">\n        <v-text-field\n          v-model=\"object_date_end\"\n          label=\"Date (UTC)\"\n          variant=\"outlined\"\n          type=\"date\"\n          hide-details=\"auto\"\n          :density=\"isTablet ? 'comfortable' : 'default'\"\n          :style=\"isTablet ? 'font-size:1.2rem;width:100%;' : ''\"\n          @input=\"sendUpdateEnd('object_datetime_end')\"\n        />\n      </v-col>\n\n      <v-col cols=\"12\" md=\"6\">\n        <v-text-field\n          v-model=\"object_time_end\"\n          label=\"Time (UTC)\"\n          variant=\"outlined\"\n          type=\"time\"\n          hide-details=\"auto\"\n          :density=\"isTablet ? 'comfortable' : 'default'\"\n          :style=\"isTablet ? 'font-size:1.2rem;width:100%;' : ''\"\n          @input=\"sendUpdateEnd('object_datetime_end')\"\n        >\n          <template #append>\n            <v-icon class=\"cursor-pointer\" @click=\"openHintEnd('datetime')\">\n              mdi-information\n            </v-icon>\n          </template>\n        </v-text-field>\n      </v-col>\n    </v-row>\n\n    <!-- LATITUDE END SECTION -->\n    <v-row>\n      <v-col cols=\"12\"><strong>Latitude (End)</strong></v-col>\n    </v-row>\n    <v-row class=\"mt-4\" align=\"start\">\n      <v-col :cols=\"isTablet ? 3 : 2\">\n        <v-text-field\n          v-model=\"latitude_D_end\"\n          label=\"\"\n          variant=\"outlined\"\n          hide-details\n          type=\"number\"\n          min=\"0\"\n          max=\"90\"\n          @input=\"syncDecimalEnd\"\n        />\n      </v-col>\n      <v-col :cols=\"isTablet ? 3 : 2\">\n        <v-text-field\n          v-model=\"latitude_M_end\"\n          label=\"\"\n          variant=\"outlined\"\n          hide-details\n          type=\"number\"\n          min=\"0\"\n          max=\"59\"\n          @input=\"syncDecimalEnd\"\n        />\n      </v-col>\n      <v-col :cols=\"isTablet ? 3 : 2\">\n        <v-text-field\n          v-model=\"latitude_S_end\"\n          label=\"\"\n          variant=\"outlined\"\n          hide-details\n          type=\"number\"\n          min=\"0\"\n          max=\"59\"\n          step=\"0.001\"\n          @input=\"syncDecimalEnd\"\n        />\n      </v-col>\n      <v-col :cols=\"isTablet ? 3 : 2\">\n        <v-select\n          v-model=\"latDir_end\"\n          :items=\"['N','S']\"\n          label=\"Dir\"\n          variant=\"outlined\"\n          hide-details\n          @update:model-value=\"syncDecimalEnd\"\n        />\n      </v-col>\n\n      <!-- Latitude Decimal -->\n      <v-col cols=\"12\" lg=\"4\">\n        <v-text-field\n          v-model.number=\"object_lat_end\"\n          label=\"Latitude (decimal)\"\n          variant=\"outlined\"\n          hide-details\n          type=\"number\"\n          min=\"-90\"\n          max=\"90\"\n          step=\"0.000001\"\n          @input=\"updateFromDecimalEnd('lat')\"\n        >\n          <template #append>\n            <v-icon class=\"cursor-pointer\" @click=\"openHintEnd('latitude')\">\n              mdi-information\n            </v-icon>\n          </template>\n        </v-text-field>\n      </v-col>\n    </v-row>\n\n    <!-- LONGITUDE END SECTION -->\n    <v-row>\n      <v-col cols=\"12\"><strong>Longitude (End)</strong></v-col>\n    </v-row>\n    <v-row class=\"mt-4\" align=\"start\">\n      <v-col :cols=\"isTablet ? 3 : 2\">\n        <v-text-field\n          v-model=\"longitude_D_end\"\n          label=\"\"\n          variant=\"outlined\"\n          hide-details\n          type=\"number\"\n          min=\"0\"\n          max=\"180\"\n          @input=\"syncDecimalEnd\"\n        />\n      </v-col>\n      <v-col :cols=\"isTablet ? 3 : 2\">\n        <v-text-field\n          v-model=\"longitude_M_end\"\n          label=\"\"\n          variant=\"outlined\"\n          hide-details\n          type=\"number\"\n          min=\"0\"\n          max=\"59\"\n          @input=\"syncDecimalEnd\"\n        />\n      </v-col>\n      <v-col :cols=\"isTablet ? 3 : 2\">\n        <v-text-field\n          v-model=\"longitude_S_end\"\n          label=\"\"\n          variant=\"outlined\"\n          hide-details\n          type=\"number\"\n          min=\"0\"\n          max=\"59\"\n          step=\"0.001\"\n          @input=\"syncDecimalEnd\"\n        />\n      </v-col>\n      <v-col :cols=\"isTablet ? 3 : 2\">\n        <v-select\n          v-model=\"lonDir_end\"\n          :items=\"['E','W']\"\n          label=\"Dir\"\n          variant=\"outlined\"\n          hide-details\n          @update:model-value=\"syncDecimalEnd\"\n        />\n      </v-col>\n\n      <!-- Longitude Decimal -->\n      <v-col cols=\"12\" lg=\"4\">\n        <v-text-field\n          v-model.number=\"object_lon_end\"\n          label=\"Longitude (decimal)\"\n          variant=\"outlined\"\n          hide-details\n          type=\"number\"\n          min=\"-180\"\n          max=\"180\"\n          step=\"0.000001\"\n          @input=\"updateFromDecimalEnd('lon')\"\n        >\n          <template #append>\n            <v-icon class=\"cursor-pointer\" @click=\"openHintEnd('longitude')\">\n              mdi-information\n            </v-icon>\n          </template>\n        </v-text-field>\n      </v-col>\n    </v-row>\n\n    <!-- Canvas Map (End) -->\n    <v-row class=\"mt-6\" style=\"position: relative;\">\n      <v-col cols=\"12\" class=\"text-center\" style=\"position: relative;\">\n        <canvas\n          id=\"mapCanvas_end\"\n          width=\"800\"\n          height=\"500\"\n          style=\"width:100%;max-width:1200px;border:1px solid #999;border-radius:8px;background:#c5ecff;cursor:grab;\"\n          @wheel.prevent=\"onWheelEnd\"\n        ></canvas>\n\n        <!-- Zoom controls -->\n        <div\n          style=\"position:absolute;bottom:25px;right:18px;display:flex;flex-direction:column;gap:6px;\"\n        >\n          <v-btn icon :size=\"isTablet ? 'large' : 'default'\" @click=\"zoomInEnd\"><span>+</span></v-btn>\n          <v-btn icon :size=\"isTablet ? 'large' : 'default'\" @click=\"zoomOutEnd\"><span></span></v-btn>\n        </div>\n      </v-col>\n    </v-row>\n\n    <!-- MID-INFO POPUP -->\n    <v-dialog v-model=\"hintDialogEnd\" max-width=\"500\">\n      <v-card>\n        <v-card-title class=\"text-h6\">{{ hintTitleEnd }}</v-card-title>\n        <v-card-text>{{ hintTextEnd }}</v-card-text>\n        <v-card-actions>\n          <v-spacer></v-spacer>\n          <v-btn color=\"primary\" text @click=\"hintDialogEnd = false\">Got it</v-btn>\n        </v-card-actions>\n      </v-card>\n    </v-dialog>\n  </v-container>\n</template>\n\n<script>\nexport default {\n  props: [\"msg\"],\n  data() {\n    return {\n      object_date_end: \"\",\n      object_time_end: \"\",\n      object_lat_end: 0,\n      object_lon_end: 0,\n      latitude_D_end: \"0\",\n      latitude_M_end: \"0\",\n      latitude_S_end: \"0\",\n      latDir_end: \"N\",\n      longitude_D_end: \"0\",\n      longitude_M_end: \"0\",\n      longitude_S_end: \"0\",\n      lonDir_end: \"E\",\n      ctx_end: null,\n      mapImage_end: null,\n      imageLoaded_end: false,\n      zoom_end: 1,\n      offsetX_end: 0,\n      offsetY_end: 0,\n      sample_gear: \"\", // <-- ajout ici\n      // Popup fields\n      hintDialogEnd: false,\n      hintTitleEnd: \"\",\n      hintTextEnd: \"\",\n    };\n  },\n  computed: {\n    isTablet() {\n      return this.$vuetify.display.mdAndDown;\n    },\n    isDisabled() {\n      // Dsactive tout le formulaire si sample_gear nest pas \"Horizontal Net\"\n      return this.sample_gear !== \"Horizontal Net\";\n    },\n  },\n  watch: {\n    msg: {\n      handler(newMsg) {\n        const p = newMsg?.payload || {};\n        if (p.sample_gear !== undefined) this.sample_gear = p.sample_gear; // <-- surveille la valeur reue\n        if (p.object_date_end !== undefined) this.object_date_end = p.object_date_end;\n        if (p.object_time_end !== undefined) {\n          // Conversion \"HHMM\"  \"HH:MM\" pour affichage dans le champ <input type=\"time\">\n          const t = p.object_time_end.toString();\n          if (t.length === 4) this.object_time_end = `${t.slice(0, 2)}:${t.slice(2, 4)}`;\n          else this.object_time_end = t; // si dj au format HH:MM\n        }\n\n        if (p.object_lat_end !== undefined)\n          this.object_lat_end = parseFloat(p.object_lat_end.toFixed(6));\n        if (p.object_lon_end !== undefined)\n          this.object_lon_end = parseFloat(p.object_lon_end.toFixed(6));\n        if (p.object_lat_end !== undefined || p.object_lon_end !== undefined) {\n          this.updateFromDecimalEnd(\"lat\");\n          this.updateFromDecimalEnd(\"lon\");\n        }\n        this.centerOnMarkerEnd();\n      },\n      deep: true,\n    },\n  },\n  mounted() {\n    const canvas = document.getElementById(\"mapCanvas_end\");\n    this.ctx_end = canvas.getContext(\"2d\");\n    this.mapImage_end = new Image();\n    this.mapImage_end.src = \"/world-map.svg\";\n    this.mapImage_end.onload = () => {\n      this.imageLoaded_end = true;\n      this.centerOnMarkerEnd();\n    };\n  },\n  methods: {\n    /** Info Popup **/\n    openHintEnd(type) {\n      if (type === \"datetime\") {\n        this.hintTitleEnd = \"End Date and Time (UTC)\";\n        this.hintTextEnd =\n          \"Enter the end time of your observation in Coordinated Universal Time (UTC). \" +\n          \"Use YYYY-MM-DD for date and HH:MM (24-hour) for time.\";\n      } else if (type === \"latitude\") {\n        this.hintTitleEnd = \"End Latitude\";\n        this.hintTextEnd =\n          \"Latitude specifies how far north or south your end location is from the equator. \" +\n          \"Use degrees (), minutes (), and seconds () with N/S direction, or directly enter a decimal between -90 and +90.\";\n      } else if (type === \"longitude\") {\n        this.hintTitleEnd = \"End Longitude\";\n        this.hintTextEnd =\n          \"Longitude specifies how far east or west your end location is from the Prime Meridian. \" +\n          \"You can enter DMS (  ) with E/W direction or a decimal between -180 and +180.\";\n      }\n      this.hintDialogEnd = true;\n    },\n\n    sendUpdateEnd(topic, extra = {}) {\n      // Conversion \"HH:MM\"  \"HHMM\" avant sauvegarde\n      const formattedTimeEnd = this.object_time_end\n        ? this.object_time_end.replace(\":\", \"\")\n        : \"\";      \n      this.send({\n        topic,\n        payload: {\n          object_date_end: this.object_date_end,\n          object_time_end: formattedTimeEnd,\n          ...extra,\n        },\n      });\n    },\n    syncDecimalEnd() {\n      this.object_lon_end = parseFloat(\n        this.toDecimal(this.longitude_D_end, this.longitude_M_end, this.longitude_S_end, this.lonDir_end).toFixed(6)\n      );\n      this.object_lat_end = parseFloat(\n        this.toDecimal(this.latitude_D_end, this.latitude_M_end, this.latitude_S_end, this.latDir_end).toFixed(6)\n      );\n      this.centerOnMarkerEnd();\n      this.sendUpdateEnd(\"object_latlon_end\", {\n        object_lat_end: this.object_lat_end,\n        object_lon_end: this.object_lon_end,\n      });\n    },\n    updateFromDecimalEnd(which) {\n      if (which === \"lon\") {\n        this.object_lon_end = parseFloat(this.object_lon_end.toFixed(6));\n        const { D, M, S, dir } = this.fromDecimal(this.object_lon_end, \"lon\");\n        this.longitude_D_end = D;\n        this.longitude_M_end = M;\n        this.longitude_S_end = S;\n        this.lonDir_end = dir;\n      } else {\n        this.object_lat_end = parseFloat(this.object_lat_end.toFixed(6));\n        const { D, M, S, dir } = this.fromDecimal(this.object_lat_end, \"lat\");\n        this.latitude_D_end = D;\n        this.latitude_M_end = M;\n        this.latitude_S_end = S;\n        this.latDir_end = dir;\n      }\n      this.centerOnMarkerEnd();\n      this.sendUpdateEnd(\"object_latlon_end\", {\n        object_lat_end: this.object_lat_end,\n        object_lon_end: this.object_lon_end,\n      });\n    },\n    toDecimal(D, M, S, dir) {\n      const d = parseFloat(D) || 0;\n      const m = parseFloat(M) || 0;\n      const s = parseFloat(S) || 0;\n      let val = d + m / 60 + s / 3600;\n      if (dir === \"S\" || dir === \"W\") val *= -1;\n      return val;\n    },\n    fromDecimal(dec, type) {\n      const dirPositive = type === \"lat\" ? \"N\" : \"E\";\n      const dirNegative = type === \"lat\" ? \"S\" : \"W\";\n      const absVal = Math.abs(dec);\n      const D = Math.floor(absVal);\n      const M = Math.floor((absVal - D) * 60);\n      const S = ((absVal - D - M / 60) * 3600).toFixed(3);\n      const dir = dec >= 0 ? dirPositive : dirNegative;\n      return { D, M, S, dir };\n    },\n    onWheelEnd(e) {\n      if (e.deltaY < 0) this.zoomInEnd();\n      else this.zoomOutEnd();\n    },\n    zoomInEnd() {\n      this.zoom_end = Math.min(this.zoom_end * 1.25, 10);\n      this.centerOnMarkerEnd();\n    },\n    zoomOutEnd() {\n      this.zoom_end = Math.max(this.zoom_end / 1.25, 0.5);\n      this.centerOnMarkerEnd();\n    },\n    centerOnMarkerEnd() {\n      const w = 800;\n      const h = 500;\n      const lat = this.object_lat_end;\n      const lon = this.object_lon_end;\n      const x = w / 2 + (lon / 180) * (w / 2);\n      const y = h / 2 - (lat / 90) * (h / 2);\n      this.offsetX_end = w / 2 - x;\n      this.offsetY_end = h / 2 - y;\n      this.drawPointEnd();\n    },\n    drawMapEnd(w, h) {\n      const ctx = this.ctx_end;\n      ctx.clearRect(0, 0, w, h);\n      ctx.save();\n      ctx.translate(\n        this.offsetX_end * this.zoom_end + (w / 2) * (1 - this.zoom_end),\n        this.offsetY_end * this.zoom_end + (h / 2) * (1 - this.zoom_end)\n      );\n      ctx.scale(this.zoom_end, this.zoom_end);\n      if (this.imageLoaded_end) ctx.drawImage(this.mapImage_end, 0, 0, w, h);\n      else {\n        ctx.fillStyle = \"#000\";\n        ctx.fillRect(0, 0, w, h);\n      }\n      ctx.restore();\n    },\n    drawPointEnd() {\n      const w = 800;\n      const h = 500;\n      const ctx = this.ctx_end;\n      if (!ctx) return;\n      this.drawMapEnd(w, h);\n      const lat = this.object_lat_end;\n      const lon = this.object_lon_end;\n      const x = w / 2 + (lon / 180) * (w / 2);\n      const y = h / 2 - (lat / 90) * (h / 2);\n      ctx.save();\n      ctx.translate(\n        this.offsetX_end * this.zoom_end + (w / 2) * (1 - this.zoom_end),\n        this.offsetY_end * this.zoom_end + (h / 2) * (1 - this.zoom_end)\n      );\n      ctx.scale(this.zoom_end, this.zoom_end);\n      ctx.fillStyle = \"red\";\n      ctx.beginPath();\n      ctx.arc(x, y, 6 / this.zoom_end, 0, 2 * Math.PI);\n      ctx.fill();\n      ctx.fillStyle = \"black\";\n      ctx.font = `${13 / this.zoom_end}px sans-serif`;\n      ctx.fillText(`${lat.toFixed(4)}, ${lon.toFixed(4)}`, x + 10 / this.zoom_end, y - 10 / this.zoom_end);\n      ctx.restore();\n    },\n  },\n};\n</script>\n\n<style scoped>\n@media (max-width: 1024px) {\n  .v-text-field input,\n  .v-select input {\n    font-size: 1.2rem !important;\n  }\n}\n</style>\n",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 390,
        "y": 300,
        "wires": [
            [
                "1d06a5e5a5877d24"
            ]
        ]
    },
    {
        "id": "09b551fa202d8029",
        "type": "ui-template",
        "z": "190b0c9aa75e8843",
        "group": "cb3521392eb4e9ed",
        "page": "",
        "ui": "",
        "name": "Net Specificity",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n  <!-- Conteneur principal dsactiv si sample_gear n'est ni Horizontal Net ni Vertical Net -->\n    <v-container\n      fluid\n      :disabled=\"isDisabled\"\n      :style=\"{\n        pointerEvents: isDisabled ? 'none' : 'auto',\n        opacity: isDisabled ? 0.5 : 1,\n        width: '100%',\n      }\"\n    >\n\n    <v-row class=\"mt-2\">\n      <!-- Net Mouth Diameter -->\n      <v-col cols=\"12\" md=\"3\">\n        <v-text-field\n          label=\"Mouth Opening Diameter\"\n          v-model.number=\"sample_net_mouth_diameter\"\n          :min=\"0\"\n          :max=\"1000\"\n          :step=\"1\"\n          suffix=\"cm\"\n          type=\"number\"\n          variant=\"outlined\"\n          hide-details=\"auto\"\n          :density=\"isTablet ? 'comfortable' : 'default'\"\n          @input=\"sendUpdate('sample_net_params')\"\n        >\n          <template #append>\n            <v-icon class=\"cursor-pointer\" @click=\"openHint('mouth_diameter')\">\n              mdi-information\n            </v-icon>\n          </template>\n        </v-text-field>\n      </v-col>\n\n      <!-- Net Length -->\n      <v-col cols=\"12\" md=\"3\">\n        <v-text-field\n          label=\"Length of the Net\"\n          v-model.number=\"sample_net_length\"\n          :min=\"0\"\n          :max=\"1000\"\n          :step=\"1\"\n          suffix=\"cm\"\n          type=\"number\"\n          variant=\"outlined\"\n          hide-details=\"auto\"\n          :density=\"isTablet ? 'comfortable' : 'default'\"\n          @input=\"sendUpdate('sample_net_params')\"\n        >\n          <template #append>\n            <v-icon class=\"cursor-pointer\" @click=\"openHint('net_length')\">\n              mdi-information\n            </v-icon>\n          </template>\n        </v-text-field>\n      </v-col>\n\n      <!-- Mesh Size -->\n      <v-col cols=\"12\" md=\"3\">\n        <v-text-field\n          label=\"Net Mesh Size\"\n          v-model.number=\"sample_net_mesh_size\"\n          :min=\"0\"\n          :max=\"1000\"\n          :step=\"1\"\n          suffix=\"m\"\n          type=\"number\"\n          variant=\"outlined\"\n          hide-details=\"auto\"\n          :density=\"isTablet ? 'comfortable' : 'default'\"\n          @input=\"sendUpdate('sample_net_params')\"\n        >\n          <template #append>\n            <v-icon class=\"cursor-pointer\" @click=\"openHint('mesh_size')\">\n              mdi-information\n            </v-icon>\n          </template>\n        </v-text-field>\n      </v-col>\n\n      <!-- Collector Volume -->\n      <v-col cols=\"12\" md=\"3\">\n        <v-text-field\n          label=\"Volume of the Collector\"\n          v-model.number=\"sample_collected_volume\"\n          :min=\"0\"\n          :max=\"1000\"\n          :step=\"1\"\n          suffix=\"mL\"\n          type=\"number\"\n          variant=\"outlined\"\n          hide-details=\"auto\"\n          :density=\"isTablet ? 'comfortable' : 'default'\"\n          @input=\"sendUpdate('sample_net_params')\"\n        >\n          <template #append>\n            <v-icon class=\"cursor-pointer\" @click=\"openHint('collector_volume')\">\n              mdi-information\n            </v-icon>\n          </template>\n        </v-text-field>\n      </v-col>\n    </v-row>\n\n    <!-- MID-INFO POPUP -->\n    <v-dialog v-model=\"hintDialog\" max-width=\"500\">\n      <v-card>\n        <v-card-title class=\"text-h6\">{{ hintTitle }}</v-card-title>\n        <v-card-text>{{ hintText }}</v-card-text>\n        <v-card-actions>\n          <v-spacer></v-spacer>\n          <v-btn color=\"primary\" text @click=\"hintDialog = false\">Got it</v-btn>\n        </v-card-actions>\n      </v-card>\n    </v-dialog>\n  </v-container>\n</template>\n\n<script>\nexport default {\n  props: [\"msg\"],\n  data() {\n    return {\n      sample_net_mouth_diameter: \"\",\n      sample_net_length: \"\",\n      sample_net_mesh_size: \"\",\n      sample_collected_volume: \"\",\n      sample_gear: \"\",\n      hintDialog: false,\n      hintTitle: \"\",\n      hintText: \"\",\n    };\n  },\n  computed: {\n    isTablet() {\n      return this.$vuetify.display.mdAndDown;\n    },\n    isDisabled() {\n      // Dsactiver si sample_gear n'est pas \"Horizontal Net\" ou \"Vertical Net\"\n      return ![\"Horizontal Net\", \"Vertical Net\"].includes(this.sample_gear);\n    },\n  },\n  watch: {\n    msg: {\n      handler(newMsg) {\n        const p = newMsg?.payload || {};\n        if (p.sample_gear !== undefined) this.sample_gear = p.sample_gear; // <-- rcupre la valeur reue\n        if (p.sample_net_mouth_diameter !== undefined)\n          this.sample_net_mouth_diameter = Number(p.sample_net_mouth_diameter);\n        if (p.sample_net_length !== undefined)\n          this.sample_net_length = Number(p.sample_net_length);\n        if (p.sample_net_mesh_size !== undefined)\n          this.sample_net_mesh_size = Number(p.sample_net_mesh_size);\n        if (p.sample_collected_volume !== undefined)\n          this.sample_collected_volume = Number(p.sample_collected_volume);\n      },\n      deep: true,\n    },\n  },\n  methods: {\n    /**\n     * Send updates (ensures all values are numbers)\n     */\n    sendUpdate(topic, extra = {}) {\n      this.send({\n        topic,\n        payload: {\n          sample_net_mouth_diameter: Number(this.sample_net_mouth_diameter) || 0,\n          sample_net_length: Number(this.sample_net_length) || 0,\n          sample_net_mesh_size: Number(this.sample_net_mesh_size) || 0,\n          sample_collected_volume: Number(this.sample_collected_volume) || 0,\n          ...extra,\n        },\n      });\n    },\n\n    /**\n     * Info popup  consistent with previous templates\n     */\n    openHint(type) {\n      if (type === \"mouth_diameter\") {\n        this.hintTitle = \"Mouth Opening Diameter\";\n        this.hintText =\n          \"Enter the diameter of the nets mouth  the circular opening where water enters the net  measured in centimeters (cm). \" +\n          \"Typical plankton nets range from 2060 cm in diameter. Larger diameters capture more water volume.\";\n      } else if (type === \"net_length\") {\n        this.hintTitle = \"Length of the Net\";\n        this.hintText =\n          \"Specify the total length of the net from the mouth opening to the collector. \" +\n          \"Measure in centimeters (cm). This helps calculate the water volume filtered and affects flow resistance.\";\n      } else if (type === \"mesh_size\") {\n        this.hintTitle = \"Net Mesh Size\";\n        this.hintText =\n          \"Enter the mesh size of the net in micrometers (m). \" +\n          \"This defines the smallest particles or plankton that can pass through. For example, a 20 m mesh captures microplankton but not bacteria.\";\n      } else if (type === \"collector_volume\") {\n        this.hintTitle = \"Volume of the Collector\";\n        this.hintText =\n          \"Specify the amount of sample collected after towing or pumping, measured in milliliters (mL). \" +\n          \"It should correspond to the water filtered and ensures proper concentration calculations.\";\n      }\n      this.hintDialog = true;\n    },\n  },\n};\n</script>\n\n<style scoped>\n@media (max-width: 1024px) {\n  .v-text-field input,\n  .v-select input {\n    font-size: 1.2rem !important;\n  }\n}\n</style>\n",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 400,
        "y": 400,
        "wires": [
            [
                "2ef0ae85c43d66d6"
            ]
        ]
    },
    {
        "id": "93a68ffbce74d70d",
        "type": "ui-template",
        "z": "190b0c9aa75e8843",
        "group": "dd4d9707051041c9",
        "page": "",
        "ui": "",
        "name": "Other Informations",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n  <v-container fluid>\n    <v-row class=\"mt-2\">\n      <!-- Filtered Volume -->\n      <v-col cols=\"12\" md=\"3\">\n        <v-text-field\n          label=\"Filtered Volume\"\n          v-model.number=\"sample_filtered_volume\"\n          :min=\"0\"\n          :max=\"100000\"\n          :step=\"1\"\n          suffix=\"L\"\n          type=\"number\"\n          variant=\"outlined\"\n          hide-details=\"auto\"\n          :disabled=\"isDisabled\"\n          :density=\"isTablet ? 'comfortable' : 'default'\"\n          @input=\"sendUpdate('sample_water_params')\"\n        >\n          <template #append>\n            <v-icon class=\"cursor-pointer\" @click=\"openHint('filtered_volume')\">\n              mdi-information\n            </v-icon>\n          </template>\n        </v-text-field>\n      </v-col>\n\n      <!-- Concentration Factor -->\n      <v-col cols=\"12\" md=\"3\">\n        <v-text-field\n          label=\"Concentration Factor\"\n          v-model.number=\"sample_concentration_factor\"\n          :min=\"0\"\n          :max=\"100\"\n          :step=\"0.01\"\n          suffix=\"\"\n          type=\"number\"\n          variant=\"outlined\"\n          hide-details=\"auto\"\n          :disabled=\"isDisabled\"\n          :density=\"isTablet ? 'comfortable' : 'default'\"\n          @input=\"sendUpdate('sample_water_params')\"\n        >\n          <template #append>\n            <v-icon class=\"cursor-pointer\" @click=\"openHint('concentration_factor')\">\n              mdi-information\n            </v-icon>\n          </template>\n        </v-text-field>\n      </v-col>\n\n      <!-- Sieve Mesh Size -->\n      <v-col cols=\"12\" md=\"3\">\n        <v-text-field\n          label=\"Sieve Mesh Size\"\n          v-model.number=\"sample_sieve_mesh_size\"\n          :min=\"1\"\n          :max=\"1000\"\n          :step=\"10\"\n          suffix=\"m\"\n          type=\"number\"\n          variant=\"outlined\"\n          hide-details=\"auto\"\n          :disabled=\"isDisabled\"\n          :density=\"isTablet ? 'comfortable' : 'default'\"\n          @input=\"sendUpdate('sample_water_params')\"\n        >\n          <template #append>\n            <v-icon class=\"cursor-pointer\" @click=\"openHint('sieve_mesh_size')\">\n              mdi-information\n            </v-icon>\n          </template>\n        </v-text-field>\n      </v-col>\n\n      <!-- Sample Depth -->\n      <v-col cols=\"12\" md=\"3\">\n        <v-text-field\n          label=\"Depth of the Sample\"\n          v-model.number=\"sample_depth\"\n          :min=\"0\"\n          :max=\"10935\"\n          :step=\"1\"\n          suffix=\"m\"\n          type=\"number\"\n          variant=\"outlined\"\n          hide-details=\"auto\"\n          :disabled=\"isDisabled\"\n          :density=\"isTablet ? 'comfortable' : 'default'\"\n          @input=\"sendUpdate('sample_water_params')\"\n        >\n          <template #append>\n            <v-icon class=\"cursor-pointer\" @click=\"openHint('sample_depth')\">\n              mdi-information\n            </v-icon>\n          </template>\n        </v-text-field>\n      </v-col>\n    </v-row>\n\n    <!-- Sample Comment (Toujours actif) -->\n    <v-row>\n      <v-col cols=\"12\">\n        <v-textarea\n          label=\"Sample Comment\"\n          v-model=\"sample_comment\"\n          variant=\"outlined\"\n          rows=\"2\"\n          :density=\"isTablet ? 'comfortable' : 'default'\"\n          @input=\"sendUpdate('sample_water_params')\"\n        >\n          <template #append>\n            <v-icon class=\"cursor-pointer\" @click=\"openHint('sample_comment')\">\n              mdi-information\n            </v-icon>\n          </template>\n        </v-textarea>\n      </v-col>\n    </v-row>\n\n    <!-- MID-INFO POPUP -->\n    <v-dialog v-model=\"hintDialog\" max-width=\"500\">\n      <v-card>\n        <v-card-title class=\"text-h6\">{{ hintTitle }}</v-card-title>\n        <v-card-text>{{ hintText }}</v-card-text>\n        <v-card-actions>\n          <v-spacer></v-spacer>\n          <v-btn color=\"primary\" text @click=\"hintDialog = false\">Got it</v-btn>\n        </v-card-actions>\n      </v-card>\n    </v-dialog>\n  </v-container>\n</template>\n\n<script>\nexport default {\n  props: [\"msg\"],\n  data() {\n    return {\n      sample_filtered_volume: \"\",\n      sample_concentration_factor: \"\",\n      sample_sieve_mesh_size: \"\",\n      sample_depth: \"\",\n      sample_comment: \"\",\n      sample_gear: \"\", // <-- ajout\n      hintDialog: false,\n      hintTitle: \"\",\n      hintText: \"\",\n    };\n  },\n  computed: {\n    isTablet() {\n      return this.$vuetify.display.mdAndDown;\n    },\n    //  Disable fields if Lab culture or Demo / Test\n    isDisabled() {\n      return [\"Lab culture\", \"Demo / Test\"].includes(this.sample_gear);\n    },\n  },\n  watch: {\n    msg: {\n      handler(newMsg) {\n        const p = newMsg?.payload || {};\n        if (p.sample_gear !== undefined) this.sample_gear = p.sample_gear;\n        if (p.sample_filtered_volume !== undefined)\n          this.sample_filtered_volume = Number(p.sample_filtered_volume);\n        if (p.sample_concentration_factor !== undefined)\n          this.sample_concentration_factor = Number(p.sample_concentration_factor);\n        if (p.sample_sieve_mesh_size !== undefined)\n          this.sample_sieve_mesh_size = Number(p.sample_sieve_mesh_size);\n        if (p.sample_depth !== undefined)\n          this.sample_depth = Number(p.sample_depth);\n        if (p.sample_comment !== undefined)\n          this.sample_comment = String(p.sample_comment);\n      },\n      deep: true,\n    },\n  },\n  methods: {\n    sendUpdate(topic, extra = {}) {\n      this.send({\n        topic,\n        payload: {\n          sample_filtered_volume: Number(this.sample_filtered_volume) || 0,\n          sample_concentration_factor: Number(this.sample_concentration_factor) || 0,\n          sample_sieve_mesh_size: Number(this.sample_sieve_mesh_size) || 0,\n          sample_depth: Number(this.sample_depth) || 0,\n          sample_comment: this.sample_comment || \"\",\n          ...extra,\n        },\n      });\n    },\n\n    openHint(type) {\n      if (type === \"filtered_volume\") {\n        this.hintTitle = \"Filtered Volume\";\n        this.hintText =\n          \"Enter the total volume of water that passed through the net or filter during sampling, measured in liters (L).\";\n      } else if (type === \"concentration_factor\") {\n        this.hintTitle = \"Concentration Factor\";\n        this.hintText =\n          \"Specify the ratio by which the filtered water volume was concentrated into the final collected sample.\";\n      } else if (type === \"sieve_mesh_size\") {\n        this.hintTitle = \"Sieve Mesh Size\";\n        this.hintText =\n          \"Indicate the mesh size of the sieve used to separate particles or organisms, in micrometers (m).\";\n      } else if (type === \"sample_depth\") {\n        this.hintTitle = \"Depth of the Sample\";\n        this.hintText =\n          \"Specify the depth (in meters) at which the sample was collected.\";\n      } else if (type === \"sample_comment\") {\n        this.hintTitle = \"Sample Comment\";\n        this.hintText =\n          \"Add any notes or context about the sample (e.g., weather, color, debris, issues).\";\n      }\n      this.hintDialog = true;\n    },\n  },\n};\n</script>\n\n<style scoped>\n@media (max-width: 1024px) {\n  .v-text-field input,\n  .v-textarea textarea {\n    font-size: 1.2rem !important;\n  }\n}\n</style>\n",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 410,
        "y": 460,
        "wires": [
            [
                "d216b35a8b521fe5"
            ]
        ]
    },
    {
        "id": "8e3eed5be42ad41f",
        "type": "ui-template",
        "z": "190b0c9aa75e8843",
        "group": "59ce6abfbb7f8683",
        "page": "",
        "ui": "",
        "name": "Navigation Bottom",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n  <v-container fluid class=\"ma-0 pa-0\">\n    <v-row \n      align=\"center\" \n      class=\"px-2 py-0\" \n      no-gutters\n    >\n      \n      <v-col cols=\"3\" class=\"py-0 d-flex justify-start\">\n        <v-btn\n          to=\"preview\"\n          color=\"primary\"\n          rounded=\"lg\"\n          class=\"px-4\" variant=\"text\" size=\"large\"\n        >\n          <v-icon start>mdi-chevron-left</v-icon>\n          Preview\n        </v-btn>\n      </v-col>\n\n      <v-col cols=\"6\" class=\"text-center py-0\">\n\n      </v-col>\n\n      <v-col cols=\"3\" class=\"py-0 d-flex justify-end\">\n        <v-btn\n          to=\"acquisition\"\n          color=\"primary\"\n          rounded=\"lg\"\n          class=\"px-4\" variant=\"text\" size=\"large\"\n        >\n          Acquisition\n          <v-icon end>mdi-chevron-right</v-icon>\n        </v-btn>\n      </v-col>\n      \n    </v-row>\n  </v-container>\n</template>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 1290,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "a6bc59e4c830d424",
        "type": "function",
        "z": "190b0c9aa75e8843",
        "name": "Get Global Variables",
        "func": "const keys = global.keys(); // Get all global variable keys\nmsg.payload = {}; // Initialize the payload object\n\nkeys.forEach(key => {\n    // Ignore keys that start with \"$\"\n    if (!key.startsWith('$')) {\n        msg.payload[key] = global.get(key);\n    }\n});\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 120,
        "y": 140,
        "wires": [
            [
                "279f3ddada9cadaa",
                "96550b272e3da513",
                "1c90e219a749e53e",
                "09b551fa202d8029",
                "93a68ffbce74d70d"
            ]
        ]
    },
    {
        "id": "0931106adf64b43d",
        "type": "ui-event",
        "z": "190b0c9aa75e8843",
        "ui": "e6ae26617c24c3ea",
        "name": "UI Event",
        "x": 80,
        "y": 40,
        "wires": [
            [
                "a68e52177173f690"
            ]
        ]
    },
    {
        "id": "a68e52177173f690",
        "type": "switch",
        "z": "190b0c9aa75e8843",
        "name": "msg.topic === \"$pageview\"",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "$pageview",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 280,
        "y": 40,
        "wires": [
            [
                "b1a74fe5569d418a"
            ]
        ]
    },
    {
        "id": "b1a74fe5569d418a",
        "type": "switch",
        "z": "190b0c9aa75e8843",
        "name": "msg.payload.page.path === \"/metadata\"",
        "property": "payload.page.path",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "/metadata",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 580,
        "y": 40,
        "wires": [
            [
                "a6bc59e4c830d424"
            ]
        ]
    },
    {
        "id": "9780c3e7b1792160",
        "type": "switch",
        "z": "190b0c9aa75e8843",
        "name": "",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "object_datetime",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "object_latlon",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 570,
        "y": 200,
        "wires": [
            [
                "ae90b33dfda74614"
            ],
            [
                "875b74e16870159d"
            ]
        ]
    },
    {
        "id": "875b74e16870159d",
        "type": "function",
        "z": "190b0c9aa75e8843",
        "name": "set object_latlon",
        "func": "if (msg.topic) {\n    global.set(\"object_lat\", msg.payload.object_lat);\n    global.set(\"object_lon\", msg.payload.object_lon);\n}\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 760,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "ae90b33dfda74614",
        "type": "function",
        "z": "190b0c9aa75e8843",
        "name": "set object_datetime",
        "func": "if (msg.topic) {\n    global.set(\"object_date\", msg.payload.object_date);\n    global.set(\"object_time\", msg.payload.object_time);\n}\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "1d06a5e5a5877d24",
        "type": "switch",
        "z": "190b0c9aa75e8843",
        "name": "",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "object_datetime_end",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "object_latlon_end",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 570,
        "y": 300,
        "wires": [
            [
                "42d27ae01c6fd201"
            ],
            [
                "23f3059257ce93f6"
            ]
        ]
    },
    {
        "id": "23f3059257ce93f6",
        "type": "function",
        "z": "190b0c9aa75e8843",
        "name": "set object_latlon_end",
        "func": "if (msg.topic) {\n    global.set(\"object_lat_end\", msg.payload.object_lat_end);\n    global.set(\"object_lon_end\", msg.payload.object_lon_end);\n}\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 780,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "42d27ae01c6fd201",
        "type": "function",
        "z": "190b0c9aa75e8843",
        "name": "set object_datetime_end",
        "func": "if (msg.topic) {\n    global.set(\"object_date_end\", msg.payload.object_date_end);\n    global.set(\"object_time_end\", msg.payload.object_time_end);\n}\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 790,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "2ef0ae85c43d66d6",
        "type": "switch",
        "z": "190b0c9aa75e8843",
        "name": "",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "sample_net_params",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 570,
        "y": 400,
        "wires": [
            [
                "e32fbe7bc4987b3c"
            ]
        ]
    },
    {
        "id": "e32fbe7bc4987b3c",
        "type": "function",
        "z": "190b0c9aa75e8843",
        "name": "set sample_net_params",
        "func": "if (msg.topic) {\n    global.set(\"sample_net_mouth_diameter\", msg.payload.sample_net_mouth_diameter);\n    global.set(\"sample_net_length\", msg.payload.sample_net_length);\n    global.set(\"sample_net_mesh_size\", msg.payload.sample_net_mesh_size);\n    global.set(\"sample_collected_volume\", msg.payload.sample_collected_volume);\n}\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 790,
        "y": 400,
        "wires": [
            []
        ]
    },
    {
        "id": "d216b35a8b521fe5",
        "type": "switch",
        "z": "190b0c9aa75e8843",
        "name": "",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "sample_water_params",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 570,
        "y": 460,
        "wires": [
            [
                "419e682def601ef5"
            ]
        ]
    },
    {
        "id": "419e682def601ef5",
        "type": "function",
        "z": "190b0c9aa75e8843",
        "name": "set sample_water_params",
        "func": "if (msg.topic) {\n    global.set(\"sample_filtered_volume\", msg.payload.sample_filtered_volume);\n    global.set(\"sample_concentration_factor\", msg.payload.sample_concentration_factor);\n    global.set(\"sample_sieve_mesh_size\", msg.payload.sample_sieve_mesh_size);\n    global.set(\"sample_depth\", msg.payload.sample_depth);\n    global.set(\"sample_comment\", msg.payload.sample_comment);\n}\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "13f96cf49ae6d6a6",
        "type": "switch",
        "z": "190b0c9aa75e8843",
        "name": "",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "sample_project_meta",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 570,
        "y": 140,
        "wires": [
            [
                "da13300e5bcb0c26",
                "1c90e219a749e53e",
                "09b551fa202d8029",
                "96550b272e3da513",
                "93a68ffbce74d70d"
            ]
        ]
    },
    {
        "id": "da13300e5bcb0c26",
        "type": "function",
        "z": "190b0c9aa75e8843",
        "name": "set sample_project_meta",
        "func": "if (msg.topic) {\n    global.set(\"sample_project\", msg.payload.sample_project);\n    global.set(\"sample_operator\", msg.payload.sample_operator);\n    global.set(\"sample_id\", msg.payload.sample_id);\n    global.set(\"sample_gear\", msg.payload.sample_gear);\n}\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 790,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "ffe728d961068c62",
        "type": "ui-template",
        "z": "35d7387466dd0bc0",
        "group": "b274327af3807b79",
        "page": "",
        "ui": "",
        "name": "Streaming",
        "order": 1,
        "width": "0",
        "height": "0",
        "head": "",
        "format": "<template>\n    <v-container fluid class=\"pa-0\">\n                \n\n                    <div class=\"iframe-container border\">\n                        <!-- \n                            Replace '/preview/node-red' with your actual target URL. \n                            Ensure the target URL allows iframe embedding (X-Frame-Options).\n                        -->\n                        <iframe src=\"/preview/node-red\" title=\"Node-RED Preview\"></iframe>\n                    </div>\n                    \n    </v-container>\n</template>\n\n<style>\n    /* Scoped styles for the iframe container \n      Force a 4:3 aspect ratio\n    */\n    .iframe-container {\n        position: relative;\n        width: 100%;\n        padding-top: 75%; /* 4:3 Aspect Ratio */\n        overflow: hidden;\n        border-radius: 8px;\n    }\n\n    .iframe-container iframe {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        border: none;\n        margin: 0;\n    }\n</style>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 1310,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "aa6924c7e0aff26c",
        "type": "ui-template",
        "z": "35d7387466dd0bc0",
        "group": "d2f77573ed4317e4",
        "page": "",
        "ui": "",
        "name": "body",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n  <v-container fluid>\n    <v-row>\n      <v-col cols=\"12\">\n        <v-text-field v-model.number=\"acq_id\" type=\"number\" label=\"Acquisition ID\" variant=\"outlined\"\n          placeholder=\"ex : 001\" @input=\"sendUpdate()\" prefix=\"A_\" density=\"compact\">\n          <template #append>\n            <v-icon class=\"cursor-pointer\"\n              @click=\"openHint('Acquisition ID','Unique identifier for each acquisition run.')\">\n              mdi-information\n            </v-icon>\n          </template>\n        </v-text-field>\n      </v-col>\n    </v-row>\n\n    <v-row>\n      <v-col cols=\"12\" sm=\"8\">\n        <v-slider v-model.number=\"acq_nb_frame\" :max=\"10000\" :min=\"1\" :step=\"1\" label=\"Number of Images\" hide-details\n          @update:model-value=\"autoCalculateVolumes\" />\n      </v-col>\n      <v-col cols=\"12\" sm=\"4\">\n        <v-text-field v-model.number=\"acq_nb_frame\" type=\"number\" variant=\"outlined\" hide-details suffix=\"img\"\n          class=\"aligned-input\" @input=\"autoCalculateVolumes\">\n          <template #append>\n            <v-icon class=\"cursor-pointer\"\n              @click=\"openHint('Number of Images','Total number of images captured during acquisition.')\">\n              mdi-information\n            </v-icon>\n          </template>\n        </v-text-field>\n      </v-col>\n    </v-row>\n\n    <v-row>\n      <v-col cols=\"12\" sm=\"8\">\n        <v-slider :model-value=\"acq_interframe_volume * 1000\"\n          @update:model-value=\"v => { acq_interframe_volume = v / 1000; autoCalculateVolumes(); }\" :max=\"100\" :min=\"0\"\n          :step=\"1\" label=\"Volume between images\" hide-details />\n      </v-col>\n      <v-col cols=\"12\" sm=\"4\">\n        <v-text-field :model-value=\"acq_interframe_volume * 1000\"\n          @update:model-value=\"v => { acq_interframe_volume = v / 1000; autoCalculateVolumes(); }\" type=\"number\"\n          variant=\"outlined\" hide-details suffix=\"L\" class=\"aligned-input\" @input=\"autoCalculateVolumes\">\n          <template #append>\n            <v-icon class=\"cursor-pointer\"\n              @click=\"openHint('Volume between images','Sample volume displaced between consecutive images (L).')\">\n              mdi-information\n            </v-icon>\n          </template>\n        </v-text-field>\n      </v-col>\n    </v-row>\n\n    <v-row class=\"aligned-row\">\n      <v-col cols=\"12\" sm=\"8\" class=\"d-flex align-center\">\n        <span class=\"text-subtitle-1 text-medium-emphasis ma-2\">Volume Imaged :</span>\n      </v-col>\n      <v-col cols=\"12\" sm=\"4\" class=\"d-flex align-center\">\n        <v-text-field :model-value=\"fmt(acq_imaged_volume)\" suffix=\"mL\" variant=\"flat\" hide-details readonly\n          class=\"aligned-input\">\n          <template #append>\n            <v-icon class=\"cursor-pointer\" @click=\"showVolumeImagedHint()\">\n              mdi-information\n            </v-icon>\n          </template>\n        </v-text-field>\n      </v-col>\n    </v-row>\n\n    <v-row class=\"aligned-row\">\n      <v-col cols=\"12\" sm=\"8\" class=\"d-flex align-center\">\n        <span class=\"text-subtitle-1 text-medium-emphasis ma-2\">Total Volume Displaced :</span>\n      </v-col>\n      <v-col cols=\"12\" sm=\"4\" class=\"d-flex align-center\">\n        <v-text-field :model-value=\"fmt(acq_pumped_volume)\" suffix=\"mL\" variant=\"flat\" hide-details readonly\n          class=\"aligned-input\">\n          <template #append>\n            <v-icon class=\"cursor-pointer\" @click=\"showVolumeDisplacedHint()\">\n              mdi-information\n            </v-icon>\n          </template>\n        </v-text-field>\n      </v-col>\n    </v-row>\n\n    <v-row>\n      <v-col cols=\"12\">\n        <v-textarea v-model=\"acq_comment\" label=\"Acquisition Comment\" variant=\"outlined\" rows=\"2\" @input=\"sendUpdate()\">\n          <template #append>\n            <v-icon class=\"cursor-pointer\"\n              @click=\"openHint('Acquisition Comment','Notes or remarks about this acquisition.')\">\n              mdi-information\n            </v-icon>\n          </template>\n        </v-textarea>\n      </v-col>\n    </v-row>\n\n    <v-row>\n      <v-col cols=\"12\">\n        <v-progress-linear :model-value=\"progression\" color=\"primary\" height=\"24\" rounded striped class=\"mt-2 mb-2\">\n          <template #default=\"{ value }\">\n            <strong>{{ Math.min(100, Math.ceil(value || 0)) }}%</strong>\n          </template>\n        </v-progress-linear>\n      </v-col>\n    </v-row>\n\n    <v-row class=\"aligned-row\">\n      <v-col cols=\"12\" sm=\"8\" class=\"d-flex align-center\">\n        <span class=\"text-subtitle-1 text-medium-emphasis ma-2\">Estimated duration left :</span>\n      </v-col>\n      <v-col cols=\"12\" sm=\"4\" class=\"d-flex align-center\">\n        <v-text-field :model-value=\"formatDuration(duration_left)\" variant=\"flat\" hide-details readonly\n          class=\"aligned-input\" />\n      </v-col>\n    </v-row>\n\n    <v-row>\n      <v-col cols=\"12\">\n        <v-alert v-if=\"acq_status_message\" :type=\"statusType\" :color=\"statusColor\" border=\"start\" variant=\"tonal\"\n          class=\"text-subtitle-1\" prominent>\n          {{ formattedStatus }}\n        </v-alert>\n      </v-col>\n    </v-row>\n\n    <v-row>\n      <v-col cols=\"12\">\n        <v-btn-toggle v-model=\"acq_status\" variant=\"outlined\" mandatory divided shaped\n          class=\"d-flex justify-space-between mt-4\" @update:model-value=\"handleAcqStatusChange\">\n          <v-btn class=\"flex-grow-1\" value=\"off\" color=\"red\">Stop</v-btn>\n          <v-btn class=\"flex-grow-1\" value=\"on\" color=\"green\">Start</v-btn>\n        </v-btn-toggle>\n      </v-col>\n    </v-row>\n\n    <v-dialog v-model=\"hintDialog\" max-width=\"600\">\n      <v-card>\n        <v-card-title class=\"text-h6\">{{ hintTitle }}</v-card-title>\n        <v-card-text v-html=\"hintText\" class=\"text-body-2\"></v-card-text>\n        <v-card-actions>\n          <v-spacer></v-spacer>\n          <v-btn text @click=\"hintDialog = false\">Close</v-btn>\n        </v-card-actions>\n      </v-card>\n    </v-dialog>\n  </v-container>\n</template>\n\n<script>\n  export default {\n  props: [\"msg\"],\n  data() {\n    return {\n      acq_id: \"\",\n      acq_nb_frame: 1,\n      acq_interframe_volume: 8,\n      acq_imaged_volume: \"\",\n      acq_pumped_volume: \"\",\n      acq_comment: \"\",\n      progression: 0,\n      duration_left: 0,\n      acq_status: \"off\",\n      acq_status_message: \"\",\n      \n      // Values that are not changing anymore (Constants)\n      calibration_sensor_width: 4056,\n      calibration_sensor_height: 3040,\n\n      // This is dynamic and used for calculation\n      calibration_pixel_size: 0,\n      \n      acq_flowcell_thickness: 300,\n      frame_volume_um3: 0,\n      topic: \"acq_params\",\n      hintDialog: false,\n      hintTitle: \"\",\n      hintText: \"\",\n      lastUpdateTime: null,\n      acq_start_timestamp: null,\n    };\n  },\n\n  computed: {\n    sensor_width_um() { return (this.calibration_sensor_width || 0) * (this.calibration_pixel_size || 0); },\n    sensor_height_um() { return (this.calibration_sensor_height || 0) * (this.calibration_pixel_size || 0); },\n    frame_volume_ml() { return this.frame_volume_um3 / 1e12; },\n\n    formattedStatus() {\n      const s = this.acq_status_message;\n      if (s === \"Started\") return \"Image capture process has started successfully.\";\n      if (s === \"Done\") return \"Acquisition completed successfully.\";\n      return s;\n    },\n\n    statusColor() {\n      const s = this.acq_status_message || \"\";\n      if (!s) return \"grey\";\n      if (s.startsWith(\"Error\")) return \"red\";\n      if (s.startsWith(\"Configuration update error\")) return \"orange\";\n      if (s.includes(\"WAS NOT CAPTURED\")) return \"red\";\n      if ([\"Started\", \"Done\"].includes(s)) return \"green\";\n      return \"grey\";\n    },\n\n    statusType() {\n      if (this.statusColor === \"green\") return \"success\";\n      if (this.statusColor === \"orange\") return \"warning\";\n      if (this.statusColor === \"red\") return \"error\";\n      return \"info\";\n    },\n  },\n\n  watch: {\n    msg: {\n      handler(newMsg) {\n        const p = newMsg?.payload || {};\n        const topic = newMsg?.topic;\n\n        if (p.acq_id !== undefined)\n          this.acq_id = String(p.acq_id).replace(/^A[_-]?/, \"\");\n\n        if (\"acq_comment\" in p) {\n          this.acq_comment = p.acq_comment ?? \"\";\n        }\n\n        if (p.acq_nb_frame !== undefined)\n          this.acq_nb_frame = Number(p.acq_nb_frame);\n\n        if (p.acq_interframe_volume !== undefined)\n          this.acq_interframe_volume = Number(p.acq_interframe_volume);\n\n        if (p.calibration_pixel_size !== undefined)\n          this.calibration_pixel_size = Number(p.calibration_pixel_size);\n\n        // NOTE: calibration_sensor_width and height removed from watcher \n        // to prevent overwriting constant values (4056/3040)\n\n        if (p.acq_flowcell_thickness !== undefined)\n          this.acq_flowcell_thickness = Number(p.acq_flowcell_thickness);\n\n        if (p.acq_start_timestamp !== undefined && p.acq_start_timestamp !== null) {\n          this.acq_start_timestamp = Number(p.acq_start_timestamp);\n        }\n\n        if (p.status && /Image\\s+\\d+\\s*\\/\\s*\\d+/i.test(p.status))\n          this.acq_status = \"on\";\n\n        if (p.status !== undefined) {\n          this.acq_status_message = p.status;\n          const s = String(p.status).toLowerCase();\n\n          if (!/Image\\s+\\d+\\s*\\/\\s*\\d+/i.test(p.status)) {\n            if (s.includes(\"capturing\") || s.includes(\"running\") || s.includes(\"started\"))\n              this.acq_status = \"on\";\n          }\n\n          if (s.includes(\"done\") || s.includes(\"idle\") || s.includes(\"stopped\") || s.includes(\"error\"))\n            this.acq_status = \"off\";\n\n          this.extractProgressFromMessage();\n        }\n\n        if (topic === \"status/imager\" && p.status === \"Done\") {\n          this.incrementAcqId();\n          this.resetProgress();\n        }\n\n        this.autoCalculateVolumes();\n      },\n      deep: true,\n    },\n  },\n\n  methods: {\n    fmt(v) { return Number(v || 0).toFixed(3); },\n\n    formatDuration(mins) {\n      const totalSeconds = Math.max(0, Math.round(mins * 60));\n      const h = String(Math.floor(totalSeconds / 3600)).padStart(2, \"0\");\n      const m = String(Math.floor((totalSeconds % 3600) / 60)).padStart(2, \"0\");\n      const s = String(totalSeconds % 60).padStart(2, \"0\");\n      return `${h}:${m}:${s}`;\n    },\n\n    resetProgress() {\n      this.progression = 0;\n      this.duration_left = 0;\n      this.lastUpdateTime = Date.now();\n    },\n\n    incrementAcqId() {\n      const next = String(Number(this.acq_id || 0) + 1).padStart(1, \"0\");\n      this.acq_id = next;\n      this.sendUpdate();\n    },\n\n    autoCalculateVolumes() {\n      // Logic adjusted to ensure constants are used even if pixel size is 0 initially\n      const w_px = this.calibration_sensor_width;\n      const h_px = this.calibration_sensor_height;\n      \n      if (w_px > 0 && h_px > 0 && this.calibration_pixel_size > 0 && this.acq_flowcell_thickness > 0) {\n        \n        const w_um = w_px * this.calibration_pixel_size;\n        const h_um = h_px * this.calibration_pixel_size;\n        const t = this.acq_flowcell_thickness;\n\n        this.frame_volume_um3 = w_um * h_um * t;\n        const frame_ml = this.frame_volume_um3 / 1e12;\n        this.acq_imaged_volume = frame_ml * (this.acq_nb_frame || 0);\n      } else {\n        this.frame_volume_um3 = 0;\n        this.acq_imaged_volume = 0;\n      }\n\n      const interimage_total_ml = (this.acq_interframe_volume || 0) * (this.acq_nb_frame || 0);\n      this.acq_pumped_volume = this.acq_imaged_volume + interimage_total_ml;\n\n      this.updateProgress();\n      this.sendUpdate();\n    },\n\n    extractProgressFromMessage() {\n      const s = this.acq_status_message || \"\";\n      const match = s.match(/Image\\s+(\\d+)\\s*\\/\\s*(\\d+)/i);\n      if (!match) return;\n\n      const current = Number(match[1]);\n      const total = Number(match[2]);\n      this.progression = Math.min(100, (current / total) * 100);\n\n      if (!this.acq_start_timestamp) return;\n\n      const now = Date.now();\n      const elapsedSec = (now - this.acq_start_timestamp) / 1000;\n      if (elapsedSec <= 0 || current === 0) return;\n\n      const avgPerFrameSec = elapsedSec / current;\n      this.duration_left = ((total - current) * avgPerFrameSec) / 60;\n    },\n\n    updateProgress() {\n      if (this.acq_status === \"on\" && this.acq_nb_frame > 0) {\n        const elapsed = (Date.now() - (this.lastUpdateTime || Date.now())) / 1000;\n        if (elapsed > 0) {\n          this.progression = Math.min(100, this.progression + (elapsed / this.acq_nb_frame) * 100);\n          this.duration_left = ((100 - this.progression) / 100) * (this.acq_nb_frame / 60);\n        }\n        this.lastUpdateTime = Date.now();\n      }\n    },\n\n    handleAcqStatusChange(value) {\n      this.acq_status = value;\n\n      if (value === \"on\") {\n        this.resetProgress();\n        this.acq_start_timestamp = Date.now();\n      }\n\n      if (value === \"off\") {\n        this.incrementAcqId();\n      }\n\n      if (typeof this.send === \"function\") {\n        this.send({\n          topic: \"imager/image\",\n          payload: { status: value }\n        });\n      }\n\n      this.sendUpdate();\n    },\n\n    showVolumeImagedHint() {\n      const area = this.sensor_width_um * this.sensor_height_um;\n      const pSize = this.calibration_pixel_size || 0;\n\n      const html = `<div class=\"text-body-2\">\n        <p class=\"mb-2\">\n          <strong>Volume Imaged</strong> is the fluid volume captured by the optics.\n        </p>\n\n        <v-divider class=\"my-3\"></v-divider>\n\n        <ul class=\"ml-4\">\n          <li class=\"mb-1\">\n            <strong>Sensor Width:</strong><br/>\n            ${this.calibration_sensor_width} px  ${pSize} m/px = \n            <strong>${Math.round(this.sensor_width_um)} m</strong>\n          </li>\n          <li class=\"mb-1\">\n            <strong>Sensor Height:</strong><br/>\n            ${this.calibration_sensor_height} px  ${pSize} m/px = \n            <strong>${Math.round(this.sensor_height_um)} m</strong>\n          </li>\n          <li>\n            <strong>Flowcell thickness:</strong>\n            ${Math.round(this.acq_flowcell_thickness)} m\n          </li>\n        </ul>\n\n        <p class=\"mt-4 mb-2\">\n          <strong>Step-by-step calculation:</strong>\n        </p>\n\n        <ol class=\"ml-4\">\n          <li>\n            Area = ${Math.round(this.sensor_width_um)}  ${Math.round(this.sensor_height_um)} =\n            ${Math.round(area)} m\n          </li>\n          <li>\n            Vol./img = Area  Thickness =\n            ${Math.round(area * this.acq_flowcell_thickness)} m\n          </li>\n          <li>\n            Convert  mL: ${this.fmt(this.frame_volume_ml)} mL/img\n          </li>\n          <li>\n            Total = ${this.acq_nb_frame} images  ${this.fmt(this.frame_volume_ml)} =\n            <strong>${this.fmt(this.acq_imaged_volume)} mL</strong>\n          </li>\n        </ol>\n      </div>`;\n\n      this.openHint(\"Volume Imaged Calculation\", html);\n    },\n\n    showVolumeDisplacedHint() {\n      const inter_ml = (this.acq_nb_frame * this.acq_interframe_volume) / 1000;\n\n      const html = `\n        <p><b>Total Volume Displaced</b> includes both the imaged volume and the extra fluid moved between images.</p>\n        <hr>\n        <ul>\n          <li><b>Interimage displacement:</b> ${this.acq_nb_frame}  ${this.fmt(this.acq_interframe_volume)} L = ${this.fmt(inter_ml)} mL</li>\n          <li><b>Imaged volume:</b> ${this.fmt(this.acq_imaged_volume)} mL</li>\n        </ul>\n        <p><b>Total:</b> ${this.fmt(this.acq_imaged_volume)} + ${this.fmt(inter_ml)} = \n        <b>${this.fmt(this.acq_pumped_volume)} mL</b></p>\n      `;\n\n      this.openHint(\"Total Volume Displaced\", html);\n    },\n\n    openHint(title, text) {\n      this.hintDialog = true;\n      this.hintTitle = title;\n      this.hintText = text;\n    },\n\n    sendUpdate(extra = {}) {\n      if (typeof this.send !== \"function\") return;\n\n      this.send({\n        topic: this.topic,\n        payload: {\n          acq_id: `A_${this.acq_id}`,\n          acq_nb_frame: this.acq_nb_frame,\n          acq_interframe_volume: this.acq_interframe_volume,\n          acq_imaged_volume: Number(this.acq_imaged_volume.toFixed(2)),\n          acq_pumped_volume: Number(this.acq_pumped_volume.toFixed(2)),\n          acq_comment: this.acq_comment,\n          progression: this.progression,\n          duration_left: this.duration_left,\n          status: this.acq_status_message,\n          \n          calibration_pixel_size: this.calibration_pixel_size,\n          // Sending constants back to confirm configuration\n          calibration_sensor_width: this.calibration_sensor_width,\n          calibration_sensor_height: this.calibration_sensor_height,\n          \n          acq_flowcell_thickness: this.acq_flowcell_thickness,\n          acq_start_timestamp: this.acq_start_timestamp,\n          ...extra,\n        },\n      });\n    },\n  },\n};\n</script>\n\n<style scoped>\n  .cursor-pointer {\n    cursor: pointer;\n  }\n</style>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 350,
        "y": 140,
        "wires": [
            [
                "56b3c60c6d4ffd87"
            ]
        ]
    },
    {
        "id": "a39e07fd1a86ac84",
        "type": "ui-template",
        "z": "35d7387466dd0bc0",
        "group": "3ae252a2e5abca89",
        "page": "",
        "ui": "",
        "name": "Navigation Top",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n  <v-container fluid class=\"ma-0 pa-0\">\n    <v-row \n      align=\"center\" \n      class=\"px-2 py-0\" \n      no-gutters\n    >\n      \n      <v-col cols=\"3\" class=\"py-0 d-flex justify-start\">\n        <v-btn\n          to=\"metadata\"\n          color=\"primary\"\n          rounded=\"lg\"\n          class=\"px-4\" variant=\"text\" size=\"large\"\n        >\n          <v-icon start>mdi-chevron-left</v-icon>\n          Metadata\n        </v-btn>\n      </v-col>\n\n      <v-col cols=\"6\" class=\"text-center py-0\">\n        <h1 class=\"text-h5 font-weight-bold text-primary my-0 text-truncate\">\n          Acquisition\n        </h1>\n      </v-col>\n\n      <v-col cols=\"3\" class=\"py-0 d-flex justify-end\">\n        <v-btn\n          to=\"segmentation\"\n          color=\"primary\"\n          rounded=\"lg\"\n          class=\"px-4\" variant=\"text\" size=\"large\"\n        >\n          Segmentation\n          <v-icon end>mdi-chevron-right</v-icon>\n        </v-btn>\n      </v-col>\n      \n    </v-row>\n  </v-container>\n</template>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 1300,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "56b3c60c6d4ffd87",
        "type": "switch",
        "z": "35d7387466dd0bc0",
        "name": "",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "acq_params",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "imager/image",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 570,
        "y": 140,
        "wires": [
            [
                "f841ebf999dd8cb3"
            ],
            [
                "09ecc922fe2214a8"
            ]
        ]
    },
    {
        "id": "f841ebf999dd8cb3",
        "type": "function",
        "z": "35d7387466dd0bc0",
        "name": "set acq_params",
        "func": "if (msg.topic) {\n    global.set(\"acq_id\", msg.payload.acq_id);\n    global.set(\"acq_nb_frame\", msg.payload.acq_nb_frame);\n    global.set(\"acq_interframe_volume\", msg.payload.acq_interframe_volume);\n    global.set(\"acq_imaged_volume\", msg.payload.acq_imaged_volume);\n    global.set(\"acq_pumped_volume\", msg.payload.acq_pumped_volume);\n    global.set(\"acq_comment\", msg.payload.acq_comment);\n    global.set(\"acq_progression\", msg.payload.acq_progression);\n    global.set(\"acq_duration_left\", msg.payload.acq_duration_left);\n    global.set(\"acq_start_timestamp\", msg.payload.acq_start_timestamp);\n    \n}\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 760,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "e3c084164002f23f",
        "type": "ui-event",
        "z": "35d7387466dd0bc0",
        "ui": "e6ae26617c24c3ea",
        "name": "UI Event",
        "x": 80,
        "y": 40,
        "wires": [
            [
                "5bea829ec02ded61"
            ]
        ]
    },
    {
        "id": "5bea829ec02ded61",
        "type": "switch",
        "z": "35d7387466dd0bc0",
        "name": "msg.topic === \"$pageview\"",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "$pageview",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 280,
        "y": 40,
        "wires": [
            [
                "54ae95ca6088f307"
            ]
        ]
    },
    {
        "id": "54ae95ca6088f307",
        "type": "switch",
        "z": "35d7387466dd0bc0",
        "name": "msg.payload.page.path === \"/acquisition\"",
        "property": "payload.page.path",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "/acquisition",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 590,
        "y": 40,
        "wires": [
            [
                "113085f8dd63df0c"
            ]
        ]
    },
    {
        "id": "113085f8dd63df0c",
        "type": "function",
        "z": "35d7387466dd0bc0",
        "name": "Get Global Variables",
        "func": "const keys = global.keys(); // Get all global variable keys\nmsg.payload = {}; // Initialize the payload object\n\nkeys.forEach(key => {\n    // Ignore keys that start with \"$\"\n    if (!key.startsWith('$')) {\n        msg.payload[key] = global.get(key);\n    }\n});\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 120,
        "y": 140,
        "wires": [
            [
                "aa6924c7e0aff26c"
            ]
        ]
    },
    {
        "id": "8ceee00f68df186c",
        "type": "mqtt in",
        "z": "35d7387466dd0bc0",
        "name": "",
        "topic": "status/imager",
        "qos": "0",
        "datatype": "json",
        "broker": "8dc3722c.06efa8",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 90,
        "y": 200,
        "wires": [
            [
                "aa6924c7e0aff26c"
            ]
        ]
    },
    {
        "id": "425d72ed91ea264e",
        "type": "ui-template",
        "z": "35d7387466dd0bc0",
        "group": "3d88a1872dbbf8a7",
        "page": "",
        "ui": "",
        "name": "Navigation Bottom",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "\n<template>\n  <v-container fluid class=\"ma-0 pa-0\">\n    <v-row align=\"center\" justify=\"space-between\" class=\"px-2\">\n      <!-- Back to Preview -->\n      <v-col cols=\"auto\">\n        <v-btn\n          to=\"metadata\"\n          color=\"primary\"\n          rounded=\"lg\"\n          class=\"px-4\" variant=\"text\" size=\"large\"\n        >\n          <v-icon start>mdi-chevron-left</v-icon>\n          Metadata\n        </v-btn>\n      </v-col>\n\n      <!-- Forward to Acquisition -->\n      <v-col cols=\"auto\">\n        <v-btn\n          to=\"segmentation\"\n          color=\"primary\"\n          rounded=\"lg\"\n          class=\"px-4\" variant=\"text\" size=\"large\"\n        >\n          Segmentation\n          <v-icon end>mdi-chevron-right</v-icon>\n        </v-btn>\n      </v-col>\n    </v-row>\n  </v-container>\n</template>\n",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 1290,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "46b98c54eb680c2e",
        "type": "mqtt out",
        "z": "35d7387466dd0bc0",
        "name": "MQTT",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "8dc3722c.06efa8",
        "x": 1070,
        "y": 200,
        "wires": []
    },
    {
        "id": "7d28a539738ca73a",
        "type": "function",
        "z": "35d7387466dd0bc0",
        "name": "update_config",
        "func": "const keys = global.keys(); // Rcupre toutes les cls des variables globales\nlet config = {}; // Objet pour stocker la configuration\n\nkeys.forEach(key => {\n    // Ignore les cls qui commencent par \"$\"\n    if (!key.startsWith('$')) {\n        // Ne garde que celles qui commencent par les prfixes demands\n        if (\n            key.startsWith('sample_') ||\n            key.startsWith('acq_') ||\n            key.startsWith('object_') ||\n            key.startsWith('process_') ||\n            key.startsWith('img_')\n        ) {\n            config[key] = global.get(key);\n        }\n    }\n});\n\n// Cre le payload final\nmsg.payload = {\n    action: \"update_config\",\n    config: config\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 760,
        "y": 200,
        "wires": [
            [
                "46b98c54eb680c2e",
                "b162f94dfd6bfdad"
            ]
        ]
    },
    {
        "id": "09ecc922fe2214a8",
        "type": "switch",
        "z": "35d7387466dd0bc0",
        "name": "",
        "property": "payload.status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "off",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 570,
        "y": 200,
        "wires": [
            [
                "7d28a539738ca73a",
                "bb2825f419cc6526"
            ],
            [
                "44c8ea6299e13784"
            ]
        ]
    },
    {
        "id": "44c8ea6299e13784",
        "type": "function",
        "z": "35d7387466dd0bc0",
        "name": "stop acquisition",
        "func": "\nmsg.payload = {\n    action: \"stop\"\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 760,
        "y": 240,
        "wires": [
            [
                "46b98c54eb680c2e"
            ]
        ]
    },
    {
        "id": "bb2825f419cc6526",
        "type": "function",
        "z": "35d7387466dd0bc0",
        "name": "start acquisition",
        "func": "const acq_interframe_volume = global.get(\"acq_interframe_volume\") || 0;\nconst acq_nb_frame = global.get(\"acq_nb_frame\") || 0;\n\n\n// Cre le payload final\nmsg.payload = {\n    action: \"image\",\n    pump_direction: \"FORWARD\",\n    volume: acq_interframe_volume,\n    nb_frame: acq_nb_frame,\n    sleep: 0.1\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 760,
        "y": 280,
        "wires": [
            [
                "ce5cca3b8fe34379"
            ]
        ]
    },
    {
        "id": "ce5cca3b8fe34379",
        "type": "delay",
        "z": "35d7387466dd0bc0",
        "name": "",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 920,
        "y": 280,
        "wires": [
            [
                "46b98c54eb680c2e",
                "b162f94dfd6bfdad"
            ]
        ]
    },
    {
        "id": "b162f94dfd6bfdad",
        "type": "debug",
        "z": "35d7387466dd0bc0",
        "name": "debug 3",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1080,
        "y": 140,
        "wires": []
    },
    {
        "id": "250979b4672d81b6",
        "type": "ui-event",
        "z": "0fd76ac156d78937",
        "ui": "e6ae26617c24c3ea",
        "name": "UI Event",
        "x": 80,
        "y": 40,
        "wires": [
            [
                "72421c36bb0418bc"
            ]
        ]
    },
    {
        "id": "72421c36bb0418bc",
        "type": "switch",
        "z": "0fd76ac156d78937",
        "name": "msg.topic === \"$pageview\"",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "$pageview",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 280,
        "y": 40,
        "wires": [
            [
                "66d295cc27d69cec"
            ]
        ]
    },
    {
        "id": "66d295cc27d69cec",
        "type": "switch",
        "z": "0fd76ac156d78937",
        "name": "msg.payload.page.path === \"/segmentation\"",
        "property": "payload.page.path",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "/segmentation",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 590,
        "y": 40,
        "wires": [
            [
                "d4129bf3f5622aa6",
                "921be0438de344ac"
            ]
        ]
    },
    {
        "id": "61c2c281b1c6e055",
        "type": "ui-table",
        "z": "0fd76ac156d78937",
        "group": "bfd4acb7b243514f",
        "name": "List of acq",
        "label": "",
        "order": 1,
        "width": 0,
        "height": 0,
        "maxrows": "100",
        "passthru": false,
        "autocols": false,
        "showSearch": false,
        "deselect": true,
        "selectionType": "click",
        "columns": [
            {
                "title": "Project name",
                "key": "project_name",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            },
            {
                "title": "Sample ID",
                "key": "sample_id",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            },
            {
                "title": "Acquisition ID",
                "key": "acquisition_id",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            },
            {
                "title": "Operator Name",
                "key": "operator_name",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            },
            {
                "title": "Number of images",
                "key": "image_acquired_count",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            },
            {
                "title": "Path",
                "key": "path",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            },
            {
                "title": "Segmented",
                "key": "is_segmented",
                "keyType": "key",
                "type": "tickcross",
                "width": "",
                "align": "start"
            },
            {
                "title": "",
                "key": "",
                "keyType": "str",
                "type": "html",
                "width": "",
                "align": "start"
            }
        ],
        "mobileBreakpoint": "sm",
        "mobileBreakpointType": "defaults",
        "action": "replace",
        "x": 330,
        "y": 140,
        "wires": [
            [
                "cdb586337f186494"
            ]
        ]
    },
    {
        "id": "d4129bf3f5622aa6",
        "type": "list acquisitions",
        "z": "0fd76ac156d78937",
        "name": "",
        "x": 100,
        "y": 140,
        "wires": [
            [
                "61c2c281b1c6e055"
            ]
        ]
    },
    {
        "id": "9e44bf9a44615e20",
        "type": "ui-template",
        "z": "0fd76ac156d78937",
        "group": "9f00807878a32dd5",
        "page": "",
        "ui": "",
        "name": "Navigation Bottom",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "\n<template>\n  <v-container fluid class=\"ma-0 pa-0\">\n    <v-row align=\"center\" justify=\"space-between\" class=\"px-2\">\n      <!-- Back to Preview -->\n      <v-col cols=\"auto\">\n        <v-btn\n          to=\"acquisition\"\n          color=\"primary\"\n          rounded=\"lg\"\n          class=\"px-4\" variant=\"text\" size=\"large\"\n        >\n          <v-icon start>mdi-chevron-left</v-icon>\n          Acquisition\n        </v-btn>\n      </v-col>\n\n      <!-- Forward to Acquisition -->\n      <v-col cols=\"auto\">\n        <v-btn\n          to=\"visualization\"\n          color=\"primary\"\n          rounded=\"lg\"\n          class=\"px-4\" variant=\"text\" size=\"large\"\n        >\n          Visualization\n          <v-icon end>mdi-chevron-right</v-icon>\n        </v-btn>\n      </v-col>\n    </v-row>\n  </v-container>\n</template>\n",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 1510,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "d11906e048438931",
        "type": "ui-template",
        "z": "0fd76ac156d78937",
        "group": "9b992ca6515ed058",
        "page": "",
        "ui": "",
        "name": "Navigation Top",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n  <v-container fluid class=\"ma-0 pa-0\">\n    <v-row \n      align=\"center\" \n      class=\"px-2 py-0\" \n      no-gutters\n    >\n      \n      <v-col cols=\"3\" class=\"py-0 d-flex justify-start\">\n        <v-btn\n          to=\"acquisition\"\n          color=\"primary\"\n          rounded=\"lg\"\n          class=\"px-4\" variant=\"text\" size=\"large\"\n        >\n          <v-icon start>mdi-chevron-left</v-icon>\n          Acquisition\n        </v-btn>\n      </v-col>\n\n      <v-col cols=\"6\" class=\"text-center py-0\">\n        <h1 class=\"text-h5 font-weight-bold text-primary my-0 text-truncate\">\n          Segmentation\n        </h1>\n      </v-col>\n\n      <v-col cols=\"3\" class=\"py-0 d-flex justify-end\">\n        <v-btn\n          to=\"visualization\"\n          color=\"primary\"\n          rounded=\"lg\"\n          class=\"px-4\" variant=\"text\" size=\"large\"\n        >\n          Vizualisation\n          <v-icon end>mdi-chevron-right</v-icon>\n        </v-btn>\n      </v-col>\n      \n    </v-row>\n  </v-container>\n</template>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 1520,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "4bdd8a4afcdb704b",
        "type": "mqtt out",
        "z": "0fd76ac156d78937",
        "name": "MQTT",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "8dc3722c.06efa8",
        "x": 1150,
        "y": 140,
        "wires": []
    },
    {
        "id": "24c71b69e60e41bd",
        "type": "switch",
        "z": "0fd76ac156d78937",
        "name": "",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "segmenter/segment",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1030,
        "y": 140,
        "wires": [
            [
                "4bdd8a4afcdb704b",
                "f8f4b34842d35713"
            ]
        ]
    },
    {
        "id": "34f6f23f1a46da67",
        "type": "mqtt in",
        "z": "0fd76ac156d78937",
        "name": "",
        "topic": "status/segmenter",
        "qos": "0",
        "datatype": "json",
        "broker": "8dc3722c.06efa8",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 100,
        "y": 260,
        "wires": [
            [
                "33c0d1b8251b5d00"
            ]
        ]
    },
    {
        "id": "33c0d1b8251b5d00",
        "type": "ui-template",
        "z": "0fd76ac156d78937",
        "group": "402b3d24c87ab0d2",
        "page": "",
        "ui": "",
        "name": "Details of Segmentation",
        "order": 1,
        "width": "0",
        "height": "0",
        "head": "",
        "format": "<template>\n  <!-- Dataset Info: shown only when segmentation is currently active -->\n  <v-list density=\"compact\" v-if=\"isSegmenting && segment.dataset.project_name\">\n    <v-list-item>\n      <v-list-item-title>\n        <b>Project:</b> {{ segment.dataset.project_name }}\n      </v-list-item-title>\n    </v-list-item>\n    <v-list-item>\n      <v-list-item-title>\n        <b>Sample:</b> {{ segment.dataset.sample_id }}\n      </v-list-item-title>\n    </v-list-item>\n    <v-list-item>\n      <v-list-item-title>\n        <b>Acquisition:</b> {{ segment.dataset.acquisition_id }}\n      </v-list-item-title>\n    </v-list-item>\n    <v-list-item>\n      <v-list-item-title>\n        <b>Path:</b> {{ segment.dataset.path }}\n      </v-list-item-title>\n    </v-list-item>\n  </v-list>\n\n  <v-divider class=\"my-4\" v-if=\"isSegmenting && segment.dataset.project_name\"></v-divider>\n\n  <!-- Error Message -->\n  <v-alert v-if=\"errorMessage\" type=\"error\" variant=\"outlined\" border=\"start\" prominent class=\"mb-4\">\n    <strong>Error:</strong> {{ errorMessage }}\n  </v-alert>\n\n  <!-- Generic Info / Other Messages -->\n  <v-alert v-else-if=\"infoMessage\" type=\"info\" variant=\"outlined\" border=\"start\" class=\"mb-4\">\n    {{ infoMessage }}\n  </v-alert>\n\n  <!-- Progress Info -->\n  <div v-if=\"statusText && !errorMessage\">\n    <div class=\"d-flex justify-space-between align-center mb-2\">\n      <span class=\"text-subtitle-1 font-weight-medium\">Progress</span>\n      <span class=\"text-caption\">{{ progressText }}</span>\n    </div>\n\n    <v-progress-linear :model-value=\"progressPercent\" height=\"10\" color=\"primary\" rounded striped></v-progress-linear>\n\n    <p class=\"mt-3 mb-0 text-body-2\" v-if=\"currentImage\">\n      Currently segmenting:\n      <strong>{{ currentImage }}</strong>\n    </p>\n  </div>\n\n  <div v-else-if=\"!errorMessage\" class=\"text-disabled mt-4\">\n    Awaiting segmentation status...\n  </div>\n</template>\n\n<script>\n  export default {\n  props: {\n    msg: Object,\n  },\n  data() {\n    return {\n      segment: {\n        dataset: {\n          project_name: \"\",\n          sample_id: \"\",\n          acquisition_id: \"\",\n          path: \"\",\n        },\n      },\n      statusText: \"\",\n      currentImage: \"\",\n      currentIndex: 0,\n      totalImages: 0,\n      progressPercent: 0,\n      progressText: \"\",\n      errorMessage: \"\",\n      infoMessage: \"\",\n    };\n  },\n  computed: {\n    // Active segmentation means: we have a status and it isn't \"Done\"\n    isSegmenting() {\n      return (\n        this.statusText &&\n        !this.statusText.toLowerCase().includes(\"done\") &&\n        !this.statusText.toLowerCase().includes(\"idle\") &&\n        !this.errorMessage\n      );\n    },\n  },\n  watch: {\n    msg: {\n      immediate: true,\n      handler(msg) {\n        if (!msg || !msg.topic || !msg.payload) return;\n\n        const p = msg.payload;\n\n        // Reset message fields\n        this.errorMessage = \"\";\n        this.infoMessage = \"\";\n        this.statusText = \"\";\n\n        // 1 Load dataset info from message payload if available\n        if (\n          p.seg_project_name ||\n          p.seg_sample_id ||\n          p.seg_acquisition_id ||\n          p.seg_path\n        ) {\n          this.segment.dataset = {\n            project_name: p.seg_project_name || \"\",\n            sample_id: p.seg_sample_id || \"\",\n            acquisition_id: p.seg_acquisition_id || \"\",\n            path: p.seg_path || \"\",\n          };\n        }\n\n        // 2 Handle status/segmenter messages\n        if (msg.topic === \"status/segmenter\") {\n          const status = p.status || \"\";\n\n          // Detect error messages\n          if (status.toLowerCase().includes(\"exception\")) {\n            this.errorMessage = status;\n            this.statusText = \"\";\n            this.progressPercent = 0;\n            this.progressText = \"\";\n            return;\n          }\n\n          // Detect \"done\" or \"idle\"\n          if (status.toLowerCase().includes(\"done\") || status.toLowerCase().includes(\"idle\")) {\n            this.statusText = status;\n            this.segment.dataset = {\n              project_name: \"\",\n              sample_id: \"\",\n              acquisition_id: \"\",\n              path: \"\",\n            };\n            this.currentImage = \"\";\n            this.progressPercent = 0;\n            this.progressText = \"\";\n            return;\n          }\n\n          // Handle other status or info messages\n          if (!status.toLowerCase().includes(\"image\")) {\n            this.infoMessage = status;\n            return;\n          }\n\n          // 3 Extract progress info if available\n          this.statusText = status;\n\n          const imgMatch = this.statusText.match(/image ([\\w\\-\\_\\.]+),/);\n          this.currentImage = imgMatch ? imgMatch[1] : \"\";\n\n          const progressMatch = this.statusText.match(/image (\\d+)\\/(\\d+)/);\n          if (progressMatch) {\n            this.currentIndex = Number(progressMatch[1]);\n            this.totalImages = Number(progressMatch[2]);\n            this.progressPercent = Math.round(\n              (this.currentIndex / this.totalImages) * 100\n            );\n            this.progressText = `${this.currentIndex} / ${this.totalImages} (${this.progressPercent}%)`;\n          } else {\n            this.progressPercent = 0;\n            this.progressText = \"\";\n          }\n        }\n      },\n    },\n  },\n};\n</script>\n\n<style scoped>\n  .text-disabled {\n    color: rgba(0, 0, 0, 0.4);\n  }\n</style>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 370,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "cdb586337f186494",
        "type": "switch",
        "z": "0fd76ac156d78937",
        "name": "",
        "property": "payload.is_segmented",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "false"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 510,
        "y": 140,
        "wires": [
            [],
            [
                "89d1bfb7839c2077"
            ]
        ]
    },
    {
        "id": "f8f4b34842d35713",
        "type": "function",
        "z": "0fd76ac156d78937",
        "name": "set seg_params",
        "func": "if (msg.topic) {\n    global.set(\"seg_project_name\", msg.payload.dataset.project_name);\n    global.set(\"seg_sample_id\", msg.payload.dataset.sample_id);\n    global.set(\"seg_acquisition_id\", msg.payload.dataset.acquisition_id);\n    global.set(\"seg_path\", msg.payload.dataset.path);\n    global.set(\"process_min_ESD\", msg.payload.settings.process_min_ESD);\n}\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1180,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "921be0438de344ac",
        "type": "function",
        "z": "0fd76ac156d78937",
        "name": "Get Global Variables",
        "func": "const keys = global.keys(); // Get all global variable keys\nmsg.payload = {}; // Initialize the payload object\n\nkeys.forEach(key => {\n    // Ignore keys that start with \"$\"\n    if (!key.startsWith('$')) {\n        msg.payload[key] = global.get(key);\n    }\n});\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 120,
        "y": 200,
        "wires": [
            [
                "33c0d1b8251b5d00"
            ]
        ]
    },
    {
        "id": "89d1bfb7839c2077",
        "type": "function",
        "z": "0fd76ac156d78937",
        "name": "add process_min_ESD",
        "func": "// Ensure msg.payload and msg.payload.settings exist\nmsg.payload = msg.payload || {};\n\n// Read the variable from global context\nconst process_min_ESD = global.get(\"process_min_ESD\");\n\n// Add it to the payload settings\nmsg.payload.process_min_ESD = process_min_ESD;\nmsg.payload.open_dialog = true;\n\n// Return the modified message\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 680,
        "y": 140,
        "wires": [
            [
                "0ec6b9337acadf6f",
                "7fde0897e436c334"
            ]
        ]
    },
    {
        "id": "0ec6b9337acadf6f",
        "type": "debug",
        "z": "0fd76ac156d78937",
        "name": "debug 1",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 880,
        "y": 180,
        "wires": []
    },
    {
        "id": "7fde0897e436c334",
        "type": "ui-template",
        "z": "0fd76ac156d78937",
        "group": "bfd4acb7b243514f",
        "page": "",
        "ui": "",
        "name": "Dialog",
        "order": 2,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n  <v-dialog v-if=\"showDialog\" v-model=\"showDialog\" max-width=\"500\">\n    <v-card>\n      <v-card-title class=\"font-weight-bold\">\n        Segmentation Required\n      </v-card-title>\n\n      <v-card-text>\n        <p>\n          The selected sample has not been segmented yet.<br>\n          Do you want to start segmentation now?\n        </p>\n\n        <v-divider class=\"my-3\"></v-divider>\n\n        <v-list density=\"compact\">\n          <v-list-item>\n            <v-list-item-title><b>Project:</b> {{ payload.project_name }}</v-list-item-title>\n          </v-list-item>\n          <v-list-item>\n            <v-list-item-title><b>Sample:</b> {{ payload.sample_id }}</v-list-item-title>\n          </v-list-item>\n          <v-list-item>\n            <v-list-item-title><b>Acquisition:</b> {{ payload.acquisition_id }}</v-list-item-title>\n          </v-list-item>\n          <v-list-item>\n            <v-list-item-title><b>Operator:</b> {{ payload.operator_name }}</v-list-item-title>\n          </v-list-item>\n          <v-list-item>\n            <v-list-item-title><b>Images acquired:</b> {{ payload.image_acquired_count }}</v-list-item-title>\n          </v-list-item>\n          <v-list-item>\n            <v-list-item-title><b>Path:</b> {{ payload.path }}</v-list-item-title>\n          </v-list-item>\n        </v-list>\n\n        <v-divider class=\"my-3\"></v-divider>\n\n        <v-text-field\n          v-model.number=\"process_min_ESD\"\n          label=\"Minimum ESD (m)\"\n          type=\"number\"\n          min=\"0\"\n          step=\"1\"\n          hint=\"Set minimum Equivalent Spherical Diameter in microns\"\n          persistent-hint\n        ></v-text-field>\n      </v-card-text>\n\n      <v-card-actions>\n        <v-spacer></v-spacer>\n        <v-btn color=\"grey\" variant=\"tonal\" @click=\"showDialog = false\">\n          Cancel\n        </v-btn>\n        <v-btn color=\"primary\" variant=\"flat\" @click=\"sendSegment\">\n          Segment\n        </v-btn>\n      </v-card-actions>\n    </v-card>\n  </v-dialog>\n</template>\n<script>\nexport default {\n  props: {\n    msg: { type: Object, default: () => ({}) },\n  },\n  data() {\n    return {\n      payload: {},\n      showDialog: false, \n      process_min_ESD: 0,\n      // 1. Add a flag to track if page is fully loaded\n      isReady: false, \n    };\n  },\n\n  mounted() {\n    // 2. Wait 1 second after the component loads before accepting \"Open\" commands.\n    // This effectively ignores the \"History\" message sent by Node-RED on refresh.\n    setTimeout(() => {\n      this.isReady = true;\n    }, 1000);\n  },\n\n  watch: {\n    msg: {\n      deep: true,\n      handler(newMsg) {\n        // 3. If the page is still loading (first 1 sec), IGNORE the message\n        if (!this.isReady) return;\n\n        // Safety check\n        if (!newMsg || !newMsg.payload) return;\n\n        const p = newMsg.payload;\n        \n        // 4. Check conditions\n        const shouldOpen = p.open_dialog === true && p.is_segmented === false;\n\n        if (shouldOpen) {\n          this.payload = p;\n          this.process_min_ESD = (typeof p.process_min_ESD === 'number') ? p.process_min_ESD : 0;\n          this.showDialog = true;\n        }\n      },\n    },\n  },\n\n  methods: {\n    sendSegment() {\n      const outMsg = {\n        topic: \"segmenter/segment\",\n        payload: {\n          action: \"segment\",\n          path: [this.payload.path],\n          settings: {\n            force: false,\n            recursive: true,\n            ecotaxa: true,\n            keep: true,\n            process_id: 1,\n            process_min_ESD: this.process_min_ESD,\n          },\n          dataset: {\n            project_name: this.payload.project_name,\n            sample_id: this.payload.sample_id,\n            acquisition_id: this.payload.acquisition_id,\n            operator_name: this.payload.operator_name,\n            image_acquired_count: this.payload.image_acquired_count,\n            path: this.payload.path,\n          },\n        },\n      };\n\n      this.send(outMsg);\n      this.showDialog = false;\n    },\n  },\n};\n</script>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 850,
        "y": 380,
        "wires": [
            [
                "24c71b69e60e41bd"
            ]
        ]
    },
    {
        "id": "77bb783e65c3ffd6",
        "type": "ui-event",
        "z": "14f8c9b5ce1235cc",
        "ui": "e6ae26617c24c3ea",
        "name": "UI Event",
        "x": 80,
        "y": 40,
        "wires": [
            [
                "55814595d9207e95"
            ]
        ]
    },
    {
        "id": "55814595d9207e95",
        "type": "switch",
        "z": "14f8c9b5ce1235cc",
        "name": "msg.topic === \"$pageview\"",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "$pageview",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 280,
        "y": 40,
        "wires": [
            [
                "90c920ecdab16908"
            ]
        ]
    },
    {
        "id": "90c920ecdab16908",
        "type": "switch",
        "z": "14f8c9b5ce1235cc",
        "name": "msg.payload.page.path === \"/visualization\"",
        "property": "payload.page.path",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "/visualization",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 590,
        "y": 40,
        "wires": [
            [
                "384aa9ab83bfe566",
                "164baa371893de7a"
            ]
        ]
    },
    {
        "id": "75b694eff7cf6747",
        "type": "ui-template",
        "z": "14f8c9b5ce1235cc",
        "group": "1d3abb201c51ff47",
        "page": "",
        "ui": "",
        "name": "Navigation Bottom",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "\n<template>\n  <v-container fluid class=\"ma-0 pa-0\">\n    <v-row align=\"center\" justify=\"space-between\" class=\"px-2\">\n      <!-- Back to Preview -->\n      <v-col cols=\"auto\">\n        <v-btn\n          to=\"segmentation\"\n          color=\"primary\"\n          rounded=\"lg\"\n          class=\"px-4\" variant=\"text\" size=\"large\"\n        >\n          <v-icon start>mdi-chevron-left</v-icon>\n          Segmentation\n        </v-btn>\n      </v-col>\n    </v-row>\n  </v-container>\n</template>\n",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 1290,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "fe2e976833fd41a9",
        "type": "ui-template",
        "z": "14f8c9b5ce1235cc",
        "group": "b570f76ef526af45",
        "page": "",
        "ui": "",
        "name": "Navigation Top",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n  <v-container fluid class=\"ma-0 pa-0\">\n    <v-row \n      align=\"center\" \n      class=\"px-2 py-0\" \n      no-gutters\n    >\n      \n      <v-col cols=\"3\" class=\"py-0 d-flex justify-start\">\n        <v-btn\n          to=\"segmentation\"\n          color=\"primary\"\n          rounded=\"lg\"\n          class=\"px-4\" variant=\"text\" size=\"large\"\n        >\n          <v-icon start>mdi-chevron-left</v-icon>\n          Segmentation\n        </v-btn>\n      </v-col>\n\n      <v-col cols=\"6\" class=\"text-center py-0\">\n        <h1 class=\"text-h5 font-weight-bold text-primary my-0 text-truncate\">\n          Visualization\n        </h1>\n      </v-col>\n\n      <v-col cols=\"3\" class=\"py-0 d-flex justify-end\">\n      </v-col>\n      \n    </v-row>\n  </v-container>\n</template>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 1300,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "164baa371893de7a",
        "type": "list segmentations",
        "z": "14f8c9b5ce1235cc",
        "name": "",
        "x": 170,
        "y": 180,
        "wires": [
            [
                "18a10804663dbaa1"
            ]
        ]
    },
    {
        "id": "18a10804663dbaa1",
        "type": "function",
        "z": "14f8c9b5ce1235cc",
        "name": "Insert export column",
        "func": "msg.payload = msg.payload.map(item => {\n    // extraction de l'acquisition_id\n    const acq = item.acquisition_id;   // ex: \"A_2\"\n\n    // cration du chemin export\n    item.export = `/ps/data/browse/api/raw/export/ecotaxa/ecotaxa_${acq}.zip`;\n\n    return item;\n});\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 180,
        "wires": [
            [
                "92e2ed9f115c3991"
            ]
        ]
    },
    {
        "id": "5ec998719a884cfe",
        "type": "file in",
        "z": "14f8c9b5ce1235cc",
        "name": "",
        "filename": "payload.path",
        "filenameType": "msg",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 180,
        "y": 380,
        "wires": [
            [
                "4caf5c846b3b9d01",
                "a5ef1df890e7bb36",
                "8cdf3c5527b9cb21",
                "e26832811411f850",
                "448a5c6830c6514f",
                "ac9d555964747130",
                "11323481847790c0",
                "8425012e07c3700f",
                "512e86195d14e773",
                "9be1cc713ac79a7b",
                "63ce87d36ae8f172",
                "9abf70a949e76eaf",
                "bdf84e9e1e0caa90"
            ]
        ]
    },
    {
        "id": "aefbf6f96248c398",
        "type": "function",
        "z": "14f8c9b5ce1235cc",
        "name": "Get tsv path",
        "func": "// 1. On s'assure que le path existe\nif (msg.payload.path) {\n    \n    // 2. On rcupre le path actuel\n    // ex: \"/home/pi/data/objects/2025-11-19/S_1/A_2\"\n    const currentPath = msg.payload.path;\n\n    // 3. On extrait l'identifiant (le dernier lment aprs le /)\n    // Si le path finit par un /, on le retire d'abord pour viter un ID vide\n    const cleanPath = currentPath.endsWith('/') ? currentPath.slice(0, -1) : currentPath;\n    const acqId = cleanPath.split('/').pop(); \n\n    // 4. On modifie le path dans l'objet\n    // Rsultat: .../A_2/ecotaxa_A_2.tsv\n    msg.payload.path = `${cleanPath}/ecotaxa_${acqId}.tsv`;\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 790,
        "y": 180,
        "wires": [
            [
                "d77ed8081a657507",
                "384aa9ab83bfe566"
            ]
        ]
    },
    {
        "id": "4244d2ed880cca66",
        "type": "ui-template",
        "z": "14f8c9b5ce1235cc",
        "group": "0c1537ce71affc2b",
        "page": "",
        "ui": "",
        "name": "Gallery",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n    <v-row class=\"pa-4\" align=\"center\" justify=\"space-between\" dense>\n        <v-col cols=\"12\" sm=\"6\" md=\"4\" lg=\"3\">\n            <div class=\"d-flex flex-column\">\n                <div class=\"d-flex align-center gap-2\">\n                    <v-icon icon=\"mdi-magnify-minus-outline\" size=\"small\" color=\"grey\"></v-icon>\n                    <v-slider\n                        v-model=\"zoom\"\n                        min=\"0.1\"\n                        max=\"3\"\n                        step=\"0.1\"\n                        density=\"compact\"\n                        hide-details\n                        thumb-label\n                        color=\"primary\"\n                        class=\"flex-grow-1 mx-2\"\n                    ></v-slider>\n                    <v-icon icon=\"mdi-magnify-plus-outline\" size=\"small\" color=\"grey\"></v-icon>\n                </div>\n                <div class=\"text-caption text-center text-grey mt-n1\">\n                    Zoom x{{ zoom.toFixed(1) }}\n                </div>\n            </div>\n        </v-col>\n\n        <v-col cols=\"12\" sm=\"6\" md=\"4\" lg=\"3\">\n            <v-select\n                v-model=\"sortBy\"\n                :items=\"sortOptions\"\n                label=\"Sort By\"\n                density=\"compact\"\n                hide-details\n                variant=\"outlined\"\n                prepend-inner-icon=\"mdi-sort\"\n                bg-color=\"white\"\n            ></v-select>\n        </v-col>\n\n        <v-col cols=\"6\" sm=\"6\" md=\"2\" lg=\"2\">\n            <v-select\n                v-model=\"itemsPerPage\"\n                :items=\"[12, 24, 48, 100]\"\n                label=\"Per Page\"\n                density=\"compact\"\n                hide-details\n                variant=\"outlined\"\n                bg-color=\"white\"\n            ></v-select>\n        </v-col>\n\n        <v-col cols=\"6\" sm=\"6\" md=\"2\" lg=\"2\" class=\"d-flex justify-end align-center\">\n            <v-chip size=\"small\" color=\"primary\" variant=\"tonal\" class=\"font-weight-bold\">\n                Total: {{ filteredItems.length }}\n            </v-chip>\n        </v-col>\n    </v-row>\n\n\n    <div class=\"gallery-scroll-area flex-grow-1\">\n\n        <div v-if=\"loading\" class=\"gallery-skeleton\">\n            <div v-for=\"n in 12\" :key=\"n\" class=\"skeleton-box\"></div>\n        </div>\n\n        <div v-else class=\"gallery-grid\">\n            <div \n                v-for=\"item in paginatedItems\" \n                :key=\"item.id\" \n                class=\"gallery-item-wrapper\"\n            >\n                <v-card \n                    class=\"gallery-card\" \n                    hover \n                    variant=\"outlined\" \n                    @click=\"openDetails(item)\"\n                    style=\"border-color: #e0e0e0;\"\n                >\n                    <div\n                        class=\"img-container\"\n                        :style=\"{ \n                            width: (Math.max(item.object_width * zoom, 40)) + 'px',\n                            height: (Math.max(item.object_height * zoom, 40)) + 'px',\n                            backgroundColor: '#f5f5f5'\n                        }\"\n                    >\n                        <img \n                            :src=\"item.url\" \n                            :style=\"{\n                                width: (item.object_width * zoom) + 'px',\n                                height: (item.object_height * zoom) + 'px',\n                                objectFit: 'contain',\n                                imageRendering: 'pixelated'\n                            }\"\n                        />\n\n                        <div \n                            class=\"mini-scale-bar\" \n                            :style=\"{ width: getScaleBar(item, 'px').width + 'px' }\"\n                        ></div>\n                        <div class=\"mini-scale-text\">\n                            {{ getScaleBar(item, 'px').label }}\n                        </div>\n                    </div>\n\n                    <v-divider />\n\n                    <div class=\"d-flex justify-center pa-0 bg-white\">\n                        <v-btn \n                            icon=\"mdi-download\"\n                            size=\"x-small\"\n                            variant=\"text\"\n                            color=\"grey-darken-1\"\n                            @click.stop=\"downloadImage(item.url, item.id)\"\n                        />\n                        <v-btn \n                            icon=\"mdi-eye\"\n                            size=\"x-small\"\n                            variant=\"text\"\n                            color=\"primary\"\n                            @click.stop=\"openDetails(item)\"\n                        />\n                    </div>\n                </v-card>\n            </div>\n\n            <div v-if=\"filteredItems.length === 0\" class=\"text-center w-100 mt-10 text-grey\">\n                No objects found.\n            </div>\n        </div>\n    </div>\n\n\n    <div class=\"text-center pt-2 flex-grow-0\" v-if=\"!loading\">\n        <v-pagination\n            v-model=\"page\"\n            :length=\"totalPages\"\n            :total-visible=\"7\"\n            density=\"compact\"\n            rounded=\"circle\"\n            color=\"primary\"\n        />\n    </div>\n\n\n    <v-dialog v-model=\"detailsDialog\" max-width=\"600\">\n        <v-card v-if=\"selectedItem\">\n\n            <v-toolbar color=\"primary\" density=\"compact\">\n                <v-toolbar-title class=\"text-subtitle-1\">Object Details</v-toolbar-title>\n                <v-btn icon=\"mdi-close\" @click=\"detailsDialog = false\" />\n            </v-toolbar>\n\n            <v-card-text class=\"pa-4\">\n                <v-row>\n                    <v-col cols=\"12\" class=\"text-center bg-grey-lighten-4 pa-4 rounded\">\n                        \n                        <div style=\"position: relative; display: inline-block;\">\n                            \n                            <img :src=\"selectedItem.url\"\n                                 style=\"max-width:100%; max-height:400px; image-rendering:pixelated; display:block;\" />\n                            \n                            <div \n                                class=\"modal-scale-bar\"\n                                :style=\"{ width: getScaleBar(selectedItem, '%').width + '%' }\"\n                            ></div>\n                            <div class=\"modal-scale-text\">\n                                {{ getScaleBar(selectedItem, '%').label }}\n                            </div>\n\n                        </div>\n\n                        <div class=\"d-flex justify-space-between mt-2 px-2 text-caption text-grey\">\n                            <span>ID: {{ selectedItem.id }}</span>\n                        </div>\n                    </v-col>\n\n                    <v-col cols=\"12\">\n                        <v-table density=\"compact\">\n                            <thead>\n                                <tr><th>Metric</th><th class=\"text-right\">Value</th></tr>\n                            </thead>\n                            <tbody>\n                                <tr v-for=\"(value, key) in formatMeta(selectedItem)\" :key=\"key\">\n                                    <td>{{ formatKeyName(key) }}</td>\n                                    <td class=\"text-right font-weight-bold\">{{ value }}</td>\n                                </tr>\n                            </tbody>\n                        </v-table>\n                    </v-col>\n                </v-row>\n            </v-card-text>\n\n        </v-card>\n    </v-dialog>\n\n</template>\n\n\n<script>\nexport default {\n    data() {\n        return {\n            rawData: [],\n            meta: { resolution: 1 },\n            keys: [],\n            zoom: 0.5,\n            page: 1,\n            itemsPerPage: 24,\n            sortBy: 'object_area',\n            loading: true,\n            detailsDialog: false,\n            selectedItem: null,\n            sortOptions: [\n                { title: 'Area (Largest)', value: 'object_area' },\n                { title: 'Width', value: 'object_width' },\n                { title: 'Height', value: 'object_height' },\n                { title: 'Hue', value: 'object_MeanHue' },\n                { title: 'Elongation', value: 'object_elongation' }\n            ]\n        }\n    },\n\n    computed: {\n        filteredItems() {\n            if (!this.rawData) return [];\n            let arr = [...this.rawData];\n            arr.sort((a, b) => b[this.sortBy] - a[this.sortBy]);\n            return arr;\n        },\n        totalPages() {\n            return Math.ceil(this.filteredItems.length / this.itemsPerPage);\n        },\n        paginatedItems() {\n            const start = (this.page - 1) * this.itemsPerPage;\n            return this.filteredItems.slice(start, start + this.itemsPerPage);\n        }\n    },\n\n    watch: {\n        msg: {\n            deep: true,\n            handler(m) {\n                if (!m || !m.payload) return;\n                if (m.payload.meta) this.meta = m.payload.meta;\n                const dataArray = m.payload.data || [];\n                if (dataArray.length === 0) {\n                    if (m.payload.data) {\n                        this.loading = true;\n                        this.rawData = [];\n                        this.page = 1;\n                    }\n                    return;\n                }\n                this.rawData = dataArray;\n                this.keys = m.payload.keys || [];\n                this.page = 1;\n                this.loading = false;\n            }\n        }\n    },\n\n    methods: {\n        openDetails(item) {\n            this.selectedItem = item;\n            this.detailsDialog = true;\n        },\n\n        /**\n         * Calculate Scale Bar.\n         * mode = 'px' -> returns absolute pixels (multiplied by zoom) for thumbnails\n         * mode = '%'  -> returns percentage of image width for the modal\n         */\n        getScaleBar(item, mode = 'px') {\n            const res = this.meta.resolution || 1; // microns per pixel\n            const pxWidth = item.object_width || 100; // raw image width in px\n            const realWidthMicrons = pxWidth * res; // real physical width\n\n            // 1. Target bar size: roughly 30% of the image\n            let target = realWidthMicrons * 0.3;\n            if (target <= 0) target = 10;\n\n            // 2. Snap to nearest nice number (1, 2, 5 series)\n            const magnitude = Math.pow(10, Math.floor(Math.log10(target)));\n            const residual = target / magnitude;\n            let niceScalar = 1;\n            if (residual > 5) niceScalar = 10;\n            else if (residual > 2) niceScalar = 5;\n            else niceScalar = 2;\n            const finalMicrons = niceScalar * magnitude; // e.g. 50, 100, 200\n\n            // 3. Return Logic\n            if (mode === 'px') {\n                // For thumbnails: scale by resolution AND gallery zoom\n                const finalPixels = (finalMicrons / res) * this.zoom;\n                return { width: finalPixels, label: `${finalMicrons} m` };\n            } else {\n                // For Modal: Calculate Percentage of the total image width\n                // (Bar Microns / Total Image Microns) * 100\n                const percent = (finalMicrons / realWidthMicrons) * 100;\n                return { width: percent, label: `${finalMicrons} m` };\n            }\n        },\n\n        formatKeyName(k) {\n            return k.replace(/_/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase());\n        },\n\n        formatMeta(item) {\n            const out = {};\n            for (let k of this.keys) {\n                if (k === \"url\" || k === \"id\") continue;\n                let v = item[k];\n                if (typeof v === \"number\") v = v.toFixed(2);\n                let unit = \"\";\n                const KL = k.toLowerCase();\n                if (KL.includes(\"area\")) unit = \" px\";\n                else if (KL.includes(\"width\") || KL.includes(\"height\")) unit = \" px\";\n                else if (KL.includes(\"hue\")) unit = \"\";\n                out[k.replace(\"object_\", \"\")] = v + unit;\n            }\n            return out;\n        },\n\n        downloadImage(url, id) {\n            const a = document.createElement(\"a\");\n            a.href = url;\n            a.download = `object_${id}.jpg`;\n            document.body.appendChild(a);\n            a.click();\n            document.body.removeChild(a);\n        }\n    }\n}\n</script>\n\n\n<style scoped>\n/* GALLERY GRID */\n.gallery-scroll-area {\n    overflow-y: auto;\n    border-radius: 4px;\n    border: 1px solid #eee;\n    padding: 16px;\n}\n.gallery-grid {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 12px;\n    justify-content: center;\n    align-items: flex-end;\n}\n\n/* SKELETON LOADER */\n.gallery-skeleton {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 12px;\n    justify-content: center;\n}\n.skeleton-box {\n    width: 120px;\n    height: 120px;\n    border-radius: 6px;\n    background: linear-gradient(90deg, #e0e0e0, #f5f5f5, #e0e0e0);\n    background-size: 200% 100%;\n    animation: sk 1.2s infinite;\n}\n@keyframes sk {\n    0% { background-position:200% 0; }\n    100% { background-position:-200% 0; }\n}\n\n.gallery-item-wrapper { display: flex; flex-direction: column; align-items: center; }\n.gallery-card { transition: transform 0.2s; cursor: pointer; }\n.gallery-card:hover { transform: translateY(-2px); border-color: #1976D2 !important; }\n.img-container { position: relative; display: flex; align-items: center; justify-content: center; overflow: hidden; }\n\n/* --- THUMBNAIL SCALE BAR --- */\n.mini-scale-bar {\n    position:absolute; bottom:2px; right:2px;\n    height:3px; \n    background: rgba(255,255,255,0);\n    border: 2px solid #333;\n    border-top: none; /* U-shape style */\n    box-shadow: 0 2px 4px rgba(0,0,0,0.3);\n}\n.mini-scale-text {\n    position:absolute; bottom:6px; right:2px;\n    font-size: 10px; \n    font-weight: bold;\n    color: #333; \n    text-shadow: 2px 0 0 #fff, -2px 0 0 #fff, 0 2px 0 #fff, 0 -2px 0 #fff, 1px 1px #fff, -1px -1px #fff, 1px -1px #fff, -1px 1px #fff;\n    pointer-events: none;\n    width: 100%;\n    text-align: right;\n    padding-right: 2px;\n}\n\n/* --- MODAL SCALE BAR (NEW) --- */\n.modal-scale-bar {\n    position:absolute; \n    bottom: 10px; \n    right: 10px;\n    height: 6px; \n    background: rgba(255,255,255,0); \n    border: 2px solid #333;\n    border-top: none; /* U-shape style */\n    box-shadow: 0 2px 4px rgba(0,0,0,0.3);\n}\n.modal-scale-text {\n    position:absolute; \n    bottom: 18px; \n    right: 10px;\n    font-size: 14px; \n    font-weight: bold;\n    color: #333; \n    text-shadow: 2px 0 0 #fff, -2px 0 0 #fff, 0 2px 0 #fff, 0 -2px 0 #fff, 1px 1px #fff, -1px -1px #fff, 1px -1px #fff, -1px 1px #fff;\n    pointer-events: none;\n    width: 100%;\n    text-align: right;\n    padding-right: 2px;\n}\n</style>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 820,
        "y": 960,
        "wires": [
            []
        ]
    },
    {
        "id": "92e2ed9f115c3991",
        "type": "ui-template",
        "z": "14f8c9b5ce1235cc",
        "group": "fa6393a7d7e3b7d7",
        "page": "",
        "ui": "",
        "name": "List of Segmentation",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n\n        <v-data-table\n            :headers=\"headers\"\n            :items=\"items\"\n            :search=\"search\"\n            item-value=\"acquisition_id\"\n            density=\"compact\"\n            class=\"elevation-1\"\n        >\n            <template v-slot:item.image_acquired_count=\"{ item }\">\n                <v-chip size=\"small\" color=\"primary\" variant=\"tonal\">\n                    {{ item.image_acquired_count }}\n                </v-chip>\n            </template>\n\n            <template v-slot:item.links=\"{ item }\">\n                \n                <v-tooltip text=\"View Gallery\" location=\"top\">\n                    <template v-slot:activator=\"{ props }\">\n                        <v-btn \n                            icon=\"mdi-image-multiple\" \n                            variant=\"text\" \n                            size=\"small\" \n                            color=\"blue-darken-2\" \n                            :href=\"item.gallery\" \n                            target=\"_blank\"\n                            v-bind=\"props\"\n                        ></v-btn>\n                    </template>\n                </v-tooltip>\n\n                <v-tooltip text=\"Download Zip\" location=\"top\">\n                    <template v-slot:activator=\"{ props }\">\n                        <v-btn \n                            icon=\"mdi-download\" \n                            variant=\"text\" \n                            size=\"small\" \n                            color=\"orange-darken-2\" \n                            :href=\"item.export\" \n                            v-bind=\"props\"\n                        ></v-btn>\n                    </template>\n                </v-tooltip>\n            </template>\n\n            <template v-slot:item.actions=\"{ item }\">\n                        <v-btn \n                            icon=\"mdi-chart-scatter-plot-hexbin\" \n                            variant=\"text\" \n                            size=\"small\" \n                            color=\"primary\" \n                            @click=\"selectAcquisition(item)\"\n                        ></v-btn>\n            </template>\n        </v-data-table>\n</template>\n\n<script>\n    export default {\n        data() { \n            return {\n                search: '',\n                items: [],\n                headers: [\n                    { title: 'Project', key: 'project_name', sortable: true },\n                    { title: 'Sample ID', key: 'sample_id', sortable: true },\n                    { title: 'Acquisition ID', key: 'acquisition_id', sortable: true },\n                    { title: 'Images', key: 'image_acquired_count', sortable: true, align: 'end' },\n                    { title: 'Resources', key: 'links', sortable: false, align: 'center' }, // New Column\n                    { title: 'Select', key: 'actions', sortable: false, align: 'end' },\n                ]\n            }\n        },\n        watch: {\n            msg: {\n                handler(newValue) {\n                    if (newValue && Array.isArray(newValue.payload)) {\n                        this.items = newValue.payload;\n                    }\n                },\n                deep: true\n            }\n        },\n        mounted() {\n            if (this.msg && Array.isArray(this.msg.payload)) {\n                this.items = this.msg.payload;\n            }\n        },\n        methods: {\n            selectAcquisition(item) {\n                this.send({\n                    topic: \"selected_acquisition\",\n                    payload: item\n                });\n            }\n        }\n    }\n</script>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 600,
        "y": 180,
        "wires": [
            [
                "aefbf6f96248c398"
            ]
        ]
    },
    {
        "id": "2ca2f83cc939607f",
        "type": "ui-template",
        "z": "14f8c9b5ce1235cc",
        "group": "53490f9c39e2065d",
        "page": "",
        "ui": "",
        "name": "Infos",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n  <div>\n\n    <!-- SKELETON WHEN LOADING OR CLEARED -->\n    <div v-if=\"loading\" class=\"ps-skeleton\" style=\"height:90px; margin-bottom:12px;\"></div>\n\n    <!-- INVITE MESSAGE -->\n    <div\n      v-else-if=\"!meta.sample_id\"\n      style=\"\n        border-left:4px solid #1976d2;\n        background:#e3f2fd;\n        padding:12px;\n        border-radius:6px;\n        margin-bottom:12px;\n        color:#0d47a1;\n        font-size:14px;\n        display:flex;\n        align-items:center;\n        gap:8px;\n      \"\n    >\n      <v-icon color=\"primary\">mdi-information-outline</v-icon>\n      Select a dataset in the table above to display its information.\n    </div>\n\n    <!-- SAMPLE INFO -->\n    <v-row v-else align=\"center\">\n\n      <v-col cols=\"12\" md=\"9\" class=\"border-right\">\n        <div class=\"caption grey--text text-uppercase font-weight-bold mb-1\">\n          Sample Identity\n        </div>\n\n        <div class=\"text-h4 primary--text font-weight-bold\">\n          {{ meta.sample_id }}\n        </div>\n\n        <div class=\"subtitle-1 grey--text text--darken-3 mt-1\">\n          <strong>Project:</strong> {{ meta.project || '--' }}<br>\n          <span class=\"caption\">Acq ID: {{ meta.acq_id || '--' }}</span>\n        </div>\n      </v-col>\n\n      <v-col cols=\"12\" md=\"3\" class=\"text-right\">\n        <a\n          :href=\"downloadUrl\"\n          target=\"_blank\"\n          :style=\"{\n            display:'inline-flex',\n            alignItems:'center',\n            gap:'6px',\n            padding:'10px 16px',\n            background: meta.sample_id ? '#1976d2' : '#90caf9',\n            color:'white',\n            borderRadius:'6px',\n            textDecoration:'none',\n            cursor: meta.sample_id ? 'pointer' : 'not-allowed'\n          }\"\n        >\n          <v-icon left>mdi-download</v-icon>\n          Download EcoTaxa .zip\n        </a>\n      </v-col>\n\n    </v-row>\n  </div>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      loading: true,\n      meta: {\n        sample_id: '',\n        project: '',\n        acq_id: ''\n      }\n    }\n  },\n\n  watch: {\n    msg: {\n      immediate: true,\n      deep: true,\n      handler(val) {\n\n        // --- CLEARING ---\n        if (!val?.payload?.meta || !val.payload.meta.sample_id) {\n          this.loading = false;\n          this.meta = {\n            sample_id: '',\n            project: '',\n            acq_id: ''\n          };\n          return;\n        }\n\n        // --- NORMAL UPDATE ---\n        this.loading = false;\n        this.meta = val.payload.meta;\n      }\n    }\n  },\n\n  computed: {\n    downloadUrl() {\n      if (!this.meta.sample_id) return '#';\n      return `/ps/data/browse/api/raw/export/ecotaxa/ecotaxa_${this.meta.sample_id}.zip`;\n    }\n  }\n}\n</script>\n\n<style>\n/* Skeleton loader consistent with other widgets */\n\n.ps-skeleton {\n  width: 100%;\n  border-radius: 6px;\n  background: linear-gradient(90deg, #e0e0e0, #f5f5f5, #e0e0e0);\n  background-size: 200% 100%;\n  animation: psSkeletonAnim 1.2s infinite;\n}\n\n@keyframes psSkeletonAnim {\n  0% { background-position: 200% 0; }\n  100% { background-position: -200% 0; }\n}\n</style>\n",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 810,
        "y": 440,
        "wires": [
            []
        ]
    },
    {
        "id": "4caf5c846b3b9d01",
        "type": "function",
        "z": "14f8c9b5ce1235cc",
        "name": "HEATMAP (object_x, object_y)",
        "func": "// Heatmap  Flowcell distribution\n\nconst lines = msg.payload.toString().trim().split(/\\r?\\n/);\nif (lines.length < 2) return null;\n\nconst headers = lines[0].split(\"\\t\");\nconst val = (row, col) => {\n  const idx = headers.indexOf(col);\n  return idx >= 0 ? row[idx] : null;\n};\n\n// Meta from first valid row\nlet firstRow = null;\nfor (let i = 1; i < lines.length; i++) {\n  if (!lines[i].trim().startsWith(\"[\")) {\n    firstRow = lines[i].split(\"\\t\");\n    break;\n  }\n}\nif (!firstRow) return null;\n\nconst meta = {\n  sample_id: val(firstRow, \"sample_id\") || \"\",\n  project: val(firstRow, \"sample_project\") || \"\",\n  acq_id: val(firstRow, \"acq_id\") || \"\"\n};\n\n// Data: x/y for heatmap\nconst data = lines.slice(1)\n  .filter(l => !l.trim().startsWith(\"[\"))\n  .map(l => {\n    const r = l.split(\"\\t\");\n    return {\n      x: parseFloat(val(r, \"object_x\")),\n      y: parseFloat(val(r, \"object_y\"))\n    };\n  });\n\nmsg.payload = { meta, data };\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 510,
        "y": 500,
        "wires": [
            [
                "0c90eb450c8d9b01"
            ]
        ]
    },
    {
        "id": "a5ef1df890e7bb36",
        "type": "function",
        "z": "14f8c9b5ce1235cc",
        "name": "ESD Histogram (object_equivalent_diameter)",
        "func": "// ESD Size Spectrum  TSV  {meta, data[{d}]}\n\nconst lines = msg.payload.toString().trim().split(/\\r?\\n/);\nif (lines.length < 2) return null;\n\nconst headers = lines[0].split(\"\\t\");\nconst val = (row, col) => {\n  const idx = headers.indexOf(col);\n  return idx >= 0 ? row[idx] : null;\n};\n\nlet firstRow = null;\nfor (let i = 1; i < lines.length; i++) {\n  if (!lines[i].startsWith(\"[\")) {\n    firstRow = lines[i].split(\"\\t\");\n    break;\n  }\n}\nconst meta = {\n  sample_id: firstRow ? (val(firstRow, \"sample_id\") || \"\") : \"\"\n};\n\nconst data = lines.slice(1)\n  .filter(l => !l.startsWith(\"[\"))\n  .map(l => {\n    const r = l.split(\"\\t\");\n    return {\n      d: parseFloat(val(r, \"object_equivalent_diameter\"))\n    };\n  });\n\nmsg.payload = { meta, data };\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 540,
        "wires": [
            [
                "0a559ab05af2548e"
            ]
        ]
    },
    {
        "id": "8cdf3c5527b9cb21",
        "type": "function",
        "z": "14f8c9b5ce1235cc",
        "name": "TIMELINE (sequence index + area)",
        "func": "// Timeline  seq index vs object_area\n\nconst lines = msg.payload.toString().trim().split(/\\r?\\n/);\nif (lines.length < 2) return null;\n\nconst headers = lines[0].split(\"\\t\");\nconst val = (row, col) => {\n  const idx = headers.indexOf(col);\n  return idx >= 0 ? row[idx] : null;\n};\n\nlet seq = 0;\nconst data = lines.slice(1)\n  .filter(l => !l.startsWith(\"[\"))\n  .map(l => {\n    const r = l.split(\"\\t\");\n    return {\n      seq: seq++,\n      area: parseFloat(val(r, \"object_area\"))\n    };\n  });\n\nmsg.payload = { data };\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 520,
        "y": 580,
        "wires": [
            [
                "7b9d103ec5981051"
            ]
        ]
    },
    {
        "id": "e26832811411f850",
        "type": "function",
        "z": "14f8c9b5ce1235cc",
        "name": "COLORSPACE (Saturation vs Value)",
        "func": "// Colorspace  MeanSaturation vs MeanValue\n\nconst lines = msg.payload.toString().trim().split(/\\r?\\n/);\nif (lines.length < 2) return null;\n\nconst headers = lines[0].split(\"\\t\");\nconst val = (row, col) => {\n  const idx = headers.indexOf(col);\n  return idx >= 0 ? row[idx] : null;\n};\n\nconst data = lines.slice(1)\n  .filter(l => !l.startsWith(\"[\"))\n  .map(l => {\n    const r = l.split(\"\\t\");\n    return {\n      s: parseFloat(val(r, \"object_MeanSaturation\")),\n      v: parseFloat(val(r, \"object_MeanValue\"))\n    };\n  });\n\nmsg.payload = { data };\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 620,
        "wires": [
            [
                "23a78a078fa1eca8"
            ]
        ]
    },
    {
        "id": "448a5c6830c6514f",
        "type": "function",
        "z": "14f8c9b5ce1235cc",
        "name": "ASPECT (Width vs Height)",
        "func": "// Aspect  width vs height\n\nconst lines = msg.payload.toString().trim().split(/\\r?\\n/);\nif (lines.length < 2) return null;\n\nconst headers = lines[0].split(\"\\t\");\nconst val = (row, col) => {\n  const idx = headers.indexOf(col);\n  return idx >= 0 ? row[idx] : null;\n};\n\nconst data = lines.slice(1)\n  .filter(l => !l.startsWith(\"[\"))\n  .map(l => {\n    const r = l.split(\"\\t\");\n    return {\n      w: parseFloat(val(r, \"object_width\")),\n      h: parseFloat(val(r, \"object_height\"))\n    };\n  });\n\nmsg.payload = { data };\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 660,
        "wires": [
            [
                "09f4914fc0a54566"
            ]
        ]
    },
    {
        "id": "ac9d555964747130",
        "type": "function",
        "z": "14f8c9b5ce1235cc",
        "name": "GREENNESS (custom index + circularity)",
        "func": "// Greenness vs Circularity  custom_greenness + object_circ.\n\nconst lines = msg.payload.toString().trim().split(/\\r?\\n/);\nif (lines.length < 2) return null;\n\nconst headers = lines[0].split(\"\\t\");\nconst val = (row, col) => {\n  const idx = headers.indexOf(col);\n  return idx >= 0 ? row[idx] : null;\n};\n\nconst data = lines.slice(1)\n  .filter(l => !l.startsWith(\"[\"))\n  .map(l => {\n    const r = l.split(\"\\t\");\n    const hue = parseFloat(val(r, \"object_MeanHue\")) || 0;\n    const circ = parseFloat(val(r, \"object_circ.\")) || 0;\n    const greenDist = Math.abs(hue - 80);\n    const g = Math.max(0, 100 - greenDist);\n    return { g, circ };\n  });\n\nmsg.payload = { data };\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 540,
        "y": 700,
        "wires": [
            [
                "7f4d047a4c73eb61"
            ]
        ]
    },
    {
        "id": "11323481847790c0",
        "type": "function",
        "z": "14f8c9b5ce1235cc",
        "name": "COMPLEXITY (Area vs Perimeter)",
        "func": "// Complexity  Area vs Perimeter\n\nconst lines = msg.payload.toString().trim().split(/\\r?\\n/);\nif (lines.length < 2) return null;\n\nconst headers = lines[0].split(\"\\t\");\nconst val = (row, col) => {\n  const idx = headers.indexOf(col);\n  return idx >= 0 ? row[idx] : null;\n};\n\nconst data = lines.slice(1)\n  .filter(l => !l.startsWith(\"[\"))\n  .map(l => {\n    const r = l.split(\"\\t\");\n    return {\n      area: parseFloat(val(r, \"object_area\")),\n      per: parseFloat(val(r, \"object_perim.\"))\n    };\n  });\n\nmsg.payload = { data };\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 520,
        "y": 740,
        "wires": [
            [
                "a7c8654291022da1"
            ]
        ]
    },
    {
        "id": "8425012e07c3700f",
        "type": "function",
        "z": "14f8c9b5ce1235cc",
        "name": "TEXTURE (Area vs StdValue)",
        "func": "// Texture  Area vs StdValue\n\nconst lines = msg.payload.toString().trim().split(/\\r?\\n/);\nif (lines.length < 2) return null;\n\nconst headers = lines[0].split(\"\\t\");\nconst val = (row, col) => {\n  const idx = headers.indexOf(col);\n  return idx >= 0 ? row[idx] : null;\n};\n\nconst data = lines.slice(1)\n  .filter(l => !l.startsWith(\"[\"))\n  .map(l => {\n    const r = l.split(\"\\t\");\n    return {\n      area: parseFloat(val(r, \"object_area\")),\n      std: parseFloat(val(r, \"object_StdValue\"))\n    };\n  });\n\nmsg.payload = { data };\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 780,
        "wires": [
            [
                "ed9d6e31cc3a01b1"
            ]
        ]
    },
    {
        "id": "512e86195d14e773",
        "type": "function",
        "z": "14f8c9b5ce1235cc",
        "name": "SOLIDITY (Histogram)",
        "func": "// Solidity  histogram of object_solidity\n\nconst lines = msg.payload.toString().trim().split(/\\r?\\n/);\nif (lines.length < 2) return null;\n\nconst headers = lines[0].split(\"\\t\");\nconst val = (row, col) => {\n    const idx = headers.indexOf(col);\n    return idx >= 0 ? row[idx] : null;\n};\n\nconst data = lines.slice(1)\n    .filter(l => !l.startsWith(\"[\"))\n    .map(l => {\n        const r = l.split(\"\\t\");\n        return {\n            sol: parseFloat(val(r, \"object_solidity\"))\n        };\n    });\n\nmsg.payload = { data };\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 480,
        "y": 820,
        "wires": [
            [
                "c15ef66d7e115bd3"
            ]
        ]
    },
    {
        "id": "0c90eb450c8d9b01",
        "type": "ui-template",
        "z": "14f8c9b5ce1235cc",
        "group": "90b33e458dd29d04",
        "page": "",
        "ui": "",
        "name": "Heatmap",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n  <div style=\"width:100%; height:300px; position:relative;\">\n    <div v-if=\"loading\" class=\"ps-skeleton\"></div>\n    <div v-show=\"!loading\" ref=\"plot\" style=\"width:100%; height:100%;\"></div>\n  </div>\n</template>\n\n<style>\n.ps-skeleton {\n  width:100%;\n  height:100%;\n  background:linear-gradient(90deg,#e0e0e0 0%,#f5f5f5 50%,#e0e0e0 100%);\n  background-size:200% 100%;\n  animation:psk 1.2s infinite;\n  border-radius:6px;\n}\n@keyframes psk {\n  0% { background-position:200% 0; }\n  100% { background-position:-200% 0; }\n}\n</style>\n\n<script>\nexport default {\n  data(){ return { loading:true, points:[] } },\n\n  watch:{\n    msg:{\n      immediate:true, deep:true,\n      handler(m){\n        if(!m?.payload) return;\n\n        if (Array.isArray(m.payload.data) && m.payload.data.length === 0){\n          this.loading = true;\n          this.points = [];\n          if(this.$refs.plot && window.Plotly) window.Plotly.purge(this.$refs.plot);\n          return;\n        }\n\n        this.points = m.payload.data || [];\n        this.loading = this.points.length === 0;\n        this.$nextTick(()=>this.draw());\n      }\n    }\n  },\n\n  mounted(){\n    if(!window.Plotly){\n      const s=document.createElement(\"script\");\n      s.src=\"https://cdn.plot.ly/plotly-2.27.0.min.js\";\n      s.onload=()=>this.draw();\n      document.head.appendChild(s);\n    } else this.draw();\n  },\n\n  methods:{\n    draw(){\n      if(!window.Plotly) return;\n      const el=this.$refs.plot;\n      if(!el) return;\n\n      if(!this.points.length){\n        this.loading=true;\n        window.Plotly.purge(el);\n        return;\n      }\n\n      this.loading=false;\n\n      const trace={\n        x:this.points.map(p=>p.x),\n        y:this.points.map(p=>p.y),\n        type:'histogram2d',\n        colorscale:'Plotly3',\n        nbinsx:100,\n        nbinsy:80\n      };\n\n      const layout={\n        margin:{t:10,b:30,l:40,r:20},\n        xaxis:{title:\"X (px)\"},\n        yaxis:{title:\"Y (px)\",autorange:\"reversed\"},\n        hovermode:false,\n        plot_bgcolor:\"#eef3ff\"\n      };\n\n      window.Plotly.newPlot(el,[trace],layout,{responsive:true});\n    }\n  }\n};\n</script>\n",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 820,
        "y": 500,
        "wires": [
            []
        ]
    },
    {
        "id": "9be1cc713ac79a7b",
        "type": "function",
        "z": "14f8c9b5ce1235cc",
        "name": "Sample Identity Metadata Only",
        "func": "// FUNCTION: Extract minimal metadata for the Sample Identity panel\n\nconst lines = msg.payload.toString().trim().split(/\\r?\\n/);\nif (lines.length < 2) return null;\n\nconst headers = lines[0].split(\"\\t\");\nconst val = (row, col) => {\n    const idx = headers.indexOf(col);\n    return idx >= 0 ? row[idx] : null;\n};\n\n// --- 1. Find first data row (skip [f] / [t] metadata-like lines) ---\nlet firstRow = null;\nfor (let i = 1; i < lines.length; i++) {\n    if (!lines[i].trim().startsWith(\"[\")) {\n        firstRow = lines[i].split(\"\\t\");\n        break;\n    }\n}\nif (!firstRow) return null;\n\n// --- 2. Extract minimal metadata ---\nconst meta = {\n    sample_id: val(firstRow, \"sample_id\") || \"\",\n    project: val(firstRow, \"sample_project\") || \"\",\n    acq_id: val(firstRow, \"acq_id\") || \"\"\n};\n\n// --- 3. Output ONLY the metadata ---\nmsg.payload = { meta };\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 510,
        "y": 440,
        "wires": [
            [
                "2ca2f83cc939607f"
            ]
        ]
    },
    {
        "id": "0a559ab05af2548e",
        "type": "ui-template",
        "z": "14f8c9b5ce1235cc",
        "group": "47800358cf7cee25",
        "page": "",
        "ui": "",
        "name": "ESD Histogram",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n  <div style=\"width:100%; height:300px; position:relative;\">\n    <div v-if=\"loading\" class=\"ps-skeleton\"></div>\n    <div v-show=\"!loading\" ref=\"plot\" style=\"width:100%; height:100%;\"></div>\n  </div>\n</template>\n\n<script>\nexport default {\n  data(){ return { loading:true, rows:[] } },\n\n  watch:{\n    msg:{\n      immediate:true, deep:true,\n      handler(m){\n        if(!m?.payload) return;\n\n        if(m.payload.data?.length===0){\n          this.loading=true;\n          this.rows=[];\n          if(this.$refs.plot&&window.Plotly) window.Plotly.purge(this.$refs.plot);\n          return;\n        }\n\n        this.rows = m.payload.data || [];\n        this.loading = this.rows.length===0;\n        this.$nextTick(()=>this.draw());\n      }\n    }\n  },\n\n  mounted(){\n    if(!window.Plotly){\n      const s=document.createElement(\"script\");\n      s.src=\"https://cdn.plot.ly/plotly-2.27.0.min.js\";\n      s.onload=()=>this.draw();\n      document.head.appendChild(s);\n    } else this.draw();\n  },\n\n  methods:{\n    draw(){\n      if(!window.Plotly) return;\n      const el=this.$refs.plot;\n\n      if(!this.rows.length){\n        this.loading=true;\n        window.Plotly.purge(el);\n        return;\n      }\n\n      this.loading=false;\n\n      const trace={\n        x:this.rows.map(r=>r.d),\n        type:\"histogram\",\n        marker:{color:\"teal\"}\n      };\n\n      const layout={\n        margin:{t:10,b:30,l:40,r:20},\n        xaxis:{title:\"ESD\"}\n      };\n\n      Plotly.newPlot(el,[trace],layout,{responsive:true});\n    }\n  }\n};\n</script>\n",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 840,
        "y": 540,
        "wires": [
            []
        ]
    },
    {
        "id": "7b9d103ec5981051",
        "type": "ui-template",
        "z": "14f8c9b5ce1235cc",
        "group": "1d9c6927a0e0a71b",
        "page": "",
        "ui": "",
        "name": "Timeline",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n  <div style=\"width:100%; height:250px; position:relative;\">\n    <div v-if=\"loading\" class=\"ps-skeleton\"></div>\n    <div v-show=\"!loading\" ref=\"plot\" style=\"width:100%; height:100%;\"></div>\n  </div>\n</template>\n\n<script>\nexport default {\n  data(){ return { loading:true, rows:[] } },\n\n  watch:{\n    msg:{\n      immediate:true, deep:true,\n      handler(m){\n        if(!m?.payload) return;\n\n        if(m.payload.data?.length===0){\n          this.loading=true;\n          this.rows=[];\n          if(this.$refs.plot&&window.Plotly) Plotly.purge(this.$refs.plot);\n          return;\n        }\n\n        this.rows = m.payload.data || [];\n        this.loading = this.rows.length===0;\n        this.$nextTick(()=>this.draw());\n      }\n    }\n  },\n\n  mounted(){\n    if(!window.Plotly){\n      const s=document.createElement(\"script\");\n      s.src=\"https://cdn.plot.ly/plotly-2.27.0.min.js\";\n      s.onload=()=>this.draw();\n      document.head.appendChild(s);\n    } else this.draw();\n  },\n\n  methods:{\n    draw(){\n      if(!window.Plotly) return;\n      const el=this.$refs.plot;\n\n      if(!this.rows.length){\n        this.loading=true;\n        Plotly.purge(el);\n        return;\n      }\n\n      this.loading=false;\n\n      const trace={\n        x:this.rows.map(r=>r.seq),\n        y:this.rows.map(r=>r.area),\n        mode:\"markers\",\n        type:\"scatter\",\n        marker:{size:10,color:\"blue\",opacity:0.5},\n        hoverinfo:\"none\"\n      };\n\n      const layout={\n        margin:{t:10,b:30,l:50,r:20},\n        xaxis:{title:\"Acq Sequence\"},\n        yaxis:{title:\"Area\"}\n      };\n\n      Plotly.newPlot(el,[trace],layout,{responsive:true});\n    }\n  }\n};\n</script>\n",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 820,
        "y": 580,
        "wires": [
            []
        ]
    },
    {
        "id": "23a78a078fa1eca8",
        "type": "ui-template",
        "z": "14f8c9b5ce1235cc",
        "group": "03ad1c8f517e8769",
        "page": "",
        "ui": "",
        "name": "Colorspace (Saturation vs Value)",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n  <div style=\"width:100%; height:250px; position:relative;\">\n    <div v-if=\"loading\" class=\"ps-skeleton\"></div>\n    <div v-show=\"!loading\" ref=\"plot\" style=\"width:100%; height:100%;\"></div>\n  </div>\n</template>\n\n<style>\n.ps-skeleton {\n  width:100%;\n  height:100%;\n  background:linear-gradient(90deg,#e0e0e0 0%,#f5f5f5 50%,#e0e0e0 100%);\n  background-size:200% 100%;\n  animation:psk 1.2s infinite;\n  border-radius:6px;\n}\n@keyframes psk {\n  0% {background-position:200% 0;}\n  100% {background-position:-200% 0;}\n}\n</style>\n\n<script>\nexport default {\n  data(){ return { loading:true, pts:[] } },\n\n  watch:{\n    msg:{ immediate:true, deep:true,\n      handler(m){\n        if(!m?.payload) return;\n\n        if(m.payload.data?.length===0){\n          this.loading=true;\n          this.pts=[];\n          if(this.$refs.plot && window.Plotly) Plotly.purge(this.$refs.plot);\n          return;\n        }\n\n        this.pts = m.payload.data || [];\n        this.loading = this.pts.length===0;\n        this.$nextTick(()=>this.draw());\n      }\n    }\n  },\n\n  mounted(){\n    if(!window.Plotly){\n      const s=document.createElement(\"script\");\n      s.src=\"https://cdn.plot.ly/plotly-2.27.0.min.js\";\n      s.onload=()=>this.draw();\n      document.head.appendChild(s);\n    } else this.draw();\n  },\n\n  methods:{\n    draw(){\n      if(!window.Plotly) return;\n      const el=this.$refs.plot;\n\n      if(!this.pts.length){ this.loading=true; Plotly.purge(el); return; }\n\n      this.loading=false;\n\n      const trace={\n        x:this.pts.map(p=>p.s),\n        y:this.pts.map(p=>p.v),\n        mode:\"markers\",\n        type:\"scatter\",\n        marker:{ size:10, color:\"magenta\", opacity:0.5 },\n        hoverinfo:\"none\"\n      };\n\n      const layout={\n        margin:{t:10,b:30,l:50,r:20},\n        xaxis:{title:\"Saturation\"},\n        yaxis:{title:\"Brightness\"}\n      };\n\n      Plotly.newPlot(el,[trace],layout,{responsive:true});\n    }\n  }\n}\n</script>\n",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 890,
        "y": 620,
        "wires": [
            []
        ]
    },
    {
        "id": "09f4914fc0a54566",
        "type": "ui-template",
        "z": "14f8c9b5ce1235cc",
        "group": "0be15f8190e6fd43",
        "page": "",
        "ui": "",
        "name": "Aspect (Width vs Height)",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n  <div style=\"width:100%; height:250px; position:relative;\">\n    <div v-if=\"loading\" class=\"ps-skeleton\"></div>\n    <div v-show=\"!loading\" ref=\"plot\" style=\"width:100%; height:100%;\"></div>\n  </div>\n</template>\n\n<style>\n.ps-skeleton {\n  width:100%;\n  height:100%;\n  background:linear-gradient(90deg,#e0e0e0,#f5f5f5,#e0e0e0);\n  background-size:200% 100%;\n  animation:psk 1.2s infinite;\n  border-radius:6px;\n}\n@keyframes psk {\n  0% {background-position:200% 0;}\n  100% {background-position:-200% 0;}\n}\n</style>\n\n<script>\nexport default {\n  data(){ return { loading:true, pts:[] } },\n\n  watch:{\n    msg:{ immediate:true, deep:true,\n      handler(m){\n        if(!m?.payload) return;\n\n        if(m.payload.data?.length===0){\n          this.loading=true;\n          this.pts=[];\n          if(this.$refs.plot&&window.Plotly) Plotly.purge(this.$refs.plot);\n          return;\n        }\n\n        this.pts = m.payload.data || [];\n        this.loading = this.pts.length===0;\n        this.$nextTick(()=>this.draw());\n      }\n    }\n  },\n\n  mounted(){\n    if(!window.Plotly){\n      const s=document.createElement(\"script\");\n      s.src=\"https://cdn.plot.ly/plotly-2.27.0.min.js\";\n      s.onload=()=>this.draw();\n      document.head.appendChild(s);\n    } else this.draw();\n  },\n\n  methods:{\n    draw(){\n      if(!window.Plotly) return;\n      const el=this.$refs.plot;\n\n      if(!this.pts.length){ this.loading=true; Plotly.purge(el); return; }\n\n      this.loading=false;\n\n      const trace={\n        x:this.pts.map(p=>p.w),\n        y:this.pts.map(p=>p.h),\n        mode:\"markers\",\n        type:\"scatter\",\n        marker:{ size:10, color:\"orange\", opacity:0.5 },\n        hoverinfo:\"none\"\n      };\n\n      const layout={\n        margin:{t:10,b:30,l:50,r:20},\n        xaxis:{title:\"Width\"},\n        yaxis:{title:\"Height\"}\n      };\n\n      Plotly.newPlot(el,[trace],layout,{responsive:true});\n    }\n  }\n}\n</script>\n",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 870,
        "y": 660,
        "wires": [
            []
        ]
    },
    {
        "id": "7f4d047a4c73eb61",
        "type": "ui-template",
        "z": "14f8c9b5ce1235cc",
        "group": "1edc962c44888abc",
        "page": "",
        "ui": "",
        "name": "Greenness",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n  <div style=\"width:100%; height:250px; position:relative;\">\n    <div v-if=\"loading\" class=\"ps-skeleton\"></div>\n    <div v-show=\"!loading\" ref=\"plot\" style=\"width:100%; height:100%;\"></div>\n  </div>\n</template>\n\n<style>\n.ps-skeleton {\n  width:100%;\n  height:100%;\n  background:linear-gradient(90deg,#e0e0e0,#f5f5f5,#e0e0e0);\n  background-size:200% 100%;\n  animation:psk 1.2s infinite;\n  border-radius:6px;\n}\n@keyframes psk { \n  0%{background-position:200% 0;}\n  100%{background-position:-200% 0;}\n}\n</style>\n\n<script>\nexport default {\n  data(){ return { loading:true, pts:[] } },\n\n  watch:{\n    msg:{ immediate:true, deep:true,\n      handler(m){\n        if(!m?.payload) return;\n\n        if(m.payload.data?.length===0){\n          this.loading=true;\n          this.pts=[];\n          if(this.$refs.plot&&window.Plotly) Plotly.purge(this.$refs.plot);\n          return;\n        }\n\n        this.pts = m.payload.data || [];\n        this.loading = this.pts.length===0;\n        this.$nextTick(()=>this.draw());\n      }\n    }\n  },\n\n  mounted(){\n    if(!window.Plotly){\n      const s=document.createElement(\"script\");\n      s.src=\"https://cdn.plot.ly/plotly-2.27.0.min.js\";\n      s.onload=()=>this.draw();\n      document.head.appendChild(s);\n    } else this.draw();\n  },\n\n  methods:{\n    draw(){\n      if(!window.Plotly) return;\n      const el=this.$refs.plot;\n\n      if(!this.pts.length){ this.loading=true; Plotly.purge(el); return; }\n\n      this.loading=false;\n\n      const trace={\n        x:this.pts.map(p=>p.g),\n        y:this.pts.map(p=>p.circ),\n        mode:\"markers\",\n        type:\"scatter\",\n        marker:{ size:10, color:\"#4CAF50\", opacity:0.5 },\n        hoverinfo:\"none\"\n      };\n\n      const layout={\n        margin:{t:10,b:30,l:50,r:20},\n        xaxis:{title:\"Green Index\"},\n        yaxis:{title:\"Circularity\"}\n      };\n\n      Plotly.newPlot(el,[trace],layout,{responsive:true});\n    }\n  }\n}\n</script>\n",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 830,
        "y": 700,
        "wires": [
            []
        ]
    },
    {
        "id": "a7c8654291022da1",
        "type": "ui-template",
        "z": "14f8c9b5ce1235cc",
        "group": "67c63cc92c23c4b1",
        "page": "",
        "ui": "",
        "name": "Complexity (Area vs Perimeter)",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n  <div style=\"width:100%; height:250px; position:relative;\">\n    <div v-if=\"loading\" class=\"ps-skeleton\"></div>\n    <div v-show=\"!loading\" ref=\"plot\" style=\"width:100%; height:100%;\"></div>\n  </div>\n</template>\n\n<style>\n.ps-skeleton{\n  width:100%; height:100%;\n  background:linear-gradient(90deg,#e0e0e0,#f5f5f5,#e0e0e0);\n  background-size:200% 100%;\n  animation:psk 1.2s infinite; border-radius:6px;\n}\n@keyframes psk{\n  0%{background-position:200% 0;}\n  100%{background-position:-200% 0;}\n}\n</style>\n\n<script>\nexport default {\n  data(){ return { loading:true, pts:[] } },\n\n  watch:{\n    msg:{ immediate:true, deep:true,\n      handler(m){\n        if(!m?.payload) return;\n\n        if(m.payload.data?.length===0){\n          this.loading=true; this.pts=[];\n          if(this.$refs.plot&&window.Plotly) Plotly.purge(this.$refs.plot);\n          return;\n        }\n\n        this.pts = m.payload.data || [];\n        this.loading = this.pts.length===0;\n        this.$nextTick(()=>this.draw());\n      }\n    }\n  },\n\n  mounted(){\n    if(!window.Plotly){\n      const s=document.createElement(\"script\");\n      s.src=\"https://cdn.plot.ly/plotly-2.27.0.min.js\";\n      s.onload=()=>this.draw();\n      document.head.appendChild(s);\n    } else this.draw();\n  },\n\n  methods:{\n    draw(){\n      if(!window.Plotly) return;\n      const el=this.$refs.plot;\n\n      if(!this.pts.length){ this.loading=true; Plotly.purge(el); return; }\n\n      this.loading=false;\n\n      const trace={\n        x:this.pts.map(p=>p.area),\n        y:this.pts.map(p=>p.per),\n        mode:\"markers\",\n        type:\"scatter\",\n        marker:{ size:10, color:\"purple\", opacity:0.5 },\n        hoverinfo:\"none\"\n      };\n\n      const layout={\n        margin:{t:10,b:30,l:50,r:20},\n        xaxis:{title:\"Area\"},\n        yaxis:{title:\"Perimeter\"}\n      };\n\n      Plotly.newPlot(el,[trace],layout,{responsive:true});\n    }\n  }\n}\n</script>\n",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 890,
        "y": 740,
        "wires": [
            []
        ]
    },
    {
        "id": "ed9d6e31cc3a01b1",
        "type": "ui-template",
        "z": "14f8c9b5ce1235cc",
        "group": "95a152a68b7ba779",
        "page": "",
        "ui": "",
        "name": "Texture (Area vs Std)",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n  <div style=\"width:100%; height:250px; position:relative;\">\n    <div v-if=\"loading\" class=\"ps-skeleton\"></div>\n    <div v-show=\"!loading\" ref=\"plot\" style=\"width:100%; height:100%;\"></div>\n  </div>\n</template>\n\n<style>\n.ps-skeleton{\n  width:100%; height:100%;\n  background:linear-gradient(90deg,#e0e0e0,#f5f5f5,#e0e0e0);\n  background-size:200% 100%;\n  animation:psk 1.2s infinite; border-radius:6px;\n}\n@keyframes psk{\n  0%{background-position:200% 0;}\n  100%{background-position:-200% 0;}\n}\n</style>\n\n<script>\nexport default {\n  data(){ return { loading:true, pts:[] } },\n\n  watch:{\n    msg:{ immediate:true, deep:true,\n      handler(m){\n        if(!m?.payload) return;\n\n        if(m.payload.data?.length===0){\n          this.loading=true;\n          this.pts=[];\n          if(this.$refs.plot&&window.Plotly) Plotly.purge(this.$refs.plot);\n          return;\n        }\n\n        this.pts = m.payload.data || [];\n        this.loading = this.pts.length===0;\n        this.$nextTick(()=>this.draw());\n      }\n    }\n  },\n\n  mounted(){\n    if(!window.Plotly){\n      const s=document.createElement(\"script\");\n      s.src=\"https://cdn.plot.ly/plotly-2.27.0.min.js\";\n      s.onload=()=>this.draw();\n      document.head.appendChild(s);\n    } else this.draw();\n  },\n\n  methods:{\n    draw(){\n      if(!window.Plotly) return;\n      const el=this.$refs.plot;\n\n      if(!this.pts.length){ this.loading=true; Plotly.purge(el); return; }\n\n      this.loading=false;\n\n      const trace={\n        x:this.pts.map(p=>p.area),\n        y:this.pts.map(p=>p.std),\n        mode:\"markers\",\n        type:\"scatter\",\n        marker:{ size:10, color:\"brown\", opacity:0.5 },\n        hoverinfo:\"none\"\n      };\n\n      const layout={\n        margin:{t:10,b:30,l:50,r:20},\n        xaxis:{title:\"Area\"},\n        yaxis:{title:\"Texture (Std Dev)\"}\n      };\n\n      Plotly.newPlot(el,[trace],layout,{responsive:true});\n    }\n  }\n}\n</script>\n",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 860,
        "y": 780,
        "wires": [
            []
        ]
    },
    {
        "id": "c15ef66d7e115bd3",
        "type": "ui-template",
        "z": "14f8c9b5ce1235cc",
        "group": "1baa943e505febf1",
        "page": "",
        "ui": "",
        "name": "Solidity Histogram",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n  <div style=\"width:100%; height:250px; position:relative;\">\n    <div v-if=\"loading\" class=\"ps-skeleton\"></div>\n    <div v-show=\"!loading\" ref=\"plot\" style=\"width:100%; height:100%;\"></div>\n  </div>\n</template>\n\n<style>\n.ps-skeleton{\n  width:100%; height:100%;\n  background:linear-gradient(90deg,#e0e0e0,#f5f5f5,#e0e0e0);\n  background-size:200% 100%;\n  animation:psk 1.2s infinite; border-radius:6px;\n}\n@keyframes psk{ \n  0%{background-position:200% 0;}\n  100%{background-position:-200% 0;}\n}\n</style>\n\n<script>\nexport default {\n  data(){ return { loading:true, pts:[] } },\n\n  watch:{\n    msg:{ immediate:true, deep:true,\n      handler(m){\n        if(!m?.payload) return;\n\n        if(m.payload.data?.length===0){\n          this.loading=true;\n          this.pts=[];\n          if(this.$refs.plot&&window.Plotly) Plotly.purge(this.$refs.plot);\n          return;\n        }\n\n        this.pts = m.payload.data || [];\n        this.loading = this.pts.length===0;\n        this.$nextTick(()=>this.draw());\n      }\n    }\n  },\n\n  mounted(){\n    if(!window.Plotly){\n      const s=document.createElement(\"script\");\n      s.src=\"https://cdn.plot.ly/plotly-2.27.0.min.js\";\n      s.onload=()=>this.draw();\n      document.head.appendChild(s);\n    } else this.draw();\n  },\n\n  methods:{\n    draw(){\n      if(!window.Plotly) return;\n      const el=this.$refs.plot;\n\n      if(!this.pts.length){ this.loading=true; Plotly.purge(el); return; }\n\n      this.loading=false;\n\n      const trace={\n        x:this.pts.map(p=>p.sol),\n        type:\"histogram\",\n        marker:{color:\"#3F51B5\"}\n      };\n\n      const layout={\n        margin:{t:10,b:30,l:50,r:20},\n        xaxis:{title:\"Solidity\"}\n      };\n\n      Plotly.newPlot(el,[trace],layout,{responsive:true});\n    }\n  }\n}\n</script>\n",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 850,
        "y": 820,
        "wires": [
            []
        ]
    },
    {
        "id": "63ce87d36ae8f172",
        "type": "function",
        "z": "14f8c9b5ce1235cc",
        "name": "EXPLORER",
        "func": "// Explorer Function Node\n// TSV  {meta, keys, data: [{id, url, ...keys}]}\n\nconst lines = msg.payload.toString().trim().split(/\\r?\\n/);\nif (lines.length < 2) return null;\n\n// 1. Parse Headers\nconst headers = lines[0].split(\"\\t\");\nconst val = (row, col) => {\n    const i = headers.indexOf(col);\n    return i >= 0 ? row[i] : null;\n};\n\n// 2. Extract Meta from first valid data row\nlet firstRow = null;\nfor (let i = 1; i < lines.length; i++) {\n    // Skip rows starting with '[' (metadata comments)\n    if (!lines[i].trim().startsWith(\"[\")) {\n        firstRow = lines[i].split(\"\\t\");\n        break;\n    }\n}\n\n// Default meta\nconst meta = {\n    sample_id: \"\",\n    project: \"\",\n    acq_id: \"\",\n    resolution: 1.0 // Default fallback\n};\n\nif (firstRow) {\n    meta.sample_id = val(firstRow, \"sample_id\") || \"\";\n    meta.project = val(firstRow, \"sample_project\") || \"\";\n    meta.acq_id = val(firstRow, \"acq_id\") || \"\";\n    \n    // CRITICAL: Extract pixel size (microns per pixel)\n    // If process_pixel is missing or 0, default to 1 to prevent division by zero\n    const px = parseFloat(val(firstRow, \"process_pixel\"));\n    if (!isNaN(px) && px > 0) {\n        meta.resolution = px;\n    }\n}\n\n// 3. Explorer Keys to extract\nconst explorerKeys = [\n    \"object_area\", \"object_equivalent_diameter\", \"object_perim.\",\n    \"object_major\", \"object_minor\", \"object_width\", \"object_height\",\n    \"object_circ.\", \"object_elongation\", \"object_solidity\",\n    \"object_eccentricity\", \"object_MeanHue\", \"object_MeanSaturation\",\n    \"object_MeanValue\", \"object_StdValue\"\n];\n\nlet seq = 0;\nconst data = [];\n\n// 4. Process Data Lines\nfor (let i = 1; i < lines.length; i++) {\n    const line = lines[i];\n    if (line.trim().startsWith(\"[\")) continue;\n\n    const row = line.split(\"\\t\");\n\n    const item = {\n        id: val(row, \"object_id\"),\n        // Construct URL\n        url: `/ps/data/browse/api/preview/big/objects/${val(row,\"object_date\")}/${val(row,\"sample_id\")}/${val(row,\"acq_id\")}/${val(row,\"img_file_name\")}`,\n        sequence_index: seq++\n    };\n\n    // Parse numeric keys\n    explorerKeys.forEach(k => {\n        let v = parseFloat(val(row, k));\n        item[k] = isNaN(v) ? 0 : v;\n    });\n\n    // Custom calc for greenness (example)\n    const hue = item.object_MeanHue || 0;\n    const dist = Math.abs(hue - 80);\n    item.custom_greenness = Math.max(0, 100 - dist);\n\n    data.push(item);\n}\n\nmsg.payload = {\n    meta,\n    keys: explorerKeys,\n    data\n};\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 900,
        "wires": [
            [
                "d57a5bca66c04989"
            ]
        ]
    },
    {
        "id": "d57a5bca66c04989",
        "type": "ui-template",
        "z": "14f8c9b5ce1235cc",
        "group": "c5651e1a3e56f3f5",
        "page": "",
        "ui": "",
        "name": "Explorer",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n  <v-row class=\"ps-controls py-4\" no-gutters>\n    <v-col cols=\"12\" md=\"4\">\n      <v-select\n        v-model=\"xAxis\"\n        :items=\"keys\"\n        label=\"X Axis\"\n        density=\"compact\"\n        variant=\"outlined\"\n        hide-details\n      />\n    </v-col>\n\n    <v-col cols=\"12\" md=\"4\">\n      <v-select\n        v-model=\"yAxis\"\n        :items=\"keys\"\n        label=\"Y Axis\"\n        density=\"compact\"\n        variant=\"outlined\"\n        hide-details\n          class=\"flex-grow-1 mx-2\"\n      />\n    </v-col>\n\n    <v-col cols=\"12\" md=\"4\" class=\"d-flex align-center\">\n      <v-btn\n        color=\"primary\"\n        block\n        @click=\"draw\"\n        prepend-icon=\"mdi-chart-scatter-plot\"\n        height=\"40\"\n      >\n        Load Plot\n      </v-btn>\n    </v-col>\n  </v-row>\n\n\n  <v-row no-gutters class=\"fill-height\" style=\"height: calc(100vh - 180px);\">\n\n    <v-col cols=\"12\" md=\"8\" class=\"pr-2\" style=\"height:100%;\">\n      <v-card variant=\"outlined\" class=\"fill-height\">\n        <div v-if=\"loading\" class=\"ps-skeleton\"></div>\n        <div v-show=\"!loading\" ref=\"plot\" class=\"plot-container\"></div>\n      </v-card>\n    </v-col>\n\n    <v-col cols=\"12\" md=\"4\" class=\"pl-2\" style=\"height:100%;\">\n      <v-card variant=\"outlined\" class=\"fill-height d-flex flex-column\">\n\n        <v-divider></v-divider>\n\n        <div class=\"pa-4 flex-grow-1 overflow-y-auto\">\n\n          <div v-if=\"loading\" class=\"ps-skeleton\" style=\"height:200px\"></div>\n\n          <div\n            v-else-if=\"!hovered\"\n            class=\"ps-placeholder d-flex flex-column align-center justify-center h-100\"\n          >\n            <v-icon size=\"48\" color=\"grey-lighten-2\" class=\"mb-2\">\n              mdi-cursor-default-click-outline\n            </v-icon>\n            <div class=\"text-caption text-grey\">\n              Hover over a point<br>to view details\n            </div>\n          </div>\n\n          <div v-else>\n\n            <v-img\n              :src=\"hovered.url\"\n              aspect-ratio=\"1\"\n              bg-color=\"grey-lighten-3\"\n              contain\n              class=\"mb-3\"\n            >\n              <template #placeholder>\n                <div class=\"d-flex align-center justify-center fill-height\">\n                  <v-progress-circular indeterminate color=\"primary\"></v-progress-circular>\n                </div>\n              </template>\n            </v-img>\n\n            <div class=\"d-flex justify-space-between align-center mb-2 px-2\">\n              <v-chip size=\"small\" color=\"primary\" label>ID: {{ hovered.id }}</v-chip>\n\n              <div class=\"scale-bar-wrapper\">\n                <div class=\"scale-bar\" :style=\"{ width: scaleBarPixels + 'px' }\"></div>\n                <div class=\"scale-label\">{{ formattedScale }}</div>\n              </div>\n            </div>\n            \n            <div class=\"text-caption text-grey text-right\">\n              Res: {{ meta.resolution }} m/px\n            </div>\n\n          </div>\n        </div>\n\n      </v-card>\n    </v-col>\n\n  </v-row>\n\n\n  <div\n    v-if=\"tooltip.show\"\n    :style=\"{\n      position:'fixed',\n      top: tooltip.y + 'px',\n      left: tooltip.x + 'px',\n      width:'160px',\n      background:'white',\n      border:'1px solid #ccc',\n      borderRadius:'6px',\n      pointerEvents:'none',\n      zIndex:99999,\n      boxShadow:'0 4px 12px rgba(0,0,0,0.15)'\n    }\"\n  >\n    <img :src=\"tooltip.url\" style=\"width:100%; border-radius:6px 6px 0 0;\" />\n    <div style=\"padding:4px 8px; text-align:center; font-size:11px; font-weight:bold; background:#f5f5f5;\">\n      ID: {{ tooltip.id }}\n    </div>\n  </div>\n\n</template>\n\n<script>\nexport default {\n  props: [\"msg\"],\n\n  data() {\n    return {\n      keys: [],\n      items: [],\n      loading: true,\n\n      xAxis: \"object_elongation\",\n      yAxis: \"object_area\",\n\n      // Default meta if nothing is passed\n      meta: { resolution: 1.0 },\n\n      hovered: null,\n      tooltip: { show: false, id: \"\", url: \"\", x: 0, y: 0 }\n    }\n  },\n\n  watch: {\n    msg: {\n      deep: true,\n      immediate: true,\n      handler(m) {\n        if (!m?.payload) return\n\n        // Update Resolution from Payload\n        if (m.payload.meta?.resolution) {\n          this.meta.resolution = parseFloat(m.payload.meta.resolution)\n        }\n\n        // CLEARING\n        if (Array.isArray(m.payload.data) && m.payload.data.length === 0) {\n          this.loading = true\n          this.items = []\n          this.hovered = null\n          this.tooltip.show = false\n          const el = this.$refs.plot\n          if (el && window.Plotly) Plotly.purge(el)\n          return\n        }\n\n        this.keys = m.payload.keys || []\n        this.items = m.payload.data || []\n\n        this.loading = this.items.length === 0\n\n        this.$nextTick(() => this.draw())\n      }\n    }\n  },\n\n  mounted() {\n    if (!window.Plotly) {\n      const s = document.createElement(\"script\")\n      s.src = \"https://cdn.plot.ly/plotly-2.27.0.min.js\"\n      s.onload = () => this.draw()\n      document.head.appendChild(s)\n    } else this.draw()\n  },\n\n  computed: {\n    // Calculate a nice round number for the scale bar length (e.g. 50um, 100um)\n    // based on the size of the current object.\n    adaptiveScaleMicrons() {\n      if (!this.hovered) return 20;\n\n      // 1. Get real width of object in microns\n      // Fallback to 100px if object_width is missing\n      const objWidthPx = this.hovered.object_width || 100; \n      const realWidthMicrons = objWidthPx * this.meta.resolution;\n\n      // 2. Target bar size ~ 25% of the object width\n      let target = realWidthMicrons / 4;\n      if (target <= 0) target = 20;\n\n      // 3. Snap to nearest nice number (10, 20, 50, 100, 200, 500...)\n      const magnitude = Math.pow(10, Math.floor(Math.log10(target)));\n      const residual = target / magnitude;\n      \n      let niceScalar = 1;\n      if (residual > 5) niceScalar = 10;\n      else if (residual > 2) niceScalar = 5;\n      else niceScalar = 2;\n\n      return niceScalar * magnitude;\n    },\n\n    scaleBarPixels() {\n      // Resolution = Microns per Pixel\n      // Pixels = Microns / Resolution\n      const res = this.meta.resolution || 1;\n      return this.adaptiveScaleMicrons / res;\n    },\n\n    formattedScale() {\n      return `${this.adaptiveScaleMicrons} m`\n    }\n  },\n\n  methods: {\n    fmt(v) { return typeof v === \"number\" ? v.toFixed(2) : v },\n\n    draw() {\n      if (!window.Plotly || !this.items.length) return\n\n      this.loading = false\n      const el = this.$refs.plot\n\n      const trace = {\n        x: this.items.map(d => d[this.xAxis]),\n        y: this.items.map(d => d[this.yAxis]),\n        mode: 'markers',\n        type: 'scatter',\n        hoverinfo: 'none',\n        marker: {\n          size: 8,\n          color: '#1976D2',\n          opacity: 0.6,\n          line: { width: 1, color: 'white' }\n        }\n      }\n\n      const layout = {\n        margin: { t: 20, b: 40, l: 50, r: 20 },\n        xaxis: { title: this.xAxis },\n        yaxis: { title: this.yAxis },\n        hovermode: 'closest',\n        dragmode: 'zoom',\n        plot_bgcolor: '#ffffff',\n        paper_bgcolor: '#ffffff'\n      }\n\n      Plotly.newPlot(el, [trace], layout, { responsive: true })\n        .then(() => {\n          el.on(\"plotly_hover\", ev => {\n            const i = ev.points[0].pointIndex\n            this.hovered = this.items[i]\n          })\n          el.on(\"plotly_unhover\", () => {\n            this.tooltip.show = false\n          })\n        })\n    }\n  }\n}\n</script>\n\n<style scoped>\n.plot-container {\n  width: 100%;\n  height: 600px;\n}\n\n.ps-skeleton {\n  width: 100%;\n  height: 100%;\n  background: linear-gradient(90deg, #eee, #f5f5f5, #eee);\n  animation: shimmer 1.5s infinite;\n  border-radius: 4px;\n}\n\n@keyframes shimmer {\n  0% { background-position: -200px 0; }\n  100% { background-position: 200px 0; }\n}\n\n.scale-bar-wrapper {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  /* Prevent the bar from shrinking */\n  flex-shrink: 0; \n}\n\n.scale-bar {\n  height: 4px;\n  background: #333;\n  border-radius: 2px;\n  margin-bottom: 2px;\n  /* Add tick marks */\n  border-left: 1px solid #333;\n  border-right: 1px solid #333;\n}\n\n.scale-label {\n  font-size: 11px;\n  text-align: center;\n  color: #555;\n  font-weight: 600;\n}\n</style>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 820,
        "y": 900,
        "wires": [
            []
        ]
    },
    {
        "id": "384aa9ab83bfe566",
        "type": "function",
        "z": "14f8c9b5ce1235cc",
        "name": "Clearing plots",
        "func": "// This function clears the plot by sending an empty data array.\n// Any template using msg.payload.data will immediately purge the plot.\n\nmsg.payload = {\n    data: []\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 580,
        "y": 380,
        "wires": [
            [
                "0c90eb450c8d9b01",
                "0a559ab05af2548e",
                "7b9d103ec5981051",
                "23a78a078fa1eca8",
                "09f4914fc0a54566",
                "7f4d047a4c73eb61",
                "a7c8654291022da1",
                "ed9d6e31cc3a01b1",
                "c15ef66d7e115bd3",
                "2ca2f83cc939607f",
                "d57a5bca66c04989",
                "4244d2ed880cca66"
            ]
        ]
    },
    {
        "id": "9abf70a949e76eaf",
        "type": "function",
        "z": "14f8c9b5ce1235cc",
        "name": "GALLERY",
        "func": "// GALLERY Function Node\n// TSV  { data: [], meta: { resolution: ... }, keys: ... }\n\n// 1. Handle Clear Signals\nif (msg.clear === true || (msg.payload && msg.payload.clear === true)) {\n    msg.payload = { data: [], meta: { resolution: 1 }, keys: [] };\n    return msg;\n}\n\n// 2. Validate Payload\nif (!msg.payload) return null;\nconst lines = msg.payload.toString().trim().split(/\\r?\\n/);\nif (lines.length < 2) {\n    msg.payload = { data: [], meta: { resolution: 1 }, keys: [] };\n    return msg;\n}\n\n// 3. Parse Headers\nconst headers = lines[0].split('\\t');\nconst get = (row, key) => {\n    const idx = headers.indexOf(key);\n    return idx >= 0 ? row[idx] : null;\n};\n\n// 4. Extract Meta (Resolution is key here)\nlet firstRow = null;\nfor (let i = 1; i < lines.length; i++) {\n    const L = lines[i].trim();\n    if (!L.startsWith('[') && L !== '') {\n        firstRow = lines[i].split('\\t');\n        break;\n    }\n}\n\nconst meta = {\n    sample_id: 'N/A',\n    project: 'N/A',\n    acq_id: 'N/A',\n    resolution: 1.0 // Default fallback\n};\n\nif (firstRow) {\n    meta.sample_id = get(firstRow, 'sample_id') || \"\";\n    meta.project   = get(firstRow, 'sample_project') || \"\";\n    meta.acq_id    = get(firstRow, 'acq_id') || \"\";\n\n    // CRITICAL: Extract microns per pixel\n    const px = parseFloat(get(firstRow, 'process_pixel'));\n    if (!isNaN(px) && px > 0) {\n        meta.resolution = px;\n    }\n}\n\n// 5. Select Keys to Display\nconst usefulKeys = [\n    \"object_area\", \"object_width\", \"object_height\",\n    \"object_equivalent_diameter\", \"object_major\", \"object_minor\",\n    \"object_MeanHue\", \"object_elongation\"\n];\n\nconst data = [];\n\n// 6. Process Rows\nfor (let i = 1; i < lines.length; i++) {\n    const rowLine = lines[i].trim();\n    if (rowLine.startsWith('[') || rowLine === '') continue;\n\n    const row = rowLine.split('\\t');\n    if (row.length !== headers.length) continue;\n\n    const item = {\n        id: get(row, 'object_id'),\n        // Construct Image URL\n        url: `/ps/data/browse/api/preview/big/objects/${get(row, 'object_date')}/${get(row, 'sample_id')}/${get(row, 'acq_id')}/${get(row, 'img_file_name')}`\n    };\n\n    // Parse numeric values\n    usefulKeys.forEach(k => {\n        let v = parseFloat(get(row, k));\n        item[k] = isNaN(v) ? 0 : v;\n    });\n\n    data.push(item);\n}\n\nmsg.payload = {\n    data,\n    keys: usefulKeys,\n    meta\n};\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 960,
        "wires": [
            [
                "4244d2ed880cca66"
            ]
        ]
    },
    {
        "id": "d77ed8081a657507",
        "type": "delay",
        "z": "14f8c9b5ce1235cc",
        "name": "",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 180,
        "y": 320,
        "wires": [
            [
                "5ec998719a884cfe"
            ]
        ]
    },
    {
        "id": "bdf84e9e1e0caa90",
        "type": "debug",
        "z": "14f8c9b5ce1235cc",
        "name": "debug 2",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 380,
        "y": 360,
        "wires": []
    },
    {
        "id": "8e11bb014b9664be",
        "type": "ui-template",
        "z": "8018bd5586fd4054",
        "group": "822cdc5b6ef13f39",
        "page": "",
        "ui": "",
        "name": "body",
        "order": 1,
        "width": "12",
        "height": "6",
        "head": "",
        "format": "<template>\n  <v-container>\n    <v-row>\n      <!-- Step 1: White Balance -->\n      <v-col cols=\"12\" md=\"3\">\n        <v-card\n          href=\"calibration_saturation_level\"\n          class=\"text-center py-2\"\n        >\n          <v-icon size=\"64\" color=\"primary\">mdi-eyedropper-variant</v-icon>\n          <v-card-title class=\"text-h6\">White Balance</v-card-title>\n          <v-card-text>\n            Use the color picker to measure the current color values and adjust the white balance accordingly.\n          </v-card-text>\n        </v-card>\n      </v-col>\n\n      <!-- Step 2: Lightness -->\n      <v-col cols=\"12\" md=\"3\">\n        <v-card\n          href=\"calibration_lightness\"\n          class=\"text-center py-2\"\n        >\n          <v-icon size=\"64\" color=\"primary\">mdi-brightness-6</v-icon>\n          <v-card-title class=\"text-h6\">Lightness</v-card-title>\n          <v-card-text>\n            Measure the current lightness value and update the LED intensity or ISO if below optimal levels.\n          </v-card-text>\n        </v-card>\n      </v-col>\n\n      <!-- Step 3: Pixel Size -->\n      <v-col cols=\"12\" md=\"3\">\n        <v-card\n          href=\"calibration_pixel_size\"\n          class=\"text-center py-2\"\n        >\n          <v-icon size=\"64\" color=\"primary\">mdi-ruler</v-icon>\n          <v-card-title class=\"text-h6\">Pixel Size</v-card-title>\n          <v-card-text>\n            Place markers on the micrometric ruler image to calculate the pixel size in microns per pixel.\n          </v-card-text>\n        </v-card>\n      </v-col>\n\n      <!-- Step 4: Pump Calibration -->\n      <v-col cols=\"12\" md=\"3\">\n        <v-card\n          href=\"calibration_pump\"\n          class=\"text-center py-2\"\n        >\n          <v-icon size=\"64\" color=\"primary\">mdi-water-pump</v-icon>\n          <v-card-title class=\"text-h6\">Pump Calibration</v-card-title>\n          <v-card-text>\n            Measure the transferred volume and adjust pump steps to improve accuracy in fluid handling.\n          </v-card-text>\n        </v-card>\n      </v-col>\n    </v-row>\n  </v-container>\n</template>\n",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 490,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "35d8e8e4b1e0ef7d",
        "type": "ui-template",
        "z": "8018bd5586fd4054",
        "group": "c29c835a70533b69",
        "page": "",
        "ui": "",
        "name": "header",
        "order": 1,
        "width": "12",
        "height": "6",
        "head": "",
        "format": "<template>\n  <v-empty-state\n    headline=\"Calibration steps\"\n    icon=\"mdi-crosshairs-gps\"\n    title=\"Follow these steps to ensure optimal image quality and measurement accuracy\"\n  >\n  </v-empty-state>\n</template>\n",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 490,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "062a3af5e12e8445",
        "type": "ui-template",
        "z": "6426e7bea6900426",
        "g": "f591255fbfc6c466",
        "group": "af8acdfe9afbad74",
        "page": "",
        "ui": "",
        "name": "Step Bar",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n  <div>\n    <v-stepper class=\"my-stepper\" model-value=\"1\" non-linear>\n      <v-stepper-header>\n        <v-stepper-item value=\"1\" editable @click=\"stepClicked(1)\" class=\"selected-step\" color=\"primary\">Saturation Level</v-stepper-item>\n        <v-divider></v-divider>\n        <v-stepper-item value=\"2\" editable @click=\"stepClicked(2)\" color=\"grey\">Lightness</v-stepper-item>\n        <v-divider></v-divider>\n        <v-stepper-item value=\"3\" editable @click=\"stepClicked(3)\" color=\"grey\">Pixel size</v-stepper-item>\n        <v-divider></v-divider>\n        <v-stepper-item value=\"4\" editable @click=\"stepClicked(4)\" color=\"grey\">Pump</v-stepper-item>\n      </v-stepper-header>\n    </v-stepper>\n  </div>\n</template>\n\n<script>\n  export default {\n    name: 'StepperComponent',\n    methods: {\n      stepClicked(step) {\n        const stepMapping = {\n          1: { page: 'Calibration - Saturation Level' },\n          2: { page: 'Calibration - Lightness' },\n          3: { page: 'Calibration - Pixel size' },\n          4: { page: 'Calibration - Pump' }\n        };\n\n        const msgPayload = stepMapping[step] || {};\n        \n        this.send({ payload: msgPayload });\n      }\n    }\n  }\n</script>\n",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 1080,
        "y": 60,
        "wires": [
            [
                "e5da27b9abdcb156"
            ]
        ]
    },
    {
        "id": "e5da27b9abdcb156",
        "type": "ui-control",
        "z": "6426e7bea6900426",
        "g": "f591255fbfc6c466",
        "name": "",
        "ui": "e6ae26617c24c3ea",
        "events": "all",
        "x": 1280,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "5350c095034ba5c6",
        "type": "ui-event",
        "z": "6426e7bea6900426",
        "ui": "e6ae26617c24c3ea",
        "name": "UI Event",
        "x": 80,
        "y": 40,
        "wires": [
            [
                "a0df077ddbb184e3"
            ]
        ]
    },
    {
        "id": "a0df077ddbb184e3",
        "type": "switch",
        "z": "6426e7bea6900426",
        "name": "msg.topic === \"$pageview\"",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "$pageview",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 280,
        "y": 40,
        "wires": [
            [
                "874fd69a5398300e"
            ]
        ]
    },
    {
        "id": "874fd69a5398300e",
        "type": "switch",
        "z": "6426e7bea6900426",
        "name": "msg.payload.page.path === \"/calibration_saturation_level\"",
        "property": "payload.page.path",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "/calibration_saturation_level",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 640,
        "y": 40,
        "wires": [
            [
                "65a5f93fc6decaac"
            ]
        ]
    },
    {
        "id": "65a5f93fc6decaac",
        "type": "function",
        "z": "6426e7bea6900426",
        "name": "Get Global Variables",
        "func": "const keys = global.keys(); // Get all global variable keys\nmsg.payload = {}; // Initialize the payload object\n\nkeys.forEach(key => {\n    // Ignore keys that start with \"$\"\n    if (!key.startsWith('$')) {\n        msg.payload[key] = global.get(key);\n    }\n});\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 120,
        "y": 140,
        "wires": [
            [
                "5ec541d6e203def5"
            ]
        ]
    },
    {
        "id": "e52cb70984e0d25d",
        "type": "mqtt out",
        "z": "6426e7bea6900426",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "broker": "8dc3722c.06efa8",
        "x": 850,
        "y": 100,
        "wires": []
    },
    {
        "id": "d8f732f8fe251222",
        "type": "function",
        "z": "6426e7bea6900426",
        "name": "set pump settings",
        "func": "if (msg.topic) {\n    global.set(\"calibration_wbg_red\", msg.payload.settings.white_balance_gain.red);\n    global.set(\"calibration_wbg_blue\", msg.payload.settings.white_balance_gain.blue);\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 990,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "615edad94a4f77e7",
        "type": "switch",
        "z": "6426e7bea6900426",
        "name": "",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "imager/image",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 590,
        "y": 140,
        "wires": [
            [
                "d8f732f8fe251222",
                "e52cb70984e0d25d"
            ]
        ]
    },
    {
        "id": "5ec541d6e203def5",
        "type": "ui-template",
        "z": "6426e7bea6900426",
        "group": "af8acdfe9afbad74",
        "page": "",
        "ui": "",
        "name": "Calibration - WB",
        "order": 2,
        "width": "0",
        "height": "0",
        "head": "",
        "format": "<template>\n  <v-container fluid>\n    <v-row>\n      <v-col cols=\"12\" md=\"8\">\n        <v-card class=\"calibration-container\" style=\"width:100%; height:750px; position:relative; overflow:hidden;\">\n          <iframe src=\"/preview/node-red\" class=\"calibration-iframe\"></iframe>\n\n          <div class=\"sampling-overlay\"></div>\n\n          <canvas\n            ref=\"captureCanvas\"\n            width=\"300\"\n            height=\"300\"\n            style=\"display:none;\"\n          ></canvas>\n        </v-card>\n      </v-col>\n\n      <v-col cols=\"12\" md=\"4\">\n        <v-card class=\"px-4 pb-4 h-100\">\n          <v-card-title class=\"text-left text-primary\">\n            White Balance Calibration\n          </v-card-title>\n\n          <v-divider class=\"mb-4\"></v-divider>\n\n          <section class=\"mb-6\">\n            <h3 class=\"text-subtitle-1 mb-2\">1. Refresh</h3>\n            <p class=\"text-caption mb-3\">\n              Click <b>Refresh Gains</b> to reset the calibration and start.\n            </p>\n            <v-btn block color=\"error\" class=\"mb-4\" @click=\"refreshGain\">\n              Refresh Gains\n            </v-btn>\n          </section>\n\n          <v-divider class=\"mb-4\"></v-divider>\n\n          <section class=\"mb-6\">\n            <h3 class=\"text-subtitle-1 mb-2\">2. Sample Average Pixel (Auto)</h3>\n            <p class=\"text-caption mb-3\">\n              Average color sampled from the central **red box**.\n            </p>\n\n            <div class=\"d-flex align-center justify-center mb-3\">\n              <div\n                :style=\"{ 'background-color': `rgb(${sampledR}, ${sampledG}, ${sampledB})`, \n                          width: '40px', height: '40px', border: '2px solid #333', 'border-radius': '4px' }\"\n                class=\"mr-3\"\n              ></div>\n              <span class=\"font-mono text-subtitle-1\">\n                RGB: {{ sampledR }}, {{ sampledG }}, {{ sampledB }}\n              </span>\n            </div>\n          </section>\n\n          <v-divider class=\"mb-4\"></v-divider>\n\n          <section class=\"mb-6\">\n            <h3 class=\"text-subtitle-1 mb-2\">3. Apply Suggested Gains</h3>\n\n            <v-data-table :items=\"rows\" density=\"comfortable\" hide-default-footer class=\"gain-table mb-6\">\n              <template #item.current=\"{ item }\">\n                <div class=\"text-center font-mono\">{{ item.current }}</div>\n              </template>\n              <template #item.suggested=\"{ item }\">\n                <v-text-field v-model.number=\"item.suggested\" type=\"number\" min=\"0\" hide-details density=\"compact\"\n                  variant=\"underlined\" class=\"text-primary text-center suggested-input\"\n                  @change=\"onManualEdit(item.channel,item.suggested)\" />\n              </template>\n            </v-data-table>\n\n            <p class=\"text-caption mb-3\">\n              Click <b>Apply Suggested Gains</b> to send the new calibration values.\n            </p>\n\n            <v-btn block color=\"primary\" class=\"mt-auto\" :disabled=\"!suggested.red && !suggested.blue\"\n              @click=\"applySuggested\">\n              Apply Suggested Gains\n            </v-btn>\n          </section>\n\n          <v-divider class=\"mb-4\"></v-divider>\n\n          <section>\n            <h3 class=\"text-subtitle-1 mb-2\">4. Repeat Until Saturation  0%</h3>\n            \n            <p class=\"text-caption\">\n              Repeat the cycle (Sample $\\rightarrow$ Apply) until the saturation is minimal.\n            </p>\n            \n            <div class=\"text-center mt-3 mb-4\">\n                <div \n                    class=\"text-h3 font-weight-bold\" \n                    :style=\"{ color: hsl.s < 5 ? 'green' : hsl.s < 15 ? 'orange' : 'red' }\"\n                >\n                    {{ hsl.s }} %\n                </div>\n                <div class=\"text-caption text-grey\">\n                    Current Saturation (Target: 0%)\n                </div>\n            </div>\n\n            <v-alert\n                :type=\"statusType\"\n                :icon=\"statusIcon\"\n                variant=\"tonal\"\n                density=\"compact\"\n            >\n              <div v-if=\"loopCount === 0\">\n                  <v-icon size=\"small\" icon=\"mdi-hand-pointing-up\" class=\"mr-1\"></v-icon>\n                  <span class=\"font-weight-bold\">Ready.</span> Click \"Refresh Gains\" to begin.\n              </div>\n              <div v-else-if=\"hsl.s < 5\">\n                  <v-icon size=\"small\" icon=\"mdi-star-four-points\" class=\"mr-1\"></v-icon>\n                  <span class=\"font-weight-bold\">Calibration Complete</span> ({{ loopCount }} Iterations)\n              </div>\n              <div v-else>\n                  <v-icon size=\"small\" icon=\"mdi-repeat\" class=\"mr-1\"></v-icon>\n                  Iteration <span class=\"font-weight-bold\">{{ loopCount }}</span>  Continue sampling & applying.\n              </div>\n            </v-alert>\n          </section>\n        </v-card>\n      </v-col>\n    </v-row>\n  </v-container>\n</template>\n<script>\nexport default {\n  props: [\"msg\"],\n  data() {\n    return {\n      current: { red: 150, blue: 130 },\n      suggested: { red: null, blue: null },\n      \n      sampledR: 0,\n      sampledG: 0,\n      sampledB: 0,\n\n      hsl: { h: 0, s: 0, l: 0 },\n      loopCount: 0, \n      \n      html2canvasReady: false,\n      captureInterval: null,\n    };\n  },\n  computed: {\n    rows() {\n      return [\n        { channel: \"AWRed\", current: this.current.red, suggested: this.suggested.red },\n        { channel: \"AWBlue\", current: this.current.blue, suggested: this.suggested.blue },\n      ];\n    },\n    statusType() {\n        if (this.loopCount === 0) return 'info';\n        if (this.hsl.s < 5) return 'success';\n        return 'warning';\n    },\n    statusIcon() {\n        if (this.loopCount === 0) return 'mdi-hand-pointing-up';\n        if (this.hsl.s < 5) return 'mdi-star-four-points';\n        return 'mdi-progress-alert';\n    }\n  },\n  watch: {\n    msg: {\n      handler(n) {\n        const p = n?.payload || {};\n        if (p.calibration_wbg_red !== undefined)\n          this.current.red = Number(p.calibration_wbg_red);\n        if (p.calibration_wbg_blue !== undefined)\n          this.current.blue = Number(p.calibration_wbg_blue);\n      },\n      deep: true,\n    },\n  },\n  \n  mounted() {\n    this.loadHtml2Canvas();\n    this.startAutoCapture();\n  },\n\n  beforeUnmount() {\n    this.stopAutoCapture();\n  },\n\n  methods: {\n    // --------------------------------------------\n    // GENERAL METHODS\n    // --------------------------------------------\n    sendUpdate(topic, extra = {}) {\n      if (typeof this.send === \"function\") this.send({ topic, payload: { ...extra } });\n    },\n    \n    // --------------------------------------------\n    // GAIN CONTROL\n    // --------------------------------------------\n    refreshGain() {\n      this.loopCount = 0;\n      this.current = { red: 100, blue: 100 };\n      this.suggested = { red: null, blue: null };\n      this.sendUpdate(\"imager/image\", {\n        action: \"settings\",\n        settings: { white_balance_gain: this.current },\n      });\n    },\n\n    onManualEdit(ch, v) {\n      if (ch === \"AWRed\") this.suggested.red = v;\n      if (ch === \"AWBlue\") this.suggested.blue = v;\n    },\n\n    applySuggested() {\n      if (!this.suggested.red && !this.suggested.blue) return;\n      \n      const p = {\n        action: \"settings\",\n        settings: {\n          white_balance_gain: {\n            red: parseInt(this.suggested.red, 10),\n            blue: parseInt(this.suggested.blue, 10),\n          },\n        },\n      };\n      this.sendUpdate(\"imager/image\", p);\n      \n      this.current = { \n        red: parseInt(this.suggested.red, 10), \n        blue: parseInt(this.suggested.blue, 10) \n      };\n\n      this.loopCount++;\n    },\n    \n    // --------------------------------------------\n    // COLOR UTILITIES\n    // --------------------------------------------\n    rgbToHsl(r, g, b) {\n      const rn = r / 255, gn = g / 255, bn = b / 255;\n      const max = Math.max(rn, gn, bn), min = Math.min(rn, gn, bn);\n      const l = (max + min) / 2;\n      let h = 0, s = 0;\n      if (max !== min) {\n        const d = max - min;\n        s = d / (1 - Math.abs(2 * l - 1));\n        switch (max) {\n          case rn: h = ((gn - bn) / d) % 6; break;\n          case gn: h = (bn - rn) / d + 2; break;\n          case bn: h = (rn - gn) / d + 4; break;\n        }\n        h *= 60;\n      }\n      return { h: Math.round(h), s: Math.round(s * 100), l: Math.round(l * 100) };\n    },\n    \n    // --------------------------------------------\n    // AUTO CAPTURE CONTROL (Always ON)\n    // --------------------------------------------\n    startAutoCapture() {\n      if (!this.html2canvasReady || this.captureInterval) return;\n      this.captureInterval = setInterval(() => {\n        this.captureColorAndCalculateGains();\n      }, 500); // update rate\n    },\n\n    stopAutoCapture() {\n      if (this.captureInterval) {\n        clearInterval(this.captureInterval);\n        this.captureInterval = null;\n      }\n    },\n\n    loadHtml2Canvas() {\n      if (window.html2canvas) {\n        this.html2canvasReady = true;\n        this.startAutoCapture();\n        return;\n      }\n\n      const script = document.createElement(\"script\");\n      script.src =\n        \"https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js\";\n      script.async = true;\n      script.onload = () => {\n        this.html2canvasReady = true;\n        this.startAutoCapture();\n      };\n      document.head.appendChild(script);\n    },\n\n    // --------------------------------------------\n    // PIXEL CAPTURE FROM IFRAME (Core Logic)\n    // --------------------------------------------\n    async captureColorAndCalculateGains() {\n      if (!this.html2canvasReady || !window.html2canvas) return;\n\n      const iframe = this.$el.querySelector(\".calibration-iframe\");\n      if (!iframe?.contentDocument) return;\n\n      const iframeDoc = iframe.contentDocument;\n      const target = iframeDoc.body;\n\n      try {\n        const snapshotCanvas = await window.html2canvas(target);\n\n        const analysisCanvas = this.$refs.captureCanvas;\n        const ctx = analysisCanvas.getContext(\"2d\");\n        const w = analysisCanvas.width;\n        const h = analysisCanvas.height;\n\n        ctx.clearRect(0, 0, w, h);\n        ctx.drawImage(snapshotCanvas, 0, 0, w, h);\n\n        const regionSize = 100;\n        const x = (w - regionSize) / 2;\n        const y = (h - regionSize) / 2;\n\n        const pixelData = ctx.getImageData(x, y, regionSize, regionSize).data;\n\n        let sumR = 0, sumG = 0, sumB = 0;\n        let count = 0;\n\n        for (let i = 0; i < pixelData.length; i += 4) {\n          sumR += pixelData[i];\n          sumG += pixelData[i + 1];\n          sumB += pixelData[i + 2];\n          count++;\n        }\n        \n        const avgR = count > 0 ? Math.round(sumR / count) : 0;\n        const avgG = count > 0 ? Math.round(sumG / count) : 0;\n        const avgB = count > 0 ? Math.round(sumB / count) : 0;\n\n        this.sampledR = avgR;\n        this.sampledG = avgG;\n        this.sampledB = avgB;\n        \n        this.hsl = this.rgbToHsl(avgR, avgG, avgB);\n        \n        const redAdj = avgG - avgR + this.current.red;\n        const blueAdj = avgG - avgB + this.current.blue;\n        \n        this.suggested.red = Math.max(0, Math.min(255, Math.round(redAdj)));\n        this.suggested.blue = Math.max(0, Math.min(255, Math.round(blueAdj)));\n\n      } catch (e) {\n        console.warn(\"Error capturing iframe:\", e);\n      }\n    },\n  },\n};\n</script>\n\n<style scoped>\n.calibration-iframe { \n  width: 100%;\n  height: 100%;\n  border: none; \n  pointer-events: none; \n}\n.calibration-container {\n  position: relative;\n}\n\n/* Styles for the visible sampling box overlay */\n.sampling-overlay {\n  position: absolute;\n  /* (1/3)x(1/3) of the parent size, centered */\n  width: calc(100% / 3); \n  height: calc(100% / 3);\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  border: 4px solid red; \n  pointer-events: none; \n  z-index: 10;\n}\n\n/* Other styles */\n.gain-table { border-radius: 8px; background: #fafafa; border: 1px solid #cfd8dc; }\n.suggested-input { max-width: 80px; margin: auto; }\n.font-mono { font-family: 'Roboto Mono', monospace; }\n</style>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 380,
        "y": 140,
        "wires": [
            [
                "615edad94a4f77e7"
            ]
        ]
    },
    {
        "id": "5fbdba7e61973f9a",
        "type": "ui-template",
        "z": "14c685bd04db8be5",
        "g": "426f6cef77fbb290",
        "group": "728c7ed3d63dfcee",
        "page": "",
        "ui": "",
        "name": "Step Bar",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n  <div>\n    <v-stepper class=\"my-stepper\" model-value=\"2\" non-linear>\n      <v-stepper-header>\n        <v-stepper-item value=\"1\" editable @click=\"stepClicked(1)\" color=\"grey\">Saturation Level</v-stepper-item>\n        <v-divider></v-divider>\n        <v-stepper-item value=\"2\" editable @click=\"stepClicked(2)\" class=\"selected-step\" color=\"primary\">Lightness</v-stepper-item>\n        <v-divider></v-divider>\n        <v-stepper-item value=\"3\" editable @click=\"stepClicked(3)\" color=\"grey\">Pixel size</v-stepper-item>\n        <v-divider></v-divider>\n        <v-stepper-item value=\"4\" editable @click=\"stepClicked(4)\" color=\"grey\">Pump</v-stepper-item>\n      </v-stepper-header>\n    </v-stepper>\n  </div>\n</template>\n\n<script>\n  export default {\n    name: 'StepperComponent',\n    methods: {\n      stepClicked(step) {\n        const stepMapping = {\n          1: { page: 'Calibration - Saturation Level' },\n          2: { page: 'Calibration - Lightness' },\n          3: { page: 'Calibration - Pixel size' },\n          4: { page: 'Calibration - Pump' }\n        };\n\n        const msgPayload = stepMapping[step] || {};\n        \n        this.send({ payload: msgPayload });\n      }\n    }\n  }\n</script>\n",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 1080,
        "y": 60,
        "wires": [
            [
                "25cb0163587aee15"
            ]
        ]
    },
    {
        "id": "25cb0163587aee15",
        "type": "ui-control",
        "z": "14c685bd04db8be5",
        "g": "426f6cef77fbb290",
        "name": "",
        "ui": "e6ae26617c24c3ea",
        "events": "all",
        "x": 1280,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "547bbdea834e849c",
        "type": "ui-event",
        "z": "14c685bd04db8be5",
        "ui": "e6ae26617c24c3ea",
        "name": "UI Event",
        "x": 80,
        "y": 40,
        "wires": [
            [
                "068b250f8668e3ea"
            ]
        ]
    },
    {
        "id": "068b250f8668e3ea",
        "type": "switch",
        "z": "14c685bd04db8be5",
        "name": "msg.topic === \"$pageview\"",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "$pageview",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 280,
        "y": 40,
        "wires": [
            [
                "72dd2876e74c3ef2"
            ]
        ]
    },
    {
        "id": "72dd2876e74c3ef2",
        "type": "switch",
        "z": "14c685bd04db8be5",
        "name": "msg.payload.page.path === \"/calibration_lightness\"",
        "property": "payload.page.path",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "/calibration_lightness",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 620,
        "y": 40,
        "wires": [
            [
                "7245cda05ff489a3"
            ]
        ]
    },
    {
        "id": "7245cda05ff489a3",
        "type": "function",
        "z": "14c685bd04db8be5",
        "name": "Get Global Variables",
        "func": "const keys = global.keys(); // Get all global variable keys\nmsg.payload = {}; // Initialize the payload object\n\nkeys.forEach(key => {\n    // Ignore keys that start with \"$\"\n    if (!key.startsWith('$')) {\n        msg.payload[key] = global.get(key);\n    }\n});\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 120,
        "y": 140,
        "wires": [
            [
                "740188ac42d17f44"
            ]
        ]
    },
    {
        "id": "740188ac42d17f44",
        "type": "ui-template",
        "z": "14c685bd04db8be5",
        "group": "728c7ed3d63dfcee",
        "page": "",
        "ui": "",
        "name": "Calibration - Lightness",
        "order": 2,
        "width": "0",
        "height": "0",
        "head": "",
        "format": "<template>\n  <v-container fluid>\n    <v-row>\n      <v-col cols=\"12\" md=\"8\">\n        <v-card\n          class=\"calibration-container\"\n          style=\"width:100%; height:750px; position:relative; overflow:hidden;\"\n        >\n          <iframe src=\"/preview/node-red\" class=\"calibration-iframe\"></iframe>\n\n          <div class=\"target-overlay\">\n            <v-icon color=\"primary\" size=\"large\">mdi-crosshairs</v-icon>\n          </div>\n\n          <div class=\"sampling-overlay\"></div>\n\n          <canvas\n            ref=\"captureCanvas\"\n            width=\"300\"\n            height=\"300\"\n            style=\"display:none;\"\n          ></canvas>\n        </v-card>\n      </v-col>\n\n      <v-col cols=\"12\" md=\"4\">\n        <v-card class=\"px-4 pb-4 h-100\">\n\n          <v-card-title class=\"text-left text-primary\">\n            Luminance Calibration\n          </v-card-title>\n\n          <v-divider class=\"mb-4\"></v-divider>\n\n          <section class=\"mb-6\">\n            <div class=\"d-flex justify-space-between align-center mb-3\">\n              <h3 class=\"text-subtitle-1 ma-0\">1. LED Control</h3>\n              <v-chip color=\"primary\" variant=\"flat\" class=\"font-mono\">\n                {{ currentLedValue.toFixed(6) }}\n              </v-chip>\n            </div>\n\n            <v-row no-gutters class=\"align-center\">\n              <v-col cols=\"auto\">\n                <v-btn\n                  icon=\"mdi-minus\"\n                  density=\"comfortable\"\n                  variant=\"outlined\"\n                  color=\"primary\"\n                  @click=\"adjustLed(-0.000001)\"\n                  class=\"mr-2\"\n                />\n              </v-col>\n\n              <v-col class=\"flex-grow-1\">\n                <v-slider\n                  v-model=\"currentLedValue\"\n                  min=\"0\"\n                  max=\"1\"\n                  step=\"0.000001\"\n                  color=\"primary\"\n                  track-color=\"grey-lighten-2\"\n                  thumb-label\n                  hide-details\n                  @end=\"onSliderRelease\"\n                  class=\"align-center mt-0\"\n                ></v-slider>\n              </v-col>\n\n              <v-col cols=\"auto\">\n                <v-btn\n                  icon=\"mdi-plus\"\n                  density=\"comfortable\"\n                  variant=\"outlined\"\n                  color=\"primary\"\n                  @click=\"adjustLed(+0.000001)\"\n                  class=\"ml-2\"\n                />\n              </v-col>\n            </v-row>\n            </section>\n\n          <v-divider class=\"mb-4\"></v-divider>\n\n          <section class=\"mb-6\">\n            <div class=\"d-flex justify-space-between align-center mb-2\">\n              <h3 class=\"text-subtitle-1 ma-0\">2. Measured Luminance</h3>\n            </div>\n\n            <div class=\"text-center mb-2\">\n              <div class=\"text-h3 font-weight-bold\">\n                {{ currentLuminance.toFixed(0) }}\n              </div>\n              <div class=\"text-caption text-grey\">\n                Measured from central region of preview\n              </div>\n            </div>\n\n            <v-progress-linear\n              :model-value=\"Math.min(Math.max((currentLuminance / 255) * 100, 0), 100)\"\n              color=\"primary\"\n              height=\"20\"\n              rounded\n            >\n              <template #default=\"{ value }\">\n                <strong style=\"color:white; text-shadow: 0 0 2px black;\">\n                  {{ Math.round(currentLuminance) }}\n                </strong>\n              </template>\n            </v-progress-linear>\n          </section>\n\n        </v-card>\n      </v-col>\n    </v-row>\n  </v-container>\n</template>\n\n<script>\nexport default {\n  props: [\"msg\"],\n  data() {\n    return {\n      currentLedValue: 0.5,\n      currentLuminance: 0,\n      html2canvasReady: false,\n      captureInterval: null,\n    };\n  },\n\n  watch: {\n    msg: {\n      handler(n) {\n        const p = n?.payload || {};\n        if (p.led_intensity !== undefined)\n          this.currentLedValue = Number(p.led_intensity);\n        if (p.value !== undefined)\n          this.currentLedValue = Number(p.value);\n      },\n      deep: true,\n    },\n  },\n\n  mounted() {\n    this.loadHtml2Canvas();\n    this.startAutoCapture();\n  },\n\n  beforeUnmount() {\n    this.stopAutoCapture();\n  },\n\n  methods: {\n    // --------------------------------------------\n    // LED CONTROL\n    // --------------------------------------------\n    adjustLed(step) {\n      let v = this.currentLedValue + step;\n      v = Math.max(0, Math.min(1, v));\n      this.currentLedValue = v;\n      this.onSliderRelease();\n    },\n\n    onSliderRelease() {\n      this.sendUpdate(\"light\", {\n        action: \"on\",\n        value: Number(this.currentLedValue.toFixed(5)),\n      });\n    },\n\n    sendUpdate(topic, payload) {\n      const msg = { topic, payload };\n      if (this.$emit) this.$emit(\"msg-input\", msg);\n      if (this.send) this.send(msg);\n    },\n\n    // --------------------------------------------\n    // AUTO CAPTURE CONTROL (Always ON)\n    // --------------------------------------------\n    startAutoCapture() {\n      if (!this.html2canvasReady || this.captureInterval) return;\n      this.captureInterval = setInterval(() => {\n        this.captureLuminance();\n      }, 500); // update rate\n    },\n\n    stopAutoCapture() {\n      if (this.captureInterval) {\n        clearInterval(this.captureInterval);\n        this.captureInterval = null;\n      }\n    },\n\n    loadHtml2Canvas() {\n      if (window.html2canvas) {\n        this.html2canvasReady = true;\n        this.startAutoCapture();\n        return;\n      }\n\n      const script = document.createElement(\"script\");\n      script.src =\n        \"https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js\";\n      script.async = true;\n      script.onload = () => {\n        this.html2canvasReady = true;\n        this.startAutoCapture();\n      };\n      document.head.appendChild(script);\n    },\n\n    // --------------------------------------------\n    // PIXEL CAPTURE FROM IFRAME\n    // --------------------------------------------\n    async captureLuminance() {\n      if (!this.html2canvasReady || !window.html2canvas) return;\n\n      const iframe = this.$el.querySelector(\".calibration-iframe\");\n      if (!iframe?.contentDocument) return;\n\n      const iframeDoc = iframe.contentDocument;\n      const target = iframeDoc.body;\n\n      try {\n        const snapshotCanvas = await window.html2canvas(target);\n\n        const analysisCanvas = this.$refs.captureCanvas;\n        const ctx = analysisCanvas.getContext(\"2d\");\n        const w = analysisCanvas.width;\n        const h = analysisCanvas.height;\n\n        ctx.clearRect(0, 0, w, h);\n        ctx.drawImage(snapshotCanvas, 0, 0, w, h);\n\n        const regionSize = 100;\n        const x = (w - regionSize) / 2;\n        const y = (h - regionSize) / 2;\n\n        const pixelData = ctx.getImageData(x, y, regionSize, regionSize).data;\n\n        let sum = 0;\n        let count = 0;\n\n        for (let i = 0; i < pixelData.length; i += 4) {\n          const r = pixelData[i];\n          const g = pixelData[i + 1];\n          const b = pixelData[i + 2];\n          sum += (r + g + b) / 3;\n          count++;\n        }\n\n        this.currentLuminance = count > 0 ? sum / count : 0;\n      } catch (e) {\n        console.warn(\"Error capturing iframe:\", e);\n      }\n    },\n  },\n};\n</script>\n\n<style scoped>\n.calibration-iframe {\n  width: 100%;\n  height: 100%;\n  border: none;\n}\n.target-overlay {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  pointer-events: none;\n  opacity: 0.5;\n}\n\n.sampling-overlay {\n  position: absolute;\n  width: calc(100% / 3); \n  height: calc(100% / 3);\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  border: 4px solid red; \n  pointer-events: none; \n  z-index: 10;\n}\n\n.font-mono {\n  font-family: 'Roboto Mono', monospace;\n}\n</style>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 400,
        "y": 140,
        "wires": [
            [
                "959de9b1292e047d"
            ]
        ]
    },
    {
        "id": "785c59c553d71326",
        "type": "mqtt out",
        "z": "14c685bd04db8be5",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "broker": "8dc3722c.06efa8",
        "x": 850,
        "y": 100,
        "wires": []
    },
    {
        "id": "0283e992ff5da0f6",
        "type": "function",
        "z": "14c685bd04db8be5",
        "name": "set led_intensity",
        "func": "if (msg.topic) {\n    global.set(\"led_intensity\", msg.payload.value);}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 880,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "959de9b1292e047d",
        "type": "switch",
        "z": "14c685bd04db8be5",
        "name": "",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "light",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 590,
        "y": 140,
        "wires": [
            [
                "785c59c553d71326",
                "0283e992ff5da0f6"
            ]
        ]
    },
    {
        "id": "05a5a9c4530d07ea",
        "type": "ui-template",
        "z": "3afb1d2b21be9114",
        "g": "da1cb3ed0c90bb56",
        "group": "c966455a52d121c0",
        "page": "",
        "ui": "",
        "name": "Step Bar",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n  <div>\n    <v-stepper class=\"my-stepper\" model-value=\"3\" non-linear>\n      <v-stepper-header>\n        <v-stepper-item value=\"1\" editable @click=\"stepClicked(1)\" color=\"grey\">Saturation Level</v-stepper-item>\n        <v-divider></v-divider>\n        <v-stepper-item value=\"2\" editable @click=\"stepClicked(2)\" color=\"grey\">Lightness</v-stepper-item>\n        <v-divider></v-divider>\n        <v-stepper-item value=\"3\" editable @click=\"stepClicked(3)\" class=\"selected-step\" color=\"primary\">Pixel size</v-stepper-item>\n        <v-divider></v-divider>\n        <v-stepper-item value=\"4\" editable @click=\"stepClicked(4)\" color=\"grey\">Pump</v-stepper-item>\n      </v-stepper-header>\n    </v-stepper>\n  </div>\n</template>\n\n<script>\n  export default {\n    name: 'StepperComponent',\n    methods: {\n      stepClicked(step) {\n        const stepMapping = {\n          1: { page: 'Calibration - Saturation Level' },\n          2: { page: 'Calibration - Lightness' },\n          3: { page: 'Calibration - Pixel size' },\n          4: { page: 'Calibration - Pump' }\n        };\n\n        const msgPayload = stepMapping[step] || {};\n        \n        this.send({ payload: msgPayload });\n      }\n    }\n  }\n</script>\n",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 1080,
        "y": 60,
        "wires": [
            [
                "419cccaf23eb2548"
            ]
        ]
    },
    {
        "id": "419cccaf23eb2548",
        "type": "ui-control",
        "z": "3afb1d2b21be9114",
        "g": "da1cb3ed0c90bb56",
        "name": "",
        "ui": "e6ae26617c24c3ea",
        "events": "all",
        "x": 1280,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "2352be52ae097a08",
        "type": "ui-template",
        "z": "3afb1d2b21be9114",
        "group": "c966455a52d121c0",
        "page": "",
        "ui": "",
        "name": "Calibration - Pixel Size",
        "order": 2,
        "width": "0",
        "height": "0",
        "head": "",
        "format": "<template>\n  <v-container fluid>\n    <v-row>\n\n      <!-- Streaming Preview (colonne 6/12) -->\n      <v-col cols=\"12\" md=\"8\">\n        <v-card\n          class=\"calibration-container\"\n          style=\"width:1000px;height:750px;position:relative;overflow:hidden\"\n          @pointermove=\"onPointerMove\"\n          @pointerup=\"stopDrag\"\n          @pointercancel=\"stopDrag\"\n          @pointerleave=\"stopDrag\"\n        >\n          <iframe src=\"/preview/node-red\" class=\"calibration-iframe\"></iframe>\n\n          <svg class=\"overlay-line\">\n            <line\n              :x1=\"markerA.x\"\n              :y1=\"markerA.y\"\n              :x2=\"markerB.x\"\n              :y2=\"markerB.y\"\n              stroke=\"red\"\n              stroke-width=\"2\"\n            />\n          </svg>\n\n          <!-- draggable markers -->\n          <div\n            class=\"marker\"\n            :style=\"{ left: markerA.x + 'px', top: markerA.y + 'px' }\"\n            @pointerdown=\"startDrag('A', $event)\"\n          ></div>\n\n          <div\n            class=\"marker\"\n            :style=\"{ left: markerB.x + 'px', top: markerB.y + 'px' }\"\n            @pointerdown=\"startDrag('B', $event)\"\n          ></div>\n\n          <!-- floating label -->\n          <div\n            class=\"distance-label\"\n            :style=\"{ left: midPoint.x + 'px', top: midPoint.y - 10 + 'px' }\"\n          >\n            {{ displayLabel }}\n          </div>\n        </v-card>\n      </v-col>\n\n      <!-- Control Panel (colonne 6/12) -->\n      <v-col cols=\"12\" md=\"4\">\n        <v-card class=\"px-4\">\n          <v-card-title class=\"text-left text-primary\">\n            Pixel Calibration\n          </v-card-title>\n\n          <v-divider class=\"mb-4\"></v-divider>\n\n          <section class=\"mb-6\">\n            <h3 class=\"text-subtitle-1 mb-2\">1. Place a ruler</h3>\n            <p class=\"text-caption mb-3\">\n              Place a ruler  beneath your <b>PlanktoScope</b> and reset the marker.\n            </p>\n            <v-btn color=\"error\" block class=\"mt-3\" @click=\"reset\">\n              Reset the positions of the markers\n            </v-btn>\n          </section>\n\n          <v-divider class=\"mb-4\"></v-divider>\n\n          <section class=\"mb-2\">\n            <h3 class=\"text-subtitle-1 mb-2\">2. Define the positions</h3>\n            <p class=\"text-caption mb-3\">\n              Drag the red line ends to match a known distance on the ruler.\n            </p>\n\n            <v-text-field\n              v-model=\"pixelDistanceDisplay\"\n              label=\"Measured distance (px)\"\n              variant=\"outlined\"\n              density=\"comfortable\"\n              readonly\n              :style=\"{ pointerEvents: 'none', userSelect: 'none', opacity: 0.7 }\"\n            ></v-text-field>\n          </section>\n\n          <v-divider class=\"mb-4\"></v-divider>\n\n          <section class=\"mb-2\">\n            <h3 class=\"text-subtitle-1 mb-2\">3. Enter known distance</h3>\n            <p class=\"text-caption mb-3\">\n              Enter the known distance in micrometers (m).\n            </p>\n\n            <v-text-field\n              v-model.number=\"knownDistance\"\n              label=\"Known distance (m)\"\n              type=\"number\"\n              variant=\"outlined\"\n              density=\"comfortable\"\n              class=\"highlight\"\n              @input=\"sendUpdate('calibration/update')\"\n            ></v-text-field>\n          </section>\n\n          <v-divider class=\"mb-4\"></v-divider>\n\n          <!-- Step 4 with dialog -->\n          <section class=\"mb-6\">\n            <h3 class=\"text-subtitle-1 mb-2\">4. Save your calibration</h3>\n            <p class=\"text-caption mb-3\">Click Save to store your calibration.</p>\n\n            <v-row dense align=\"center\">\n              <v-col cols=\"12\">\n                <v-text-field\n                  v-model=\"pixelSizeDisplay\"\n                  label=\"Real pixel size (m/pixel)\"\n                  readonly\n                  variant=\"outlined\"\n                  density=\"comfortable\"\n                  class=\"highlight\"\n                >\n                  <template #append>\n                    <v-icon\n                      class=\"cursor-pointer\"\n                      color=\"primary\"\n                      @click=\"showFormula = true\"\n                    >\n                      mdi-information\n                    </v-icon>\n                  </template>\n                </v-text-field>\n\n                <!-- Dialogue -->\n                <v-dialog v-model=\"showFormula\" max-width=\"500\">\n                  <v-card>\n                    <v-card-title class=\"text-h6\">Pixel Size Calculation</v-card-title>\n                    <v-card-text class=\"text-body-2\">\n                      <div><strong>Formula:</strong></div>\n                      <div>\n                        pixel_size = known_distance / (measured_distance  scale_factor)\n                      </div>\n\n                      <div class=\"mt-2\">\n                        = {{ knownDistance || '' }} /\n                        ({{ pixelDistanceDisplay || '' }} \n                        {{ scaleFactor ? scaleFactor.toFixed(3) : '' }}) =\n                        <strong>{{ pixelSizeDisplay || '' }} m/pixel</strong>\n                      </div>\n\n                      <v-divider class=\"my-3\"></v-divider>\n\n                      <div class=\"text-caption text-grey-darken-1\">\n                        <strong>Note:</strong><br />\n                        scale_factor = sensor_width / stream_width<br />\n                        = {{ sensorWidth || '' }} / {{ streamWidth || '' }}<br />\n                        = {{ scaleFactor ? scaleFactor.toFixed(3) : '' }}\n                      </div>\n                    </v-card-text>\n\n                    <v-card-actions>\n                      <v-spacer></v-spacer>\n                      <v-btn color=\"primary\" text @click=\"showFormula = false\">\n                        Close\n                      </v-btn>\n                    </v-card-actions>\n                  </v-card>\n                </v-dialog>\n              </v-col>\n            </v-row>\n\n            <v-btn\n              color=\"primary\"\n              block\n              class=\"mt-2\"\n              :disabled=\"!pixelSize\"\n              @click=\"saveCalibration\"\n            >\n              Save calibration\n            </v-btn>\n          </section>\n\n        </v-card>\n      </v-col>\n\n    </v-row>\n  </v-container>\n</template>\n\n\n<script>\nexport default {\n  props: [\"msg\"],\n  data() {\n    return {\n      markerA: { x: 250, y: 375 },\n      markerB: { x: 750, y: 375 },\n      dragging: null,\n      knownDistance: null,\n      pixelDistance: 0,\n      sensorWidth: 4056,\n      streamWidth: 1000,\n      scaleFactor: 4056 / 1000,\n      pixelSize: null,\n      scaleManual: false,\n      showFormula: false, //  Nouveau : tat du dialog\n    };\n  },\n  computed: {\n    midPoint() {\n      return {\n        x: (this.markerA.x + this.markerB.x) / 2,\n        y: (this.markerA.y + this.markerB.y) / 2,\n      };\n    },\n    pixelDistanceDisplay() {\n      return this.pixelDistance > 0 ? this.pixelDistance.toFixed(0) : \"\";\n    },\n    pixelSizeDisplay() {\n      return this.pixelSize ? this.pixelSize.toFixed(2) : \"\";\n    },\n    displayLabel() {\n      if (this.pixelSize)\n        return `${this.pixelSize.toFixed(2)} m/px`;\n      return `${this.pixelDistance.toFixed(0)} px`;\n    },\n  },\n  watch: {\n    msg: {\n      handler(newMsg) {\n        const p = newMsg?.payload || {};\n        if (p.calibration_pixel_size !== undefined) this.pixelSize = Number(p.calibration_pixel_size);\n        if (p.calibration_scale_factor !== undefined) this.scaleFactor = Number(p.calibration_scale_factor);\n        if (p.calibration_sensor_width !== undefined) this.sensorWidth = Number(p.calibration_sensor_width);\n        if (p.calibration_stream_width !== undefined) this.streamWidth = Number(p.calibration_stream_width);\n        if (p.calibration_known_distance !== undefined) this.knownDistance = Number(p.calibration_known_distance);\n        if (p.calibration_measured_distance !== undefined) this.pixelDistance = Number(p.calibration_measured_distance);\n        if (p.calibration_markerA_x !== undefined && p.calibration_markerA_y !== undefined)\n          this.markerA = { x: Number(p.calibration_markerA_x), y: Number(p.calibration_markerA_y) };\n        if (p.calibration_markerB_x !== undefined && p.calibration_markerB_y !== undefined)\n          this.markerB = { x: Number(p.calibration_markerB_x), y: Number(p.calibration_markerB_y) };\n      },\n      deep: true,\n    },\n    knownDistance() { this.autoCalculate(); },\n    scaleFactor() { this.autoCalculate(); },\n  },\n  mounted() {\n    this.updateScaleFactor();\n    this.updateDistance();\n  },\n  methods: {\n    sendUpdate(topic, extra = {}) {\n      if (typeof this.send === \"function\") {\n        this.send({\n          topic,\n          payload: {\n            calibration_pixel_size: this.round(this.pixelSize, 2),\n            calibration_scale_factor: this.round(this.scaleFactor, 3),\n            calibration_sensor_width: Math.round(this.sensorWidth),\n            calibration_stream_width: Math.round(this.streamWidth),\n            calibration_known_distance: this.round(this.knownDistance, 2),\n            calibration_measured_distance: Math.round(this.pixelDistance),\n            calibration_markerA_x: this.round(this.markerA.x, 1),\n            calibration_markerA_y: this.round(this.markerA.y, 1),\n            calibration_markerB_x: this.round(this.markerB.x, 1),\n            calibration_markerB_y: this.round(this.markerB.y, 1),\n            ...extra,\n          },\n        });\n      }\n    },\n    round(value, digits = 2) {\n      if (typeof value !== \"number\" || isNaN(value)) return 0;\n      const factor = 10 ** digits;\n      return Math.round(value * factor) / factor;\n    },\n    startDrag(marker, e) {\n      e.preventDefault();\n      this.dragging = marker;\n      e.target.setPointerCapture(e.pointerId);\n    },\n    onPointerMove(e) {\n      if (!this.dragging) return;\n      const container = this.$el.querySelector(\".calibration-container\");\n      const rect = container.getBoundingClientRect();\n      const x = Math.max(0, Math.min(e.clientX - rect.left, rect.width));\n      const y = Math.max(0, Math.min(e.clientY - rect.top, rect.height));\n      this[`marker${this.dragging}`] = { x, y };\n      this.updateDistance();\n      this.sendUpdate(\"calibration/live\");\n    },\n    stopDrag() {\n      this.dragging = null;\n    },\n    updateDistance() {\n      const dx = this.markerB.x - this.markerA.x;\n      const dy = this.markerB.y - this.markerA.y;\n      this.pixelDistance = Math.sqrt(dx * dx + dy * dy);\n      this.autoCalculate();\n    },\n    updateScaleFactor() {\n      if (!this.scaleManual && this.sensorWidth > 0 && this.streamWidth > 0) {\n        this.scaleFactor = this.sensorWidth / this.streamWidth;\n        this.autoCalculate();\n      }\n    },\n    manualScaleFactor() {\n      this.scaleManual = true;\n      this.autoCalculate();\n    },\n    autoCalculate() {\n      const { knownDistance, pixelDistance, scaleFactor } = this;\n      if (knownDistance > 0 && pixelDistance > 0 && scaleFactor > 0) {\n        const realDist = pixelDistance * scaleFactor;\n        this.pixelSize = knownDistance / realDist;\n      } else {\n        this.pixelSize = null;\n      }\n    },\n    reset() {\n      this.markerA = { x: 250, y: 375 };\n      this.markerB = { x: 750, y: 375 };\n      this.knownDistance = null;\n      this.pixelDistance = 0;\n      this.pixelSize = null;\n      this.dragging = null;\n      this.scaleManual = false;\n      this.updateScaleFactor();\n      this.updateDistance();\n      this.sendUpdate(\"calibration/reset\");\n    },\n    saveCalibration() {\n      if (this.pixelSize > 0) this.sendUpdate(\"calibration/save\");\n    },\n  },\n};\n</script>\n\n<style scoped>\n.calibration-iframe {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 1000px;\n  height: 750px;\n  border: none;\n  pointer-events: none;\n}\n.overlay-line {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  pointer-events: none;\n}\n.marker {\n  position: absolute;\n  width: 24px;\n  height: 24px;\n  transform: translate(-50%, -50%);\n  cursor: crosshair;\n  touch-action: none;\n}\n.marker::before,\n.marker::after {\n  content: \"\";\n  position: absolute;\n  background: red;\n}\n.marker::before {\n  width: 2px;\n  height: 24px;\n  left: 50%;\n  top: 0;\n  transform: translateX(-50%);\n}\n.marker::after {\n  width: 24px;\n  height: 2px;\n  top: 50%;\n  left: 0;\n  transform: translateY(-50%);\n}\n.distance-label {\n  position: absolute;\n  color: white;\n  font-size: 16px;\n  background: rgba(0, 0, 0, 0.7);\n  padding: 4px 10px;\n  border-radius: 6px;\n  pointer-events: none;\n  transform: translate(-50%, -50%);\n}\n.highlight input {\n  background-color: #e3f2fd !important;\n  font-weight: 600;\n}\n</style>\n",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 400,
        "y": 140,
        "wires": [
            [
                "a30cdd39d7c3b802"
            ]
        ]
    },
    {
        "id": "d10ef113c9a4b297",
        "type": "ui-event",
        "z": "3afb1d2b21be9114",
        "ui": "e6ae26617c24c3ea",
        "name": "UI Event",
        "x": 80,
        "y": 40,
        "wires": [
            [
                "78cf0ca00b9e1214"
            ]
        ]
    },
    {
        "id": "78cf0ca00b9e1214",
        "type": "switch",
        "z": "3afb1d2b21be9114",
        "name": "msg.topic === \"$pageview\"",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "$pageview",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 280,
        "y": 40,
        "wires": [
            [
                "943c62c18d43f2a6"
            ]
        ]
    },
    {
        "id": "943c62c18d43f2a6",
        "type": "switch",
        "z": "3afb1d2b21be9114",
        "name": "msg.payload.page.path === \"/calibration_pixel_size\"",
        "property": "payload.page.path",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "/calibration_pixel_size",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 620,
        "y": 40,
        "wires": [
            [
                "0deb8e29532f1503"
            ]
        ]
    },
    {
        "id": "0deb8e29532f1503",
        "type": "function",
        "z": "3afb1d2b21be9114",
        "name": "Get Global Variables",
        "func": "const keys = global.keys(); // Get all global variable keys\nmsg.payload = {}; // Initialize the payload object\n\nkeys.forEach(key => {\n    // Ignore keys that start with \"$\"\n    if (!key.startsWith('$')) {\n        msg.payload[key] = global.get(key);\n    }\n});\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 120,
        "y": 140,
        "wires": [
            [
                "2352be52ae097a08"
            ]
        ]
    },
    {
        "id": "a30cdd39d7c3b802",
        "type": "switch",
        "z": "3afb1d2b21be9114",
        "name": "",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "calibration/save",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 590,
        "y": 140,
        "wires": [
            [
                "13cda406d9feacec"
            ]
        ]
    },
    {
        "id": "13cda406d9feacec",
        "type": "function",
        "z": "3afb1d2b21be9114",
        "name": "set calibration_pixel_size",
        "func": "if (msg.topic) {\n    global.set(\"process_pixel\", msg.payload.calibration_pixel_size);\n    global.set(\"calibration_pixel_size\", msg.payload.calibration_pixel_size);\n    global.set(\"calibration_scale_factor\", msg.payload.calibration_scale_factor);\n    global.set(\"calibration_sensor_width\", msg.payload.calibration_sensor_width);\n    global.set(\"calibration_stream_width\", msg.payload.calibration_stream_width);\n    global.set(\"calibration_known_distance\", msg.payload.calibration_known_distance);\n    global.set(\"calibration_measured_distance\", msg.payload.calibration_measured_distance);\n    global.set(\"calibration_markerA_x\", msg.payload.calibration_markerA_x);\n    global.set(\"calibration_markerA_y\", msg.payload.calibration_markerA_y);\n    global.set(\"calibration_markerB_x\", msg.payload.calibration_markerB_x);\n    global.set(\"calibration_markerB_y\", msg.payload.calibration_markerB_y);\n}\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1010,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "c92cd7e25b01278d",
        "type": "ui-template",
        "z": "d5b2c64b84f8ed4f",
        "g": "0861054b07c3373d",
        "group": "6039d653304537af",
        "page": "",
        "ui": "",
        "name": "Step Bar",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n  <div>\n    <v-stepper class=\"my-stepper\" model-value=\"4\" non-linear>\n      <v-stepper-header>\n        <v-stepper-item value=\"1\" editable @click=\"stepClicked(1)\" color=\"grey\">Saturation Level</v-stepper-item>\n        <v-divider></v-divider>\n        <v-stepper-item value=\"2\" editable @click=\"stepClicked(2)\" color=\"grey\">Lightness</v-stepper-item>\n        <v-divider></v-divider>\n        <v-stepper-item value=\"3\" editable @click=\"stepClicked(3)\" color=\"grey\">Pixel size</v-stepper-item>\n        <v-divider></v-divider>\n        <v-stepper-item value=\"4\" editable @click=\"stepClicked(4)\" class=\"selected-step\" color=\"primary\">Pump</v-stepper-item>\n      </v-stepper-header>\n    </v-stepper>\n  </div>\n</template>\n\n<script>\n  export default {\n    name: 'StepperComponent',\n    methods: {\n      stepClicked(step) {\n        const stepMapping = {\n          1: { page: 'Calibration - Saturation Level' },\n          2: { page: 'Calibration - Lightness' },\n          3: { page: 'Calibration - Pixel size' },\n          4: { page: 'Calibration - Pump' }\n        };\n\n        const msgPayload = stepMapping[step] || {};\n        \n        this.send({ payload: msgPayload });\n      }\n    }\n  }\n</script>\n",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 1080,
        "y": 60,
        "wires": [
            [
                "f8db1578262f6bc8"
            ]
        ]
    },
    {
        "id": "f8db1578262f6bc8",
        "type": "ui-control",
        "z": "d5b2c64b84f8ed4f",
        "g": "0861054b07c3373d",
        "name": "",
        "ui": "e6ae26617c24c3ea",
        "events": "all",
        "x": 1280,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "b69414b64961f4e9",
        "type": "ui-event",
        "z": "d5b2c64b84f8ed4f",
        "ui": "e6ae26617c24c3ea",
        "name": "UI Event",
        "x": 80,
        "y": 40,
        "wires": [
            [
                "2e99999b7cf152b7"
            ]
        ]
    },
    {
        "id": "2e99999b7cf152b7",
        "type": "switch",
        "z": "d5b2c64b84f8ed4f",
        "name": "msg.topic === \"$pageview\"",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "$pageview",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 280,
        "y": 40,
        "wires": [
            [
                "138136e6a1917e49"
            ]
        ]
    },
    {
        "id": "138136e6a1917e49",
        "type": "switch",
        "z": "d5b2c64b84f8ed4f",
        "name": "msg.payload.page.path === \"/calibration_pump\"",
        "property": "payload.page.path",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "/calibration_pump",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 610,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "0a0c441d1757b9d2",
        "type": "function",
        "z": "d5b2c64b84f8ed4f",
        "name": "Get Global Variables",
        "func": "const keys = global.keys(); // Get all global variable keys\nmsg.payload = {}; // Initialize the payload object\n\nkeys.forEach(key => {\n    // Ignore keys that start with \"$\"\n    if (!key.startsWith('$')) {\n        msg.payload[key] = global.get(key);\n    }\n});\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 120,
        "y": 140,
        "wires": [
            [
                "1bd39bfcfab012fe"
            ]
        ]
    },
    {
        "id": "1bd39bfcfab012fe",
        "type": "ui-template",
        "z": "d5b2c64b84f8ed4f",
        "group": "6039d653304537af",
        "page": "",
        "ui": "",
        "name": "Calibration - Pump",
        "order": 2,
        "width": "0",
        "height": "0",
        "head": "",
        "format": "<template>\n  <v-container class=\"py-6 d-flex flex-column align-center\" style=\"gap: 24px;\">\n    <v-card width=\"440\" class=\"px-4\">\n      <v-card-title class=\"text-left text-primary\">Pump Calibration</v-card-title>\n      <v-divider class=\"mb-4\"></v-divider>\n\n      <!-- Step 1 -->\n      <section class=\"mb-6\">\n        <h3 class=\"text-subtitle-1 mb-2\">1. Place a scale</h3>\n        <p class=\"text-caption mb-3\">Place a scale  beneath the waste container.</p>\n      </section>\n\n      <v-divider class=\"mb-4\"></v-divider>\n      <!-- Step 2 -->\n      <section class=\"mb-6\">\n        <h3 class=\"text-subtitle-1 mb-2\">2. Run a liquid transfer</h3>\n        <p class=\"text-caption mb-3\">Run a liquid transfer to collect a known volume.</p>\n\n        <v-row dense align=\"center\">\n          <v-col cols=\"12\">\n            <v-text-field\n              v-model.number=\"targetVolume\"\n              label=\"Target Volume (mL)\"\n              type=\"number\"\n              variant=\"outlined\"\n              density=\"comfortable\"\n              min=\"0\"\n            />\n          </v-col>\n\n          <v-col cols=\"6\">\n            <v-btn\n              color=\"error\"\n              block\n              @click=\"stopPump\"\n              :disabled=\"!pumpRunning\"\n            >\n               Stop Pump\n            </v-btn>\n          </v-col>\n\n          <v-col cols=\"6\">\n            <v-btn\n              color=\"primary\"\n              block\n              @click=\"runTransferTest\"\n              :loading=\"pumpRunning\"\n              :disabled=\"pumpRunning\"\n            >\n              Run Test\n            </v-btn>\n          </v-col>\n        </v-row>\n      </section>\n\n      <v-divider class=\"mb-4\"></v-divider>\n      <!-- Step 3 -->\n      <section class=\"mb-0\">\n        <h3 class=\"text-subtitle-1 mb-2\">3. Measure the weight</h3>\n        <p class=\"text-caption mb-3\">\n          Enter the measured weight in milliliters (mL).\n        </p>\n\n        <v-row dense align=\"center\">\n          <v-col cols=\"7\">\n            <v-text-field\n              v-model.number=\"measuredVolume\"\n              label=\"Measured Volume (mL)\"\n              type=\"number\"\n              variant=\"outlined\"\n              density=\"comfortable\"\n              min=\"0\"\n              :disabled=\"!pumpDone\"\n            />\n          </v-col>\n\n          <v-col cols=\"5\" class=\"mb-6\">\n            <v-alert\n              v-if=\"pumpDone\"\n              color=\"error\"\n              variant=\"tonal\"\n              class=\"pa-3 text-caption text-primary-darken-3\"\n            >\n              <strong>Delta:</strong> {{ errorVolume.toFixed(2) }} mL\n            </v-alert>\n          </v-col>\n        </v-row>\n      </section>\n\n      <v-divider class=\"mb-4\"></v-divider>\n      <!-- Step 4 -->\n      <section class=\"mb-0\">\n        <h3 class=\"text-subtitle-1 mb-2\">4. Save your calibration.</h3>\n        <p class=\"text-caption mb-3\">\n          Click <b>Save</b> to store your calibration.\n        </p>\n\n        <div class=\"mb-3\">\n          <v-text-field\n            v-model.number=\"currentSteps\"\n            label=\"Current steps per 1 mL (S)\"\n            type=\"number\"\n            variant=\"outlined\"\n            density=\"comfortable\"\n            min=\"1\"\n            :disabled=\"!pumpDone\"\n\n          readonly\n          :style=\"{ pointerEvents: 'none', userSelect: 'none', opacity: 0.7 }\"\n          />\n        </div>\n\n        <div class=\"mb-3 d-flex align-center\">\n\n          <v-text-field\n            v-model.number=\"suggestedSteps\"\n            label=\"Suggested steps per 1 mL (S)\"\n            type=\"number\"\n            variant=\"outlined\"\n            density=\"comfortable\"\n            min=\"1\"\n            :disabled=\"!pumpDone\"\n    class=\"highlight\"\n\n  >\n    <!-- Icne append avec dialogue -->\n    <template #append>\n      <v-icon\n        class=\"cursor-pointer\"\n        color=\"primary\"\n        @click=\"dialog = true\"\n      >\n        mdi-information\n      </v-icon>\n    </template>\n          </v-text-field>\n        </div>\n      </section>\n\n      <section class=\"mb-6\">\n          <v-btn\n            color=\"primary\"\n            block\n            @click=\"validateCalibration\"\n            :disabled=\"!pumpDone\"\n          >\n            Validate\n          </v-btn>\n\n        <!-- Dialog with formula -->\n        <v-dialog v-model=\"dialog\" max-width=\"480\">\n          <v-card>\n            <v-card-title class=\"text-h6 text-primary\">Formula</v-card-title>\n            <v-card-text class=\"text-body-2\">\n              <p><strong>Suggested steps per 1 mL = (Volume to transfer (Y) / Transferred volume (X))  Current steps (S)</strong></p>\n              <p>\n                (Y / X)  S = ({{ targetVolume }} / {{ measuredVolume }})  {{ currentSteps }} = \n                <b>{{ suggestedSteps.toFixed(0) }}</b> steps\n              </p>\n            </v-card-text>\n            <v-card-actions>\n              <v-spacer></v-spacer>\n              <v-btn text color=\"primary\" @click=\"dialog = false\">Close</v-btn>\n            </v-card-actions>\n          </v-card>\n        </v-dialog>\n      </section>\n    </v-card>\n  </v-container>\n</template>\n\n<script>\nexport default {\n  props: [\"msg\"],\n  data() {\n    return {\n      targetVolume: 10, // Y\n      measuredVolume: 0, // X\n      currentSteps: 507, // S\n      pumpRunning: false,\n      pumpDone: false,\n      dialog: false,\n    };\n  },\n  computed: {\n    errorVolume() {\n      return this.targetVolume - this.measuredVolume;\n    },\n    suggestedSteps() {\n      const { targetVolume, measuredVolume, currentSteps } = this;\n      if (measuredVolume <= 0) return currentSteps;\n      return Math.round((targetVolume / measuredVolume) * currentSteps);\n    },\n  },\n  watch: {\n    msg: {\n      handler(newMsg) {\n        const topic = newMsg?.topic;\n        const payload = newMsg?.payload || {};\n        if (topic === \"status/pump\" && payload.status === \"Done\") {\n          this.pumpRunning = false;\n          this.pumpDone = true;\n        }\n      },\n      deep: true,\n    },\n  },\n  methods: {\n    sendUpdate(topic, extra = {}) {\n      if (typeof this.send === \"function\") {\n        this.send({ topic, payload: { ...extra } });\n      }\n    },\n    runTransferTest() {\n      this.pumpDone = false;\n      this.pumpRunning = true;\n      this.sendUpdate(\"actuator/pump\", {\n        action: \"move\",\n        direction: \"FORWARD\",\n        volume: this.targetVolume,\n        flowrate: 1,\n      });\n    },\n    stopPump() {\n      this.sendUpdate(\"actuator/pump\", { action: \"stop\" });\n      this.pumpRunning = false;\n    },\n    validateCalibration() {\n      const steps = Math.round(this.suggestedSteps);\n      this.sendUpdate(\"calibration/save\", {\n        calibration_nb_step: steps,\n      });\n    },\n  },\n};\n</script>\n<style>\n\n.highlight input {\n  background-color: #e3f2fd !important;\n  font-weight: 600;\n}\n</style>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 390,
        "y": 140,
        "wires": [
            [
                "b4d023d76ef0504c"
            ]
        ]
    },
    {
        "id": "f2348c422d051cc9",
        "type": "mqtt out",
        "z": "d5b2c64b84f8ed4f",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "broker": "8dc3722c.06efa8",
        "x": 850,
        "y": 100,
        "wires": []
    },
    {
        "id": "b4d023d76ef0504c",
        "type": "switch",
        "z": "d5b2c64b84f8ed4f",
        "name": "",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "actuator/pump",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "calibration/save",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 590,
        "y": 140,
        "wires": [
            [
                "f2348c422d051cc9"
            ],
            [
                "486bc5c0891a3a15"
            ]
        ]
    },
    {
        "id": "b49a9221938d1621",
        "type": "mqtt in",
        "z": "d5b2c64b84f8ed4f",
        "name": "",
        "topic": "status/pump",
        "qos": "0",
        "datatype": "json",
        "broker": "8dc3722c.06efa8",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 90,
        "y": 340,
        "wires": [
            [
                "1bd39bfcfab012fe"
            ]
        ]
    },
    {
        "id": "486bc5c0891a3a15",
        "type": "function",
        "z": "d5b2c64b84f8ed4f",
        "name": "set calibration_pump",
        "func": "if (msg.topic) {\n    global.set(\"calibration_nb_step\", msg.payload.calibration_nb_step);\n}\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1000,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "64ae825a687fb054",
        "type": "ecotaxa",
        "z": "8555b76c53e789e0",
        "name": "Import to Ecotaxa Project",
        "api_url": "https://ecotaxa.obs-vlfr.fr/api/",
        "project_id": "9366",
        "x": 830,
        "y": 300,
        "wires": [
            [
                "c21f20a7a9902ee4"
            ]
        ]
    },
    {
        "id": "af1ec6323cc00231",
        "type": "inject",
        "z": "8555b76c53e789e0",
        "name": "Lancer import",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "0",
        "topic": "",
        "x": 310,
        "y": 300,
        "wires": [
            [
                "28f8eb0318735246"
            ]
        ]
    },
    {
        "id": "c21f20a7a9902ee4",
        "type": "debug",
        "z": "8555b76c53e789e0",
        "name": "Show import result",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1110,
        "y": 300,
        "wires": []
    },
    {
        "id": "28f8eb0318735246",
        "type": "function",
        "z": "8555b76c53e789e0",
        "name": "Set file_path",
        "func": "msg.payload = {}\nmsg.payload.file_path = \"/home/pi/data/export/ecotaxa/ecotaxa_A_2.zip\"\n\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 300,
        "wires": [
            [
                "64ae825a687fb054",
                "1457a0786f787415"
            ]
        ]
    },
    {
        "id": "1457a0786f787415",
        "type": "debug",
        "z": "8555b76c53e789e0",
        "name": "debug 9",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 820,
        "y": 200,
        "wires": []
    },
    {
        "id": "7ccb5c8c66ad170a",
        "type": "inject",
        "z": "a02961610bc3982a",
        "g": "153af3e4645145a8",
        "name": "inject",
        "props": [
            {
                "p": "payload.timezone",
                "v": "Europe/Paris",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 110,
        "y": 280,
        "wires": [
            [
                "89c198d4d49eca98"
            ]
        ]
    },
    {
        "id": "7bf0f35f3f491657",
        "type": "set timezone",
        "z": "a02961610bc3982a",
        "g": "153af3e4645145a8",
        "name": "",
        "x": 340,
        "y": 380,
        "wires": [
            [
                "2fe0de4d0d304630"
            ]
        ]
    },
    {
        "id": "89c198d4d49eca98",
        "type": "list timezones",
        "z": "a02961610bc3982a",
        "g": "153af3e4645145a8",
        "name": "",
        "x": 140,
        "y": 360,
        "wires": [
            [
                "7bf0f35f3f491657"
            ]
        ]
    },
    {
        "id": "2fe0de4d0d304630",
        "type": "get timezone",
        "z": "a02961610bc3982a",
        "g": "153af3e4645145a8",
        "name": "",
        "x": 540,
        "y": 400,
        "wires": [
            []
        ]
    },
    {
        "id": "abc662f31074fc22",
        "type": "inject",
        "z": "a02961610bc3982a",
        "g": "3bb20cd87e85a6b8",
        "name": "inject",
        "props": [
            {
                "p": "payload.country",
                "v": "FR",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 110,
        "y": 60,
        "wires": [
            [
                "d082d59bfaddcd80"
            ]
        ]
    },
    {
        "id": "d082d59bfaddcd80",
        "type": "list countries",
        "z": "a02961610bc3982a",
        "g": "3bb20cd87e85a6b8",
        "name": "",
        "x": 140,
        "y": 140,
        "wires": [
            [
                "9f5061a034f606a3"
            ]
        ]
    },
    {
        "id": "9f5061a034f606a3",
        "type": "set country",
        "z": "a02961610bc3982a",
        "g": "3bb20cd87e85a6b8",
        "name": "",
        "x": 330,
        "y": 160,
        "wires": [
            [
                "1f6f854383bffbc8"
            ]
        ]
    },
    {
        "id": "1f6f854383bffbc8",
        "type": "get country",
        "z": "a02961610bc3982a",
        "g": "3bb20cd87e85a6b8",
        "name": "",
        "x": 510,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "1433d7bb97c2b52e",
        "type": "inject",
        "z": "a02961610bc3982a",
        "g": "3fe3efd04fb1a41a",
        "name": "inject",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 110,
        "y": 700,
        "wires": [
            [
                "58b352badddb48f5"
            ]
        ]
    },
    {
        "id": "58b352badddb48f5",
        "type": "get hostname",
        "z": "a02961610bc3982a",
        "g": "3fe3efd04fb1a41a",
        "name": "",
        "x": 140,
        "y": 760,
        "wires": [
            []
        ]
    },
    {
        "id": "39cd9534b43ef484",
        "type": "get name",
        "z": "a02961610bc3982a",
        "g": "9c49d230dea06fdf",
        "name": "",
        "x": 130,
        "y": 920,
        "wires": [
            []
        ]
    },
    {
        "id": "79d35d7ad73f89f9",
        "type": "inject",
        "z": "a02961610bc3982a",
        "g": "9c49d230dea06fdf",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 110,
        "y": 860,
        "wires": [
            [
                "39cd9534b43ef484"
            ]
        ]
    },
    {
        "id": "959839bc2c390088",
        "type": "storage info",
        "z": "a02961610bc3982a",
        "g": "27e22d982f0bcb2f",
        "name": "",
        "x": 530,
        "y": 920,
        "wires": [
            []
        ]
    },
    {
        "id": "0d10e66bb2b9d1cc",
        "type": "inject",
        "z": "a02961610bc3982a",
        "g": "27e22d982f0bcb2f",
        "name": "inject",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 510,
        "y": 860,
        "wires": [
            [
                "959839bc2c390088"
            ]
        ]
    },
    {
        "id": "29b3163c363f83d7",
        "type": "list hardware versions",
        "z": "a02961610bc3982a",
        "g": "cef91df1f697848e",
        "name": "",
        "x": 170,
        "y": 560,
        "wires": [
            [
                "28f8ab1b6c179786"
            ]
        ]
    },
    {
        "id": "19da48e7c9119862",
        "type": "get hardware version",
        "z": "a02961610bc3982a",
        "g": "cef91df1f697848e",
        "name": "",
        "x": 660,
        "y": 600,
        "wires": [
            []
        ]
    },
    {
        "id": "28f8ab1b6c179786",
        "type": "set hardware version",
        "z": "a02961610bc3982a",
        "g": "cef91df1f697848e",
        "name": "",
        "x": 420,
        "y": 580,
        "wires": [
            [
                "19da48e7c9119862"
            ]
        ]
    },
    {
        "id": "4966524cdc764174",
        "type": "inject",
        "z": "a02961610bc3982a",
        "g": "cef91df1f697848e",
        "name": "inject",
        "props": [
            {
                "p": "payload.hardware_version",
                "v": "v3.0",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 110,
        "y": 500,
        "wires": [
            [
                "29b3163c363f83d7"
            ]
        ]
    },
    {
        "id": "0e1835e8b7c470ee",
        "type": "comment",
        "z": "a02961610bc3982a",
        "g": "3bb20cd87e85a6b8",
        "name": "country",
        "info": "",
        "x": 690,
        "y": 60,
        "wires": []
    },
    {
        "id": "bcdab829fb50bc57",
        "type": "comment",
        "z": "a02961610bc3982a",
        "g": "153af3e4645145a8",
        "name": "timezone",
        "info": "",
        "x": 740,
        "y": 280,
        "wires": []
    },
    {
        "id": "f640495d00bb68b9",
        "type": "comment",
        "z": "a02961610bc3982a",
        "g": "cef91df1f697848e",
        "name": "hardware version",
        "info": "",
        "x": 840,
        "y": 500,
        "wires": []
    },
    {
        "id": "1f1c86a14bf3ac61",
        "type": "comment",
        "z": "a02961610bc3982a",
        "g": "3fe3efd04fb1a41a",
        "name": "hostname",
        "info": "",
        "x": 300,
        "y": 700,
        "wires": []
    },
    {
        "id": "7e293f564d4fbfc4",
        "type": "comment",
        "z": "a02961610bc3982a",
        "g": "9c49d230dea06fdf",
        "name": "name",
        "info": "",
        "x": 310,
        "y": 860,
        "wires": []
    },
    {
        "id": "53516cda8e4f5a3c",
        "type": "comment",
        "z": "a02961610bc3982a",
        "g": "27e22d982f0bcb2f",
        "name": "storage",
        "info": "",
        "x": 690,
        "y": 860,
        "wires": []
    },
    {
        "id": "c34bff0e83b45e68",
        "type": "poweroff",
        "z": "a02961610bc3982a",
        "g": "fc6b573a63d6dfaa",
        "name": "",
        "x": 1180,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "dc07c747a235da10",
        "type": "reboot",
        "z": "a02961610bc3982a",
        "g": "fc6b573a63d6dfaa",
        "name": "",
        "x": 1180,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "f12fd63508bb1b63",
        "type": "inject",
        "z": "a02961610bc3982a",
        "g": "fc6b573a63d6dfaa",
        "name": "inject",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1030,
        "y": 140,
        "wires": [
            [
                "c34bff0e83b45e68"
            ]
        ]
    },
    {
        "id": "2babe27c1bf9d6ef",
        "type": "inject",
        "z": "a02961610bc3982a",
        "g": "fc6b573a63d6dfaa",
        "name": "inject",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1030,
        "y": 200,
        "wires": [
            [
                "dc07c747a235da10"
            ]
        ]
    },
    {
        "id": "15f16463c05bb479",
        "type": "comment",
        "z": "a02961610bc3982a",
        "g": "fc6b573a63d6dfaa",
        "name": "system ",
        "info": "",
        "x": 1200,
        "y": 80,
        "wires": []
    },
    {
        "id": "94a433cec8b54203",
        "type": "wake up",
        "z": "a02961610bc3982a",
        "g": "fc6b573a63d6dfaa",
        "name": "",
        "minutes": "2",
        "x": 1180,
        "y": 260,
        "wires": [
            []
        ]
    },
    {
        "id": "b552ca516cc07737",
        "type": "inject",
        "z": "a02961610bc3982a",
        "g": "fc6b573a63d6dfaa",
        "name": "inject",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1030,
        "y": 260,
        "wires": [
            [
                "94a433cec8b54203"
            ]
        ]
    },
    {
        "id": "61ebceb724041fb2",
        "type": "list acquisitions",
        "z": "a02961610bc3982a",
        "g": "dc792afbab434446",
        "name": "",
        "x": 1120,
        "y": 600,
        "wires": [
            []
        ]
    },
    {
        "id": "50128147f802f133",
        "type": "inject",
        "z": "a02961610bc3982a",
        "g": "dc792afbab434446",
        "name": "inject",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1090,
        "y": 540,
        "wires": [
            [
                "61ebceb724041fb2"
            ]
        ]
    },
    {
        "id": "b9c2e0abaad12bd9",
        "type": "comment",
        "z": "a02961610bc3982a",
        "g": "dc792afbab434446",
        "name": "acquisitions",
        "info": "",
        "x": 1310,
        "y": 540,
        "wires": []
    },
    {
        "id": "300343e6b56f088e",
        "type": "inject",
        "z": "a02961610bc3982a",
        "g": "dc307bb5d26c60f4",
        "name": "inject",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1090,
        "y": 700,
        "wires": [
            [
                "7d1f9414be49d7c3"
            ]
        ]
    },
    {
        "id": "da645aa8ebbed646",
        "type": "comment",
        "z": "a02961610bc3982a",
        "g": "dc307bb5d26c60f4",
        "name": "segmentations",
        "info": "",
        "x": 1300,
        "y": 700,
        "wires": []
    },
    {
        "id": "7d1f9414be49d7c3",
        "type": "list segmentations",
        "z": "a02961610bc3982a",
        "g": "dc307bb5d26c60f4",
        "name": "",
        "x": 1130,
        "y": 760,
        "wires": [
            []
        ]
    },
    {
        "id": "f7c18ab2aa687120",
        "type": "get machine info",
        "z": "a02961610bc3982a",
        "g": "855d9ef468b5db0f",
        "name": "",
        "x": 150,
        "y": 1080,
        "wires": [
            [
                "9249e16ed7ae4929"
            ]
        ]
    },
    {
        "id": "ede7a86fd97b5e1b",
        "type": "inject",
        "z": "a02961610bc3982a",
        "g": "855d9ef468b5db0f",
        "name": "inject",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 110,
        "y": 1020,
        "wires": [
            [
                "f7c18ab2aa687120"
            ]
        ]
    },
    {
        "id": "af8ce4702c170449",
        "type": "comment",
        "z": "a02961610bc3982a",
        "g": "855d9ef468b5db0f",
        "name": "machine info",
        "info": "",
        "x": 290,
        "y": 1020,
        "wires": []
    },
    {
        "id": "a98bde5f8940edbc",
        "type": "inject",
        "z": "a02961610bc3982a",
        "g": "91f8b76bf61fc59c",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1090,
        "y": 860,
        "wires": [
            [
                "59ec9623add53a47"
            ]
        ]
    },
    {
        "id": "59ec9623add53a47",
        "type": "capture",
        "z": "a02961610bc3982a",
        "g": "91f8b76bf61fc59c",
        "name": "",
        "x": 1100,
        "y": 920,
        "wires": [
            []
        ]
    },
    {
        "id": "750a1061c84bdae2",
        "type": "comment",
        "z": "a02961610bc3982a",
        "g": "91f8b76bf61fc59c",
        "name": "camera",
        "info": "",
        "x": 1330,
        "y": 860,
        "wires": []
    },
    {
        "id": "9249e16ed7ae4929",
        "type": "debug",
        "z": "a02961610bc3982a",
        "g": "855d9ef468b5db0f",
        "name": "debug 10",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 470,
        "y": 1100,
        "wires": []
    }
]